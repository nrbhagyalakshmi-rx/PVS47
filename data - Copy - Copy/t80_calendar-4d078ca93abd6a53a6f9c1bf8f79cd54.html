$(document).ready(function(){init_calendar("#calendar");focusFirst();$(".calendar").on("keypress","td.fc-day",function(a){13===a.keyCode&&$("#createEventModal").modal()});$("#actionItemModal").find(".datepicker").datepicker({allowPastDates:!0,momentConfig:{format:DEFAULT_DATE_DISPLAY_FORMAT}});$("#createActionItem").click(function(){actionItem.actionItemModal.init_action_item_modal(!0,PR_Calendar)});hideCalendarModal()});
var editAction=function(a){$.ajax({url:"/signal/action/getById?id="+a.id,async:!1,cache:!1}).done(function(b){b.action_types=action_select_values.types;b.action_configs=action_select_values.configs;b.all_status=action_select_values.allStatus;b.alertId=void 0;b.actionStatus={name:b.actionStatus};var c=signal.utils.render("action_editor",b);$("#action-editor-container").html(c);$("#action-editor-container #due-date-picker").datepicker({date:$("#due-date-picker").val()?new Date($("#due-date-picker").val()):
null,momentConfig:{culture:userLocale,format:DEFAULT_DATE_DISPLAY_FORMAT}});c=moment(b.dueDate,"DD-MMM-YYYY").format(DEFAULT_DATE_FORMAT);$("#action-editor-container").find("#due-date-picker").find("#dueDate").val(c);c=$("#action-edit-modal");"undefined"!=typeof alertId&&c.find(".id-element").attr("data-id",a.id);c.find("#appType").val(b.alertType);c.modal({});$("#action-edit-modal #cancel-bt").unbind().click(handle_action_editor_cancel);$("#action-edit-modal #update-bt").unbind().click(handle_action_editor_update)})},
editMeeting=function(a){var b=$("#meetingMinutesModal"),c="/signal/meeting/getById?meetingId="+a.id,d=a.id,e=$("#meetingModalForm");$.ajax({url:c,async:!1,cache:!1,dataType:"json"}).success(function(a){var c=$(".meetingMinutes");fillModalDataWithText(a,b,!1,"meeting-minutes");fillModalData(a,b,!1);disableFormFields(e);c.removeAttr("disabled");c.val(a.meetingMinutes);b.modal({})});$(".update-meeting").unbind().click(function(a){a=$("#meetingModalForm #appType").val();var c=$("#meetingModalForm #alertId").val();
a="/signal/meeting/saveMeetingMinutes?appType="+a+"&alertId="+c+"&meetingId="+d;var c=e.find("textarea.meetingMinutes").val(),h=new FormData;h.append("meetingMinutes",c);$.ajax({url:a,type:"POST",data:h,async:!1,processData:!1,contentType:!1,dataType:"json",cache:!1}).success(function(a){b.find(".form-control").val("");b.find("#attachments").val("");b.modal("hide");a="#"+signal.utils.localStorageUtil.getJSON("dashboardWidgetsConfig")["pvWidgetChart-6"].content.id;$(a).fullCalendar("destroy");init_calendar(a)})})},
fillModalDataWithText=function(a,b,c,d){var e=a.attendees;clearModal(b);for(var g=[],f=0;f<e.length;f++)g.push(e[f].id);e="";for(f=0;f<a.meetingAttachments.length;f++)e=e+"<div class='attachment-name'><a target='_blank' href='"+("/signal/meeting/viewAttachments?attachmentId="+a.meetingAttachments[f].id+"&meetingId="+a.id)+"' download='"+a.meetingAttachments[f].name+"' <i class='fa fa-file' aria-hidden='true' style='font-size: medium'> </i>"+a.meetingAttachments[f].name+"</a></div>";b.find(".attachments .attachment-body").html(e);
b.find(".id-element").attr("data-id",alertId);b.find(".meeting-id-element").attr("data-is-edit-series",c);c?(b.find(".meeting-id-element").attr("data-master-id",a.masterId),$("#cancelMeetingLink").hide(),$("#cancelMeetingSeriesLink").show(),b.find(".recurrence-checkbox-container").show(),$("#edit-meeting-title-container").text("Edit Series"),$(".isRecurringMeeting").attr("checked","checked"),$(".meetingDate").attr("disabled","disabled"),$(".meetingTime").attr("disabled","disabled"),$(".schedular-container").collapse("show")):
(b.find(".meeting-id-element").attr("data-meeting-id",a.id),$("#cancelMeetingLink").show(),$("#cancelMeetingSeriesLink").hide(),b.find(".recurrence-checkbox-container").hide(),$("#edit-meeting-title-container").text("Edit Meeting"),$(".isRecurringMeeting").removeAttr("checked"),$(".meetingDate").removeAttr("disabled"),$(".meetingTime").removeAttr("disabled"),$(".schedular-container").collapse("hide"));b.find("#meetingTitle").val(a.meetingTitle);b.find("#meetingOwner").val(a.ownerId);b.find("#meetingDate").val(moment(a.meetingDate).format("MM/DD/YYYY"));
b.find("#meetingTime").val(moment(a.meetingDate).format("HH:mm"));b.find("#due-date-picker").datepicker();b.find("#meetingAgenda").val(a.meetingAgenda);a.guestAttendees&&$.each(a.guestAttendees,function(a,c){b.find("#meetingAttendees-"+d).append("<option value='"+c+"'>"+c+"</option>");g.push(c)});b.find("#meetingAttendees-"+d).val("");b.find("#meetingAttendees-"+d).find("option.guestAttendee").remove();b.find("#meetingAttendees-"+d).val(g);showTagWidget("#meetingAttendees-"+d);b.find("#duration").val(a.duration)},
fillModalData=function(a,b,c){fillModalDataWithText(a,b,c,"edit")};function disableFormFields(a){a.find("input").attr("disabled",!0);a.find("select").attr("disabled",!0);a.find("textarea").attr("disabled",!0);a.find(".searchMeetingTimes").addClass("disabled")}function clearModal(a){a.find("input[type=text]").val("");a.find("textarea").val("")}
function showTagWidget(a){$(a).select2({placeholder:"Select Attendees",allowClear:!0,width:"100%",createTag:function(b){b=$.trim(b.term);return""!=b?{id:b,text:b}:null}})}
var init_calendar=function(a){$(a).fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},firstDay:1,eventLimit:!0,dayClick:function(b,a,d){b=moment(b).format(DEFAULT_DATE_DISPLAY_FORMAT);$("#dueDateHidden").val(b);$("#createEventModal #modalTitle").text("Add Events ( "+b+" )");$("#createEventModal").modal()},eventClick:function(b,a,d){switch(b.eventType){case "AGGREGATE_CASE_ALERT":window.open("/signal/aggregateCaseAlert/view?id="+b.id,"_blank");break;case "SINGLE_CASE_ALERT":window.open("/signal/singleCaseAlert/view?id="+
b.id,"_blank");break;case "ACTION_ITEM":editAction(b);break;case "MEETING":editMeeting(b)}},eventMouseover:function(b,a,d){$(this).css({"border-color":"#ba3939","border-width":"1px","border-style":"dashed"})},eventMouseout:function(b,a,d){$(this).css({"border-color":"#cccccc","border-width":"1px","border-style":"solid"})},events:function(b,a,d,e){jQuery.ajax({url:eventsUrl,type:"POST",dataType:"json",data:{start:b.format(DEFAULT_DATE_DISPLAY_FORMAT),end:a.format(DEFAULT_DATE_DISPLAY_FORMAT)},success:function(a){var b=
[];a&&$.map(a,function(a){b.push({id:a.id,title:a.title,start:moment.utc(a.startDate).tz(userTimeZone),end:a.endDate?moment.utc(a.endDate).tz(userTimeZone):void 0,url:getEventUrl(a.eventType,a.id),allDay:"MEETING"===a.eventType?a.allDay:!0,color:a.color,textColor:a.textColor,eventType:a.eventType})});e(b)}})},loading:function(a,c){a?$(".alert-info").removeClass("hide"):$(".alert-info").addClass("hide")}})};
function bindActionItemCRUD(a){$("#actionItemModal").find("#deleteActionItem").removeClass("hide");actionItem.actionItemModal.view_action_item(a);$(".action-item-delete").on("click",function(){actionItem.actionItemModal.delete_action_item(a,!0,PR_Calendar)});$(".edit-action-item").on("click",function(){actionItem.actionItemModal.edit_action_item(a,!0,null,null)});$(".update-action-item").on("click",function(){actionItem.actionItemModal.update_action_item(!0,$("#actionItemModal"),PR_Calendar)})}
function reloadCalendar(a,b){var c;c=$('<span title="Refresh Calender" class="glyphicon calendar-reloader-btn glyphicon-refresh"></span>');a.prepend(c);void 0!=b&&$(".calendar-reloader-btn").click(function(){$(".calendar-reloader-btn").addClass("glyphicon-refresh-animate");$(b).fullCalendar("refetchEvents")})}function hideCalendarModal(){$(".prModalHide").on("click",function(){$("#createEventModal").modal("hide")})}
function getEventUrl(a,b){if(a==EVENTS_TYPE_CONSTANTS.REPORT_REQUEST)return reportRequestShowURL+"/"+b;if(a==EVENTS_TYPE_CONSTANTS.EXECUTED_PERIODIC_REPORT)return executedPeriodicReportShowURL+"/"+b;if(a==EVENTS_TYPE_CONSTANTS.EXECUTED_ADHOC_REPORT)return executedAdhocReportShowURL+"/"+b;if(a==EVENTS_TYPE_CONSTANTS.SCHEDULED_ADHOC_REPORT)return adhocReportShowURL+"/"+b;if(a==EVENTS_TYPE_CONSTANTS.SCHEDULED_PERIODIC_REPORT)return periodicReportShowURL+"/"+b}
var EVENTS_TYPE_CONSTANTS={EXECUTED_ADHOC_REPORT:"EXECUTED_ADHOC_REPORT",SCHEDULED_ADHOC_REPORT:"SCHEDULED_ADHOC_REPORT",EXECUTED_PERIODIC_REPORT:"EXECUTED_PERIODIC_REPORT",SCHEDULED_PERIODIC_REPORT:"SCHEDULED_PERIODIC_REPORT",REPORT_REQUEST:"REPORT_REQUEST",ACTION_ITEM:"ACTION_ITEM"};