$(document).ready(function(){signal.utils.localStorageUtil.setProp("dashboardWidgetsConfig",dashboardWidgetConfigJSON);$(window).on("beforeunload",function(){persistDashboardWidgetConfig()});$(".grid-stack").gridstack({width:12,verticalMargin:10,disableResize:!0});$(".grid-stack").on("change",function(a,b){refreshDashboardConfigJSON();if(b)for(a=0;a<b.length;a++){var c=$(b[a].el).find(".chart-container").first();c.length&&"undefined"!=typeof c.highcharts()&&null!=c.highcharts()&&c.highcharts().setSize(c.innerWidth(),
c.innerHeight())}});$(".grid-stack").on("resizestop",function(a,b){resizeWidgetContents(b)});populateDashboardWidgets();populateClosedWidgetsMenu();$(".close-widget").on("click",closeWidget);$(".refresh-widget").on("click",refreshWidget);$(document).on("click",".pv-widget-list-item",function(){var a=$(this).closest(".panel"),b=$(this).data("target-widget");$(this).addClass("list-hide");setTimeout(function(){$(".list-hide").remove();isWidgetAvailable(a);isWidgetSelectorMenuAvailable();var c=signal.utils.localStorageUtil.getJSON("dashboardWidgetsConfig");
c[b].visible=!0;signal.utils.localStorageUtil.setJSON("dashboardWidgetsConfig",c);addWidget(c[b],!0)},500)})});var persistDashboardWidgetConfig=function(){var a=signal.utils.localStorageUtil.getJSON("dashboardWidgetsConfig");a.isDirty&&$.ajax({type:"POST",url:"/signal/dashboard/saveDashboardConfig",data:{dashboardWidgetsConfig:signal.utils.localStorageUtil.getProp("dashboardWidgetsConfig")},success:function(b){b?(a.isDirty=!1,signal.utils.localStorageUtil.setJSON("dashboardWidgetsConfig",a)):persistDashboardWidgetConfig()}})};
function refreshDashboardConfigJSON(){var a=signal.utils.localStorageUtil.getJSON("dashboardWidgetsConfig");$.each(a,function(a,c){"Inbox"!==c.reportWidgetName&&(c.visible=!1)});$("#mainDashboard").children().each(function(){var b={visible:!0,reportWidgetDetails:{},content:{}};b.reportWidgetName=$(this).find("h3.panel-title").first().html();b.reportWidgetDetails.id=$(this).attr("id");b.reportWidgetDetails.x=parseInt($(this).attr("data-gs-x"));b.reportWidgetDetails.y=parseInt($(this).attr("data-gs-y"));
b.reportWidgetDetails.height=parseInt($(this).attr("data-gs-height"));b.reportWidgetDetails.width=parseInt($(this).attr("data-gs-width"));var c=$(this).find("div.panel-body div:first-child :first-child"),d=$(c).data("type"),c="pvDashReports"===d?$(c).attr("data-id"):$(c).attr("id");b.content.id=c;b.content.type=d;a[b.reportWidgetDetails.id]=b});a.isDirty=!0;signal.utils.localStorageUtil.setJSON("dashboardWidgetsConfig",a)}
function updateDashboardWidgetConfigForInbox(){var a=signal.utils.localStorageUtil.getJSON("dashboardWidgetsConfig");a.inbox.visible=$("#inbox").is(":visible");signal.utils.localStorageUtil.setJSON("dashboardWidgetsConfig",a)}
function resizeWidgetContents(a){var b=$(a.element[0]);a=$(b).find("div.panel-body").height();var c=$(b).find("div.panel-body").width();switch($(b).data("type")){case "pvDashChart":$(b).find("div.chart-container").parent().height(a-.08*a);$(b).find("div.chart-container").height(a-.08*a);(b=$("#"+$(b).find("div.chart-container").attr("id")).highcharts())&&b.setSize(c,a-.1*a,setAnimation=!0);break;case "pvDashCalendar":$(b).find("div.calendar").width(c-.075*c);$(b).find("div.fc-scroller.fc-day-grid-container").height(a-
.4*a);break;case "pvDashReports":$(b).find("table").width("100%")}}
function resizeWidgetContentsAfterInitialization(a){var b=$(a);a=$(b).find("div.panel-body").height();var c=$(b).find("div.panel-body").width();switch($(b).data("type")){case "pvDashChart":$(b).find("div.chart-container").parent().height(a-.08*a);$(b).find("div.chart-container").height(a-.08*a);(b=$("#"+$(b).find("div.chart-container").attr("id")).highcharts())&&b.setSize(c,a-.1*a,setAnimation=!0);break;case "pvDashCalendar":$(b).find("div.calendar").width(c-.075*c);console.log($(b).find("div.fc-scroller.fc-day-grid-container"));
$(b).find("div.fc-scroller.fc-day-grid-container").height(a-.2*a);break;case "pvDashReports":$(b).find("table").width("100%")}}
function addWidget(a,b){var c=$(".grid-stack").data("gridstack"),d=signal.utils.render("dashboard_widget",{reportWidgetId:a.reportWidgetDetails.id,reportWidgetName:a.reportWidgetName,content:a.content});b?(c.addWidget($(d),null,null,a.reportWidgetDetails.width,a.reportWidgetDetails.height,b),$(".close-widget").off("click").on("click",closeWidget),$(".refresh-widget").off("click").on("click",refreshWidget),init_triggered_alert_table(),loadTableOption("#assignedTriggeredAlerts"),init_assigned_signal_table(),
init_assigned_topic_table(),init_action_list_table()):c.addWidget($(d),a.reportWidgetDetails.x,a.reportWidgetDetails.y,a.reportWidgetDetails.width,a.reportWidgetDetails.height,b);a=$("#"+a.reportWidgetDetails.id);"pvDashReports"!=$(a).closest(".pv-dashWidget").data("type")&&$(a).find(".refresh-widget").trigger("click")}
var populateDashboardWidgets=function(){var a=signal.utils.localStorageUtil.getJSON("dashboardWidgetsConfig"),b=$(".grid-stack").data("gridstack");b.batchUpdate();$.each(a,function(a,b){"Inbox"===b.reportWidgetName?b.visible?$("#inbox").show():$(".pv-dash-inbox-icon").removeClass("hide"):b.visible&&addWidget(b,!1)});b.commit();triggerResizeForAll()},triggerResizeForAll=function(){var a=signal.utils.localStorageUtil.getJSON("dashboardWidgetsConfig");$.each(a,function(a,c){c.visible&&resizeWidgetContentsAfterInitialization($("#"+
c.reportWidgetDetails.id))})},populateClosedWidgetsMenu=function(){var a=signal.utils.localStorageUtil.getJSON("dashboardWidgetsConfig"),b;for(b in a)!1===a[b].visible&&"Inbox"!==a[b].reportWidgetName&&addWidgetOptionInSideMenu(a[b].content.type,a[b].reportWidgetDetails.id,a[b].reportWidgetName)},refreshWidget=function(){var a=$(this).closest(".pv-dashWidget").data("type"),b=$(this).closest(".pv-dashWidget").attr("id"),c="#"+signal.utils.localStorageUtil.getJSON("dashboardWidgetsConfig")[b].content.id;
switch(a){case "pvDashChart":refreshPvDashChart(b,c);break;case "pvDashReports":$(c).DataTable().ajax.reload();break;case "pvDashCalendar":$(c).fullCalendar("destroy"),init_calendar(c)}},refreshPvDashChart=function(a,b){switch(b){case "#qualitative-products-status":build_product_by_status(b,"Single Case Alert");break;case "#quantitative-products-status":build_product_by_status(b,"Aggregate Case Alert");break;case "#case-status-chart":build_sca_by_status(b,"case-status-chart");break;case "#aggregate-chart":build_agg_by_status(b,
"aggregate-chart");break;case "#adhoc-chart":build_aha_by_status(b,"adhoc-chart");break;case "#due-date-chart":build_alert_by_duedate(b)}},closeWidget=function(){var a=$(this).closest(".panel"),b=a.parent(),c=b.attr("id"),d=b.data("type"),a=a.find("h3.panel-title").text();$(".grid-stack").data("gridstack").removeWidget(b);b=signal.utils.localStorageUtil.getJSON("dashboardWidgetsConfig");b[c].visible=!1;signal.utils.localStorageUtil.setJSON("dashboardWidgetsConfig",b);addWidgetOptionInSideMenu(d,c,
a)};function isWidgetAvailable(a){1>$(a).find(".pv-widget-list-item").length?$(a).addClass("hide"):$(a).removeClass("hide")}function isWidgetSelectorMenuAvailable(){var a=$("#pvi-dash-topMinWidget a");3===$("#accordionDashConfig div.panel.panel-default.hide").size()?($(a).click(),$(a).hide()):$(a).show()}
var addWidgetOptionInSideMenu=function(a,b,c){$("#"+a+" .list-group").append('<li class="list-group-item pv-widget-list-item" data-target-widget="'+b+'">'+c+"</li>");isWidgetAvailable("div#"+a+".panel");isWidgetSelectorMenuAvailable()};