<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="146">
  <HTTPTask id="818" hostname="10.100.22.24:8181" path="/signal/assets/app/pvs/alerts_review/single_case_alert_details-50076305d9a840e6a3de6bf721a5516a.js" url="http://10.100.22.24:8181/signal/assets/app/pvs/alerts_review/single_case_alert_details-50076305d9a840e6a3de6bf721a5516a.js" ip="10.100.22.24" port="8181" connectionId="32" origin="Primary" frame="1" startDateTime="2020-05-22T11:19:01.282+05:30" startTime="89389875" endTime="89394109">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Host" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MTAuMTAwLjIyLjI0OjgxODE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzgxLjAuNDA0NC4xMzggU2FmYXJpLzUzNy4zNg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cDovLzEwLjEwMC4yMi4yNDo4MTgxL3NpZ25hbC9zaW5nbGVDYXNlQWxlcnQvZGV0YWlscz9jYWxsaW5nU2NyZWVuPXJldmlldyZjb25maWdJZD0xNQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW4tVVMsZW47cT0wLjk=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>U0VTU0lPTj04ZmE2YTc5MS0zOTFlLTRkNDItYjAzNi0xYzUwNjdhYzZkOGU=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9zaWduYWwvYXNzZXRzL2FwcC9wdnMvYWxlcnRzX3Jldmlldy9zaW5nbGVfY2FzZV9hbGVydF9kZXRhaWxzLTUwMDc2MzA1ZDlhODQwZTZhM2RlNmJmNzIxYTU1MTZhLmpzIEhUVFAvMS4xDQpIb3N0OiAxMC4xMDAuMjIuMjQ6ODE4MQ0KQ29ubmVjdGlvbjoga2VlcC1hbGl2ZQ0KVXNlci1BZ2VudDogTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzgxLjAuNDA0NC4xMzggU2FmYXJpLzUzNy4zNg0KQWNjZXB0OiAqLyoNClJlZmVyZXI6IGh0dHA6Ly8xMC4xMDAuMjIuMjQ6ODE4MS9zaWduYWwvc2luZ2xlQ2FzZUFsZXJ0L2RldGFpbHM/Y2FsbGluZ1NjcmVlbj1yZXZpZXcmY29uZmlnSWQ9MTUNCkFjY2VwdC1FbmNvZGluZzogZ3ppcCwgZGVmbGF0ZQ0KQWNjZXB0LUxhbmd1YWdlOiBlbi1VUyxlbjtxPTAuOQ0KQ29va2llOiBTRVNTSU9OPThmYTZhNzkxLTM5MWUtNGQ0Mi1iMDM2LTFjNTA2N2FjNmQ4ZQ0KDQo=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="SESSION" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>OGZhNmE3OTEtMzkxZS00ZDQyLWIwMzYtMWM1MDY3YWM2ZDhl</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <contentLenght>39730</contentLenght>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Last-Modified" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>VGh1LCAyMSBNYXkgMjAyMCAwODoxODowMCBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ImFwcC9wdnMvYWxlcnRzX3Jldmlldy9zaW5nbGVfY2FzZV9hbGVydF9kZXRhaWxzLTUwMDc2MzA1ZDlhODQwZTZhM2RlNmJmNzIxYTU1MTZhLmpzIg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cache-Control" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>cHVibGljLCBtYXgtYWdlPTMxNTM2MDAw</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YXBwbGljYXRpb24vamF2YXNjcmlwdDtjaGFyc2V0PVVURi04</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Length" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Mzk3MzA=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>RnJpLCAyMiBNYXkgMjAyMCAwNTo0MDoxNiBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIA0KTGFzdC1Nb2RpZmllZDogVGh1LCAyMSBNYXkgMjAyMCAwODoxODowMCBHTVQNCkVUYWc6ICJhcHAvcHZzL2FsZXJ0c19yZXZpZXcvc2luZ2xlX2Nhc2VfYWxlcnRfZGV0YWlscy01MDA3NjMwNWQ5YTg0MGU2YTNkZTZiZjcyMWE1NTE2YS5qcyINClZhcnk6IEFjY2VwdC1FbmNvZGluZw0KQ2FjaGUtQ29udHJvbDogcHVibGljLCBtYXgtYWdlPTMxNTM2MDAwDQpDb250ZW50LUVuY29kaW5nOiBnemlwDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQ7Y2hhcnNldD1VVEYtOA0KQ29udGVudC1MZW5ndGg6IDM5NzMwDQpEYXRlOiBGcmksIDIyIE1heSAyMDIwIDA1OjQwOjE2IEdNVA0KDQo=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>dmFyIHNpZ25hbCA9IHNpZ25hbCB8fCB7fTsKCi8vIGEgY29udmVuaWVuY2UgZnVuY3Rpb24gZm9yIHBhcnNpbmcgc3RyaW5nIG5hbWVzcGFjZXMgYW5kCi8vIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGluZyBuZXN0ZWQgbmFtZXNwYWNlcwpmdW5jdGlvbiBleHRlbmQoIG5zLCBuc19zdHJpbmcgKSB7CiAgICB2YXIgcGFydHMgPSBuc19zdHJpbmcuc3BsaXQoJy4nKSwKICAgICAgICBwYXJlbnQgPSBucywKICAgICAgICBwbCwgaTsKICAgIGlmIChwYXJ0c1swXSA9PSAic2lnbmFsIikgewogICAgICAgIHBhcnRzID0gcGFydHMuc2xpY2UoMSk7CiAgICB9CiAgICBwbCA9IHBhcnRzLmxlbmd0aDsKICAgIGZvciAoaSA9IDA7IGkgPCBwbDsgaSsrKSB7CiAgICAgICAgLy9jcmVhdGUgYSBwcm9wZXJ0eSBpZiBpdCBkb2VzbnQgZXhpc3QKICAgICAgICBpZiAodHlwZW9mIHBhcmVudFtwYXJ0c1tpXV0gPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgcGFyZW50W3BhcnRzW2ldXSA9IHt9OwogICAgICAgIH0KICAgICAgICBwYXJlbnQgPSBwYXJlbnRbcGFydHNbaV1dOwogICAgfQogICAgcmV0dXJuIHBhcmVudDsKfQoKLy9Qcm90b3R5cGUgbWV0aG9kcwpEYXRlLnByb3RvdHlwZS5hZGREYXlzID0gZnVuY3Rpb24oZGF5cykgewogICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSk7CiAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgKyBkYXlzKTsKICAgIHJldHVybiBkYXRlOwp9OwoKQXJyYXkucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgcmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uKGYpe2YgIT0gdmFsdWV9KTsKfTsKClNDQV9XT1JLRkxPV19TVEFUVVNfRU5VTSA9IHsgTkVXOiAnTmV3JywKICAgIEFTU09DSUFURV9SRVZJRVdFRDogJ0Fzc29jaWF0ZVJldmlld2VkJywKICAgIFBIWVNJQ0lBTl9SRVZJRVdFRDogJ1BoeXNpY2lhblJldmlld2VkJywKICAgIFJFUVVJUkVEX0VWQUxVQVRJT046ICdSZXF1aXJlZEV2YWx1YXRpb24nLAogICAgQ09OVElOVUVEX01PTklUT1JJTkc6ICdDb250aW51ZWRNb25pdG9yaW5nJwp9OwoKU0NBX0RJU1BPU0lUSU9OX0VOVU0gPSB7CiAgICBWQUxJREFURURfU0lHTkFMIDogJ1ZhbGlkYXRlZFNpZ25hbCcsCiAgICBWQUxJREFURURfTk9OX0NPTkZJUk1FRF9TSUdOQUwgOiAnVmFsaWRhdGVkTm9uQ29uZmlybWVkU2lnbmFsJywKICAgIFZBTElEQVRFRF9VTkRFUl9JTlZFU1RJR0FUSU9OIDogJ1ZhbGlkYXRlZFVuZGVySW52ZXN0aWdhdGlvbicsCiAgICBDT01NVU5JQ0FURURfU0lHTkFMIDogJ0NvbW11bmljYXRlZFNpZ25hbCcsCiAgICBOT05fVkFMSUQ6ICdOb25WYWxpZCcKfTsKClNDQV9QUklPUklUWV9FTlVNID0gewogICAgSElHSDogIkhpZ2giLAogICAgTUVESVVNOiAiTWVkaXVtIiwKICAgIExPVzogIkxPVyIKfTsKCkRBVEVfRk1UX1RaID0gIllZWVktTU0tREQiOwoKc2lnbmFsLnV0aWxzID0gKGZ1bmN0aW9uKCkgewoKICAgIHZhciBzdGFja2VkID0gZnVuY3Rpb24odG9wVmFsdWUsIGJvdHRvbVZhbHVlKSB7CiAgICAgICAgdmFyIHRvcENvbXAgPSAiIjsKICAgICAgICB2YXIgYm90dG9tQ29tcCA9ICIiOwoKICAgICAgICBpZihfLmlzRnVuY3Rpb24odG9wVmFsdWUpKSB7CiAgICAgICAgICAgIHRvcENvbXAgPSB0b3BWYWx1ZSgpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdG9wQ29tcCA9ICc8ZGl2IGNsYXNzPSJzdGFja2VkLWNlbGwtY2VudGVyLXRvcCI+JyArIHRvcFZhbHVlICsgJzwvZGl2PicKICAgICAgICB9CgogICAgICAgIGlmIChfLmlzRnVuY3Rpb24oYm90dG9tVmFsdWUpKSB7CiAgICAgICAgICAgIGJvdHRvbUNvbXAgPSBib3R0b21WYWx1ZSgpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYm90dG9tQ29tcCA9ICc8ZGl2IGNsYXNzPSJzdGFja2VkLWNlbGwtY2VudGVyLWJvdHRvbSI+JyArIGJvdHRvbVZhbHVlICsgJzwvZGl2PicKICAgICAgICB9CgogICAgICAgIHJldHVybiB0b3BDb21wICsgYm90dG9tQ29tcAogICAgfTsKCiAgICAvLyBBbmQgdGhpcyBpcyB0aGUgZGVmaW5pdGlvbiBvZiB0aGUgY3VzdG9tIGZ1bmN0aW9uIOKAiwogICAgdmFyIHJlbmRlciA9IGZ1bmN0aW9uKHRtcGxfbmFtZSwgdG1wbF9kYXRhKSB7CgogICAgICAgIGlmICggIXJlbmRlci50bXBsX2NhY2hlICkgewoKCgogICAgICAgICAgICByZW5kZXIudG1wbF9jYWNoZSA9IHt9OwogICAgICAgIH0KICAgICAgICBpZiAoIXJlbmRlci50bXBsX2NhY2hlW3RtcGxfbmFtZV0pIHsKICAgICAgICAgICAgdmFyIHRtcGxfZGlyID0gJy9zaWduYWwvYXNzZXRzL2FwcC9wdnMvaGJzLXRlbXBsYXRlcyc7CiAgICAgICAgICAgIHZhciB0bXBsX3VybCA9IHRtcGxfZGlyICsgJy8nICsgdG1wbF9uYW1lICsgJy5oYnMnOwoKICAgICAgICAgICAgdmFyIHRtcGxfc3RyaW5nID0gIiI7CiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6IHRtcGxfdXJsLAogICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJywKICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICB0bXBsX3N0cmluZyA9IGRhdGEKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZW5kZXIudG1wbF9jYWNoZVt0bXBsX25hbWVdID0gSGFuZGxlYmFycy5jb21waWxlKHRtcGxfc3RyaW5nKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZW5kZXIudG1wbF9jYWNoZVt0bXBsX25hbWVdKHRtcGxfZGF0YSkKICAgIH07CgogICAgdmFyIGhic19wYXJ0aWFsID0gZnVuY3Rpb24odG1wbF9uYW1lKSB7CiAgICAgICAgaWYgKCFoYnNfcGFydGlhbC50bXBsX2NhY2hlKSB7CiAgICAgICAgICAgIGhic19wYXJ0aWFsLnRtcGxfY2FjaGUgPSB7fQogICAgICAgIH0KCiAgICAgICAgaWYgKCFoYnNfcGFydGlhbC50bXBsX2NhY2hlW3RtcGxfbmFtZV0pIHsKICAgICAgICAgICAgIHZhciB0bXBsX2RpciA9ICcvc2lnbmFsL2Fzc2V0cy9hcHAvcHZzL2hicy10ZW1wbGF0ZXMnOwogICAgICAgICAgICB2YXIgdG1wbF91cmwgPSB0bXBsX2RpciArICcvJyArIHRtcGxfbmFtZSArICcuaGJzJzsKCiAgICAgICAgICAgIHZhciB0bXBsX3N0cmluZyA9ICIiOwogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgdXJsOiB0bXBsX3VybCwKICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgdG1wbF9zdHJpbmcgPSBkYXRhCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaGJzX3BhcnRpYWwudG1wbF9jYWNoZVt0bXBsX25hbWVdID0gdG1wbF9zdHJpbmcKICAgICAgICB9CgogICAgICAgIHJldHVybiBoYnNfcGFydGlhbC50bXBsX2NhY2hlW3RtcGxfbmFtZV0KICAgIH07CgogICAgdmFyIGNvbXBvc2VVcmwgPSBmdW5jdGlvbihjb250cm9sbGVyLCBhY3Rpb24sIHBhcmFtcykgewogICAgICAgIHZhciB1cmwgPSAiL3NpZ25hbC8iICsgY29udHJvbGxlciArICIvIiArIGFjdGlvbiArIChfLmlzTnVsbChwYXJhbXMpID8gJycgOiAnPycgKyBjb21wb3NlUGFyYW1zKHBhcmFtcykpOwoKICAgICAgICByZXR1cm4gdXJsCiAgICB9OwoKICAgIC8vVE9ETyA6IE5lZWQgdG8gY2hhbmdlIHRoaXMgdG8gaGFuZGxlYmFyIGZvcm0sIFdpbGwgYmUgZG9uZSBsYXRlcgogICAgdmFyIHBvc3RVcmwgPSBmdW5jdGlvbiAocGF0aCwgcGFyYW1zLCBuZXdXaW5kb3cpIHsKCiAgICAgICAgY29uc3QgZm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zvcm0nKTsKICAgICAgICBmb3JtLm1ldGhvZCA9ICJwb3N0IjsKICAgICAgICBmb3JtLmFjdGlvbiA9IHBhdGg7CiAgICAgICAgZm9ybS5lbmN0eXBlID0gImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCI7CiAgICAgICAgaWYgKG5ld1dpbmRvdykgZm9ybS50YXJnZXQgPSAiX2JsYW5rIjsKCiAgICAgICAgdmFyIHRva2VuID0gJCgibWV0YVtuYW1lPSdfY3NyZiddIikuYXR0cigiY29udGVudCIpOwogICAgICAgIHZhciBwYXJhbWV0ZXIgPSAkKCJtZXRhW25hbWU9J19jc3JmX3BhcmFtZXRlciddIikuYXR0cigiY29udGVudCIpOwogICAgICAgIHBhcmFtc1twYXJhbWV0ZXJdID0gdG9rZW47CiAgICAgICAgZm9yIChsZXQga2V5IGluIHBhcmFtcykgewogICAgICAgICAgICBpZiAocGFyYW1zLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGhpZGRlbkZpZWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgICAgICAgICAgICAgIGhpZGRlbkZpZWxkLnR5cGUgPSAnaGlkZGVuJzsKICAgICAgICAgICAgICAgIGhpZGRlbkZpZWxkLm5hbWUgPSBrZXk7CiAgICAgICAgICAgICAgICBoaWRkZW5GaWVsZC52YWx1ZSA9IHBhcmFtc1trZXldOwogICAgICAgICAgICAgICAgZm9ybS5hcHBlbmRDaGlsZChoaWRkZW5GaWVsZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChmb3JtKTsKICAgICAgICBmb3JtLnN1Ym1pdCgpOwogICAgfQoKICAgIHZhciBjb21wb3NlUGFyYW1zID0gZnVuY3Rpb24obykgewogICAgICAgIHJldHVybiBfLm1hcChfLnBhaXJzKG8pLCBmdW5jdGlvbihwKXtyZXR1cm4gcC5qb2luKCc9Jyl9ICkuam9pbignJicpCiAgICB9OwoKICAgIHZhciBjYXBpdGFsSXQgPSBmdW5jdGlvbihzKSB7CiAgICAgICAgcmV0dXJuIHMgJiYgc1swXS50b1VwcGVyQ2FzZSgpICsgcy5zbGljZSgxKTsKICAgIH07CgogICAgdmFyIGJyZWFrSXQgPSBmdW5jdGlvbihzKSB7CiAgICAgICAgcmV0dXJuIHMgPyBzLnNwbGl0KC8oPz1bQS1aXSkvKS5qb2luKCcgJykgOiBzCiAgICB9OwoKICAgIHZhciBlbmFibGVfbG9hZF9idXR0b24gPSBmdW5jdGlvbihlbGUsIGVuYWJsZWQpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgICAgIHZhciB0YXJnZXRFbGUgPSBlbGUuZmluZCgnLmdseXBoaWNvbicpOwogICAgICAgICAgICBpZiAoZW5hYmxlZCkgewogICAgICAgICAgICAgICAgJCh0YXJnZXRFbGUpLmFkZENsYXNzKCdyZWZyZXNoLWFuaW1hdGUnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICQodGFyZ2V0RWxlKS5yZW1vdmVDbGFzcygncmVmcmVzaC1hbmltYXRlJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHNldEluTG9jYWxTdG9yYWdlID0gZnVuY3Rpb24ocHJvcCwgZGF0YSkgewogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHByb3AsIGRhdGEpOwogICAgfTsKCiAgICB2YXIgZ2V0RnJvbUxvY2FsU3RvcmFnZSA9IGZ1bmN0aW9uKHByb3ApIHsKICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0ocHJvcCk7CiAgICB9OwoKICAgIHZhciBzZXRKU09OSW5Mb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbihwcm9wLCBkYXRhKSB7CiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0ocHJvcCwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgfTsKCiAgICB2YXIgZ2V0SlNPTkZyb21Mb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbiAocHJvcCkgewogICAgICAgIHJldHVybiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHByb3ApKTsKICAgIH07CgogICAgdmFyIGxvY2FsU3RvcmFnZVV0aWwgPSB7CiAgICAgICAgc2V0UHJvcCA6IHNldEluTG9jYWxTdG9yYWdlLAogICAgICAgIGdldFByb3AgOiBnZXRGcm9tTG9jYWxTdG9yYWdlLAogICAgICAgIHNldEpTT04gOiBzZXRKU09OSW5Mb2NhbFN0b3JhZ2UsCiAgICAgICAgZ2V0SlNPTiA6IGdldEpTT05Gcm9tTG9jYWxTdG9yYWdlCiAgICB9OwoKICAgIHZhciBnZXRRdWVyeVN0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBrZXkgPSBmYWxzZSwgcmVzID0ge30sIGl0bSA9IG51bGw7CiAgICAgICAgLy8gZ2V0IHRoZSBxdWVyeSBzdHJpbmcgd2l0aG91dCB0aGUgPwogICAgICAgIHZhciBxcyA9IGxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSk7CiAgICAgICAgLy8gY2hlY2sgZm9yIHRoZSBrZXkgYXMgYW4gYXJndW1lbnQKICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdLmxlbmd0aCA+IDEpCiAgICAgICAgICAgIGtleSA9IGFyZ3VtZW50c1swXTsKICAgICAgICAvLyBtYWtlIGEgcmVnZXggcGF0dGVybiB0byBncmFiIGtleS92YWx1ZQogICAgICAgIHZhciBwYXR0ZXJuID0gLyhbXiY9XSspPShbXiZdKikvZzsKICAgICAgICAvLyBsb29wIHRoZSBpdGVtcyBpbiB0aGUgcXVlcnkgc3RyaW5nLCBlaXRoZXIKICAgICAgICAvLyBmaW5kIGEgbWF0Y2ggdG8gdGhlIGFyZ3VtZW50LCBvciBidWlsZCBhbiBvYmplY3QKICAgICAgICAvLyB3aXRoIGtleS92YWx1ZSBwYWlycwogICAgICAgIHdoaWxlIChpdG0gPSBwYXR0ZXJuLmV4ZWMocXMpKSB7CiAgICAgICAgICAgIGlmIChrZXkgIT09IGZhbHNlICYmIGRlY29kZVVSSUNvbXBvbmVudChpdG1bMV0pID09PSBrZXkpCiAgICAgICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGl0bVsyXSk7CiAgICAgICAgICAgIGVsc2UgaWYgKGtleSA9PT0gZmFsc2UpCiAgICAgICAgICAgICAgICByZXNbZGVjb2RlVVJJQ29tcG9uZW50KGl0bVsxXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KGl0bVsyXSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4ga2V5ID09PSBmYWxzZSA/IHJlcyA6IG51bGw7CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgICAgcmVuZGVyIDogcmVuZGVyLAogICAgICAgIHN0YWNrZWQ6IHN0YWNrZWQsCiAgICAgICAgY29tcG9zZVVybDogY29tcG9zZVVybCwKICAgICAgICBwb3N0VXJsOiBwb3N0VXJsLAogICAgICAgIGNvbXBvc2VQYXJhbXM6IGNvbXBvc2VQYXJhbXMsCiAgICAgICAgY2FwaXRhbEl0OiBjYXBpdGFsSXQsCiAgICAgICAgYnJlYWtJdDogYnJlYWtJdCwKICAgICAgICBoYnNfcGFydGlhbDogaGJzX3BhcnRpYWwsCiAgICAgICAgZW5hYmxlX2xvYWRfYnV0dG9uOiBlbmFibGVfbG9hZF9idXR0b24sCiAgICAgICAgbG9jYWxTdG9yYWdlVXRpbDogbG9jYWxTdG9yYWdlVXRpbCwKICAgICAgICBnZXRRdWVyeVN0cmluZzogZ2V0UXVlcnlTdHJpbmcKICAgIH0KfSkoKTsKCgoKSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignaTE4bicsCiAgICBmdW5jdGlvbihzdHIpewogICAgICAgIHJldHVybiAoICh0eXBlb2YgaTE4bikgIT09ICd1bmRlZmluZWQnID8gc3RyIDogc3RyKQogICAgfQopOwoKSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignc2VsZWN0JywgZnVuY3Rpb24obmFtZSwgc2VsZWN0ZWRWYWx1ZSwgb3B0aW9ucywgZGlzcF9maWVsZCwgdmFsdWVfZmllbGQpIHsKICAgIHZhciBvdXQgPSAiPHNlbGVjdCBjbGFzcz0nZm9ybS1jb250cm9sIHNlbGVjdEJveCcgaWQ9XCciICsgbmFtZSArICJcJyBuYW1lPSIgKyBuYW1lICsgIj5cbiI7CiAgICBfLmVhY2gob3B0aW9ucywgZnVuY3Rpb24odikgewogICAgICAgIG91dCArPSAiPG9wdGlvbiB2YWx1ZT0nIiArIHZbdmFsdWVfZmllbGRdICsgIiciICsKICAgICAgICAgICAgKHZbdmFsdWVfZmllbGRdID09IHNlbGVjdGVkVmFsdWVbdmFsdWVfZmllbGRdID8gIiBzZWxlY3RlZCAiIDogIiIpICsgIiA+IiArCiAgICAgICAgICAgIGVzY2FwZUhUTUwodltkaXNwX2ZpZWxkXSkgKyAiPC9vcHRpb24+XG4iCiAgICB9KTsKICAgIG91dCArPSAiPC9zZWxlY3Q+IjsKCiAgICByZXR1cm4gbmV3IEhhbmRsZWJhcnMuU2FmZVN0cmluZyhvdXQpCn0pOwoKSGFuZGxlYmFycy5yZWdpc3RlclBhcnRpYWwoJ2RhdGVfcGlja2VyX3RlbXBsYXRlJywgc2lnbmFsLnV0aWxzLmhic19wYXJ0aWFsKCdkYXRlX3BpY2tlcl90ZW1wbGF0ZScpKTsKCi8vSGFuZGxlYmFyIGhlbHBlciB0byBpbWl0YXRlIHRoZSBpZiBjb25kaXRpb25zCkhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2lmX2VxJywgZnVuY3Rpb24oYSwgYiwgb3B0cykgewogICAgaWYgKGEgPT0gYikgewogICAgICAgIHJldHVybiBvcHRzLmZuKHRoaXMpOwogICAgfQp9KTsKCi8vSGFuZGxlYmFyIGhlbHBlciB0byBpbWl0YXRlIHRoZSBpZi4uZWxzZSBjb25kaXRpb25zCkhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2lmX2Vsc2VfZXEnLCBmdW5jdGlvbihhLCBiLCBvcHRzKSB7CiAgICBpZiAoYSA9PSBiKSB7CiAgICAgICAgcmV0dXJuIG9wdHMuZm4odGhpcyk7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBvcHRzLmludmVyc2UodGhpcyk7CiAgICB9Cn0pOwoKSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignaWZfdGFnX2V4aXN0JywgZnVuY3Rpb24oa2V5LCB2YWx1ZSx0YWdzLCBvcHRzKSB7CiAgICBpZih2YWx1ZS50YWdUZXh0ID09IHRhZ3Nba2V5LTFdLnRhZ1RleHQgJiYgdmFsdWUuc3ViVGFnVGV4dCE9bnVsbCAmJiB2YWx1ZS5zdWJUYWdUZXh0ICE9IHRhZ3Nba2V5LTFdLnN1YlRhZ1RleHQpewogICAgICAgIHJldHVybiBvcHRzLmZuKHRoaXMpOwogICAgfSBlbHNlewogICAgICAgIHJldHVybiBvcHRzLmludmVyc2UodGhpcyk7CiAgICB9Cn0pOwoKSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignaWZfZWxzZV9uZXEnLCBmdW5jdGlvbihhLCBiLCBvcHRzKSB7CiAgICBpZiAoYSAhPSBiKSB7CiAgICAgICAgcmV0dXJuIG9wdHMuZm4odGhpcyk7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBvcHRzLmludmVyc2UodGhpcyk7CiAgICB9Cn0pOwoKLy89IHJlcXVpcmUgYXBwL3B2cy9jb21tb24vcnhfaGFuZGxlYmFyX2V4dC5qcwoKdmFyIHNpZ25hbCA9IHNpZ25hbCB8fCB7fTsKCnNpZ25hbC5hbGVydHNfdXRpbHMgPSAoZnVuY3Rpb24oKSB7CiAgICB2YXIgcHJpb3JpdGllczsKICAgIHZhciB3b3JrZmxvd1N0YXRlczsKCiAgICB2YXIgZ2V0X3ByaW9yaXRpZXMgPSBmdW5jdGlvbigpIHsKICAgICAgICAkLmFqYXgoewogICAgICAgICAgICB1cmw6ICIvc2lnbmFsL3dvcmtmbG93L3ByaW9yaXRpZXMiLAogICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICAgICAgICAgcHJpb3JpdGllcyA9IHJlc3VsdAogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBwcmlvcml0aWVzCiAgICB9OwoKICAgIHZhciBnZXRfd29ya2Zsb3dTdGF0ZXMgPSBmdW5jdGlvbihpbml0RGF0YSkgewogICAgICAgICQuYWpheCh7CiAgICAgICAgICAgIHVybDogIi9zaWduYWwvd29ya2Zsb3cvd29ya2Zsb3dTdGF0ZSIsCiAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgZGF0YTogaW5pdERhdGEsCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICAgICAgICAgd29ya2Zsb3dTdGF0ZXMgPSByZXN1bHQKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gd29ya2Zsb3dTdGF0ZXMKICAgIH07CgogICAgdmFyIHByaW9yaXRpZXNfc2VsZWN0aW9ucyA9IGZ1bmN0aW9uKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgIHZhciBuZXdfc2VsZWN0ID0gJzxkaXY+PHNlbGVjdCBjbGFzcz0iZm9ybS1jb250cm9sIGFkZC1jdXJzb3IiICcgKwogICAgICAgICAgICAnc3R5bGU9ImhlaWdodDogMzBweDsiIG9uY2hhbmdlPSJ1cGRhdGVQcmlvcml0eSh0aGlzLnZhbHVlLCcgKyByb3cuaWQgKyAnKSI+JzsKICAgICAgICB2YXIgcHJpb3JpdHkgPSByb3cucHJpb3JpdHk7CgogICAgICAgIHZhciB0aGVfc2VsZWN0ID0gXy5yZWR1Y2UocHJpb3JpdGllcywgZnVuY3Rpb24obSwgcCl7CiAgICAgICAgICAgIGlmIChwLnZhbHVlID09IHByaW9yaXR5KQogICAgICAgICAgICAgICAgcmV0dXJuIG0gKyAnPG9wdGlvbiB2YWx1ZT0iJyArIHAudmFsdWUgKyAnIiBzZWxlY3RlZD4gJyArIHAuZGlzcGxheU5hbWUgKyAnPC9vcHRpb24+JzsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcmV0dXJuIG0gKyAnPG9wdGlvbiB2YWx1ZT0iJyArIHAudmFsdWUgKyAnIj4nICsgcC5kaXNwbGF5TmFtZSArICc8L29wdGlvbj4nCiAgICAgICAgfSwgbmV3X3NlbGVjdCk7CiAgICAgICAgdGhlX3NlbGVjdCA9IHRoZV9zZWxlY3QgKyAnPC9zZWxlY3Q+PC9kaXY+JzsKICAgICAgICByZXR1cm4gdGhlX3NlbGVjdDsKICAgIH07CgogICAgdmFyIHdvcmtmbG93X3NlbGVjdGlvbnMgPSBmdW5jdGlvbihkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICB2YXIgbmV3X3NlbGVjdCA9ICc8ZGl2PjxzZWxlY3QgY2xhc3M9ImZvcm0tY29udHJvbCBhZGQtY3Vyc29yIiBzdHlsZT0iaGVpZ2h0OiAzMHB4OyIgb25jaGFuZ2U9InVwZGF0ZVN0YXR1cyh0aGlzLnZhbHVlLCcgKyByb3cuaWQgKyAnKSI+JzsKICAgICAgICB2YXIgd29ya2Zsb3dTdGF0ZSA9IHJvdy53b3JrZmxvd1N0YXRlOwoKICAgICAgICB2YXIgdGhlX3NlbGVjdCA9IF8ucmVkdWNlKHdvcmtmbG93U3RhdGVzLCBmdW5jdGlvbihtLCB3cyl7CiAgICAgICAgICAgIGlmICh3cy52YWx1ZSA9PSB3b3JrZmxvd1N0YXRlKQogICAgICAgICAgICAgICAgcmV0dXJuIG0gKyAnPG9wdGlvbiB2YWx1ZT0iJyArIHdzLnZhbHVlICsgJyIgc2VsZWN0ZWQ+ICcgKyB3cy5kaXNwbGF5TmFtZSArICc8L29wdGlvbj4nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByZXR1cm4gbSArICc8b3B0aW9uIHZhbHVlPSInICsgd3MudmFsdWUgKyAnIj4nICsgd3MuZGlzcGxheU5hbWUgKyAnPC9vcHRpb24+JwogICAgICAgIH0sIG5ld19zZWxlY3QpOwogICAgICAgIHRoZV9zZWxlY3QgPSB0aGVfc2VsZWN0ICsgJzwvc2VsZWN0PjwvZGl2Pic7CiAgICAgICAgcmV0dXJuIHRoZV9zZWxlY3Q7CiAgICB9OwoKICAgIHZhciBjb21wb3NlX2VkaXRfc3RhdGVfbGluayA9IGZ1bmN0aW9uKHZhbHVlLCByb3dJZCwgZmlsZWROYW1lKSB7CiAgICAgICAgcmV0dXJuICI8c3Bhbj4iICsgdmFsdWUgKyAiPC9zcGFuPiIgKyAiPGEgaHJlZj0nIycgY2xhc3M9J2VkaXQtc3RhdGUnID4iICsKICAgICAgICAgICAgIjxpIGNsYXNzPSdmYSBmYS1zaGFyZS1hbHQgcHVsbC1yaWdodCcgZGF0YS1maWVsZD0nIiAgKyBmaWxlZE5hbWUgKwogICAgICAgICAgICAiJyBkYXRhLWlkPSciICsgcm93SWQgKyAiJy8+PC9hPiIKICAgIH07CgogICAgdmFyIHN0YXRlX2NoYW5nZWQgPSBmdW5jdGlvbihleHRyYV92YWx1ZXMpIHsKICAgICAgICAkKCIjdmFsdWVTZWxlY3QiKS5jaGFuZ2UoZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgICAgIHZhciBhdmFpbGFibGVfZXh0cmFfdmFsdWVzID0gZXh0cmFfdmFsdWVzWyQodmFsdWVTZWxlY3QpLnZhbCgpXQogICAgICAgIH0pCiAgICB9OwoKICAgIC8vVE9ETyB0aGlzIGlzIGEgdGVtcCBzb2x1dGlvbiBmb3IgdGhlIEpTT04gZm9ybWF0LiBJdCBzaG91bGQgY29tZSBmcm9tIHNlcnZlciBzaWRlCiAgICAvL0Z1bmN0aW9uIHRoYXQgY29udmVydHMgdGhlIGpzb24gaW5uZXJodG1sIHRvIHRoZSBjc3YgdmFsdWVzLgogICAgLy9JdCBjb252ZXJ0cyB0aGUgcHJvcGVydGllcyB3aGljaCBhcmUgbm90IGlkLgogICAgdmFyIHNob3dfanNvbl9hc19jc3YgPSBmdW5jdGlvbiAoZWxlbWVudENsYXNzKSB7CiAgICAgICAgJCgiLiIgKyBlbGVtZW50Q2xhc3MpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgaWYgKGlzTmFOKCQodGhpcykuaHRtbCgpKSkgewogICAgICAgICAgICAgICAgICB2YXIgbW9kaWZpZWRWYWwgPSAiIjsKICAgICAgICAgICAgICAgICAgdmFyIGpzb25WYWwgPSBKU09OLnBhcnNlKCQodGhpcykuaHRtbCgpKTsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgb2JqIGluIGpzb25WYWwpIHsKICAgICAgICAgICAgICAgICAgICAgaWYgKGpzb25WYWwuaGFzT3duUHJvcGVydHkob2JqKSkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluIGpzb25WYWxbb2JqXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoanNvblZhbFtvYmpdLmhhc093blByb3BlcnR5KHByb3ApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9wICE9ICdpZCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRWYWwgPSBtb2RpZmllZFZhbCArIGpzb25WYWxbb2JqXVtwcm9wXSArICIsIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgJCh0aGlzKS5odG1sKG1vZGlmaWVkVmFsLnNsaWNlKDAsIC0xKSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgLy9EbyBub3RoaW5nCiAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhlcnIpCiAgICAgICAgICAgfQogICAgICAgICAgICQodGhpcykuaHRtbCgpCiAgICAgICAgfSkKICAgIH07CgogICAgdmFyIGluaXRfbWF0Y2hlZF9hbGVydHNfdGFibGUgPSBmdW5jdGlvbih0YWJsZUVsZSwgdXJsKSB7CiAgICAgICAgdmFyIHRhYmxlID0gdGFibGVFbGUuRGF0YVRhYmxlKHsKICAgICAgICAgICAgImxhbmd1YWdlIjogewogICAgICAgICAgICAgICAgInVybCI6ICIvc2lnbmFsL2Fzc2V0cy9pMThuL2RhdGFUYWJsZXNfIiArIHVzZXJMb2NhbGUgKyAiLmpzb24iCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhamF4OiB7CiAgICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICAgIGRhdGFTcmM6ICcnLAogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKHhocixzdGF0dXMsZXJyb3Ipe30KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFvQ29sdW1uczpbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbURhdGE6ICduYW1lJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBtRGF0YTogJ3Byb2R1Y3RTZWxlY3Rpb24nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG1EYXRhOiAndG9waWMnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG1EYXRhOiAnZGV0ZWN0ZWREYXRlJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBtRGF0YTogJ2Rpc3Bvc2l0aW9uJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICBkb206ICcnCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiB0YWJsZQogICAgfTsKCiAgICB2YXIgZ2V0U2lnbmFsTmFtZUxpc3QgPSBmdW5jdGlvbihzaWduYWxzQW5kVG9waWNzKSB7CiAgICAgICAgdmFyIHNpZ25hbEFuZFRvcGljcyA9ICcnOwogICAgICAgICQuZWFjaChzaWduYWxzQW5kVG9waWNzLCBmdW5jdGlvbihpLCBvYmopewogICAgICAgICAgICB2YXIgdXJsID0gc2lnbmFsRGV0YWlsVXJsICsgJz9pZD0nICsgb2JqWydzaWduYWxJZCddOwogICAgICAgICAgICBzaWduYWxBbmRUb3BpY3MgPSBzaWduYWxBbmRUb3BpY3MgKyAnPHNwYW4gY2xhc3M9ImNsaWNrIj48YSBocmVmPSInICsgdXJsICsgJyI+JyArIG9ialsnbmFtZSddICsgJzwvYT48L3NwYW4+Jm5ic3A7JwogICAgICAgICAgICBzaWduYWxBbmRUb3BpY3MgPSBzaWduYWxBbmRUb3BpY3MgKyAiLCIKICAgICAgICB9KTsKICAgICAgICBpZihzaWduYWxBbmRUb3BpY3MubGVuZ3RoID4gMSkKICAgICAgICAgICAgcmV0dXJuICc8ZGl2PicgKyBzaWduYWxBbmRUb3BpY3Muc3Vic3RyaW5nKDAsIHNpZ25hbEFuZFRvcGljcy5sZW5ndGggLSAxKSArICc8L2Rpdj4nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuICctJzsKICAgIH07CgogICAgLy8gRm9yIHNoYXJlZCB3aXRoIG1vZGFsCiAgICB2YXIgaW5pdGlhbGl6ZVNoYXJlV2l0aFNlbGVjdDIgPSBmdW5jdGlvbigpewogICAgICAgICQoJyNzaGFyZVdpdGgnKS5zZWxlY3QyKCkub24oImNoYW5nZSIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICQoJyNzaGFyZVdpdGgnKS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnaGFzLWVycm9yJyk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBpbml0aWFsaXplU2hhcmVXaXRoVmFsdWVzID0gZnVuY3Rpb24oKXsKICAgICAgICAkKCcjc2hhcmVkV2l0aE1vZGFsJykub24oJ3Nob3cuYnMubW9kYWwnLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciBleGVjdXRlZENvbmZpZ0lkID0gZS5yZWxhdGVkVGFyZ2V0LmlkOwogICAgICAgICAgICAkKCcjZXhlY3V0ZWRDb25maWdJZCcpLnZhbChleGVjdXRlZENvbmZpZ0lkKTsKICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGgnKS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnaGFzLWVycm9yJyk7CgogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsCiAgICAgICAgICAgICAgICB1cmw6IGdldFNoYXJlZFdpdGggKyAnP2lkPScgKyBleGVjdXRlZENvbmZpZ0lkLAogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXJzID0gJyc7CiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKHJlc3VsdC51c2VycywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJzICs9IHRoaXMubmFtZSArICc8YnIgLz4nCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGhVc2VyTGlzdCcpLmh0bWwodXNlcnMpOwogICAgICAgICAgICAgICAgICAgIHZhciBncm91cHMgPSAnJzsKICAgICAgICAgICAgICAgICAgICAkLmVhY2gocmVzdWx0Lmdyb3VwcywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwcyArPSAgdGhpcy5uYW1lICsgJyA8YnIgLz4nCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGhHcm91cExpc3QnKS5odG1sKGdyb3Vwcyk7CgogICAgICAgICAgICAgICAgICAgICQuZWFjaChyZXN1bHQuYWxsLCBmdW5jdGlvbihpLCBkYXRhKXsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbiA9IG5ldyBPcHRpb24oZGF0YS5uYW1lLCBkYXRhLmlkLCB0cnVlLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGgnKS5hcHBlbmQob3B0aW9uKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBzaGFyZWRXaXRoTW9kYWxTaG93ID0gdHJ1ZTsKCiAgICAgICAgfSkub24oJ2hpZGRlbi5icy5tb2RhbCcsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgc2hhcmVkV2l0aE1vZGFsU2hvdyA9IGZhbHNlOwogICAgICAgICAgICAkKCcjc2hhcmVkV2l0aCcpLnZhbChudWxsKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGgnKS5maW5kKCdvcHRpb24nKS5yZW1vdmUoKTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGdldFRhZ3NFbGVtZW50ID0gZnVuY3Rpb24odGFncykgewogICAgICAgIHZhciB0YWdzRWxlbWVudCA9ICc8ZGl2IGNsYXNzPSJ0YWctY29udGFpbmVyIGJsb2NrLWVsbGlwc2lzIj48ZGl2IGNsYXNzPSJ0YWctbGVuZ3RoIj4nOwogICAgICAgIHZhciBnbG9iYWxUYWdzQXJyYXkgPSBbXTsKICAgICAgICB2YXIgYWxlcnRUYWdzcnJheSA9IFtdOwogICAgICAgIHZhciBwcml2YXRlVGFnc0FycmF5ID0gW107CiAgICAgICAgJC5lYWNoKHRhZ3MsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgIGlmICh2YWx1ZS5wcml2YXRlVXNlciA9PSAnKFApJykgewogICAgICAgICAgICAgICAgcHJpdmF0ZVRhZ3NBcnJheS5wdXNoKHZhbHVlKQogICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlLnRhZ1R5cGUgPT0gJyhBKScpIHsKICAgICAgICAgICAgICAgIGFsZXJ0VGFnc3JyYXkucHVzaCh2YWx1ZSkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGdsb2JhbFRhZ3NBcnJheS5wdXNoKHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0YWdzRWxlbWVudCArPSBzaWduYWwudXRpbHMucmVuZGVyKCd0YWdzX2RldGFpbHMnLCB7CiAgICAgICAgICAgICAgICBrZXk6IGtleSwKICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICAgICAgICAgIHRhZ3M6dGFncywKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIHZpZXdBbGxFbGVtZW50cyA9IGZldGNoVmlld0FsbFRhZ3MoZ2xvYmFsVGFnc0FycmF5ICwgYWxlcnRUYWdzcnJheSAsIHByaXZhdGVUYWdzQXJyYXkpOwoKICAgICAgICB0YWdzRWxlbWVudCArPSAnPGEgdGFiaW5kZXg9IjAiIHRpdGxlPSJBZGQvRWRpdCBDYXRlZ29yaWVzIiBjbGFzcz0iZWRpdEFsZXJ0VGFncyBidG4tZWRpdC10YWcgbWlkIj48aSBjbGFzcz0ibWRpIG1kaS1wZW5jaWwtYm94IGZvbnQtMjAgYmx1ZS0xIj4gPC9pPjwvYT4nOwogICAgICAgIHRhZ3NFbGVtZW50ICs9ICc8YSB0YWJpbmRleD0iMCIgdGl0bGU9IicgKyAkLmkxOG4uXygnYXBwTGFiZWwudmlld0FsbCcpICsgJyIgY2xhc3M9Imljby1kb3RzIHZpZXctYWxsIiBtb3JlLWRhdGE9Iicrdmlld0FsbEVsZW1lbnRzKyciPjxpIGNsYXNzPSJtZGkgbWRpLWRvdHMtaG9yaXpvbnRhbCBmb250LTIwIGJsdWUtMSI+IDwvaT48L2E+JzsKICAgICAgICB0YWdzRWxlbWVudCArPSAnPC9kaXY+PC9kaXY+JzsKICAgICAgICByZXR1cm4gdGFnc0VsZW1lbnQKICAgIH07CgogICAgdmFyIGZldGNoVmlld0FsbFRhZ3MgPSBmdW5jdGlvbihnbG9iYWxUYWdzQXJyYXkgLCBhbGVydFRhZ3NBcnJheSAsIHByaXZhdGVUYWdzQXJyYXkpIHsKICAgICAgICB2YXIgcmV0dXJuRWxlbWVudCA9ICIiOwogICAgICAgIGlmIChnbG9iYWxUYWdzQXJyYXkubGVuZ3RoID4gMCkgewogICAgICAgICAgICByZXR1cm5FbGVtZW50ID0gIjxwIGNsYXNzPSdwYnInIHN0eWxlPSdtYXJnaW4tdG9wOjdweCc+PGI+R2xvYmFsIENhdGVnb3J5PC9iPjxociBjbGFzcz0ndGFnZWhyJz4iOwogICAgICAgICAgICByZXR1cm5FbGVtZW50ICs9IHNpZ25hbC51dGlscy5yZW5kZXIoJ3RhZ3NfZGV0YWlsc192aWV3X2FsbCcsIHt0YWdzOiBnbG9iYWxUYWdzQXJyYXl9KSArICI8L3A+IiAgOwogICAgICAgIH0KICAgICAgICBpZiAoYWxlcnRUYWdzQXJyYXkubGVuZ3RoID4gMCkgewogICAgICAgICAgICByZXR1cm5FbGVtZW50ICs9ICI8cCBjbGFzcz0ncGJyJyBzdHlsZT0nbWFyZ2luLXRvcDo3cHgnPjxiPkFsZXJ0IFNwZWNpZmljIENhdGVnb3J5PC9iPjxociBjbGFzcz0ndGFnZWhyJz4iOwogICAgICAgICAgICByZXR1cm5FbGVtZW50ICs9IHNpZ25hbC51dGlscy5yZW5kZXIoJ3RhZ3NfZGV0YWlsc192aWV3X2FsbCcsIHsKICAgICAgICAgICAgICAgIHRhZ3M6IGFsZXJ0VGFnc0FycmF5LAogICAgICAgICAgICB9KSAgKyAiPC9wPiIgOwogICAgICAgIH0KICAgICAgICBpZiAocHJpdmF0ZVRhZ3NBcnJheS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHJldHVybkVsZW1lbnQgKz0gIjxwIGNsYXNzPSdwYnInIHN0eWxlPSdtYXJnaW4tdG9wOjdweCc+PGI+UHJpdmF0ZSBDYXRlZ29yeTwvYj48aHIgY2xhc3M9J3RhZ2Vocic+IjsKICAgICAgICAgICAgcmV0dXJuRWxlbWVudCArPSBzaWduYWwudXRpbHMucmVuZGVyKCd0YWdzX2RldGFpbHNfdmlld19hbGwnLCB7dGFnczogcHJpdmF0ZVRhZ3NBcnJheX0pICArICI8L3A+IiA7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXR1cm5FbGVtZW50CiAgICB9OwogICAgcmV0dXJuIHsKICAgICAgICBnZXRfcHJpb3JpdGllczogZ2V0X3ByaW9yaXRpZXMsCiAgICAgICAgcHJpb3JpdGllc19zZWxlY3Rpb25zOiBwcmlvcml0aWVzX3NlbGVjdGlvbnMsCiAgICAgICAgZ2V0X3dvcmtmbG93U3RhdGVzOiBnZXRfd29ya2Zsb3dTdGF0ZXMsCiAgICAgICAgd29ya2Zsb3dfc2VsZWN0aW9uczogd29ya2Zsb3dfc2VsZWN0aW9ucywKICAgICAgICBjb21wb3NlX2VkaXRfc3RhdGVfbGluazogY29tcG9zZV9lZGl0X3N0YXRlX2xpbmssCiAgICAgICAgc3RhdGVfY2hhbmdlOiBzdGF0ZV9jaGFuZ2VkLAogICAgICAgIHNob3dfanNvbl9hc19jc3Y6IHNob3dfanNvbl9hc19jc3YsCiAgICAgICAgaW5pdF9tYXRjaGVkX2FsZXJ0c190YWJsZTogaW5pdF9tYXRjaGVkX2FsZXJ0c190YWJsZSwKICAgICAgICBnZXRTaWduYWxOYW1lTGlzdDogZ2V0U2lnbmFsTmFtZUxpc3QsCiAgICAgICAgaW5pdGlhbGl6ZVNoYXJlV2l0aFNlbGVjdDIgOiBpbml0aWFsaXplU2hhcmVXaXRoU2VsZWN0MiwKICAgICAgICBpbml0aWFsaXplU2hhcmVXaXRoVmFsdWVzOmluaXRpYWxpemVTaGFyZVdpdGhWYWx1ZXMsCiAgICAgICAgZ2V0X3RhZ3NfZWxlbWVudCA6IGdldFRhZ3NFbGVtZW50CiAgICB9Cn0pKCk7Cgp2YXIgc2lnbmFsID0gc2lnbmFsIHx8IHt9OwoKc2lnbmFsLmxpc3RfdXRpbHMgPSAoZnVuY3Rpb24gKCkgewogICAgdmFyIGZsYWdfaXQgPSBmdW5jdGlvbiAoZmxhZywgaWQpIHsKICAgICAgICB2YXIgdGhlSHRtbCA9ICc8aSBjbGFzcz0iZmEgZmEtZmxhZy1vIHRleHQtbXV0ZWQgcngtbGlzdC1mbGFnIiBkYXRhLWlkPSInICsgaWQgKyAnIj48L2k+JwogICAgICAgIGlmIChmbGFnKSB7CiAgICAgICAgICAgIHRoZUh0bWwgPSAnPGkgY2xhc3M9ImZhIGZhLWZsYWcgdGV4dC1wcmltYXJ5IHJ4LWxpc3QtZmxhZyIgZGF0YS1pZD0iJyArIGlkICsgJyI+PC9pPicKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoZUh0bWwKICAgIH07CgogICAgdmFyIGZsYWdfaGFuZGxlciA9IGZ1bmN0aW9uIChjb250cm9sbGVyLCBhY3Rpb24pIHsKICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnJ4LWxpc3QtZmxhZycsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHZhciBlbGUgPSBlLnRhcmdldDsKICAgICAgICAgICAgdmFyIGlkID0gJChlbGUpLmF0dHIoJ2RhdGEtaWQnKTsKCiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6ICIvc2lnbmFsLyIgKyBjb250cm9sbGVyICsgIi8iICsgYWN0aW9uICsgIj9pZD0iICsgaWQsCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5mbGFnZ2VkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQoZWxlKS5yZW1vdmVDbGFzcygnZmEtZmxhZy1vJykucmVtb3ZlQ2xhc3MoJ3RleHQtbXV0ZWQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgJChlbGUpLmFkZENsYXNzKCdmYS1mbGFnJykuYWRkQ2xhc3MoJ3RleHQtcHJpbWFyeScpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQoZWxlKS5hZGRDbGFzcygnZmEtZmxhZy1vJykuYWRkQ2xhc3MoJ3RleHQtbXV0ZWQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgJChlbGUpLnJlbW92ZUNsYXNzKCdmYS1mbGFnJykucmVtb3ZlQ2xhc3MoJ3RleHQtcHJpbWFyeScpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0pCiAgICB9OwoKICAgIHZhciBwcmlvcml0eV9saW5rID0gZnVuY3Rpb24gKHByaW9yaXR5LCBpZCkgewogICAgICAgIHZhciBpY29uX3VybCA9IGNvbXBvc2VfcHJpb3JpdHlfaWNvbihwcmlvcml0eSk7CiAgICAgICAgcmV0dXJuICc8YSBocmVmPSIjIiBjbGFzcz0iY2hhbmdlLXByaW9yaXR5Ij48aW1nIGRhdGEtZmllbGQ9InByaW9yaXR5IiBkYXRhLWluZm89InJvdyIgZGF0YS1pZD0iJyArCiAgICAgICAgICAgIGlkICsgJyIgZGF0YS12YWx1ZT0iJyArIHByaW9yaXR5ICsgJyIgc3JjPSInICsgaWNvbl91cmwgKyAnIi8+PC9hPicKICAgIH07CgogICAgdmFyIGNvbXBvc2VfcHJpb3JpdHlfaWNvbiA9IGZ1bmN0aW9uIChwcmlvcml0eSkgewogICAgICAgIHZhciBpY29uX3VybCA9ICIvc2lnbmFsL2Fzc2V0cy9pY29ucy9kZWZhdWx0X3ByaW9yaXR5LnBuZyI7CgogICAgICAgIGlmIChfLmNvbnRhaW5zKFsnaGlnaCcsICdsb3cnLCAnbWVkaXVtJ10sIHByaW9yaXR5LnRvTG93ZXJDYXNlKCkpKSB7CiAgICAgICAgICAgIGljb25fdXJsID0gIi9zaWduYWwvYXNzZXRzL2ljb25zLyIgKyBwcmlvcml0eS50b0xvd2VyQ2FzZSgpICsgIl9wcmlvcml0eS5wbmciOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaWNvbl91cmw7CiAgICB9OwoKICAgIHZhciBjaGFuZ2VfcHJpb3JpdHkgPSBmdW5jdGlvbiAocHJpb3JpdHlFbGUsIHByaW9yaXR5KSB7CiAgICAgICAgdmFyIGljb25fdXJsID0gY29tcG9zZV9wcmlvcml0eV9pY29uKHByaW9yaXR5KTsKICAgICAgICAkKHByaW9yaXR5RWxlKS5hdHRyKCJzcmMiLCBpY29uX3VybCk7CiAgICAgICAgJChwcmlvcml0eUVsZSkuYXR0cigiZGF0YS12YWx1ZSIsIHByaW9yaXR5KTsKICAgIH07CgogICAgdmFyIGNoYW5nZV9wcmlvcml0eVRlc3QgPSBmdW5jdGlvbiAocHJpb3JpdHlFbGUsIHByaW9yaXR5KSB7CiAgICAgICAgJChwcmlvcml0eUVsZSkuYXR0cigiZGF0YS12YWx1ZSIsIHByaW9yaXR5KTsKICAgIH07CgogICAgY2hhbmdlX3ByaW9yaXR5VGVzdAoKICAgIHZhciBmaW5kX2ZpZWxkID0gZnVuY3Rpb24gKHRhYmxlX3Jvd19lbGUsIGF0dHJfbmFtZSkgewogICAgICAgIHJldHVybiAkKHRhYmxlX3Jvd19lbGUpLmZpbmQoIltkYXRhLWF0dHJpYnV0ZS1uYW1lPSciICsgYXR0cl9uYW1lICsgIiddIikKICAgIH07CgogICAgdmFyIHNldF92YWx1ZSA9IGZ1bmN0aW9uICh0YWJsZV9yb3dfZWxlLCBhdHRyX25hbWUsIGlkLCBkYXRhX2Z1biwgYXBwX25hbWUpIHsKICAgICAgICB2YXIgZWxlID0gZmluZF9maWVsZCh0YWJsZV9yb3dfZWxlLCBhdHRyX25hbWUpOwogICAgICAgIGVsZS5odG1sKGRhdGFfZnVuKGlkLCBhcHBfbmFtZSkpOwogICAgfTsKCiAgICB2YXIgZ2V0X2R1ZV9pbiA9IGZ1bmN0aW9uIChpZCwgYXBwX25hbWUpIHsKICAgICAgICB2YXIgZHVlSW4gPSAwOwogICAgICAgICQuYWpheCh7CiAgICAgICAgICAgIHVybDogIi9zaWduYWwvYWxlcnQvZHVlSW4/YWxlcnRJZD0iICsgaWQgKyAiJmFwcE5hbWU9IiArIGFwcF9uYW1lLAogICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICBkdWVJbiA9IGRhdGEucmVzdWx0OwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGR1ZUluCiAgICB9OwoKICAgIHZhciBkdWVfaW5fY29tcCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIGlmICh2YWx1ZSA8PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAiPGRpdiBkYXRhLWF0dHJpYnV0ZS1uYW1lPSdkdWVJbicgc3R5bGUgPSAnY29sb3I6cmVkJz4iICsgdmFsdWUgKyAiPC9kaXY+IjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gIjxkaXYgZGF0YS1hdHRyaWJ1dGUtbmFtZT0nZHVlSW4nPiIgKyB2YWx1ZSArICI8L2Rpdj4iOwogICAgICAgIH0KICAgIH07CgogICAgdmFyIGFzc2lnbmVkX3RvX2NvbXAgPSBmdW5jdGlvbiAoaWQsIGFzc2lnbmVkVG8pIHsKICAgICAgICB2YXIgaHRtbCA9ICc8ZGl2IGNsYXNzPSJhc3NpZ25lZFRvQ29udGFpbmVyIj48c2VsZWN0IGNsYXNzPSJhc3NpZ25lZFRvU2VsZWN0IGZvcm0tY29udHJvbCBzZWxlY3QyIj48L3NlbGVjdD48aSBjbGFzcz0ibWRpIG1kaS1zcGluIG1kaS1sb2FkaW5nIGFzc2lnblRvUHJvY2Vzc2luZyIgc3R5bGU9ImRpc3BsYXk6IG5vbmUiPjwvaT48L2Rpdj4nOwogICAgICAgIHJldHVybiBodG1sCiAgICB9OwoKICAgIHZhciB0cnVuY2F0ZVRleHRBbmRTaG93VG9vbHRpcCA9IGZ1bmN0aW9uIChjdXRvZmYsIHdvcmRicmVhaywgZXNjYXBlSHRtbCkgewogICAgICAgIHZhciBlc2MgPSBmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gdAogICAgICAgICAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JykKICAgICAgICAgICAgICAgIC5yZXBsYWNlKC88L2csICcmbHQ7JykKICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8+L2csICcmZ3Q7JykKICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8iL2csICcmcXVvdDsnKTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGQsIHR5cGUsIHJvdykgewogICAgICAgICAgICAvLyBPcmRlciwgc2VhcmNoIGFuZCB0eXBlIGdldCB0aGUgb3JpZ2luYWwgZGF0YQogICAgICAgICAgICBpZiAodHlwZSAhPT0gJ2Rpc3BsYXknKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHR5cGVvZiBkICE9PSAnbnVtYmVyJyAmJiB0eXBlb2YgZCAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkID0gZC50b1N0cmluZygpOyAvLyBjYXN0IG51bWJlcnMKCiAgICAgICAgICAgIGlmIChkLmxlbmd0aCA8PSBjdXRvZmYpIHsKICAgICAgICAgICAgICAgIHJldHVybiBlc2MoZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBzaG9ydGVuZWQgPSBkLnN1YnN0cigwLCBjdXRvZmYgLSAxKTsKCiAgICAgICAgICAgIC8vIEZpbmQgdGhlIGxhc3Qgd2hpdGUgc3BhY2UgY2hhcmFjdGVyIGluIHRoZSBzdHJpbmcKICAgICAgICAgICAgaWYgKHdvcmRicmVhaykgewogICAgICAgICAgICAgICAgc2hvcnRlbmVkID0gc2hvcnRlbmVkLnJlcGxhY2UoL1xzKFteXHNdKikkLywgJycpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBQcm90ZWN0IGFnYWluc3QgdW5jb250cm9sbGVkIEhUTUwgaW5wdXQKICAgICAgICAgICAgaWYgKGVzY2FwZUh0bWwpIHsKICAgICAgICAgICAgICAgIHNob3J0ZW5lZCA9IGVzYyhzaG9ydGVuZWQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPSJlbGxpcHNpcyIgdGl0bGU9IicgKyBlc2MoZCkgKyAnIj4nICsgc2hvcnRlbmVkICsgJyYjODIzMDs8L3NwYW4+JzsKICAgICAgICB9OwogICAgfTsKCiAgICB2YXIgYWRkX2ZpbHRlcnMgPSBmdW5jdGlvbiAodGFibGUsIGZpbHRlcnMsIGZpbHRlcl90b2dnbGVfYnRfY29udGFpbmVyKSB7CgogICAgICAgIHZhciB5YWRjZl9maWx0ZXJzID0gXy5maWx0ZXIoZmlsdGVycywgZnVuY3Rpb24gKGYpIHsKICAgICAgICAgICAgaWYgKGZbMV0gIT0gJ2N1c3RvbWl6ZWQnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgY3VzdF9maWx0ZXJzID0gXy5kaWZmZXJlbmNlKGZpbHRlcnMsIHlhZGNmX2ZpbHRlcnMpOwoKICAgICAgICB5YWRjZi5pbml0KHRhYmxlLCBfLm1hcCh5YWRjZl9maWx0ZXJzLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICBpZiAoaXRlbVsyXSA9PSB0cnVlKQogICAgICAgICAgICAgICAgcmV0dXJuIHtjb2x1bW5fbnVtYmVyOiBpdGVtWzBdLCBmaWx0ZXJfdHlwZTogaXRlbVsxXSwgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiAneCd9OwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByZXR1cm4ge2NvbHVtbl9udW1iZXI6IGl0ZW1bMF0sIGZpbHRlcl90eXBlOiBpdGVtWzFdLCBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlfTsKICAgICAgICB9KSk7CgogICAgICAgIGlmIChmaWx0ZXJfdG9nZ2xlX2J0X2NvbnRhaW5lcikgewogICAgICAgICAgICBhZGRfZmlsdGVyX3RvZ2dsZV9idXR0b24oJ2lkeHh4eHh4JywgZmlsdGVyX3RvZ2dsZV9idF9jb250YWluZXIpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGN1c3RfZmlsdGVycykgewogICAgICAgICAgICBfLmVhY2goY3VzdF9maWx0ZXJzLCBmdW5jdGlvbiAoZikgewogICAgICAgICAgICAgICAgJCh0YWJsZS5jb2x1bW4oZlswXSkuaGVhZGVyKCkpLmFwcGVuZChjcmVhdGVfc3RhY2tlZF9maWx0ZXIoZlswXSkpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9OwoKICAgIHZhciBjcmVhdGVfc3RhY2tlZF9maWx0ZXIgPSBmdW5jdGlvbiAoaWR4KSB7CiAgICAgICAgcmV0dXJuICQoIjxpbnB1dCB0eXBlPSd0ZXh0JyBkYXRhLWluZGV4PSciICsgaWR4ICsgIicgY2xhc3M9J2NvbHVtbi1maWx0ZXInIHBsYWNlaG9sZGVyPSdUeXBlIHRvIGZpbHRlcic+IiArCiAgICAgICAgICAgICI8aW5wdXQgdHlwZT0ndGV4dCcgZGF0YS1pbmRleD0nIiArIGlkeCArICInIGNsYXNzPSdjb2x1bW4tZmlsdGVyJyBwbGFjZWhvbGRlcj0nVHlwZSB0byBmaWx0ZXInPiIpOwogICAgfTsKCiAgICB2YXIgYWRkX2ZpbHRlcl90b2dnbGVfYnV0dG9uID0gZnVuY3Rpb24gKHRhYmxlX2lkLCBjb250YWluZXIpIHsKICAgICAgICAkKCcueWFkY2YtZmlsdGVyLXdyYXBwZXIsIC5jb2x1bW4tZmlsdGVyJykuaGlkZSgpOwogICAgICAgICQoJy5jb2x1bW4tZmlsdGVyJykuY2xpY2soZnVuY3Rpb24gKGV2dCkgewogICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0pOwogICAgICAgICQoJy5jb2x1bW4tZmlsdGVyJykub24oJ2tleXVwJywgZnVuY3Rpb24gKGV2dCkgewogICAgICAgICAgICAvLyBQZXJmb3JtIHNlYXJjaAogICAgICAgICAgICB2YXIgaW5kZXggPSAkKHRoaXMpLmRhdGEoJ2luZGV4Jyk7CiAgICAgICAgICAgICQodGFibGVfaWQpLkRhdGFUYWJsZSgpLmNvbHVtbihpbmRleCkuc2VhcmNoKCQodGhpcykudmFsKCkpLmRyYXcoKTsKICAgICAgICB9KTsKICAgICAgICB2YXIgZmlsdGVyVG9nZ2xlID0gIjxpIGNsYXNzPSd0YWJsZS1maWx0ZXItdG9nZ2xlIGdseXBoaWNvbiBnbHlwaGljb24tZmlsdGVyJyBkYXRhLXRhYmxlPSciICsgdGFibGVfaWQgKwogICAgICAgICAgICAiJyBvbmNsaWNrPSdzaWduYWwubGlzdF91dGlscy5oYW5kbGVfZmlsdGVyX3RvZ2dsZScgZGF0YS1zaG93LWZpbHRlcj0ndHJ1ZSc+PC9pPiI7CiAgICAgICAgdmFyIHRvZ2dsZV9idXR0b24gPSAkLnBhcnNlSFRNTChmaWx0ZXJUb2dnbGUpOwogICAgICAgIGlmICghKF8uaXNVbmRlZmluZWQoY29udGFpbmVyKSAmJiBfLmlzTnVsbChjb250YWluZXIpKSkgewogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kKHRvZ2dsZV9idXR0b24pOwogICAgICAgIH0KCiAgICAgICAgJChkb2N1bWVudCkub24oJ2ZpbHRlci10b2dnbGUtaW5pdCcsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgJCgnLnRhYmxlLWZpbHRlci10b2dnbGUnKS5jbGljayhmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgICAgICB2YXIgaGlkZV9zaG93X2ZpdGxlciA9IGZ1bmN0aW9uICh0YWJsZUlkLCBoaWRlT3JTaG93KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGhpZGVPclNob3cgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQodGFibGVJZCArICdfd3JhcHBlciAueWFkY2YtZmlsdGVyLXdyYXBwZXIsLmNvbHVtbi1maWx0ZXInKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJCh0YWJsZUlkICsgJ193cmFwcGVyIC55YWRjZi1maWx0ZXItd3JhcHBlciwuY29sdW1uLWZpbHRlcicpLnNob3coKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIHZhciB0YXJnZXRGaWx0ZXJUb2dnbGUgPSAkKGV2dC50YXJnZXQpOwogICAgICAgICAgICAgICAgdmFyIHRhYmxlSWQgPSB0YXJnZXRGaWx0ZXJUb2dnbGUuZGF0YSgndGFibGUnKTsKICAgICAgICAgICAgICAgIHZhciBzaG93RmlsdGVyID0gdGFyZ2V0RmlsdGVyVG9nZ2xlLmRhdGEoJ3Nob3ctZmlsdGVyJyk7CiAgICAgICAgICAgICAgICBpZiAoc2hvd0ZpbHRlciA9PT0gJ3RydWUnKSB7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RmlsdGVyVG9nZ2xlLmRhdGEoJ3Nob3dGaWx0ZXInLCAnZmFsc2UnKTsKICAgICAgICAgICAgICAgICAgICBoaWRlX3Nob3dfZml0bGVyKHRhYmxlSWQsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RmlsdGVyVG9nZ2xlLmRhdGEoJ3Nob3dGaWx0ZXInLCAndHJ1ZScpOwogICAgICAgICAgICAgICAgICAgIGhpZGVfc2hvd19maXRsZXIodGFibGVJZCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAkKGRvY3VtZW50KS50cmlnZ2VyKCdmaWx0ZXItdG9nZ2xlLWluaXQnKTsKICAgICAgICByZXR1cm4gJCh0b2dnbGVfYnV0dG9uKTsKICAgIH07CgogICAgdmFyIGhhbmRsZV9maWx0ZXJfdG9nZ2xlID0gZnVuY3Rpb24gKGV2dCkgewogICAgICAgICQodGhpcykuYXR0cigndGFyZ2V0LXRhYmxlJyk7CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgICAgZmxhZ19pdDogZmxhZ19pdCwKICAgICAgICBmbGFnX2hhbmRsZXI6IGZsYWdfaGFuZGxlciwKICAgICAgICBwcmlvcml0eV9saW5rOiBwcmlvcml0eV9saW5rLAogICAgICAgIGNoYW5nZV9wcmlvcml0eTogY2hhbmdlX3ByaW9yaXR5LAogICAgICAgIGZpbmRfZmllbGQ6IGZpbmRfZmllbGQsCiAgICAgICAgc2V0X3ZhbHVlOiBzZXRfdmFsdWUsCiAgICAgICAgZ2V0X2R1ZV9pbjogZ2V0X2R1ZV9pbiwKICAgICAgICBkdWVfaW5fY29tcDogZHVlX2luX2NvbXAsCiAgICAgICAgYXNzaWduZWRfdG9fY29tcDogYXNzaWduZWRfdG9fY29tcCwKICAgICAgICB0cnVuY2F0ZVRleHRBbmRTaG93VG9vbHRpcDogdHJ1bmNhdGVUZXh0QW5kU2hvd1Rvb2x0aXAsCiAgICAgICAgYWRkX2ZpbHRlcnM6IGFkZF9maWx0ZXJzLAogICAgICAgIGhhbmRsZV9maWx0ZXJfdG9nZ2xlOiBoYW5kbGVfZmlsdGVyX3RvZ2dsZSwKICAgICAgICBhZGRfZmlsdGVyX3RvZ2dsZV9idXR0b246IGFkZF9maWx0ZXJfdG9nZ2xlX2J1dHRvbgogICAgfQp9KSgpOwp2YXIgc2lnbmFsID0gc2lnbmFsIHx8IHt9CgpzaWduYWwuYWN0aXZpdGllc191dGlscyA9IChmdW5jdGlvbigpIHsKICAgIHZhciBhY3Rpdml0eV90YWJsZTsKICAgIHZhciBzb3J0aW5nQ291bnQgPSAzOwoKICAgIHZhciBpbml0X2FjdGl2aXRpZXNfdGFibGUgPSBmdW5jdGlvbih0YWJsZSwgdXJsLCBhcHBUeXBlKSB7CiAgICAgICAgdmFyIGNvbHVtbnMgPSBjcmVhdGVfYWN0aXZpdHlfY29sdW1uX2RhdGEoYXBwVHlwZSk7CiAgICAgICAgYWN0aXZpdHlfdGFibGUgPSAkKHRhYmxlKS5EYXRhVGFibGUoewogICAgICAgICAgICAic1BhZ2luYXRpb25UeXBlIjogImJvb3RzdHJhcCIsCgogICAgICAgICAgICAibGFuZ3VhZ2UiOiB7CiAgICAgICAgICAgICAgICAidXJsIjogIi4uL2Fzc2V0cy9pMThuL2RhdGFUYWJsZXNfIiArIHVzZXJMb2NhbGUgKyAiLmpzb24iCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJhamF4IjogewogICAgICAgICAgICAgICAgInVybCI6IHVybCwKICAgICAgICAgICAgICAgICJkYXRhU3JjIjogIiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZm5EcmF3Q2FsbGJhY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICQoJ2FbaHJlZj0iI2FjdGl2aXRpZXMiXScpLm9uKCJzaG93bi5icy50YWIiLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpdml0aWVzVGFibGUnKS5EYXRhVGFibGUoKS5hamF4LnVybChnZXRBY3Rpdml0eVVybCgpKS5sb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgYWRkR3JpZFNob3J0Y3V0cygnI2FjdGl2aXRpZXNUYWJsZScpOwogICAgICAgICAgICAgICAgICAgIHJlbW92ZUdyaWRTaG9ydGN1dHMoJyNhbGVydHNEZXRhaWxzVGFibGUnKTsKICAgICAgICAgICAgICAgICAgICByZW1vdmVHcmlkU2hvcnRjdXRzKCcjYXJjaGl2ZWRBbGVydHNUYWJsZScpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJhYVNvcnRpbmciOiBbW3NvcnRpbmdDb3VudCwgImRlc2MiXV0sCiAgICAgICAgICAgICJiTGVuZ3RoQ2hhbmdlIjogdHJ1ZSwKICAgICAgICAgICAgImlEaXNwbGF5TGVuZ3RoIjogMTAsCiAgICAgICAgICAgICJiQXV0b1dpZHRoIjogZmFsc2UsCiAgICAgICAgICAgICJhb0NvbHVtbnMiOiBjb2x1bW5zLAogICAgICAgICAgICAic2Nyb2xsWCI6IHRydWUsCiAgICAgICAgICAgICJzY3JvbGxZIjoiY2FsYygxMDB2aCAtIDMwMXB4KSIsCiAgICAgICAgICAgICJhdXRvV2lkdGgiOnRydWUsCiAgICAgICAgICAgIGNvbHVtbkRlZnM6IFt7CiAgICAgICAgICAgICAgICAidGFyZ2V0cyI6ICdfYWxsJywKICAgICAgICAgICAgICAgICJyZW5kZXIiOiAkLmZuLmRhdGFUYWJsZS5yZW5kZXIudGV4dCgpCiAgICAgICAgICAgIH1dCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGFjdGl2aXR5X3RhYmxlOwogICAgfTsKCiAgICB2YXIgY3JlYXRlX2FjdGl2aXR5X2NvbHVtbl9kYXRhID0gZnVuY3Rpb24oYXBwVHlwZSkgewogICAgICAgIHZhciBhb0NvbHVtbnMgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJ0eXBlIiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24oZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgaWYocm93LnR5cGU9PSdQRUNEaXNzb2NpYXRlZCcpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ1BFQyBEaXNzb2NpYXRlZCcKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYocm93LnR5cGU9PSdQRUNBc3NvY2lhdGVkJykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ1BFQyBBc3NvY2lhdGVkJwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2lnbmFsLnV0aWxzLmJyZWFrSXQocm93LnR5cGUpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTE1MCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogImRldGFpbHMiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbihkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByb3cuZGV0YWlscyA9IHJvdy5kZXRhaWxzLnJlcGxhY2UoLzxicj4vZywnXG4nKQogICAgICAgICAgICAgICAgICAgIGlmIChyb3cuanVzdGlmaWNhdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjxzcGFuIGNsYXNzPSd3b3JkLXdyYXAtYnJlYWstd29yZCc+Iitlc2NhcGVIVE1MKHJvdy5kZXRhaWxzKSArICIgLS0gd2l0aCBKdXN0aWZpY2F0aW9uICciICsgZXNjYXBlSFRNTChyb3cuanVzdGlmaWNhdGlvbikgKyAiJyIrIjwvc3Bhbj4iOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkZXNjcmlwdGlvblRleHQgPSBwcm9jZXNzX2Rlc2NyaXB0aW9uKHJvdy5kZXRhaWxzKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI8c3BhbiBjbGFzcz0nd29yZC13cmFwLWJyZWFrLXdvcmQgY2VsbC1icmVhayc+IitkZXNjcmlwdGlvblRleHQrIjwvc3Bhbj4iOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMjAwIGNvbC1tYXgtMzAwJwogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAicGVyZm9ybWVkQnkiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgaWYocm93LnBlcmZvcm1lZEJ5RGVwdCAmJiByb3cucGVyZm9ybWVkQnlEZXB0ICE9ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlc2NhcGVIVE1MKHJvdy5wZXJmb3JtZWRCeSArICIgKCIgKyByb3cucGVyZm9ybWVkQnlEZXB0ICsgIikiKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJvdy5wZXJmb3JtZWRCeQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAidGltZXN0YW1wIiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24oZGF0YSwgdHlwZSwgZnVsbCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhCgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xNTAnCiAgICAgICAgICAgIH0KICAgICAgICBdOwogICAgICAgIGlmKGFwcFR5cGUgPT0gJ1NpbmdsZSBDYXNlIEFsZXJ0JykgewogICAgICAgICAgICBhb0NvbHVtbnMuc3BsaWNlKDAsMCx7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiY2FzZU51bWJlciIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTAwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSgyLDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogInN1c3BlY3QiLAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTIwMCcKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGFvQ29sdW1ucy5zcGxpY2UoMywwLHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJldmVudE5hbWUiLAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTE1MCcKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGFvQ29sdW1ucy5zcGxpY2UoNSwwLHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjdXJyZW50QXNzaWdubWVudCIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY3VyckFzc2lnbm1lbnQKICAgICAgICAgICAgICAgICAgICBpZiAocm93LmN1cnJlbnRBc3NpZ25tZW50RGVwdCAmJiByb3cuY3VycmVudEFzc2lnbm1lbnREZXB0ICE9ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJBc3NpZ25tZW50ID0gcm93LmN1cnJlbnRBc3NpZ25tZW50ICsgIiAoIiArIHJvdy5jdXJyZW50QXNzaWdubWVudERlcHQgKyAiKSIKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjdXJyQXNzaWdubWVudCA9IChyb3cuY3VycmVudEFzc2lnbm1lbnQpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBlc2NhcGVIVE1MKGN1cnJBc3NpZ25tZW50KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xNTAnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzb3J0aW5nQ291bnQgPSA3CiAgICAgICAgfWVsc2UgaWYoYXBwVHlwZSA9PSAnTGl0ZXJhdHVyZSBTZWFyY2ggQWxlcnQnKSB7CiAgICAgICAgICAgIGFvQ29sdW1ucy5zcGxpY2UoMCwwLHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJhcnRpY2xlSWQiLAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTEwMCcKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGFvQ29sdW1ucy5zcGxpY2UoMiwwLHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJzZWFyY2hTdHJpbmciLAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTEwMCcKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGFvQ29sdW1ucy5zcGxpY2UoMywwLHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJwcm9kdWN0TmFtZSIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMjAwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSg0LDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogImV2ZW50TmFtZSIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSg2LDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogImN1cnJlbnRBc3NpZ25tZW50IiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHZhciBjdXJyQXNzaWdubWVudAogICAgICAgICAgICAgICAgICAgIGlmIChyb3cuY3VycmVudEFzc2lnbm1lbnREZXB0ICYmIHJvdy5jdXJyZW50QXNzaWdubWVudERlcHQgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VyckFzc2lnbm1lbnQgPSByb3cuY3VycmVudEFzc2lnbm1lbnQgKyAiICgiICsgcm93LmN1cnJlbnRBc3NpZ25tZW50RGVwdCArICIpIgogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJBc3NpZ25tZW50ID0gKHJvdy5jdXJyZW50QXNzaWdubWVudCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVzY2FwZUhUTUwoY3VyckFzc2lnbm1lbnQpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTE1MCcKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNvcnRpbmdDb3VudCA9IDgKICAgICAgICB9IGVsc2UgaWYgKGFwcFR5cGUgPT0gJ0FnZ3JlZ2F0ZSBDYXNlIEFsZXJ0JyB8fCBhcHBUeXBlID09ICdFVkRBUyBBbGVydCcpIHsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSgxLDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogInN1c3BlY3QiLAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTE1MCcKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGFvQ29sdW1ucy5zcGxpY2UoMiwwLHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJldmVudE5hbWUiLAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTE1MCcKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGFvQ29sdW1ucy5zcGxpY2UoNCwwLHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjdXJyZW50QXNzaWdubWVudCIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY3VyckFzc2lnbm1lbnQKICAgICAgICAgICAgICAgICAgICBpZiAocm93LmN1cnJlbnRBc3NpZ25tZW50RGVwdCAmJiByb3cuY3VycmVudEFzc2lnbm1lbnREZXB0ICE9ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJBc3NpZ25tZW50ID0gcm93LmN1cnJlbnRBc3NpZ25tZW50ICsgIiAoIiArIHJvdy5jdXJyZW50QXNzaWdubWVudERlcHQgKyAiKSIKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjdXJyQXNzaWdubWVudCA9IChyb3cuY3VycmVudEFzc2lnbm1lbnQpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBlc2NhcGVIVE1MKGN1cnJBc3NpZ25tZW50KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xNTAnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzb3J0aW5nQ291bnQgPSA2CiAgICAgICAgfQogICAgICAgIHJldHVybiBhb0NvbHVtbnMKICAgIH07CgogICAgdmFyIHJlbG9hZF9hY3Rpdml0eV90YWJsZSA9IGZ1bmN0aW9uKCkgewoKICAgICAgICBpZiAodHlwZW9mIGFjdGl2aXR5X3RhYmxlICE9ICJ1bmRlZmluZWQiICYmIGFjdGl2aXR5X3RhYmxlICE9IG51bGwpIHsKICAgICAgICAgICAgYWN0aXZpdHlfdGFibGUuYWpheC5yZWxvYWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmxvZygiVW5hYmxlIHRvIHJlbG9hZCB0aGUgYWN0aXZpdHkgdGFibGUuIFBsZWFzZSByZWZyZXNoIHRoZSBwYWdlLiIpCiAgICAgICAgfQoKICAgIH07CgogICAgdmFyIHByb2Nlc3NfZGVzY3JpcHRpb24gPSBmdW5jdGlvbihkZXNjcmlwdGlvblN0cikgewogICAgICAgIGlmICh0eXBlb2YgZGVzY3JpcHRpb25TdHIgIT0gInVuZGVmaW5lZCIgJiYgZGVzY3JpcHRpb25TdHIgIT0gbnVsbCkgewogICAgICAgICAgICB2YXIgZGVzY3JpcHRpb25zID0gZGVzY3JpcHRpb25TdHIuc3BsaXQoJ3wnKTsKICAgICAgICAgICAgLy92YXIgZm9ybWF0dGVkU3RyaW5nID0gJycKICAgICAgICAgICAgdmFyIGZvcm1hdHRlZFN0cmluZyA9ICBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleDxkZXNjcmlwdGlvbnMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgICAgICB2YXIgZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbnNbaW5kZXhdOwogICAgICAgICAgICAgICAgdmFyIGRlc2NTcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgICAgICAgICAgICAgZGVzY1NwYW4uaW5uZXJIVE1MID0gZXNjYXBlSFRNTChkZXNjcmlwdGlvbik7CiAgICAgICAgICAgICAgICBkZXNjU3Bhbi5pbm5lckhUTUwgPSBkZXNjU3Bhbi5pbm5lckhUTUwucmVwbGFjZSgvXG4vZywgJzxicj4nKQogICAgICAgICAgICAgICAgZm9ybWF0dGVkU3RyaW5nLmFwcGVuZENoaWxkKGRlc2NTcGFuKTsKICAgICAgICAgICAgICAgIGZvcm1hdHRlZFN0cmluZy5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdicicpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZm9ybWF0dGVkU3RyaW5nLmlubmVySFRNTDsKICAgICAgICB9CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgICAgaW5pdF9hY3Rpdml0aWVzX3RhYmxlIDogaW5pdF9hY3Rpdml0aWVzX3RhYmxlLAogICAgICAgIHByb2Nlc3NfZGVzY3JpcHRpb24gOiBwcm9jZXNzX2Rlc2NyaXB0aW9uLAogICAgICAgIHJlbG9hZF9hY3Rpdml0eV90YWJsZSA6IHJlbG9hZF9hY3Rpdml0eV90YWJsZQogICAgfQp9KSgpOwoKZnVuY3Rpb24gZ2V0QWN0aXZpdHlVcmwoKSB7CiAgICBpZiAoYXBwbGljYXRpb25OYW1lID09PSBBTEVSVF9DT05GSUdfVFlQRS5MSVRFUkFUVVJFX1NFQVJDSF9BTEVSVCkgewogICAgICAgIHJldHVybiBhbGVydEFjdGl2aXRpZXM7CiAgICB9IGVsc2UgaWYgKGFwcGxpY2F0aW9uTmFtZSA9PT0gQUxFUlRfQ09ORklHX1RZUEUuU0lHTkFMX01BTkFHRU1FTlQpIHsKICAgICAgICByZXR1cm4gYWN0aXZpdHlVcmw7CiAgICB9CiAgICByZXR1cm4gYWxlcnRBY3Rpdml0aWVzVXJsICsgJz9leGVjdXRlZElkTGlzdD0nICsgZXhlY3V0ZWRJZExpc3QgKyAiJmFwcFR5cGU9IiArIGFwcGxpY2F0aW9uTmFtZQoKfQoKCnZhciBzaWduYWwgPSBzaWduYWwgfHwge307CgpzaWduYWwuYWN0aW9uc191dGlscyA9IChmdW5jdGlvbigpIHsKICAgIHZhciBhY3Rpb25fbGlzdF90YWJsZTsKICAgIHZhciBjdXJyZW50X2NyZWF0ZV9idDsKICAgIHZhciBhZGhvY192YWxpZGF0ZWRfdGFibGU7CgogICAgdmFyIHNldF9hY3Rpb25fY3JlYXRlX21vZGFsID0gZnVuY3Rpb24gKCkgewogICAgICAgICQoJyNjcmVhdGVBY3Rpb25Nb2RhbCcpLm9uKCdoaWRkZW4uYnMubW9kYWwnLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAkKHRoaXMpCiAgICAgICAgICAgICAgICAuZmluZCgnI2NvbmZpZycpLnZhbCgnJykuZW5kKCkKICAgICAgICAgICAgICAgIC5maW5kKCcjdHlwZScpLnZhbCgnJykuZW5kKCkKICAgICAgICAgICAgICAgIC5maW5kKCcjbWVldGluZ0VsZW1lbnQnKS52YWwoJycpLmVuZCgpCiAgICAgICAgICAgICAgICAuZmluZCgnLmFzc2lnbmVkVG9WYWx1ZScpLnZhbCgnJykudHJpZ2dlcignY2hhbmdlJykuZW5kKCkKICAgICAgICAgICAgICAgIC5maW5kKCcuYXNzaWduZWRUb1ZhbHVlJykuZW1wdHkoKS5lbmQoKQogICAgICAgICAgICAgICAgLmZpbmQoImlucHV0W3R5cGU9dGV4dF0sdGV4dGFyZWEiKS52YWwoJycpCiAgICAgICAgICAgICAgICAuZW5kKCk7CgogICAgICAgICAgICAkKCcjY3JlYXRlQWN0aW9uTW9kYWwgLnNlbGVjdDItc2VsZWN0aW9uX19yZW5kZXJlZCcpLmhvdmVyKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlQXR0cigndGl0bGUnKTsKICAgICAgICAgICAgfSk7CgogICAgICAgIH0pOwoKICAgICAgICAkKCcjYWN0aW9uLWVkaXQtbW9kYWwnKS5vbignaGlkZGVuLmJzLm1vZGFsJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgY2xlYXJfZWRpdF9lcnJvcnMoKTsKICAgICAgICAgICAgJCh0aGlzKQogICAgICAgICAgICAgICAgLmZpbmQoImlucHV0W3R5cGU9dGV4dF0sdGV4dGFyZWEsc2VsZWN0IikKICAgICAgICAgICAgICAgIC52YWwoJycpCiAgICAgICAgICAgICAgICAuZW5kKCkKICAgICAgICB9KTsKCiAgICAgICAgJCgnI2VkaXRBY3Rpb25Nb2RhbCcpLm9uKCdoaWRkZW4uYnMubW9kYWwnLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBjbGVhcl9lZGl0X3NpZ25hbCgpOwogICAgICAgICAgICAkKHRoaXMpCiAgICAgICAgICAgICAgICAuZmluZCgiaW5wdXRbdHlwZT10ZXh0XSx0ZXh0YXJlYSxzZWxlY3QiKQogICAgICAgICAgICAgICAgLnZhbCgnJykKICAgICAgICAgICAgICAgIC5lbmQoKQogICAgICAgIH0pOwoKICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmFjdGlvbi1jcmVhdGUnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgIHZhciBzcmNFbGUgPSAkKGV2dC50YXJnZXQpOwogICAgICAgICAgICBjdXJyZW50X2NyZWF0ZV9idCA9IHNyY0VsZTsKICAgICAgICAgICAgdmFyIGFsZXJ0SWQgPSBhbGVydElkOwogICAgICAgICAgICBpZiAodHlwZW9mIChzcmNFbGUuYXR0cignYWxlcnQtaWQnKSkgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICBhbGVydElkID0gc3JjRWxlLmF0dHIoJ2FsZXJ0LWlkJykKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgY3JlYXRlQWN0aW9uTW9kYWwgPSAkKCcjY3JlYXRlQWN0aW9uTW9kYWwnKTsKICAgICAgICAgICAgdmFyIGNyZWF0ZUFjdGlvbkJ1dHRvbiA9ICQoIiNjcmVhdGUtYWN0aW9uLWJ0biIpOwogICAgICAgICAgICBjcmVhdGVBY3Rpb25Nb2RhbC5maW5kKCcuaWQtZWxlbWVudCcpLmF0dHIoJ2RhdGEtaWQnLCBhbGVydElkKTsKCiAgICAgICAgICAgIC8vU2V0IHRoZSBhbGVydElkIGluIHRoZSBoaWRkZW4gZmllbGQgb2YgdGhlIG1vZGFsLgogICAgICAgICAgICBpZiAodHlwZW9mIGFsZXJ0SWQgIT0gInVuZGVmaW5lZCIgJiYgYWxlcnRJZCAhPSAnJykgewogICAgICAgICAgICAgICAgY3JlYXRlQWN0aW9uTW9kYWwuZmluZCgiLmFsZXJ0SWQiKS52YWwoYWxlcnRJZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNyZWF0ZUFjdGlvbk1vZGFsLmZpbmQoJyNkdWUtZGF0ZS1waWNrZXInKS5kYXRlcGlja2VyKCk7CiAgICAgICAgICAgIGNyZWF0ZUFjdGlvbkJ1dHRvbi5hdHRyKCJkaXNhYmxlZCIsIGZhbHNlKTsKICAgICAgICAgICAgY2xlYXJfZXJyb3JzKCk7CiAgICAgICAgICAgICQoJy5hY3Rpb24tdHlwZS1saXN0JykucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpOwogICAgICAgICAgICAkKCcubWVldGluZy1saXN0JykuYWRkQ2xhc3MoJ2hpZGRlbicpOwogICAgICAgICAgICBjcmVhdGVBY3Rpb25Nb2RhbC5tb2RhbCh7fSk7CgogICAgICAgICAgICAvL0V2ZW50IGJpbmQgd2hlbiB0aGUgc2F2ZS9jcmVhdGUgYnV0dG9uIGlzIGNsaWNrCiAgICAgICAgICAgIC8vIGtlZCBpbiB0aGUgYWN0aW9uIGV2ZW50IG1vZGFsLgogICAgICAgICAgICBjcmVhdGVBY3Rpb25CdXR0b24udW5iaW5kKCdjbGljaycpLmNsaWNrKGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgICAgY3JlYXRlQWN0aW9uQnV0dG9uLmF0dHIoImRpc2FibGVkIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB2YXIgYWxlcnRJZCA9ICQoZXZlbnQudGFyZ2V0KS5hdHRyKCdkYXRhLWlkJyk7CiAgICAgICAgICAgICAgICB2YXIgYWN0aW9uTW9kYWxJZCA9ICQoIiNjcmVhdGVBY3Rpb25Nb2RhbCAjdGVtcEZvcm0iKTsKICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgICAgICAgICAgICAgIHVybDogJy9zaWduYWwvYWN0aW9uL3NhdmUnLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IGdldEFjdGlvbkRldGFpbHMoYWN0aW9uTW9kYWxJZCksCiAgICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZQogICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyX2Vycm9ycygpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JNc2cgPSAiPGRpdiBjbGFzcz0nYWxlcnQgYWxlcnQtZGFuZ2VyJz4iOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgcmVzcG9uc2UuZGF0YS5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvck1lc3NhZ2VPYmogPSByZXNwb25zZS5kYXRhW2luZGV4XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yTXNnICs9IGVycm9yTWVzc2FnZU9iajsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yTXNnICs9ICc8L2JyPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgKz0gIjwvZGl2PiI7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjcmVhdGVBY3Rpb25Nb2RhbCAubW9kYWwtYm9keScpLnByZXBlbmQoZXJyb3JNc2cpOwogICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVBY3Rpb25CdXR0b24uYXR0cigiZGlzYWJsZWQiLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlQWN0aW9uTW9kYWwubW9kYWwoJ2hpZGUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF9jcmVhdGVfYnQucGFyZW50c1VudGlsKCJ0ZCIpLmZpbmQoJy5kZWZhdWx0LXZhbHVlJykuaHRtbChyZXNwb25zZS5hY3Rpb25Db3VudCk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGFwcGxpY2F0aW9uTGFiZWwgIT0gJ3VuZGVmaW5lZCcgJiYgYXBwbGljYXRpb25MYWJlbCA9PT0gIkNhc2UgRGV0YWlsIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGlvbi10YWJsZScpLkRhdGFUYWJsZSgpLmFqYXgucmVsb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGFsZXJ0SWQgIT0gInVuZGVmaW5lZCIgJiYgYWxlcnRJZCAhPSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGV0YWlsX3RhYmxlICE9ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbF90YWJsZS5hamF4LnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGlvbi10YWJsZScpLkRhdGFUYWJsZSgpLmFqYXgucmVsb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI21lZXRpbmctdGFibGUnKS5EYXRhVGFibGUoKS5hamF4LnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNzaWduYWxBY3Rpdml0eVRhYmxlJykuRGF0YVRhYmxlKCkuYWpheC5yZWxvYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgLy9SZWZyZXNoIHRoZSBhY3Rpdml0eSB0YWJsZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGFwcGxpY2F0aW9uTGFiZWwgIT0gJ3VuZGVmaW5lZCcgJiYgYXBwbGljYXRpb25MYWJlbCAhPT0gQVBQTElDQVRJT05fTEFCRUwuQ0FTRV9ERVRBSUwgJiYgYXBwbGljYXRpb25MYWJlbCAhPT0gQVBQTElDQVRJT05fTEFCRUwuRVZFTlRfREVUQUlMKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWduYWwuYWN0aXZpdGllc191dGlscy5yZWxvYWRfYWN0aXZpdHlfdGFibGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcHBsaWNhdGlvbkxhYmVsID09IEFQUExJQ0FUSU9OX0xBQkVMLlNJR05BTF9NQU5BR0VNRU5UKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLm1lZXRpbmdfdXRpbHMucmVsb2FkX21lZXRpbmdfdGFibGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJfZXJyb3JzKCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yTXNnID0gIjxkaXYgY2xhc3M9J2FsZXJ0IGFsZXJ0LWRhbmdlcic+IjsKICAgICAgICAgICAgICAgICAgICBlcnJvck1zZyArPSAiRXJyb3Igb2NjdXJlZCB3aGlsZSBzYXZpbmcgQWN0aW9uLiI7CiAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgKz0gIjwvZGl2PiI7CiAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFjdGlvbk1vZGFsIC5tb2RhbC1ib2R5JykucHJlcGVuZChlcnJvck1zZyk7CiAgICAgICAgICAgICAgICAgICAgY3JlYXRlQWN0aW9uQnV0dG9uLmF0dHIoImRpc2FibGVkIiwgZmFsc2UpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSkKICAgICAgICB9KQogICAgfTsKCiAgICB2YXIgZ2V0QWN0aW9uRGV0YWlscyA9IGZ1bmN0aW9uKG1vZGFsSWQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiY29uZmlnIjogbW9kYWxJZC5maW5kKCIjY29uZmlnIikudmFsKCksCiAgICAgICAgICAgICJ0eXBlIjogbW9kYWxJZC5maW5kKCIjdHlwZSIpLnZhbCgpLAogICAgICAgICAgICAiYXNzaWduZWRUb1ZhbHVlIjogbW9kYWxJZC5maW5kKCIjYXNzaWduZWRUbyIpLnZhbCgpLAogICAgICAgICAgICAiZHVlRGF0ZSI6IG1vZGFsSWQuZmluZCgiI2R1ZURhdGUiKS52YWwoKSwKICAgICAgICAgICAgImRldGFpbHMiOiBtb2RhbElkLmZpbmQoIiNkZXRhaWxzIikudmFsKCksCiAgICAgICAgICAgICJjb21tZW50cyI6IG1vZGFsSWQuZmluZCgiI2NvbW1lbnRzIikudmFsKCksCiAgICAgICAgICAgICJhbGVydElkIjogbW9kYWxJZC5maW5kKCIjYWxlcnRJZCIpLnZhbCgpLAogICAgICAgICAgICAiYXBwVHlwZSI6IG1vZGFsSWQuZmluZCgiI2FwcFR5cGUiKS52YWwoKSwKICAgICAgICAgICAgImV4ZUNvbmZpZ0lkIjogbW9kYWxJZC5maW5kKCIjZXhlQ29uZmlnSWQiKS52YWwoKSwKICAgICAgICAgICAgIm1lZXRpbmdJZCI6IG1vZGFsSWQuZmluZCgiI21lZXRpbmdFbGVtZW50IikudmFsKCksCiAgICAgICAgICAgICJhY3Rpb25TdGF0dXMiOiBtb2RhbElkLmZpbmQoIiNhY3Rpb25TdGF0dXMiKS52YWwoKSwKICAgICAgICAgICAgImFjdGlvbklkIjogbW9kYWxJZC5maW5kKCIjYWN0aW9uSWQiKS52YWwoKQogICAgICAgIH0KICAgIH07CgogICAgdmFyIGNsZWFyX2Vycm9ycyA9IGZ1bmN0aW9uKCkgewogICAgICAgICQoJyNjcmVhdGVBY3Rpb25Nb2RhbCAubW9kYWwtYm9keSAuYWxlcnQnKS5yZW1vdmUoKQogICAgfTsKCiAgICB2YXIgY2xlYXJfZWRpdF9lcnJvcnMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgJCgnI2FjdGlvbi1lZGl0LW1vZGFsIC5tb2RhbC1ib2R5IC5hbGVydCcpLnJlbW92ZSgpCiAgICB9OwogICAgdmFyIGNsZWFyX2VkaXRfc2lnbmFsID0gZnVuY3Rpb24gKCkgewogICAgICAgICQoJyNlZGl0QWN0aW9uTW9kYWwgLm1vZGFsLWJvZHkgLmFsZXJ0JykucmVtb3ZlKCkKICAgIH07CgovL1NpbmdsZSBhbmQgQWdncmVnYXRlIEFjdGlvbiBsaXN0IGRhdGEKICAgIHZhciBzZXRfYWN0aW9uX2xpc3RfbW9kYWwgPSBmdW5jdGlvbihjb21wKSB7CiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5saXN0LWFjdGlvbicsIGZ1bmN0aW9uKGV2dCkgewogICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgY29tcC5tb2RhbCgndG9nZ2xlJywgJCh0aGlzKSk7CiAgICAgICAgfSk7CiAgICAgICAgY29tcC5vbignc2hvd24uYnMubW9kYWwnLCBmdW5jdGlvbihldnQpIHsKICAgICAgICAgICAgdmFyIHNyY0VsZSA9IGV2dC5yZWxhdGVkVGFyZ2V0OwogICAgICAgICAgICB2YXIgYWxlcnRJZCA9ICQoc3JjRWxlKS5hdHRyKCdkYXRhLWlkJyk7CiAgICAgICAgICAgIHZhciBhcHBUeXBlID0gJCgiI2NyZWF0ZUFjdGlvbk1vZGFsICN0ZW1wRm9ybSIpLmZpbmQoIiNhcHBUeXBlIikudmFsKCk7CiAgICAgICAgICAgIHZhciBhY3Rpb25VcmwgPSAiL3NpZ25hbC9hY3Rpb24vbGlzdEJ5QWxlcnQ/YWxlcnRJZD0iICsgYWxlcnRJZCArIiZhcHBUeXBlPSIgKyBhcHBUeXBlOwogICAgICAgICAgICBhY3Rpb25fbGlzdF90YWJsZSA9ICQoJyNhY3Rpb24tdGFibGUnKS5EYXRhVGFibGUoewogICAgICAgICAgICAgICAgZGVzdHJveSA6IHRydWUsCiAgICAgICAgICAgICAgICAibGFuZ3VhZ2UiOiB7CiAgICAgICAgICAgICAgICAgICAgInVybCI6ICIuLi9hc3NldHMvaTE4bi9kYXRhVGFibGVzXyIgKyB1c2VyTG9jYWxlICsgIi5qc29uIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGZuRHJhd0NhbGxiYWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgJCgnLmVkaXQtYWN0aW9uLWxpbmsnKS5jbGljayhmdW5jdGlvbihldnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9ICIvc2lnbmFsL2FjdGlvbi9nZXRCeUlkP2lkPSIgKyAkKHRoaXMpLmF0dHIoJ2RhdGEtaWQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmRvbmUoZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5hY3Rpb25fdHlwZXMgPSBhY3Rpb25fc2VsZWN0X3ZhbHVlcy50eXBlczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuYWN0aW9uX2NvbmZpZ3MgPSBhY3Rpb25fc2VsZWN0X3ZhbHVlcy5jb25maWdzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5hbGxfc3RhdHVzID0gYWN0aW9uX3NlbGVjdF92YWx1ZXMuYWxsU3RhdHVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5hbGVydElkID0gYWxlcnRJZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuYWN0aW9uU3RhdHVzID0ge25hbWU6IGRhdGEuYWN0aW9uU3RhdHVzfTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaHRtbF9jb250ZW50ID0gc2lnbmFsLnV0aWxzLnJlbmRlcignYWN0aW9uX2VkaXRvcicsIGRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGlvbi1lZGl0b3ItY29udGFpbmVyJykuaHRtbChodG1sX2NvbnRlbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGlvbi1lZGl0b3ItY29udGFpbmVyICNkdWUtZGF0ZS1waWNrZXInKS5kYXRlcGlja2VyKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBkYXRhLmR1ZURhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmtleWRvd24ocHJldmVudEVudGVyS2V5U3VibWl0KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZHVlRGF0ZSA9IG1vbWVudChkYXRhLmR1ZURhdGUsICJERC1NTU0tWVlZWSIpLmZvcm1hdChERUZBVUxUX0RBVEVfRk9STUFUKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tZWRpdG9yLWNvbnRhaW5lcicpLmZpbmQoJyNkdWUtZGF0ZS1waWNrZXInKS5maW5kKCcjZHVlRGF0ZScpLnZhbChkdWVEYXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tZWRpdG9yLWNvbnRhaW5lcicpLmZpbmQoJyNhcHBUeXBlJykudmFsKGFwcFR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGlvbl9lZGl0b3IgPSAkKCcjYWN0aW9uLWVkaXRvci1jb250YWluZXInKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlZGl0QWN0aW9uTW9kYWwgPSAkKCcjYWN0aW9uLWVkaXQtbW9kYWwnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCcuaWQtZWxlbWVudCcpLmF0dHIoJ2RhdGEtaWQnLCBhbGVydElkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCcuYXNzaWduZWRUb1ZhbHVlJykudmFsKG51bGwpLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGlvbi1tb2RhbCcpLm1vZGFsKCdoaWRlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0QWN0aW9uTW9kYWwubW9kYWwoe30pOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tZWRpdC1tb2RhbCAjY2FuY2VsLWJ0JykuY2xpY2soaGFuZGxlX2FjdGlvbl9lZGl0b3JfY2FuY2VsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tZWRpdC1tb2RhbCAjdXBkYXRlLWJ0JykuY2xpY2soaGFuZGxlX2FjdGlvbl9lZGl0b3JfdXBkYXRlKQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImZuSW5pdENvbXBsZXRlIjogZnVuY3Rpb24ob1NldHRpbmdzLCBqc29uKSB7CiAgICAgICAgICAgICAgICAgICAgJCgnLmFjdGlvbi1jcmVhdGUnKS5hdHRyKCdkYXRhLWlkJywgYWxlcnRJZCk7CiAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFjdGlvbnNfdXRpbHMuc2V0X2FjdGlvbl9jcmVhdGVfbW9kYWwoKTsKICAgICAgICAgICAgICAgICAgICAkKCcjZHVlLWRhdGUtcGlja2VyJykuZGF0ZXBpY2tlcigpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImFqYXgiOiB7CiAgICAgICAgICAgICAgICAgICAgInVybCI6IGFjdGlvblVybCwKICAgICAgICAgICAgICAgICAgICBjYWNoZTpmYWxzZSwKICAgICAgICAgICAgICAgICAgICAiZGF0YVNyYyI6ICIiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgInNlYXJjaGluZyI6IHRydWUsCiAgICAgICAgICAgICAgICAiYlByb2Nlc3NpbmciOiB0cnVlLAogICAgICAgICAgICAgICAgImJMZW5ndGhDaGFuZ2UiOiB0cnVlLAogICAgICAgICAgICAgICAgIm9MYW5ndWFnZSI6IHsKICAgICAgICAgICAgICAgICAgICAic1Byb2Nlc3NpbmciOiAnPGRpdiBjbGFzcz0iZ3JpZC1sb2FkaW5nIj48aW1nIHNyYz0iL3NpZ25hbC9hc3NldHMvc3Bpbm5lci5naWYiIHdpZHRoPSIzMCIgYWxpZ249Im1pZGRsZSIgLz48L2Rpdj4nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImlEaXNwbGF5TGVuZ3RoIjogNSwKICAgICAgICAgICAgICAgICJhTGVuZ3RoTWVudSI6IFtbNSwgMTAsIDIwLCAtMV0sIFs1LCAxMCwgMjAsICJBbGwiXV0sCiAgICAgICAgICAgICAgICAiYW9Db2x1bW5zIjogWwogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImlkIiwKICAgICAgICAgICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjxhIGhyZWY9JyMnIGNsYXNzPSdlZGl0LWFjdGlvbi1saW5rJyBkYXRhLWlkPSciICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3cuaWQgKyAiJz4iICsgcm93LmlkICsgIjxhPiIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAidHlwZSIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImNvbmZpZyIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImRldGFpbHMiLAogICAgICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjoiY29sLW1pbi0yMDAiCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJkdWVEYXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ImNvbC1taW4tMTAwIgogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiYXNzaWduZWRUbyIsCiAgICAgICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiJjb2wtbWluLTEwMCIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1EYXRhIiA6ICJhY3Rpb25TdGF0dXMiCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjb21wbGV0ZWREYXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ImNvbC1taW4tMTUwIiwKICAgICAgICAgICAgICAgICAgICAgICAgbVJlbmRlcjogZnVuY3Rpb24oZGF0YSwgdHlwZSxyb3cpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJvdy5jb21wbGV0ZWREYXRlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgc2Nyb2xsWDogdHJ1ZSwKICAgICAgICAgICAgICAgIGNvbHVtbkRlZnM6IFt7CiAgICAgICAgICAgICAgICAgICAgInRhcmdldHMiOiAnX2FsbCcsCiAgICAgICAgICAgICAgICAgICAgInJlbmRlciI6ICQuZm4uZGF0YVRhYmxlLnJlbmRlci50ZXh0KCkKICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgIH0pCiAgICAgICAgfSk7CgogICAgICAgIGNvbXAub24oJ2hpZGRlbi5icy5tb2RhbCcsIGZ1bmN0aW9uKGV2dCkgewogICAgICAgICAgY29tcC5maW5kKCIjYWN0aW9uLXRhYmxlIikuZW1wdHkoKTsKICAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGFjdGlvbl9saXN0X3RhYmxlCiAgICB9OwogICAgdmFyIHNldEVkaXRNb2RhbFZhbHVlcyA9IGZ1bmN0aW9uIChlZGl0QWN0aW9uTW9kYWwsIGRhdGEpIHsKICAgICAgICB2YXIgYWN0aW9uVHlwZSA9IGRhdGEudHlwZU9iai5pZDsKICAgICAgICB2YXIgbWVldGluZ0lkID0gZGF0YS5tZWV0aW5nSWQ7CiAgICAgICAgdmFyIG9wdGlvbiA9IG5ldyBPcHRpb24oZGF0YS5hc3NpZ25lZFRvT2JqLmZ1bGxOYW1lLCBkYXRhLmFzc2lnbmVkVG9PYmouaWQsIHRydWUsIHRydWUpOwogICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCIjYXNzaWduZWRUbyIpLmFwcGVuZChvcHRpb24pLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgIGlmKCFtZWV0aW5nSWQpIHsKICAgICAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoIiN0eXBlIikudmFsKGFjdGlvblR5cGUpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoIiNtZWV0aW5nRWxlbWVudCIpLnZhbChtZWV0aW5nSWQpOwogICAgICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgiI21lZXRpbmdWYWx1ZSIpLnZhbChtZWV0aW5nSWQpOwogICAgICAgIH0KICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgiLnN0YXR1cy1pY29uIikucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpOwogICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCIjY29uZmlnIikudmFsKGRhdGEuY29uZmlnT2JqLmlkKTsKICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgiI2FjdGlvbklkIikudmFsKGRhdGEuaWQpOwogICAgICAgIHZhciBkdWVEYXRlID0gbW9tZW50KGRhdGEuZHVlRGF0ZSwgREVGQVVMVF9EQVRFX0ZPUk1BVCkuZm9ybWF0KERFRkFVTFRfREFURV9GT1JNQVQpOwogICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCIjZHVlLWRhdGUtcGlja2VyIikuZGF0ZXBpY2tlcih7CiAgICAgICAgICAgIGRhdGU6ICQoIiNkdWUtZGF0ZS1waWNrZXIiKS52YWwoKSA/IG5ldyBEYXRlKCQoIiNkdWUtZGF0ZS1waWNrZXIiKS52YWwoKSkgOiBudWxsLAogICAgICAgICAgICBtb21lbnRDb25maWc6IHsKICAgICAgICAgICAgICAgIGN1bHR1cmU6IHVzZXJMb2NhbGUsCiAgICAgICAgICAgICAgICBmb3JtYXQ6IERFRkFVTFRfREFURV9ESVNQTEFZX0ZPUk1BVAogICAgICAgICAgICB9CiAgICAgICAgfSkua2V5cHJlc3MocHJldmVudEVudGVyS2V5U3VibWl0KTsKICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgiI2R1ZURhdGUiKS52YWwoZHVlRGF0ZSk7CiAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoIiNjb21tZW50cyIpLnZhbChkYXRhLmNvbW1lbnRzKTsKICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgiI2RldGFpbHMiKS52YWwoZGF0YS5kZXRhaWxzKTsKICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgiI2FjdGlvblN0YXR1cyIpLnZhbChkYXRhLmFjdGlvblN0YXR1cyk7CiAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoJy5hY3Rpb24tdmFsdWUnKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgIH07CiAgICB2YXIgaGFuZGxlX2FjdGlvbl9lZGl0b3JfY2FuY2VsID0gZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdmFyIGFjdGlvbl9saXN0X3RhYmxlID0gJCgnI2FjdGlvbi10YWJsZScpLkRhdGFUYWJsZSgpOwogICAgICAgIGFjdGlvbl9saXN0X3RhYmxlLmFqYXgucmVsb2FkKCk7CiAgICAgICAgJCgnI2FjdGlvbi1lZGl0LW1vZGFsJykubW9kYWwoJ2hpZGUnKQogICAgfTsKCiAgICB2YXIgaGFuZGxlX2FjdGlvbl9lZGl0b3JfdXBkYXRlID0gZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgaWYgKCFldnQuaGFuZGxlZCkgewogICAgICAgICAgICBldnQuaGFuZGxlZCA9IHRydWU7CiAgICAgICAgICAgIHZhciBqc29uID0gJCgnI2FjdGlvbi1lZGl0b3ItY29udGFpbmVyIGZvcm0jYWN0aW9uLWVkaXRvci1mb3JtJykuc2VyaWFsaXplKCkgKyAiJmFwcFR5cGU9IiArICQoIiNhcHBUeXBlIikudmFsKCkgKyAiJmV4ZUNvbmZpZ0lkPSIgKyAkKCIjZXhlQ29uZmlnSWQiKS52YWwoKTsKCiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6ICcvc2lnbmFsL2FjdGlvbi91cGRhdGVBY3Rpb24nLAogICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgICAgICBkYXRhOiBqc29uLAogICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLAogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyX2VkaXRfZXJyb3JzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvck1zZyA9ICI8ZGl2IGNsYXNzPSdhbGVydCBhbGVydC1kYW5nZXInPiI7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaW5kZXggPSAwOyBpbmRleCA8IHJlc3BvbnNlLmRhdGEubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JNZXNzYWdlT2JqID0gcmVzcG9uc2UuZGF0YVtpbmRleF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvck1zZyArPSBlcnJvck1lc3NhZ2VPYmo7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvck1zZyArPSAnPC9icj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yTXNnICs9ICI8L2Rpdj4iOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWN0aW9uLWVkaXQtbW9kYWwgLm1vZGFsLWJvZHknKS5wcmVwZW5kKGVycm9yTXNnKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpb25fbGlzdF90YWJsZSA9ICQoJyNhY3Rpb24tdGFibGUnKS5EYXRhVGFibGUoKQogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fbGlzdF90YWJsZS5hamF4LnJlbG9hZCgpCiAgICAgICAgICAgICAgICAgICAgICAgIC8vUmVmcmVzaCB0aGUgYWN0aXZpdHkgdGFibGUKICAgICAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIGFwcGxpY2F0aW9uTGFiZWwgIT0gJ3VuZGVmaW5lZCcgJiYgYXBwbGljYXRpb25MYWJlbCAhPT0gQVBQTElDQVRJT05fTEFCRUwuQ0FTRV9ERVRBSUwgJiYgYXBwbGljYXRpb25MYWJlbCAhPT0gQVBQTElDQVRJT05fTEFCRUwuRVZFTlRfREVUQUlMKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWduYWwuYWN0aXZpdGllc191dGlscy5yZWxvYWRfYWN0aXZpdHlfdGFibGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWN0aW9uLWVkaXQtbW9kYWwnKS5tb2RhbCgnaGlkZScpCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICB9CiAgICAvL0FkLWhvYyBhbGVydCBhY3Rpb24gbGlzdCBkYXRhCiAgICB2YXIgaW5pdF9hY3Rpb25fdGFibGUgPSBmdW5jdGlvbiAodGFibGVfaWQsIGFwcFR5cGUpIHsKCiAgICAgICAgdmFyIGRhdGFVcmwgPSAiL3NpZ25hbC9hY3Rpb24vbGlzdEJ5QWxlcnQ/YWxlcnRJZD0iICsgYWxlcnRJZCArIiZhcHBUeXBlPSIgKyBhcHBUeXBlOwogICAgICAgIGFkaG9jX3ZhbGlkYXRlZF90YWJsZSA9ICQodGFibGVfaWQpLkRhdGFUYWJsZSh7CiAgICAgICAgICAgIC8vInNQYWdpbmF0aW9uVHlwZSI6ICJib290c3RyYXAiLAoKICAgICAgICAgICAgImxhbmd1YWdlIjogewogICAgICAgICAgICAgICAgInVybCI6ICIuLi9hc3NldHMvaTE4bi9kYXRhVGFibGVzXyIgKyB1c2VyTG9jYWxlICsgIi5qc29uIgogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZm5EcmF3Q2FsbGJhY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICQoJy5lZGl0LWFjdGlvbi1saW5rJykuY2xpY2soZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9ICIvc2lnbmFsL2FjdGlvbi9nZXRCeUlkP2lkPSIgKyAkKHRoaXMpLmF0dHIoJ2RhdGEtaWQnKQogICAgICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZQogICAgICAgICAgICAgICAgICAgIH0pLmRvbmUoZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZihhcHBUeXBlID09ICJTaWduYWwgTWFuYWdlbWVudCIgfHwgYXBwVHlwZSA9PSAiVG9waWMiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWRpdEFjdGlvbk1vZGFsID0gJCgnI2VkaXRBY3Rpb25Nb2RhbCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0RWRpdE1vZGFsVmFsdWVzKGVkaXRBY3Rpb25Nb2RhbCwgZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0QWN0aW9uTW9kYWwubW9kYWwoe30pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoJy51cGRhdGUtYWN0aW9uJykudW5iaW5kKCkuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpb25Nb2RhbElkID0gJCgiI2VkaXRBY3Rpb25Nb2RhbCAjdGVtcEZvcm0iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXJsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKCcubWVldGluZy1kZWNpZGVyJykudmFsKCkgPT0gJ3RydWUnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9ICcvc2lnbmFsL2FjdGlvbi91cGRhdGVNZWV0aW5nQWN0aW9uJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSAnL3NpZ25hbC9hY3Rpb24vdXBkYXRlQWN0aW9uJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBnZXRBY3Rpb25EZXRhaWxzKGFjdGlvbk1vZGFsSWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJfZWRpdF9zaWduYWwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JNc2cgPSAiPGRpdiBjbGFzcz0nYWxlcnQgYWxlcnQtZGFuZ2VyJz4iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaW5kZXggPSAwOyBpbmRleCA8IHJlc3BvbnNlLmRhdGEubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvck1lc3NhZ2VPYmogPSByZXNwb25zZS5kYXRhW2luZGV4XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgKz0gZXJyb3JNZXNzYWdlT2JqOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvck1zZyArPSAnPC9icj4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvck1zZyArPSAiPC9kaXY+IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjZWRpdEFjdGlvbk1vZGFsIC5tb2RhbC1ib2R5JykucHJlcGVuZChlcnJvck1zZykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGlvbi10YWJsZScpLkRhdGFUYWJsZSgpLmFqYXgucmVsb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI21lZXRpbmctdGFibGUnKS5EYXRhVGFibGUoKS5hamF4LnJlbG9hZCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1JlZnJlc2ggdGhlIGFjdGl2aXR5IHRhYmxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIGFwcGxpY2F0aW9uTGFiZWwgIT0gJ3VuZGVmaW5lZCcgJiYgYXBwbGljYXRpb25MYWJlbCAhPT0gQVBQTElDQVRJT05fTEFCRUwuQ0FTRV9ERVRBSUwgJiYgYXBwbGljYXRpb25MYWJlbCAhPT0gQVBQTElDQVRJT05fTEFCRUwuRVZFTlRfREVUQUlMKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbC5hY3Rpdml0aWVzX3V0aWxzLnJlbG9hZF9hY3Rpdml0eV90YWJsZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0QWN0aW9uTW9kYWwubW9kYWwoJ2hpZGUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuYWN0aW9uX3R5cGVzID0gYWN0aW9uX3NlbGVjdF92YWx1ZXMudHlwZXM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmFjdGlvbl9jb25maWdzID0gYWN0aW9uX3NlbGVjdF92YWx1ZXMuY29uZmlnczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuYWxsX3N0YXR1cyA9IGFjdGlvbl9zZWxlY3RfdmFsdWVzLmFsbFN0YXR1czsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuYWxlcnRJZCA9IGFsZXJ0SWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmFjdGlvblN0YXR1cyA9IHtuYW1lOiBkYXRhLmFjdGlvblN0YXR1c307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaHRtbF9jb250ZW50ID0gc2lnbmFsLnV0aWxzLnJlbmRlcignYWN0aW9uX2VkaXRvcicsIGRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGlvbl9lZGl0b3IgPSAkKCcjYWN0aW9uLWVkaXRvci1jb250YWluZXInKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbl9lZGl0b3IuaHRtbChodG1sX2NvbnRlbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGlvbi1lZGl0b3ItY29udGFpbmVyICNkdWUtZGF0ZS1waWNrZXInKS5kYXRlcGlja2VyKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBkYXRhLmR1ZURhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9tZW50Q29uZmlnOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1bHR1cmU6IHVzZXJMb2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR6OiB1c2VyVGltZVpvbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogREVGQVVMVF9EQVRFX0RJU1BMQVlfRk9STUFUCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkua2V5ZG93bihwcmV2ZW50RW50ZXJLZXlTdWJtaXQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uX2VkaXRvci5maW5kKCcjZHVlLWRhdGUtcGlja2VyJykuZmluZCgnI2R1ZURhdGUnKS52YWwoZGF0YS5kdWVEYXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbl9lZGl0b3IuZmluZCgnI2R1ZS1kYXRlLXBpY2tlcicpLmRhdGVwaWNrZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlZGl0QWN0aW9uTW9kYWwgPSAkKCcjYWN0aW9uLWVkaXQtbW9kYWwnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCcuaWQtZWxlbWVudCcpLmF0dHIoJ2RhdGEtaWQnLCBhbGVydElkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5tb2RhbCh7fSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWN0aW9uLWVkaXRvci1jb250YWluZXInKS5maW5kKCcjYXBwVHlwZScpLnZhbChhcHBUeXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tZWRpdC1tb2RhbCAjY2FuY2VsLWJ0JykuY2xpY2soaGFuZGxlX2FjdGlvbl9lZGl0b3JfY2FuY2VsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tZWRpdC1tb2RhbCAjdXBkYXRlLWJ0JykuY2xpY2soaGFuZGxlX2FjdGlvbl9lZGl0b3JfdXBkYXRlKQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImZuSW5pdENvbXBsZXRlIjogZnVuY3Rpb24ob1NldHRpbmdzLCBqc29uKSB7CiAgICAgICAgICAgICAgICAkKCcuYWN0aW9uLWNyZWF0ZScpLmF0dHIoJ2RhdGEtaWQnLCBhbGVydElkKQogICAgICAgICAgICAgICAgc2lnbmFsLmFjdGlvbnNfdXRpbHMuc2V0X2FjdGlvbl9jcmVhdGVfbW9kYWwoKQogICAgICAgICAgICAgICAgJCgnI2R1ZS1kYXRlLXBpY2tlcicpLmRhdGVwaWNrZXIoKQogICAgICAgICAgICB9LAogICAgICAgICAgICAiYWpheCI6IHsKICAgICAgICAgICAgICAgICJ1cmwiOiBkYXRhVXJsLAogICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLAogICAgICAgICAgICAgICAgZGF0YVNyYzogIiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2VhcmNoaW5nOiB0cnVlLAogICAgICAgICAgICBkb206ICdCZnJ0aXAnLAogICAgICAgICAgICBidXR0b25zOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ05ldyBBY3Rpb24nLAogICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2J0bi1wcmltYXJ5IGFjdGlvbi1jcmVhdGUnLAogICAgICAgICAgICAgICAgICAgIGFjdGlvbjogZnVuY3Rpb24gKCBlLCBkdCwgbm9kZSwgY29uZmlnICkgewogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICAgICAgYWFTb3J0aW5nOiBbWzAsICJkZXNjIl1dLAogICAgICAgICAgICAiYkxlbmd0aENoYW5nZSI6IHRydWUsCiAgICAgICAgICAgICJpRGlzcGxheUxlbmd0aCI6IDEwLAogICAgICAgICAgICAiYUxlbmd0aE1lbnUiOiBbWzEwLCAyMCwgNTAsIC0xXSwgWzEwLCAyMCwgNTAsICJBbGwiXV0sCiAgICAgICAgICAgICJhb0NvbHVtbnMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImlkIiwKICAgICAgICAgICAgICAgICAgICBtUmVuZGVyOiBmdW5jdGlvbihkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI8YSBocmVmPScjJyBjbGFzcz0nZWRpdC1hY3Rpb24tbGluaycgZGF0YS1pZD0nIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3cuaWQgKyAiJz4iICsgcm93LmlkICsgIjxhPiIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAiIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAidHlwZSIsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICIiLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjxzcGFuIGNsYXNzPSd3b3JkLXdyYXAtYnJlYWstd29yZCc+IiArIGVzY2FwZUhUTUwocm93LnR5cGUpICsgIjwvc3Bhbj4iOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImNvbmZpZyIsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICIiLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjxzcGFuIGNsYXNzPSd3b3JkLXdyYXAtYnJlYWstd29yZCc+IiArIGVzY2FwZUhUTUwocm93LmNvbmZpZykgKyAiPC9zcGFuPiI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiZGV0YWlscyIsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICIiLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjxzcGFuIGNsYXNzPSd3b3JkLXdyYXAtYnJlYWstd29yZCc+IiArIGVzY2FwZUhUTUwocm93LmRldGFpbHMpICsgIjwvc3Bhbj4iOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImR1ZURhdGUiLAogICAgICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xMDAnLAogICAgICAgICAgICAgICAgICAgIG1SZW5kZXI6IGZ1bmN0aW9uKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShyb3cuYWN0aW9uU3RhdHVzID09PSAnQ2xvc2VkJyAmJiByb3cuYWN0aW9uU3RhdHVzID09PSAnRGVsZXRlZCcpICYmIHJvdy5wYXNzRHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjxkaXYgY2xhc3M9J2Nsb3NlZCc+IiArIHJvdy5kdWVEYXRlICsgIjwvZGl2PiIKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiPGRpdj4iICsgcm93LmR1ZURhdGUgKyAiPC9kaXY+IgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiYXNzaWduZWRUbyIsCiAgICAgICAgICAgICAgICAgICAgbVJlbmRlcjogZnVuY3Rpb24oZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlc2NhcGVIVE1MKHJvdy5hc3NpZ25lZFRvKQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICJjb2wtbWluLTE1MCIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogIiIsCiAgICAgICAgICAgICAgICAgICAgbVJlbmRlcjogZnVuY3Rpb24oZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByb3cuYWN0aW9uU3RhdHVzCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogIiIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImNvbXBsZXRlZERhdGUiLAogICAgICAgICAgICAgICAgICAgIG1SZW5kZXI6IGZ1bmN0aW9uKGRhdGEsIHR5cGUscm93KXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJvdy5jb21wbGV0ZWREYXRlCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogImNvbC1taW4tMTUwIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICBzY3JvbGxYIDogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIGFkaG9jX3ZhbGlkYXRlZF90YWJsZS5idXR0b24oKS5kaXNhYmxlKCk7CiAgICAgICAgcmV0dXJuIGFkaG9jX3ZhbGlkYXRlZF90YWJsZQogICAgfTsKCiAgICB2YXIgYnVpbGRfYWN0aW9uX3JlbmRlciA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICB2YXIgYWN0aW9uX2Ryb3BfZG93bl9odG1sID0gc2lnbmFsLnV0aWxzLnJlbmRlcigiYWN0aW9uX2Ryb3BfZG93biIsIGRhdGEpOwogICAgICAgIHJldHVybiBhY3Rpb25fZHJvcF9kb3duX2h0bWwKICAgIH07CiAgICB2YXIgcmVsb2FkX2FjdGlvbl90YWJsZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodHlwZW9mIGFkaG9jX3ZhbGlkYXRlZF90YWJsZSAhPSAidW5kZWZpbmVkIiAmJiBhZGhvY192YWxpZGF0ZWRfdGFibGUgIT0gbnVsbCkgewogICAgICAgICAgICBhZGhvY192YWxpZGF0ZWRfdGFibGUuYWpheC5yZWxvYWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmxvZygiVW5hYmxlIHRvIHJlbG9hZCB0aGUgYWN0aXZpdHkgdGFibGUuIFBsZWFzZSByZWZyZXNoIHRoZSBwYWdlLiIpCiAgICAgICAgfQogICAgfTsKCiAgICByZXR1cm4gewogICAgICAgIHNldF9hY3Rpb25fbGlzdF9tb2RhbDogc2V0X2FjdGlvbl9saXN0X21vZGFsLAogICAgICAgIHNldF9hY3Rpb25fY3JlYXRlX21vZGFsOiBzZXRfYWN0aW9uX2NyZWF0ZV9tb2RhbCwKICAgICAgICBidWlsZF9hY3Rpb25fcmVuZGVyOiBidWlsZF9hY3Rpb25fcmVuZGVyLAogICAgICAgIGluaXRfYWN0aW9uX3RhYmxlOiBpbml0X2FjdGlvbl90YWJsZSwKICAgICAgICByZWxvYWRfYWN0aW9uX3RhYmxlIDogcmVsb2FkX2FjdGlvbl90YWJsZSwKICAgICAgICBoYW5kbGVfYWN0aW9uX2VkaXRvcl9jYW5jZWw6IGhhbmRsZV9hY3Rpb25fZWRpdG9yX2NhbmNlbCwKICAgICAgICBoYW5kbGVfYWN0aW9uX2VkaXRvcl91cGRhdGU6IGhhbmRsZV9hY3Rpb25fZWRpdG9yX3VwZGF0ZSwKICAgICAgICBjbGVhcl9lZGl0X2Vycm9yczogY2xlYXJfZWRpdF9lcnJvcnMKICAgIH0KfSkoKTsKCnZhciBzaWduYWwgPSBzaWduYWwgfHwge30KCnNpZ25hbC5hbGVydENvbW1lbnRzID0gKGZ1bmN0aW9uICgpIHsKCiAgICB2YXIgbGlzdENvbW1lbnRzID0gZnVuY3Rpb24gKGNhc2VKc29uKSB7CgogICAgICAgIC8vTW9kYWwgb2JqZWN0CiAgICAgICAgdmFyIGNvbW1lbnRNb2RhbCA9ICQoJyNjb21tZW50TW9kYWwnKTsKCiAgICAgICAgLy9Qb3B1bGF0ZSB0aGUgZXhpc3RpbmcgY29tbWVudHMgYW5kIGJpbmQgZXZlbnRzIHRvIHRoZW0uCiAgICAgICAgcG9wdWxhdGVDb21tZW50cyhjb21tZW50TW9kYWwsIGNhc2VKc29uKTsKCiAgICAgICAgLy9TZXQgdmFsdWVzIHRvIHRoZSBtb2RhbCBlbGVtZW50cy4KICAgICAgICB2YXIgY29tbWVudE1ldGFJbmZvID0gIiIKICAgICAgICBpZiAoY2FzZUpzb24uYWxlcnRUeXBlID09ICJBZ2dyZWdhdGUgQ2FzZSBBbGVydCIpIHsKICAgICAgICAgICAgY29tbWVudE1ldGFJbmZvID0gJzxzcGFuIGlkPSJwcm9kdWN0TmFtZSI+JyArIGNhc2VKc29uLnByb2R1Y3ROYW1lICsgJzwvc3Bhbj4gLSA8c3BhbiBpZD0iZXZlbnROYW1lIj4nICsgY2FzZUpzb24uZXZlbnROYW1lICsgJzwvc3Bhbj4nCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29tbWVudE1ldGFJbmZvID0gJzxzcGFuIGlkPSJjYXNlTnVtYmVyIj4nICsgY2FzZUpzb24uY2FzZU51bWJlciArICc8L3NwYW4+IC0gPHNwYW4gaWQ9InByb2R1Y3RGYW1pbHkiPicgKyBjYXNlSnNvbi5wcm9kdWN0RmFtaWx5ICsgJzwvc3Bhbj4nCiAgICAgICAgfQogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudC1tZXRhLWluZm8iKS5odG1sKGNvbW1lbnRNZXRhSW5mbyk7CiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNhcHBsaWNhdGlvbiIpLmh0bWwoY2FzZUpzb24uYWxlcnRUeXBlKTsKICAgICAgICBjb21tZW50TW9kYWwubW9kYWwoJ3Nob3cnKTsKICAgICAgICBiaW5kU2F2ZUNvbW1lbnQoY29tbWVudE1vZGFsKTsKICAgIH07CgogICAgdmFyIHBvcHVsYXRlQ29tbWVudHMgPSBmdW5jdGlvbiAoY29tbWVudE1vZGFsLCBjYXNlSnNvbiwgb25TaWduYWxTY3JlZW4pIHsKICAgICAgICB2YXIgdXBkYXRlZENvbW1lbnRzID0gJCgiI2NvbW1lbnRib3giKS52YWwoKTsKICAgICAgICAkLmFqYXgoewogICAgICAgICAgICB1cmw6ICIvc2lnbmFsL2FsZXJ0Q29tbWVudC9saXN0Q29tbWVudHMiLAogICAgICAgICAgICBkYXRhOiBjYXNlSnNvbiwKICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjbm8tY29tbWVudHMiKS5hZGRDbGFzcygiaGlkZSIpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcjY29tbWVudGJveCcpLnJlbW92ZUNsYXNzKCJoaWRlIik7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJy5hZGQtY29tbWVudHMnKS5odG1sKCJVcGRhdGUiKTsKICAgICAgICAgICAgICAgICAgICBpZih1cGRhdGVkQ29tbWVudHMubGVuZ3RoID49IHJlc3VsdC5jb21tZW50cy5sZW5ndGgpewogICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRib3giKS52YWwodXBkYXRlZENvbW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50Ym94IikudmFsKHJlc3VsdC5jb21tZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudElkIikudmFsKHJlc3VsdC5pZCk7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIi5jcmVhdGVkQnkiKS50ZXh0KCJMYXN0IE1vZGlmaWVkIGJ5ICIgKyByZXN1bHQubW9kaWZpZWRCeSArICIgb24gIiArIHJlc3VsdC5kYXRlVXBkYXRlZCk7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJy5hZGQtY29tbWVudHMnKS5wcm9wKCJkaXNhYmxlZCIsIHRydWUpOwoKICAgICAgICAgICAgICAgIH1lbHNlIGlmKHR5cGVvZiBpc0NvbW1lbnRBZGRlZCAhPSAndW5kZWZpbmVkJyAmJiBpc0NvbW1lbnRBZGRlZCAmJiBvblNpZ25hbFNjcmVlbil7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50SWQiKS52YWwoJycpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykuaHRtbCgiQWRkIik7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50Ym94IikudmFsKCcnKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI25vLWNvbW1lbnRzIikucmVtb3ZlQ2xhc3MoImhpZGUiKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLnByb3AoImRpc2FibGVkIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIi5jcmVhdGVkQnkiKS50ZXh0KCcnKTsKCiAgICAgICAgICAgICAgICB9ZWxzZSBpZih0eXBlb2YgaXNDb21tZW50QWRkZWQgIT0gJ3VuZGVmaW5lZCcgJiYgaXNDb21tZW50QWRkZWQpewogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudElkIikudmFsKCcnKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLmh0bWwoIkFkZCIpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudGJveCIpLnZhbCgnJyk7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNuby1jb21tZW50cyIpLnJlbW92ZUNsYXNzKCJoaWRlIik7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJy5hZGQtY29tbWVudHMnKS5wcm9wKCJkaXNhYmxlZCIsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcjY29tbWVudGJveCcpLmFkZENsYXNzKCJoaWRlIik7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIi5jcmVhdGVkQnkiKS50ZXh0KCcnKTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudElkIikudmFsKCcnKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiLmNyZWF0ZWRCeSIpLnRleHQoJycpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykuaHRtbCgiQWRkIik7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJy5hZGQtY29tbWVudHMnKS5wcm9wKCJkaXNhYmxlZCIsIHRydWUpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcjY29tbWVudGJveCcpLm9uKCJrZXl1cCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBpZihjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRJZCIpLnZhbCgpPT0iIiAmJiBjb21tZW50TW9kYWwuZmluZCgnI2NvbW1lbnRib3gnKS52YWwoKT09IiIpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykucHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJy5hZGQtY29tbWVudHMnKS5wcm9wKCJkaXNhYmxlZCIsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJVbmFibGUgdG8gbG9hZCBwcmV2aW91cyBjb21tZW50cy4iKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgYmluZFNhdmVDb21tZW50ID0gZnVuY3Rpb24gKGNvbW1lbnRNb2RhbCkgewoKICAgICAgICAvL0FkZCBjbGljayBldmVudCB0byB0aGUgYWRkIGNvbW1lbnQgYnV0dG9uLgogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIuYWRkLWNvbW1lbnRzIikudW5iaW5kKCkuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgY2FzZUpzb25PYmpBcnJheSA9IFtdOwogICAgICAgICAgICB2YXIgYXBwVHlwZSA9ICQoIiNhcHBsaWNhdGlvbiIpLmh0bWwoKTsKICAgICAgICAgICAgdmFyIHZhbGlkYXRlZFNpZ25hbElkID0gJCgiI3ZhbGlkYXRlZFNpZ25hbElkIikuaHRtbCgpOwogICAgICAgICAgICB2YXIgdG9waWNJZCA9ICQoIiN0b3BpY0lkIikuaHRtbCgpOwoKICAgICAgICAgICAgaWYgKGFwcFR5cGUgPT0gJycpIHsKICAgICAgICAgICAgICAgIGFwcFR5cGUgPSBjb21tZW50TW9kYWwuZmluZCgiI2FwcGxpY2F0aW9uIikuaHRtbCgpOwogICAgICAgICAgICAgICAgdmFsaWRhdGVkU2lnbmFsSWQgPSBjb21tZW50TW9kYWwuZmluZCgiI3ZhbGlkYXRlZFNpZ25hbElkIikuaHRtbCgpOwogICAgICAgICAgICAgICAgdG9waWNJZCA9IGNvbW1lbnRNb2RhbC5maW5kKCIjdG9waWNJZCIpLmh0bWwoKQogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgY2FzZUpzb25PYmo7CiAgICAgICAgICAgIHZhciB1cmw7CiAgICAgICAgICAgIHZhciBkYXRhOwogICAgICAgICAgICAvL0Nhc2UgSlNPTi4KICAgICAgICAgICAgY2FzZUpzb25PYmogPSB7CiAgICAgICAgICAgICAgICAiYWxlcnRUeXBlIjogYXBwVHlwZSwKICAgICAgICAgICAgICAgICJwcm9kdWN0TmFtZSI6IGNvbW1lbnRNb2RhbC5maW5kKCIjcHJvZHVjdE5hbWUiKS5odG1sKCksCiAgICAgICAgICAgICAgICAiZXZlbnROYW1lIjogY29tbWVudE1vZGFsLmZpbmQoIiNldmVudE5hbWUiKS5odG1sKCksCiAgICAgICAgICAgICAgICAiY29tbWVudHMiOiBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRib3giKS52YWwoKSwKICAgICAgICAgICAgICAgICJ2YWxpZGF0ZWRTaWduYWxJZCI6IHZhbGlkYXRlZFNpZ25hbElkLAogICAgICAgICAgICAgICAgImFzc2lnbmVkVG8iOiBjb21tZW50TW9kYWwuZmluZCgiI2Fzc2lnbmVkVG8iKS5odG1sKCksCiAgICAgICAgICAgICAgICAiZXhlY3V0ZWRDb25maWdJZCI6IGNvbW1lbnRNb2RhbC5maW5kKCIjZXhlY3V0ZWRDb25maWdJZCIpLmh0bWwoKSwKICAgICAgICAgICAgICAgICJjb25maWdJZCIgOiBjb21tZW50TW9kYWwuZmluZCgiI2NvbmZpZ0lkIikuaHRtbCgpLAogICAgICAgICAgICAgICAgInRvcGljSWQiOiBjb21tZW50TW9kYWwuZmluZCgiI3RvcGljSWQiKS5odG1sKCksCiAgICAgICAgICAgICAgICAicHJvZHVjdEZhbWlseSI6IGNvbW1lbnRNb2RhbC5maW5kKCIjcHJvZEZhbWlseSIpLmh0bWwoKSwKICAgICAgICAgICAgICAgICJjYXNlTnVtYmVyIjogY29tbWVudE1vZGFsLmZpbmQoIiNjYXNlTm8iKS5odG1sKCksCiAgICAgICAgICAgICAgICAicHJvZHVjdElkIjogcGFyc2VJbnQoY29tbWVudE1vZGFsLmZpbmQoIiNwcm9kdWN0SWQiKS5odG1sKCkpLAogICAgICAgICAgICAgICAgInB0Q29kZSI6IHBhcnNlSW50KGNvbW1lbnRNb2RhbC5maW5kKCIjcHRDb2RlIikuaHRtbCgpKQoKICAgICAgICAgICAgfTsKICAgICAgICAgICAgY2FzZUpzb25PYmpBcnJheS5wdXNoKGNhc2VKc29uT2JqKTsKICAgICAgICAgICAgaWYoY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50SWQiKS52YWwoKSl7CiAgICAgICAgICAgICAgICB1cmwgPSAiL3NpZ25hbC9hbGVydENvbW1lbnQvdXBkYXRlQ29tbWVudCI7CiAgICAgICAgICAgICAgICBkYXRhID0gewogICAgICAgICAgICAgICAgICAgICJhbGVydFR5cGUiOiBhcHBUeXBlLAogICAgICAgICAgICAgICAgICAgICJjb21tZW50IjogY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50Ym94IikudmFsKCksCiAgICAgICAgICAgICAgICAgICAgImlkIjogY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50SWQiKS52YWwoKSwKICAgICAgICAgICAgICAgICAgICAiZXhlY3V0ZWRDb25maWdJZCI6IGNvbW1lbnRNb2RhbC5maW5kKCIjZXhlY3V0ZWRDb25maWdJZCIpLmh0bWwoKSwKICAgICAgICAgICAgICAgICAgICAidmFsaWRhdGVkU2lnbmFsSWQiOiB2YWxpZGF0ZWRTaWduYWxJZAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICB1cmwgPSAiL3NpZ25hbC9hbGVydENvbW1lbnQvc2F2ZUNvbW1lbnQiOwogICAgICAgICAgICAgICAgZGF0YSA9IHsiY2FzZUpzb25PYmpBcnJheSI6IEpTT04uc3RyaW5naWZ5KGNhc2VKc29uT2JqQXJyYXkpfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgICAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdC5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjaXNVcGRhdGVkIikudmFsKCJ0cnVlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvcHVsYXRlQ29tbWVudHMoY29tbWVudE1vZGFsLCBjYXNlSnNvbk9iakFycmF5WzBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NvbW1lbnRib3gnKS52YWwoJycpLmJsdXIoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGJpbmRFZGl0Q29tbWVudCA9IGZ1bmN0aW9uIChjb21tZW50TW9kYWwpIHsKCiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIi5wcmV2aW91cy1jb21tZW50cyIpLmZpbmQoJy5lZGl0LWNvbW1lbnQnKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICQodGhpcykucGFyZW50KCkuZmluZCgiLnVwZGF0ZS1jb21tZW50IikucmVtb3ZlQ2xhc3MoImhpZGRlbiIpOwogICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmZpbmQoIi5jb21tZW50LWFyZWEiKS5hdHRyKCdkaXNhYmxlZCcsIGZhbHNlKTsKICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygiaGlkZGVuIikKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGJpbmREZWxldGVDb21tZW50ID0gZnVuY3Rpb24gKGNvbW1lbnRNb2RhbCwgY2FzZUpzb24pIHsKCiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIi5wcmV2aW91cy1jb21tZW50cyIpLmZpbmQoJy5kZWxldGUtY29tbWVudCcpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGlkID0gewogICAgICAgICAgICAgICAgImlkIjogJCh0aGlzKS5wYXJlbnQoKS5maW5kKCIuY29tbWVudElkIikudmFsKCksCiAgICAgICAgICAgICAgICAidmFsaWRhdGVkU2lnbmFsSWQiOiAkKCIjdmFsaWRhdGVkU2lnbmFsSWQiKS50ZXh0KCksCiAgICAgICAgICAgICAgICAiYWRob2NBbGVydElkIiA6IGNhc2VKc29uLmFkaG9jQWxlcnRJZAogICAgICAgICAgICB9OwogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgdXJsOiAiL3NpZ25hbC9hbGVydENvbW1lbnQvZGVsZXRlQ29tbWVudCIsCiAgICAgICAgICAgICAgICBkYXRhOiBpZCwKICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICBwb3B1bGF0ZUNvbW1lbnRzKGNvbW1lbnRNb2RhbCwgY2FzZUpzb24pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgYmluZFVwZGF0ZUNvbW1lbnQgPSBmdW5jdGlvbiAoY29tbWVudE1vZGFsLCBjYXNlSnNvbikgewoKCiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIi5wcmV2aW91cy1jb21tZW50cyIpLmZpbmQoJy51cGRhdGUtY29tbWVudCcpLmNsaWNrKGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgICQodGhpcykucGFyZW50KCkuZmluZCgiLmdseXBoaWNvbi1wZW5jaWwiKS5yZW1vdmVDbGFzcygiaGlkZGVuIik7CiAgICAgICAgICAgIHZhciBjb21tZW50RGF0YSA9IHsKICAgICAgICAgICAgICAgICJjb21tZW50IjogJCh0aGlzKS5wYXJlbnQoKS5maW5kKCIuY29tbWVudC1hcmVhIikudmFsKCksCiAgICAgICAgICAgICAgICAiaWQiOiAkKHRoaXMpLnBhcmVudCgpLmZpbmQoIi5jb21tZW50SWQiKS52YWwoKSwKICAgICAgICAgICAgICAgICJ2YWxpZGF0ZWRTaWduYWxJZCI6ICQoIiN2YWxpZGF0ZWRTaWduYWxJZCIpLnRleHQoKSwKICAgICAgICAgICAgICAgICJ0b3BpY0lkIjogJCgiI3RvcGljSWQiKS5odG1sKCksCiAgICAgICAgICAgICAgICAiZXhlY3V0ZWRDb25maWdJZCI6IGNhc2VKc29uLmV4ZWN1dGVkQ29uZmlnSWQsCiAgICAgICAgICAgICAgICAiYWRob2NBbGVydElkIiA6IGNhc2VKc29uLmFkaG9jQWxlcnRJZAogICAgICAgICAgICB9OwoKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDogIi9zaWduYWwvYWxlcnRDb21tZW50L3VwZGF0ZUNvbW1lbnQiLAogICAgICAgICAgICAgICAgZGF0YTogY29tbWVudERhdGEsCiAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CgogICAgICAgICAgICAgICAgICAgIHBvcHVsYXRlQ29tbWVudHMoY29tbWVudE1vZGFsLCBjYXNlSnNvbik7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgICAgbGlzdF9jb21tZW50czogbGlzdENvbW1lbnRzLAogICAgICAgIHBvcHVsYXRlX2NvbW1lbnRzOiBwb3B1bGF0ZUNvbW1lbnRzLAogICAgICAgIHNhdmVfY29tbWVudDogYmluZFNhdmVDb21tZW50CiAgICB9Cn0pKCk7CgoKdmFyIHNob3dUb3BpY1dpZGdldCA9IGZ1bmN0aW9uICgpIHsKICAgICQoIiN0b3BpYyIpLnNlbGVjdDIoewogICAgICAgIHRhZ3M6IHRydWUsCiAgICAgICAgcGxhY2Vob2xkZXI6ICJTZWxlY3QgdG9waWMiLAogICAgICAgIGFsbG93Q2xlYXI6IHRydWUsCiAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICBjcmVhdGVUYWc6IGZ1bmN0aW9uIChwYXJhbXMpIHsKICAgICAgICAgICAgdmFyIHRlcm0gPSAkLnRyaW0ocGFyYW1zLnRlcm0pOwogICAgICAgICAgICBpZiAodGVybSAhPSAiIikgewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBpZDogdGVybSwKICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXJtCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICB9CiAgICB9KTsKfTsKLy89IHJlcXVpcmUgYXBwL3B2cy9jb21tb24vcnhfY29tbW9uLmpzCi8vPSByZXF1aXJlIGFwcC9wdnMvY29tbW9uL3J4X2xpc3RfdXRpbHMuanMKLy89IHJlcXVpcmUgYXBwL3B2cy9jb21tb24vcnhfaGFuZGxlYmFyX2V4dC5qcwovLz0gcmVxdWlyZSBhcHAvcHZzL3RvcGljL2F0dGFjaEFsZXJ0VG9Ub3BpYy5qcwoKdmFyIHNpZ25hbCA9IHNpZ25hbCB8fCB7fTsKCnZhciB0b3BpY0RhdGE7CnZhciBjb2x1bW5TZXE7CnZhciBpc1ZpZXdJbnN0YW5jZSA9IDE7CnZhciBzaWduYWxBbGVydFR5cGUgPSB7CiAgICBTSU5HTEVfQ0FTRV9BTEVSVDogIlNpbmdsZSBDYXNlIEFsZXJ0IiwKICAgIEFHR1JFR0FURV9BTEVSVDogIkFnZ3JlZ2F0ZSBDYXNlIEFsZXJ0IiwKICAgIEVWREFTX0FMRVJUOiAiRXZkYXMgQWxlcnQiLAogICAgQURIT0NfQUxFUlQ6ICJBZC1Ib2MgQWxlcnQiLAogICAgTElURVJBVFVSRV9TRUFSQ0hfQUxFUlQ6ICJMaXRlcmF0dXJlIFNlYXJjaCBBbGVydCIKfQoKc2lnbmFsLmFsZXJ0UmV2aWV3ID0gKGZ1bmN0aW9uICgpIHsKCiAgICB2YXIgaWRzID0gW107CiAgICB2YXIgcm93cyA9IFtdOwoKICAgIHZhciBhcHBseUJ1c2luZXNzUnVsZXMgPSBmdW5jdGlvbiAocm93LCBkYXRhKSB7CiAgICAgICAgLy9BcHBseSB0aGUgZXVkcmEgcnVsZXMuCiAgICAgICAgaWYgKGRhdGEuZm9ybWF0KSB7CiAgICAgICAgICAgIHZhciBvYmogPSBKU09OLnBhcnNlKGRhdGEuZm9ybWF0KTsKICAgICAgICAgICAgdmFyIHRleHRPYmo7CiAgICAgICAgICAgICQuZWFjaChvYmoudGV4dC50YywgZnVuY3Rpb24gKGluZGV4LCBkYXRhKSB7CiAgICAgICAgICAgICAgICB0ZXh0T2JqID0gJChyb3cpLmZpbmQoJy4nICsgZGF0YSk7CiAgICAgICAgICAgICAgICB0ZXh0T2JqLmNzcygnY29sb3InLCBvYmoudGV4dC5jb2xvcik7CiAgICAgICAgICAgICAgICBpZiAob2JqLnRleHQuYm9sZCkgewogICAgICAgICAgICAgICAgICAgIHRleHRPYmouY3NzKCdmb250LXdlaWdodCcsICc5MDAnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChvYmoudGV4dC5pdGFsaWMpIHsKICAgICAgICAgICAgICAgICAgICB0ZXh0T2JqLmNzcygnZm9udC1zdHlsZScsICdpdGFsaWMnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChvYmoudGV4dC51bmRlcmxpbmUpIHsKICAgICAgICAgICAgICAgICAgICB0ZXh0T2JqLmNzcygndGV4dC1kZWNvcmF0aW9uJywgJ3VuZGVybGluZScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJC5lYWNoKG9iai5jZWxsLnRjLCBmdW5jdGlvbiAoaW5kZXgsIGRhdGEpIHsKICAgICAgICAgICAgICAgICQocm93KS5maW5kKCcuJyArIGRhdGEpLnBhcmVudHMoJ3RkJykuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgb2JqLmNlbGwuY29sb3IpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9OwoKICAgIHZhciBlbmFibGVNZW51VG9vbHRpcHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgJCgiLmdyaWQtbWVudS10b29sdGlwIikubW91c2VvdmVyKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTsKICAgICAgICAgICAgdmFyIHRvb2x0aXBUZXh0ID0gJHRoaXMuYXR0cigiZGF0YS10aXRsZSIpOwogICAgICAgICAgICAkdGhpcy50b29sdGlwKHsKICAgICAgICAgICAgICAgIHRpdGxlOiB0b29sdGlwVGV4dCwKICAgICAgICAgICAgICAgIHBsYWNlbWVudDogImJvdHRvbSIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICR0aGlzLnRvb2x0aXAoJ3Nob3cnKTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGRpc2FibGVUb29sdGlwcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAkKCIubWRpLWFscGhhLWQtYm94LCAubWRpLWZpbHRlci1vdXRsaW5lLCAubWRpLXRyZW5kaW5nLXVwLCAubWRpLWNvbnRlbnQtc2F2ZSwgLm1kaS1leHBvcnQsIC5tZGktc2V0dGluZ3MsIG1kaS1wbHVzLWJveCwgbWRpLWNoYXJ0LWJhciIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgJCgiLnRvb2x0aXAiKS5oaWRlKCk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBzb3J0SWNvbkhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHRoQXJyYXkgPSAkKCcjYWxlcnRzRGV0YWlsc1RhYmxlJykuRGF0YVRhYmxlKCkuY29sdW1ucygpLmhlYWRlcigpOwogICAgICAgIGlmIChpc1ZpZXdJbnN0YW5jZSkgewogICAgICAgICAgICB2YXIgY29sdW1uTmFtZTsKICAgICAgICAgICAgdmFyIGluZGV4T2ZDb2x1bW4gPSAwOwogICAgICAgICAgICBjb2x1bW5TZXEuZXZlcnkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHNlcSA9IGNvbHVtblNlcVtpbmRleE9mQ29sdW1uXS5zZXE7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT0gc2VxKSB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uTmFtZSA9IGNvbHVtblNlcVtpbmRleE9mQ29sdW1uXS5uYW1lOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGluZGV4T2ZDb2x1bW4rKzsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIGNvbHVtbkluZGV4ID0gJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLmZpbmQoInRoW2RhdGEtZmllbGQ9IiArIGNvbHVtbk5hbWUgKyAiXSIpLmF0dHIoJ2RhdGEtY29sdW1uLWluZGV4Jyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29sdW1uSW5kZXggPSBpbmRleDsKICAgICAgICB9CiAgICAgICAgJC5lYWNoKHRoQXJyYXksIGZ1bmN0aW9uIChjdXJyZW50SW5kZXgsIGVsZW1lbnQpIHsKICAgICAgICAgICAgaWYgKGVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzb3J0aW5nX2FzYycpKSB7CiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3NvcnRpbmdfYXNjJyk7CiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoInNvcnRpbmciKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnc29ydGluZ19kZXNjJykpIHsKICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnc29ydGluZ19kZXNjJyk7CiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoInNvcnRpbmciKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY3VycmVudEluZGV4ID09IGNvbHVtbkluZGV4ICYmICFlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnc29ydGluZ19kaXNhYmxlZCcpKSB7CiAgICAgICAgICAgICAgICBpZiAoZGlyID09ICdhc2MnKSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdzb3J0aW5nJyk7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCJzb3J0aW5nX2FzYyIpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkaXIgPT0gJ2Rlc2MnKSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdzb3J0aW5nJyk7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCJzb3J0aW5nX2Rlc2MiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfTsKCiAgICAvKioKICAgICAqIFRoZSByZXNldCBtb2RhbCBzY3JlZW4gZnVuY3Rpb24gd2hpY2ggcmVzZXRzIHRoZSBwYXNzd29yZCBkaXYgaW4gdGhlIHdvcmtmbG93IG1vZGFsIHNjcmVlbi4KICAgICAqIFRoaXMgaXMgaW50ZXJuYWwgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGludGVybmFsbHkgaW4gdGhpcyBvYmplY3Qgc2NvcGUuCiAgICAgKi8KICAgIHZhciByZXNldE1vZGFsU2NyZWVuID0gZnVuY3Rpb24gKCkgewogICAgICAgIC8vQ2xlYW4gdXAgdGhlIHRoZSBkaXNwb3NpdGlvbnMgZmllbGRzLgogICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsJykuZmluZCgnI2V4dHJhLXZhbHVlLXNlbGVjdCcpLmh0bWwoIjxvcHRpb24+PC9vcHRpb24+Iik7CiAgICAgICAgLy9IaWRlIHRoZSBwYXNzd29yZAogICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsJykuZmluZCgnI3Bhc3N3b3JkRGl2JykuYWRkQ2xhc3MoJ2hpZGUnKTsKICAgICAgICAkKCcjZWRpdC1zdGF0ZS1tb2RhbCcpLmZpbmQoJyNpc1Bhc3N3b3JkRW5hYmxlZCcpLnZhbCgwKTsKICAgIH0KCiAgICB2YXIgc2hvd1Bhc3N3b3JkRmllbGQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgJCgnI2VkaXQtc3RhdGUtbW9kYWwnKS5maW5kKCcjcGFzc3dvcmREaXYnKS5yZW1vdmVDbGFzcygnaGlkZScpOwogICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsJykuZmluZCgnI2lzUGFzc3dvcmRFbmFibGVkJykudmFsKDEpOwogICAgfQoKICAgIHZhciBjaGFuZ2VXb3JrZmxvd0VkaXRTY3JlZW4gPSBmdW5jdGlvbiAoYXZhaWxhYmxlVmFsdWVzLCB0YXJnZXRWYWwpIHsKCiAgICAgICAgdmFyIGF2YWlsYWJsZVZhbE9iaiA9IF8uZmluZFdoZXJlKGF2YWlsYWJsZVZhbHVlcywge3ZhbHVlOiB0YXJnZXRWYWx9KTsKCiAgICAgICAgaWYgKHR5cGVvZiBhdmFpbGFibGVWYWxPYmogIT0gJ3VuZGVmaW5lZCcgJiYgYXZhaWxhYmxlVmFsT2JqKSB7CiAgICAgICAgICAgIGlmIChhdmFpbGFibGVWYWxPYmouYXBwcm92YWxSZXF1aXJlZCkgewogICAgICAgICAgICAgICAgc2hvd1Bhc3N3b3JkRmllbGQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlc2V0TW9kYWxTY3JlZW4oKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9DbGVhbiB1cCB0aGUgdGhlIGRpc3Bvc2l0aW9ucyBmaWVsZHMKICAgICAgICAgICAgJCgnI2VkaXQtc3RhdGUtbW9kYWwnKS5maW5kKCcjZXh0cmEtdmFsdWUtc2VsZWN0JykuaHRtbCgnJykKCiAgICAgICAgICAgIC8vRmlsbCB1cCB0aGUgZGlzcG9zaXRpb25zIGluIHRoZSBjb21ibwogICAgICAgICAgICAkKCcjZWRpdC1zdGF0ZS1tb2RhbCcpLmZpbmQoJyNleHRyYS12YWx1ZS1zZWxlY3QnKS5odG1sKGdldERpc3Bvc2l0aW9uT3B0aW9ucyhhdmFpbGFibGVWYWxPYmopKQogICAgICAgIH0KICAgIH0KCiAgICB2YXIgZ2V0RGlzcG9zaXRpb25PcHRpb25zID0gZnVuY3Rpb24gKGF2YWlsYWJsZVZhbE9iaikgewogICAgICAgIHZhciBkaXNwb3NpdGlvblN0ciA9ICI8b3B0aW9uPjwvb3B0aW9uPiI7CiAgICAgICAgXy5lYWNoKGF2YWlsYWJsZVZhbE9iai5kaXNwb3NpdGlvbnMsIGZ1bmN0aW9uIChkaXNwb3NpdGlvbikgewogICAgICAgICAgICBkaXNwb3NpdGlvblN0ciA9IGRpc3Bvc2l0aW9uU3RyICsKICAgICAgICAgICAgICAgICI8b3B0aW9uIHZhbHVlPVwiIiArIGRpc3Bvc2l0aW9uLnZhbHVlICsgIlwiPiIgKyBkaXNwb3NpdGlvbi5kaXNwbGF5TmFtZSArICI8L29wdGlvbj4iCiAgICAgICAgfSkKICAgICAgICByZXR1cm4gZGlzcG9zaXRpb25TdHIKICAgIH0KCiAgICB2YXIgYXV0aGVudGljYXRlVXNlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgcmV0dXJuVmFsID0gZmFsc2UKICAgICAgICB2YXIgcGFzc3dvcmRKc29uID0gewogICAgICAgICAgICAicGFzc3dvcmQiOiAkKCcjZWRpdC1zdGF0ZS1tb2RhbCcpLmZpbmQoJyNwYXNzd29yZEF1dGhlbnRpY2F0aW9uJykudmFsKCkKICAgICAgICB9CgogICAgICAgIHZhciBhdXRoVXJsID0gJy9zaWduYWwvdXNlci9hdXRoZW50aWNhdGUnCgogICAgICAgICQuYWpheCh7CiAgICAgICAgICAgIHVybDogYXV0aFVybCwKICAgICAgICAgICAgZGF0YTogcGFzc3dvcmRKc29uLAogICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuYXV0aG9yaXplZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IHRydWUKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsID0gZmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gcmV0dXJuVmFsCiAgICB9CgogICAgdmFyIHRvZ2dsZUVycm9yTm90aWZpY2F0aW9uID0gZnVuY3Rpb24gKGFjdGlvbikgewogICAgICAgIGlmIChhY3Rpb24gPT0gJ2hpZGUnKSB7CiAgICAgICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsIC5lcnJvck5vdGlmaWNhdGlvbicpLmFkZENsYXNzKCdoaWRlJyk7CiAgICAgICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsJykuZmluZCgnLmVycm9yTWVzc2FnZScpLmh0bWwoJycpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsIC5lcnJvck5vdGlmaWNhdGlvbicpLnJlbW92ZUNsYXNzKCdoaWRlJykKICAgICAgICAgICAgJCgnI2VkaXQtc3RhdGUtbW9kYWwnKS5maW5kKCcuZXJyb3JNZXNzYWdlJykuaHRtbCgnIEF1dGhlbnRpY2F0aW9uIEZhaWxlZCEnKTsKICAgICAgICB9CiAgICB9OwoKICAgIHZhciBvcGVuQ2FzZUhpc3RvcnlNb2RhbCA9IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgLy9CaW5kIHRoZSBjbGljayBldmVudCBvbiB0aGUgY2FzZSBoaXN0b3J5IGljb24uCiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5jYXNlLWhpc3RvcnktaWNvbicsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB2YXIgcGFyZW50X3JvdyA9ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCd0cicpOwogICAgICAgICAgICB2YXIgc2VsZWN0ZWRSb3dJbmRleCA9ICQodGhpcykuY2xvc2VzdCgndHInKS5pbmRleCgpOwogICAgICAgICAgICBpZiAoaXNBYnN0cmFjdFZpZXdPckNhc2VWaWV3KHNlbGVjdGVkUm93SW5kZXgpKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZFJvd0luZGV4ID0gc2VsZWN0ZWRSb3dJbmRleCAvIDIKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgaXNTaWduYWwgPSAkKHRoaXMpLmRhdGEoJ3NpZ25hbCcpOwoKICAgICAgICAgICAgdmFyIHJvd09iamVjdCA9IHt9OwogICAgICAgICAgICBpZiAoIWlzU2lnbmFsKSB7CiAgICAgICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZS5yb3dzKHNlbGVjdGVkUm93SW5kZXgpLmRhdGEoKVswXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJvd09iamVjdCA9IHRhYmxlU2luZ2xlUmV2aWV3LnJvdygkKHRoaXMpLnBhcmVudHMoJ3RyJykpLmRhdGEoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgY2FzZU51bWJlciA9IHJvd09iamVjdC5jYXNlTnVtYmVyOwogICAgICAgICAgICB2YXIgcHJvZHVjdEZhbWlseSA9IHJvd09iamVjdC5wcm9kdWN0RmFtaWx5OwogICAgICAgICAgICB2YXIgY2FzZVZlcnNpb24gPSByb3dPYmplY3QuY2FzZVZlcnNpb247CiAgICAgICAgICAgIHZhciBwcm9kdWN0TmFtZSA9IHJvd09iamVjdC5wcm9kdWN0TmFtZTsKICAgICAgICAgICAgdmFyIHB0ID0gcm93T2JqZWN0LnByaW1hcnlFdmVudDsKICAgICAgICAgICAgdmFyIGFsZXJ0Q29uZmlnSWQgPSByb3dPYmplY3QuYWxlcnRDb25maWdJZDsKCiAgICAgICAgICAgIHZhciBjYXNlSGlzdG9yeU1vZGFsID0gJCgnI2Nhc2VIaXN0b3J5TW9kYWwnKTsKICAgICAgICAgICAgY2FzZUhpc3RvcnlNb2RhbC5maW5kKCIjY2FzZU51bWJlciIpLmh0bWwoY2FzZU51bWJlcik7CiAgICAgICAgICAgIGNhc2VIaXN0b3J5TW9kYWwuZmluZCgiI3Byb2R1Y3RGYW1pbHkiKS5odG1sKHByb2R1Y3RGYW1pbHkpOwogICAgICAgICAgICBjYXNlSGlzdG9yeU1vZGFsLmZpbmQoIiNjYXNlVmVyc2lvbiIpLnZhbChjYXNlVmVyc2lvbik7CiAgICAgICAgICAgIGNhc2VIaXN0b3J5TW9kYWwuZmluZCgiI3Byb2R1Y3ROYW1lIikudmFsKHByb2R1Y3ROYW1lKTsKICAgICAgICAgICAgY2FzZUhpc3RvcnlNb2RhbC5maW5kKCIjYWxlcnRDb25maWdJZCIpLnZhbChhbGVydENvbmZpZ0lkKTsKICAgICAgICAgICAgY2FzZUhpc3RvcnlNb2RhbC5maW5kKCIjcHQiKS52YWwocHQpOwogICAgICAgICAgICBjYXNlSGlzdG9yeU1vZGFsLm1vZGFsKCdzaG93Jyk7CgogICAgICAgICAgICBpZih0eXBlb2Ygc2luZ2xlQ2FzZVVwZGF0ZUp1c3RpZmljYXRpb25VcmwgIT0gJ3VuZGVmaW5lZCcpCiAgICAgICAgICAgICAgICB1cGRhdGVKdXN0aWZpY2F0aW9uVXJsID0gc2luZ2xlQ2FzZVVwZGF0ZUp1c3RpZmljYXRpb25Vcmw7CgogICAgICAgICAgICBzaWduYWwuY2FzZUhpc3RvcnlUYWJsZS5pbml0X2Nhc2VfaGlzdG9yeV90YWJsZShjYXNlSGlzdG9yeVVybCk7CiAgICAgICAgICAgIHNpZ25hbC5jYXNlSGlzdG9yeVRhYmxlLmluaXRfY2FzZV9oaXN0b3J5X3RhYmxlX3N1c3BlY3QoY2FzZUhpc3RvcnlTdXNwZWN0VXJsKTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIG9wZW5BbGVydENvbW1lbnRNb2RhbCA9IGZ1bmN0aW9uIChhbGVydFR5cGUsIGFwcGxpY2F0aW9uTmFtZSkgewoKICAgICAgICAvL01vZGFsIG9iamVjdAogICAgICAgIHZhciBjb21tZW50TW9kYWwgPSAkKCcjY29tbWVudE1vZGFsJyk7CiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5jb21tZW50LWljb24nLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpczsKICAgICAgICAgICAgdmFyIGRhdGFJbmZvOwogICAgICAgICAgICB2YXIgaXNDYXNlRGV0YWlsOwogICAgICAgICAgICB2YXIgYXBwVHlwZTsKICAgICAgICAgICAgdmFyIHZhbGlkYXRlZFNpZ25hbElkOwogICAgICAgICAgICB2YXIgY29tbWVudEFsZXJ0VHlwZSA9ICQoJHRoaXMpLmRhdGEoJ25hbWUnKTsKICAgICAgICAgICAgdmFyIGlzU2lnbmFsID0gJCgkdGhpcykuZGF0YSgnc2lnbmFsJyk7CgogICAgICAgICAgICBpZiAoY29tbWVudEFsZXJ0VHlwZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBhbGVydFR5cGUgPSBjb21tZW50QWxlcnRUeXBlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHZhciBjYXNlSnNvbkFycmF5ID0gW107CiAgICAgICAgICAgIGRhdGFJbmZvID0gJChldmVudC50YXJnZXQpLmF0dHIoJ2RhdGEtaW5mbycpOwogICAgICAgICAgICBpc0Nhc2VEZXRhaWwgPSAkKGV2ZW50LnRhcmdldCkuYXR0cignZGF0YS1jb21tZW50Jyk7CgogICAgICAgICAgICBhcHBUeXBlID0gJCgiI2FwcGxpY2F0aW9uIikuaHRtbCgpOwogICAgICAgICAgICBpZiAoYXBwVHlwZSA9PT0gJycpIHsKICAgICAgICAgICAgICAgIGFwcFR5cGUgPSBjb21tZW50TW9kYWwuZmluZCgiI2FwcGxpY2F0aW9uIikuaHRtbCgpOwogICAgICAgICAgICAgICAgdmFsaWRhdGVkU2lnbmFsSWQgPSBjb21tZW50TW9kYWwuZmluZCgiI3ZhbGlkYXRlZFNpZ25hbElkIikuaHRtbCgpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBzZWxlY3RlZFJvd0NvdW50OwogICAgICAgICAgICBpZiAoJCgnI2RldGFpbGVkLXZpZXctY2hlY2tib3gnKS5pcygnOmNoZWNrZWQnKSkgewogICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dDb3VudCA9ICQoJ3RhYmxlI2FsZXJ0c0RldGFpbHNUYWJsZSAuY29weS1zZWxlY3Q6Y2hlY2tlZCcpLmxlbmd0aDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNlbGVjdGVkUm93Q291bnQgPSAkKCd0YWJsZS5EVEZDX0Nsb25lZCAuY29weS1zZWxlY3Q6Y2hlY2tlZCcpLmxlbmd0aDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2VsZWN0ZWRSb3dDb3VudCA+IDEgJiYgJCgkdGhpcykuY2xvc2VzdCgndHInKS5maW5kKCIuY29weS1zZWxlY3QiKS5wcm9wKCJjaGVja2VkIikpIHsKICAgICAgICAgICAgICAgIHZhciB0ZXh0VG9EaXNwbGF5OwogICAgICAgICAgICAgICAgc3dpdGNoIChhcHBsaWNhdGlvbk5hbWUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICdTaW5nbGUgQ2FzZSBBbGVydCc6CiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRUb0Rpc3BsYXkgPSAnQ2FzZSc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ0FnZ3JlZ2F0ZSBDYXNlIEFsZXJ0JzoKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dFRvRGlzcGxheSA9ICdQRUMnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdFVkRBUyBBbGVydCc6CiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRUb0Rpc3BsYXkgPSAnUEVDJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTGl0ZXJhdHVyZSBTZWFyY2ggQWxlcnQnOgogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0VG9EaXNwbGF5ID0gJ0FydGljbGUnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICQoY29tbWVudE1vZGFsKS5maW5kKCdkaXYuYnVsa09wdGlvbnNTZWN0aW9uJykuc2hvdygpOwogICAgICAgICAgICAgICAgJChjb21tZW50TW9kYWwpLmZpbmQoJ2Rpdi5idWxrT3B0aW9uc1NlY3Rpb24gc3Bhbi5hbGVydFR5cGVUZXh0JykuaHRtbCh0ZXh0VG9EaXNwbGF5KTsKICAgICAgICAgICAgICAgICQoY29tbWVudE1vZGFsKS5maW5kKCdkaXYuYnVsa09wdGlvbnNTZWN0aW9uIHNwYW4uY291bnQnKS5odG1sKHNlbGVjdGVkUm93Q291bnQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJChjb21tZW50TW9kYWwpLmZpbmQoJ2Rpdi5idWxrT3B0aW9uc1NlY3Rpb24nKS5oaWRlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICQoJ2Rpdi5idWxrT3B0aW9uc1NlY3Rpb24gaW5wdXRbbmFtZT1idWxrT3B0aW9uc10nKS51bmJpbmQoKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgc3dpdGNoICgkKHRoaXMpLnZhbCgpKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYWxsU2VsZWN0ZWQnOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbkFycmF5ID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYXRlU2luZ2xlQnVsa1Jvd0NvbW1lbnRQcm9jZXNzKGNhc2VKc29uQXJyYXksIGNvbW1lbnRNb2RhbCwgYWxlcnRUeXBlLCBpc0Nhc2VEZXRhaWwsIGlzU2lnbmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgYmluZEFkZENvbW1lbnRzKGNvbW1lbnRNb2RhbCwgY2FzZUpzb25BcnJheSwgImJ1bGsiLCBhbGVydFR5cGUsIHZhbGlkYXRlZFNpZ25hbElkLCBpc0Nhc2VEZXRhaWwpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdjdXJyZW50JzoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZUpzb25BcnJheSA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICBpbml0aWF0ZVNpbmdsZVJvd0NvbW1lbnRQcm9jZXNzKCR0aGlzLCBjYXNlSnNvbkFycmF5LCBjb21tZW50TW9kYWwsIGFsZXJ0VHlwZSwgaXNDYXNlRGV0YWlsLCBpc1NpZ25hbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJpbmRBZGRDb21tZW50cyhjb21tZW50TW9kYWwsIGNhc2VKc29uQXJyYXksICJyb3ciLCBhbGVydFR5cGUsIHZhbGlkYXRlZFNpZ25hbElkLCBpc0Nhc2VEZXRhaWwpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoZGF0YUluZm8gPT09ICJyb3ciKSB7CiAgICAgICAgICAgICAgICBpbml0aWF0ZVNpbmdsZVJvd0NvbW1lbnRQcm9jZXNzKCR0aGlzLCBjYXNlSnNvbkFycmF5LCBjb21tZW50TW9kYWwsIGFsZXJ0VHlwZSwgaXNDYXNlRGV0YWlsLCBpc1NpZ25hbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5tb2RhbCgnc2hvdycpOwogICAgICAgICAgICBiaW5kQWRkQ29tbWVudHMoY29tbWVudE1vZGFsLCBjYXNlSnNvbkFycmF5LCBkYXRhSW5mbywgYWxlcnRUeXBlLCB2YWxpZGF0ZWRTaWduYWxJZCwgaXNDYXNlRGV0YWlsLCAkdGhpcykKICAgICAgICB9KQogICAgfTsKCiAgICB2YXIgYmluZEFkZENvbW1lbnRzID0gZnVuY3Rpb24gKGNvbW1lbnRNb2RhbCwgY2FzZUpzb25BcnJheSwgZGF0YUluZm8sIGFsZXJ0VHlwZSwgdmFsaWRhdGVkU2lnbmFsSWQsIGlzQ2FzZURldGFpbCwgY3VycmVudFJvdykgewogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIuYWRkLWNvbW1lbnRzIikudW5iaW5kKCkuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgY2FzZUpzb247CiAgICAgICAgICAgIHZhciBjYXNlSnNvbk9iajsKICAgICAgICAgICAgdmFyIGRhdGE7CiAgICAgICAgICAgIHZhciB1cmw7CiAgICAgICAgICAgIHZhciAkdGhpcyA9IHRoaXM7CiAgICAgICAgICAgIHZhciBjYXNlSnNvbk9iakFycmF5ID0gW107CiAgICAgICAgICAgIGlmIChkYXRhSW5mbyA9PT0gInJvdyIpIHsKICAgICAgICAgICAgICAgIGNhc2VKc29uID0gY2FzZUpzb25BcnJheVswXTsKCiAgICAgICAgICAgICAgICBpZiAoY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50SWQiKS52YWwoKSkgewogICAgICAgICAgICAgICAgICAgIGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICJhbGVydFR5cGUiOiBhbGVydFR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICJjb21tZW50IjogY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50Ym94IikudmFsKCksCiAgICAgICAgICAgICAgICAgICAgICAgICJpZCI6IGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudElkIikudmFsKCksCiAgICAgICAgICAgICAgICAgICAgICAgICJ2YWxpZGF0ZWRTaWduYWxJZCI6IHZhbGlkYXRlZFNpZ25hbElkLAogICAgICAgICAgICAgICAgICAgICAgICAidG9waWNJZCI6ICQoIiN0b3BpY0lkIikuaHRtbCgpLAogICAgICAgICAgICAgICAgICAgICAgICAiZXhlY3V0ZWRDb25maWdJZCI6IGNhc2VKc29uLmV4ZWN1dGVkQ29uZmlnSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJhZGhvY0FsZXJ0SWQiOiBjYXNlSnNvbi5hZGhvY0FsZXJ0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJjb25maWdJZCI6IGNhc2VKc29uLmNvbmZpZ0lkLAogICAgICAgICAgICAgICAgICAgICAgICAibGl0ZXJhdHVyZUFsZXJ0SWQiOiBjYXNlSnNvbi5saXRlcmF0dXJlQWxlcnRJZAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgaWYoZGF0YS5jb21tZW50PT0iIikgewogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSAiL3NpZ25hbC9hbGVydENvbW1lbnQvZGVsZXRlQ29tbWVudCI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSAiL3NpZ25hbC9hbGVydENvbW1lbnQvdXBkYXRlQ29tbWVudCI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB1cmwgPSAiL3NpZ25hbC9hbGVydENvbW1lbnQvc2F2ZUNvbW1lbnQiOwoKICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbk9iaiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgImFsZXJ0VHlwZSI6IGFsZXJ0VHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgInByb2R1Y3ROYW1lIjogY2FzZUpzb24ucHJvZHVjdE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJldmVudE5hbWUiOiBjYXNlSnNvbi5ldmVudE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJwdCI6IGNhc2VKc29uLnB0LAogICAgICAgICAgICAgICAgICAgICAgICAiY29tbWVudHMiOiBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRib3giKS52YWwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgImNhc2VOdW1iZXIiOiBjYXNlSnNvbi5jYXNlTnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICAicHJvZHVjdEZhbWlseSI6IGNhc2VKc29uLnByb2R1Y3RGYW1pbHksCiAgICAgICAgICAgICAgICAgICAgICAgICJ2YWxpZGF0ZWRTaWduYWxJZCI6IHZhbGlkYXRlZFNpZ25hbElkLAogICAgICAgICAgICAgICAgICAgICAgICAidG9waWNJZCI6IGNvbW1lbnRNb2RhbC5maW5kKCIjdG9waWNJZCIpLmh0bWwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgImFzc2lnbmVkVG8iOiBjYXNlSnNvbi5hc3NpZ25lZFRvLAogICAgICAgICAgICAgICAgICAgICAgICAiYWRob2NBbGVydElkIjogY2FzZUpzb24uYWRob2NBbGVydElkLAogICAgICAgICAgICAgICAgICAgICAgICAiZXhlY3V0ZWRDb25maWdJZCI6IGNhc2VKc29uLmV4ZWN1dGVkQ29uZmlnSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJwcm9kdWN0SWQiOiBjYXNlSnNvbi5wcm9kdWN0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJwdENvZGUiOiBjYXNlSnNvbi5wdENvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICJjb25maWdJZCI6IGNhc2VKc29uLmNvbmZpZ0lkLAogICAgICAgICAgICAgICAgICAgICAgICAibGl0ZXJhdHVyZUFsZXJ0SWQiOiBjYXNlSnNvbi5saXRlcmF0dXJlQWxlcnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgImFydGljbGVJZCI6IGNhc2VKc29uLmFydGljbGVJZAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZUpzb25PYmpBcnJheS5wdXNoKGNhc2VKc29uT2JqKTsKICAgICAgICAgICAgICAgICAgICBkYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbk9iakFycmF5OiBKU09OLnN0cmluZ2lmeShjYXNlSnNvbk9iakFycmF5KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHVybCA9ICIvc2lnbmFsL2FsZXJ0Q29tbWVudC9zYXZlQ29tbWVudCI7CiAgICAgICAgICAgICAgICB2YXIgc2VsZWN0ZWRSb3dDb3VudDsKICAgICAgICAgICAgICAgIGlmICgkKCcjZGV0YWlsZWQtdmlldy1jaGVja2JveCcpLmlzKCc6Y2hlY2tlZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dDb3VudCA9ICQoJ3RhYmxlI2FsZXJ0c0RldGFpbHNUYWJsZSAuY29weS1zZWxlY3Q6Y2hlY2tlZCcpLmxlbmd0aDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dDb3VudCA9ICQoJ3RhYmxlLkRURkNfQ2xvbmVkIC5jb3B5LXNlbGVjdDpjaGVja2VkJykubGVuZ3RoOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHNlbGVjdGVkUm93Q291bnQ7IGluZGV4KyspIHsKICAgICAgICAgICAgICAgICAgICB2YWxpZGF0ZWRTaWduYWxJZCA9ICQoIiN2YWxpZGF0ZWRTaWduYWxJZCIpLmh0bWwoKTsKICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbiA9IGNhc2VKc29uQXJyYXlbaW5kZXhdOwoKICAgICAgICAgICAgICAgICAgICAvL0Nhc2UgSlNPTi4KICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbk9iaiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgImFsZXJ0VHlwZSI6IGFsZXJ0VHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgInByb2R1Y3ROYW1lIjogY2FzZUpzb24ucHJvZHVjdE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJldmVudE5hbWUiOiBjYXNlSnNvbi5ldmVudE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJwdCI6IGNhc2VKc29uLnB0LAogICAgICAgICAgICAgICAgICAgICAgICAiY29tbWVudHMiOiBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRib3giKS52YWwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgImNhc2VOdW1iZXIiOiBjYXNlSnNvbi5jYXNlTnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICAicHJvZHVjdEZhbWlseSI6IGNhc2VKc29uLnByb2R1Y3RGYW1pbHksCiAgICAgICAgICAgICAgICAgICAgICAgICJ2YWxpZGF0ZWRTaWduYWxJZCI6IHZhbGlkYXRlZFNpZ25hbElkLAogICAgICAgICAgICAgICAgICAgICAgICAidG9waWNJZCI6IGNvbW1lbnRNb2RhbC5maW5kKCIjdG9waWNJZCIpLmh0bWwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgImFzc2lnbmVkVG8iOiBjYXNlSnNvbi5hc3NpZ25lZFRvLAogICAgICAgICAgICAgICAgICAgICAgICAiYWRob2NBbGVydElkIjogY2FzZUpzb24uYWRob2NBbGVydElkLAogICAgICAgICAgICAgICAgICAgICAgICAicHJvZHVjdElkIjogY2FzZUpzb24ucHJvZHVjdElkLAogICAgICAgICAgICAgICAgICAgICAgICAicHRDb2RlIjogY2FzZUpzb24ucHRDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAiY29uZmlnSWQiOiBjYXNlSnNvbi5jb25maWdJZCwKICAgICAgICAgICAgICAgICAgICAgICAgImxpdGVyYXR1cmVBbGVydElkIjogY2FzZUpzb24ubGl0ZXJhdHVyZUFsZXJ0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJhcnRpY2xlSWQiOiBjYXNlSnNvbi5hcnRpY2xlSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJleGVjdXRlZENvbmZpZ0lkIjogY2FzZUpzb24uZXhlY3V0ZWRDb25maWdJZAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZUpzb25PYmpBcnJheS5wdXNoKGNhc2VKc29uT2JqKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbk9iakFycmF5OiBKU09OLnN0cmluZ2lmeShjYXNlSnNvbk9iakFycmF5KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvL1NhdmUgY29tbWVudCBjYWxsCiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgICB0eXBlOiAiUE9TVCIsCiAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICBiZWZvcmVTZW5kOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoImkuaXNQcm9jZXNzaW5nIikuc2hvdygpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiaS5pc1Byb2Nlc3NpbmciKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgLy9Qb3B1bGF0ZSB0aGUgY29tbWVudHMgYWdhaW4gaWYgc2luZ2xlIGNvbW1lbnQgaXMgYWRkZWQuCiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBpc0Nhc2VEZXRhaWwgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YUluZm8gPT09ICJyb3ciKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbC5hbGVydENvbW1lbnRzLnBvcHVsYXRlX2NvbW1lbnRzKGNvbW1lbnRNb2RhbCwgY2FzZUpzb24pOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY29tbWVudGJveCcpLnZhbCgnJykuYmx1cigpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5jb21tZW50ICE9ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93Q29tbWVudEljb24oY3VycmVudFJvdykgOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQ29tbWVudEljb24oY3VycmVudFJvdykgOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ21vZGFsLW9wZW4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnLm1vZGFsLWJhY2tkcm9wJykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaGVja2JveFNlbGVjdG9yOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCgnI2RldGFpbGVkLXZpZXctY2hlY2tib3gnKS5pcygnOmNoZWNrZWQnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tib3hTZWxlY3RvciA9ICd0YWJsZSNhbGVydHNEZXRhaWxzVGFibGUgLmNvcHktc2VsZWN0OmNoZWNrZWQnOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tib3hTZWxlY3RvciA9ICd0YWJsZS5EVEZDX0Nsb25lZCAuY29weS1zZWxlY3Q6Y2hlY2tlZCc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKCQoY2hlY2tib3hTZWxlY3RvciksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dDb21tZW50SWNvbih0aGlzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICQuTm90aWZpY2F0aW9uLm5vdGlmeSgnc3VjY2VzcycsICd0b3AgcmlnaHQnLCAiU3VjY2VzcyIsICJDb21tZW50cyBhZGRlZCBzdWNjZXNzZnVsbHkuIiwge2F1dG9IaWRlRGVsYXk6IDEwMDAwfSk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSkKICAgIH07CgogICAgdmFyIGluaXRpYXRlU2luZ2xlUm93Q29tbWVudFByb2Nlc3MgPSBmdW5jdGlvbiAoJHRoaXMsIGNhc2VKc29uQXJyYXksIGNvbW1lbnRNb2RhbCwgYWxlcnRUeXBlLCBpc0Nhc2VEZXRhaWwsIGlzU2lnbmFsKSB7CiAgICAgICAgdmFyIGFkaG9jQWxlcnRJZDsKICAgICAgICB2YXIgbGl0ZXJhdHVyZUFsZXJ0SWQ7CiAgICAgICAgdmFyIGFydGljbGVJZDsKCiAgICAgICAgdmFyIHJvd09iamVjdCA9IHt9OwogICAgICAgIGlmICgoYWxlcnRUeXBlID09PSAnQWdncmVnYXRlIENhc2UgQWxlcnQnIHx8IGFsZXJ0VHlwZSA9PT0gJ1NpbmdsZSBDYXNlIEFsZXJ0JyB8fCBhbGVydFR5cGUgPT09ICdFVkRBUyBBbGVydCcgfHwgYWxlcnRUeXBlID09PSAnTGl0ZXJhdHVyZSBTZWFyY2ggQWxlcnQnKSAmJiAhaXNTaWduYWwpIHsKICAgICAgICAgICAgdmFyIHNlbGVjdGVkUm93SW5kZXggPSAkKCR0aGlzKS5jbG9zZXN0KCd0cicpLmluZGV4KCk7CiAgICAgICAgICAgIGlmIChpc0Fic3RyYWN0Vmlld09yQ2FzZVZpZXcoc2VsZWN0ZWRSb3dJbmRleCkpIHsKICAgICAgICAgICAgICAgIHNlbGVjdGVkUm93SW5kZXggPSBzZWxlY3RlZFJvd0luZGV4IC8gMgogICAgICAgICAgICB9CiAgICAgICAgICAgIHJvd09iamVjdCA9IHRhYmxlLnJvdyhzZWxlY3RlZFJvd0luZGV4KS5kYXRhKCk7CiAgICAgICAgfSBlbHNlIGlmIChhbGVydFR5cGUgPT09ICdBZ2dyZWdhdGUgQ2FzZSBBbGVydCcpIHsKICAgICAgICAgICAgcm93T2JqZWN0ID0gdGFibGVBZ2dSZXZpZXcucm93KCQoJHRoaXMpLnBhcmVudHMoJ3RyJykpLmRhdGEoKTsKICAgICAgICB9IGVsc2UgaWYgKGFsZXJ0VHlwZSA9PT0gJ0xpdGVyYXR1cmUgU2VhcmNoIEFsZXJ0JykgewogICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZUxpdGVyYXR1cmVSZXZpZXcucm93KCQoJHRoaXMpLnBhcmVudHMoJ3RyJykpLmRhdGEoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZVNpbmdsZVJldmlldy5yb3coJCgkdGhpcykucGFyZW50cygndHInKSkuZGF0YSgpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNhc2VOdW1iZXIgPSByb3dPYmplY3QuY2FzZU51bWJlcjsKICAgICAgICB2YXIgcHJvZHVjdEZhbWlseSA9IHJvd09iamVjdC5wcm9kdWN0RmFtaWx5OwogICAgICAgIHZhciBjYXNlVmVyc2lvbiA9IHJvd09iamVjdC5jYXNlVmVyc2lvbjsKICAgICAgICB2YXIgcHJvZHVjdE5hbWUgPSByb3dPYmplY3QucHJvZHVjdE5hbWU7CiAgICAgICAgdmFyIGV2ZW50TmFtZSA9IHJvd09iamVjdC5wcmVmZXJyZWRUZXJtOwogICAgICAgIHZhciBwdCA9IHJvd09iamVjdC5wdDsKICAgICAgICB2YXIgYXNzaWduZWRUbyA9IHJvd09iamVjdC5hc3NpZ25lZFRvLmlkOwogICAgICAgIHZhciBhc3NpZ25lZFRvVXNlciA9IG51bGw7CiAgICAgICAgIGlmKHJvd09iamVjdC5hc3NpZ25lZFRvVXNlciAhPSB1bmRlZmluZWQpCiAgICAgICAgICAgICBhc3NpZ25lZFRvVXNlciA9IHJvd09iamVjdC5hc3NpZ25lZFRvVXNlci5pZDsKICAgICAgICB2YXIgcHJvZHVjdElkID0gcm93T2JqZWN0LnByb2R1Y3RJZDsKICAgICAgICB2YXIgcHRDb2RlID0gcm93T2JqZWN0LnB0Q29kZTsKICAgICAgICB2YXIgY29uZmlnSWQgPSByb3dPYmplY3QuYWxlcnRDb25maWdJZDsKICAgICAgICB2YXIgZXhlY3V0ZWRDb25maWdJZCA9IHJvd09iamVjdC5leGVjQ29uZmlnSWQ7CgogICAgICAgIGlmIChhbGVydFR5cGUgPT09IHNpZ25hbEFsZXJ0VHlwZS5BREhPQ19BTEVSVCkgewogICAgICAgICAgICBhZGhvY0FsZXJ0SWQgPSByb3dPYmplY3QuaWQ7CiAgICAgICAgfSBlbHNlIGlmIChhbGVydFR5cGUgPT09IHNpZ25hbEFsZXJ0VHlwZS5MSVRFUkFUVVJFX1NFQVJDSF9BTEVSVCkgewogICAgICAgICAgICBsaXRlcmF0dXJlQWxlcnRJZCA9IHJvd09iamVjdC5pZDsKICAgICAgICAgICAgYXJ0aWNsZUlkID0gcm93T2JqZWN0LmFydGljbGVJZAogICAgICAgIH0KICAgICAgICB2YXIgY2FzZUpzb24gPSB7CiAgICAgICAgICAgICJhbGVydFR5cGUiOiBhbGVydFR5cGUsCiAgICAgICAgICAgICJwcm9kdWN0RmFtaWx5IjogcHJvZHVjdEZhbWlseSwKICAgICAgICAgICAgImNhc2VOdW1iZXIiOiBjYXNlTnVtYmVyLAogICAgICAgICAgICAicHJvZHVjdE5hbWUiOiBwcm9kdWN0TmFtZSwKICAgICAgICAgICAgImV2ZW50TmFtZSI6IGV2ZW50TmFtZSwKICAgICAgICAgICAgInB0IjogcHQsCiAgICAgICAgICAgICJwdENvZGUiOiBwdENvZGUsCiAgICAgICAgICAgICJwcm9kdWN0SWQiOiBwcm9kdWN0SWQsCiAgICAgICAgICAgICJhc3NpZ25lZFRvIjogYXNzaWduZWRUbyA/IGFzc2lnbmVkVG8gOiBhc3NpZ25lZFRvVXNlciwKICAgICAgICAgICAgImV4ZWN1dGVkQ29uZmlnSWQiOiBleGVjdXRlZENvbmZpZ0lkLAogICAgICAgICAgICAiY29uZmlnSWQiOiBjb25maWdJZCwKICAgICAgICAgICAgImFkaG9jQWxlcnRJZCI6IGFkaG9jQWxlcnRJZCwKICAgICAgICAgICAgImxpdGVyYXR1cmVBbGVydElkIjogbGl0ZXJhdHVyZUFsZXJ0SWQsCiAgICAgICAgICAgICJhcnRpY2xlSWQiOiBhcnRpY2xlSWQKICAgICAgICB9OwoKICAgICAgICBjYXNlSnNvbkFycmF5LnB1c2goY2FzZUpzb24pOwogICAgICAgIHZhciBjb21tZW50TWV0YUluZm8gPSAiIjsKCiAgICAgICAgaWYgKGNhc2VKc29uLmFsZXJ0VHlwZSA9PT0gc2lnbmFsQWxlcnRUeXBlLkFHR1JFR0FURV9BTEVSVCB8fCBjYXNlSnNvbi5hbGVydFR5cGUgPT09IHNpZ25hbEFsZXJ0VHlwZS5FVkRBU19BTEVSVCkgewogICAgICAgICAgICBpZiAodHlwZW9mIChjYXNlSnNvbi5ldmVudE5hbWUpID09PSAidW5kZWZpbmVkIiB8fCB0eXBlb2YgKGNhc2VKc29uLnByb2R1Y3ROYW1lKSA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgIGNvbW1lbnRNZXRhSW5mbyA9ICIiCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb21tZW50TWV0YUluZm8gPSAnPHNwYW4gaWQ9InByb2R1Y3ROYW1lIj4nICsgY2FzZUpzb24ucHJvZHVjdE5hbWUgKyAnPC9zcGFuPiAtIDxzcGFuIGlkPSJldmVudE5hbWUiPicgKyBjYXNlSnNvbi5ldmVudE5hbWUgKyAnPC9zcGFuPicgKyAnPHNwYW4gY2xhc3M9ImhpZGRlbiIgaWQ9InByb2R1Y3RJZCI+JyArIGNhc2VKc29uLnByb2R1Y3RJZCArICc8L3NwYW4+JyArCiAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPSJoaWRkZW4iIGlkPSJwdENvZGUiPicgKyBjYXNlSnNvbi5wdENvZGUgKyAnPC9zcGFuPicKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgKGNhc2VKc29uLmNhc2VOdW1iZXIpID09PSAidW5kZWZpbmVkIiB8fCB0eXBlb2YgKGNhc2VKc29uLnByb2R1Y3RGYW1pbHkpID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgY29tbWVudE1ldGFJbmZvID0gIiIKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbW1lbnRNZXRhSW5mbyA9ICc8c3BhbiBpZD0iY2FzZU51bWJlciI+JyArIGNhc2VKc29uLmNhc2VOdW1iZXIgKyAnPC9zcGFuPiAtIDxzcGFuIGlkPSJwcm9kdWN0RmFtaWx5Ij4nICsgY2FzZUpzb24ucHJvZHVjdEZhbWlseSArICc8L3NwYW4+JwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudC1tZXRhLWluZm8iKS5odG1sKGNvbW1lbnRNZXRhSW5mbyk7CiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNhc3NpZ25lZFRvIikuaHRtbChhc3NpZ25lZFRvKTsKICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbmZpZ0lkIikuaHRtbChjb25maWdJZCk7CiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNhcHBsaWNhdGlvbiIpLmh0bWwoY2FzZUpzb24uYWxlcnRUeXBlKTsKCiAgICAgICAgLy9Qb3B1bGF0ZSB0aGUgZXhpc3RpbmcgY29tbWVudHMgYW5kIGJpbmQgZXZlbnRzIHRvIHRoZW0gaW4gY2FzZSBvZiBzaW5nbGUgY29tbWVudC4KICAgICAgICBpZiAodHlwZW9mIGlzQ2FzZURldGFpbCAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgJCgnI2xvYWRpbmdDb21tZW50cycpLmh0bWwoJycpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2lnbmFsLmFsZXJ0Q29tbWVudHMucG9wdWxhdGVfY29tbWVudHMoY29tbWVudE1vZGFsLCBjYXNlSnNvbik7CiAgICAgICAgfQogICAgICAgICQoIiNjb21tZW50TW9kYWwiKS5vbignaGlkZGVuLmJzLm1vZGFsJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAkKCcjY29tbWVudGJveCcpLnZhbCgnJyk7CiAgICAgICAgICAgICQoJy5hZGQtY29tbWVudHMnKS5odG1sKCdBZGQnKTsKICAgICAgICAgICAgJCgiLmNyZWF0ZWRCeSIpLnRleHQoJycpOwogICAgICAgIH0pCiAgICB9OwoKICAgIHZhciBpbml0aWF0ZVNpbmdsZUJ1bGtSb3dDb21tZW50UHJvY2VzcyA9IGZ1bmN0aW9uIChjYXNlSnNvbkFycmF5LCBjb21tZW50TW9kYWwsIGFsZXJ0VHlwZSwgaXNDYXNlRGV0YWlsLCBpc1NpZ25hbCkgewogICAgICAgIHZhciBpbmRleFNldCA9IG5ldyBTZXQoKTsKICAgICAgICB2YXIgY2hlY2tib3hTZWxlY3RvcjsKICAgICAgICBpZiAoJCgnI2RldGFpbGVkLXZpZXctY2hlY2tib3gnKS5pcygnOmNoZWNrZWQnKSkgewogICAgICAgICAgICBjaGVja2JveFNlbGVjdG9yID0gJ3RhYmxlI2FsZXJ0c0RldGFpbHNUYWJsZSAuY29weS1zZWxlY3Q6Y2hlY2tlZCc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2hlY2tib3hTZWxlY3RvciA9ICd0YWJsZS5EVEZDX0Nsb25lZCAuY29weS1zZWxlY3Q6Y2hlY2tlZCc7CiAgICAgICAgfQogICAgICAgICQuZWFjaCgkKGNoZWNrYm94U2VsZWN0b3IpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxlY3RlZFJvd0luZGV4ID0gJCh0aGlzKS5jbG9zZXN0KCd0cicpLmluZGV4KCk7CiAgICAgICAgICAgIGlmIChpc0Fic3RyYWN0Vmlld09yQ2FzZVZpZXcoc2VsZWN0ZWRSb3dJbmRleCkpCiAgICAgICAgICAgICAgICBzZWxlY3RlZFJvd0luZGV4ID0gc2VsZWN0ZWRSb3dJbmRleCAvIDI7CiAgICAgICAgICAgIGluZGV4U2V0LmFkZCgoc2VsZWN0ZWRSb3dJbmRleCkpOwogICAgICAgIH0pOwogICAgICAgIGluZGV4U2V0LmZvckVhY2goZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgICAgICAgIHZhciBhZGhvY0FsZXJ0SWQ7CiAgICAgICAgICAgIHZhciBsaXRlcmF0dXJlQWxlcnRJZDsKICAgICAgICAgICAgdmFyIGFydGljbGVJZDsKICAgICAgICAgICAgdmFyIHJvd09iamVjdCA9IHt9OwogICAgICAgICAgICBpZiAoKGFsZXJ0VHlwZSA9PT0gJ0FnZ3JlZ2F0ZSBDYXNlIEFsZXJ0JyB8fCBhbGVydFR5cGUgPT09ICdTaW5nbGUgQ2FzZSBBbGVydCcgfHwgYWxlcnRUeXBlID09PSAnRVZEQVMgQWxlcnQnIHx8IGFsZXJ0VHlwZSA9PT0gJ0xpdGVyYXR1cmUgU2VhcmNoIEFsZXJ0JykgJiYgIWlzU2lnbmFsKSB7CiAgICAgICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZS5yb3dzKGluZGV4KS5kYXRhKClbMF07CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWxlcnRUeXBlID09PSAnQWdncmVnYXRlIENhc2UgQWxlcnQnKSB7CiAgICAgICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZUFnZ1Jldmlldy5yb3dzKGluZGV4KS5kYXRhKClbMF07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZVNpbmdsZVJldmlldy5yb3dzKGluZGV4KS5kYXRhKClbMF07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBjYXNlTnVtYmVyID0gcm93T2JqZWN0LmNhc2VOdW1iZXI7CiAgICAgICAgICAgIHZhciBwcm9kdWN0RmFtaWx5ID0gcm93T2JqZWN0LnByb2R1Y3RGYW1pbHk7CiAgICAgICAgICAgIHZhciBjYXNlVmVyc2lvbiA9IHJvd09iamVjdC5jYXNlVmVyc2lvbjsKICAgICAgICAgICAgdmFyIHByb2R1Y3ROYW1lID0gcm93T2JqZWN0LnByb2R1Y3ROYW1lOwogICAgICAgICAgICB2YXIgZXZlbnROYW1lID0gcm93T2JqZWN0LnByZWZlcnJlZFRlcm07CiAgICAgICAgICAgIHZhciBwdCA9IHJvd09iamVjdC5wdDsKICAgICAgICAgICAgdmFyIGFzc2lnbmVkVG8gPSByb3dPYmplY3QuYXNzaWduZWRUby5pZDsKICAgICAgICAgICAgdmFyIHByb2R1Y3RJZCA9IHJvd09iamVjdC5wcm9kdWN0SWQ7CiAgICAgICAgICAgIHZhciBwdENvZGUgPSByb3dPYmplY3QucHRDb2RlOwogICAgICAgICAgICB2YXIgY29uZmlnSWQgPSByb3dPYmplY3QuYWxlcnRDb25maWdJZDsKICAgICAgICAgICAgdmFyIGV4ZWN1dGVkQ29uZmlnSWQgPSByb3dPYmplY3QuZXhlY0NvbmZpZ0lkOwoKICAgICAgICAgICAgaWYgKGFsZXJ0VHlwZSA9PT0gc2lnbmFsQWxlcnRUeXBlLkFESE9DX0FMRVJUKSB7CiAgICAgICAgICAgICAgICBhZGhvY0FsZXJ0SWQgPSByb3dPYmplY3QuaWQ7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWxlcnRUeXBlID09PSBzaWduYWxBbGVydFR5cGUuTElURVJBVFVSRV9TRUFSQ0hfQUxFUlQpIHsKICAgICAgICAgICAgICAgIGxpdGVyYXR1cmVBbGVydElkID0gcm93T2JqZWN0LmlkOwogICAgICAgICAgICAgICAgYXJ0aWNsZUlkID0gcm93T2JqZWN0LmFydGljbGVJZAogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBjYXNlSnNvbiA9IHsKICAgICAgICAgICAgICAgICJhbGVydFR5cGUiOiBhbGVydFR5cGUsCiAgICAgICAgICAgICAgICAicHJvZHVjdEZhbWlseSI6IHByb2R1Y3RGYW1pbHksCiAgICAgICAgICAgICAgICAiY2FzZU51bWJlciI6IGNhc2VOdW1iZXIsCiAgICAgICAgICAgICAgICAicHJvZHVjdE5hbWUiOiBwcm9kdWN0TmFtZSwKICAgICAgICAgICAgICAgICJldmVudE5hbWUiOiBldmVudE5hbWUsCiAgICAgICAgICAgICAgICAicHQiOiBwdCwKICAgICAgICAgICAgICAgICJwdENvZGUiOiBwdENvZGUsCiAgICAgICAgICAgICAgICAicHJvZHVjdElkIjogcHJvZHVjdElkLAogICAgICAgICAgICAgICAgImFzc2lnbmVkVG8iOiBhc3NpZ25lZFRvLAogICAgICAgICAgICAgICAgImV4ZWN1dGVkQ29uZmlnSWQiOiBleGVjdXRlZENvbmZpZ0lkLAogICAgICAgICAgICAgICAgImNvbmZpZ0lkIjogY29uZmlnSWQsCiAgICAgICAgICAgICAgICAiYWRob2NBbGVydElkIjogYWRob2NBbGVydElkLAogICAgICAgICAgICAgICAgImxpdGVyYXR1cmVBbGVydElkIjogbGl0ZXJhdHVyZUFsZXJ0SWQsCiAgICAgICAgICAgICAgICAiYXJ0aWNsZUlkIjogYXJ0aWNsZUlkCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNhc2VKc29uQXJyYXkucHVzaChjYXNlSnNvbikKICAgICAgICB9KTsKCiAgICAgICAgLy9TZXQgdmFsdWVzIHRvIHRoZSBtb2RhbCBlbGVtZW50cy4KICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2xvYWRpbmdDb21tZW50cyIpLmhpZGUoKTsKICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnQtbWV0YS1pbmZvIikuaHRtbCgiIik7CiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIi5wcmV2aW91cy1jb21tZW50cyIpLmh0bWwoIiIpOwogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudElkIikudmFsKCcnKTsKICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiLmNyZWF0ZWRCeSIpLnRleHQoJycpOwogICAgICAgIGlmIChjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLmh0bWwoKSAhPSAnVXBkYXRlJykgewogICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLmh0bWwoIkFkZCIpOwogICAgICAgIH0KICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLnByb3AoImRpc2FibGVkIiwgZmFsc2UpOwogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcjY29tbWVudGJveCcpLm9uKCJrZXl1cCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKGNvbW1lbnRNb2RhbC5maW5kKCcjY29tbWVudGJveCcpLnZhbCgpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykucHJvcCgiZGlzYWJsZWQiLCBmYWxzZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLnByb3AoImRpc2FibGVkIiwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIHJlc3RhcnRSZXZpZXcgPSBmdW5jdGlvbiAoY2FzZVJldmlld1ByZXZpb3VzVXJsKSB7CgogICAgICAgIC8vRXZlbnQgd2hlbiByZXZpZXcgcmVzdGFydCBpcyBjbGlja2VkLgogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuY2FzZS1yZXN0YXJ0LXJldmlldycsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB2YXIgcGFyZW50X3JvdyA9ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCd0cicpOwogICAgICAgICAgICB2YXIgY2FzZU51bWJlciA9IHBhcmVudF9yb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJjYXNlTnVtYmVyIl0nKS5hdHRyKCJkYXRhLWlkIik7CiAgICAgICAgICAgIHZhciBmb2xsb3dVcE51bWJlciA9IHBhcmVudF9yb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJmb2xsb3dVcE51bWJlciJdJykuYXR0cigiZGF0YS1pZCIpOwogICAgICAgICAgICB2YXIgY2FzZVZlcnNpb24gPSBwYXJlbnRfcm93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0iY2FzZVZlcnNpb24iXScpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICAgICAgdmFyIHByb2R1Y3RGYW1pbHkgPSBwYXJlbnRfcm93LmZpbmQoJ2lucHV0W2RhdGEtZmllbGQ9InByb2R1Y3RGYW1pbHkiXScpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICAgICAgdmFyIGZvbGxvd1VwTW9kYWwgPSAkKCcjZm9sbG93VXBNb2RhbCcpOwogICAgICAgICAgICBmb2xsb3dVcE1vZGFsLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICAgIGZvbGxvd1VwTW9kYWwuZmluZCgiLnByZXZpb3VzLWZvbGxvd1VwIikudW5iaW5kKCkuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGdldFByZXZpb3VzU3RhdGUgPSBjYXNlUmV2aWV3UHJldmlvdXNVcmwgKyAiP2Nhc2VOdW1iZXI9IiArIGNhc2VOdW1iZXIgKwogICAgICAgICAgICAgICAgICAgICImY2FzZVZlcnNpb249IiArIGNhc2VWZXJzaW9uICsgIiZwcm9kdWN0RmFtaWx5PSIgKyBwcm9kdWN0RmFtaWx5ICsgIiZmb2xsb3dVcE51bWJlcj0iICsgZm9sbG93VXBOdW1iZXI7CiAgICAgICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgIHVybDogZ2V0UHJldmlvdXNTdGF0ZSwKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudF9yb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJ3b3JrZmxvd1N0YXRlIl0nKS50ZXh0KHJlc3VsdC5wcmV2aW91c1N0YXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50X3Jvdy5maW5kKCdzcGFuW2RhdGEtZmllbGQ9ImRpc3Bvc2l0aW9uIl0nKS50ZXh0KHJlc3VsdC5wcmV2aW91c0Rpc3Bvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50X3Jvdy5maW5kKCdzcGFuW2RhdGEtZmllbGQ9ImluZm8tc2lnbiJdJykuYWRkQ2xhc3MoImhpZGRlbiIpOwogICAgICAgICAgICAgICAgICAgICAgICBmb2xsb3dVcE1vZGFsLm1vZGFsKCdkZXN0cm95Jyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSkKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIG9wZW5TaW1pbGFyQ2FzZXNNb2RhbCA9IGZ1bmN0aW9uIChjYXNlSW5mb1VybCkgewoKICAgICAgICAvL0V2ZW50IHRyaWdnZXJlZCB3aGVuIHNpbWlsYXIgY2FzZXMgY291bnQgaXMgY2xpY2tlZC4KICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnNpbWlsYXItY2FzZXMnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCiAgICAgICAgICAgIHZhciBzaW1pbGFyQ2FzZU1vZGFsID0gJCgnI3NpbWlsYXJDYXNlTW9kYWwnKTsKICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICAgIHZhciBwYXJlbnRfcm93ID0gJChldmVudC50YXJnZXQpLmNsb3Nlc3QoInRyIik7CgogICAgICAgICAgICAvL0ZldGNoIHRoZSB2YWx1ZXMgb2YgdGhlIGV2ZW50LgogICAgICAgICAgICB2YXIgZXZlbnRWYWwgPSAkKGV2ZW50LnRhcmdldCkuYXR0cignZGF0YS1ldmVudC12YWwnKTsKICAgICAgICAgICAgdmFyIGV2ZW50VHlwZSA9ICQoZXZlbnQudGFyZ2V0KS5hdHRyKCdkYXRhLWZpZWxkJyk7CiAgICAgICAgICAgIHZhciBleGVjdXRlZENvbmZpZ0lkID0gJChldmVudC50YXJnZXQpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICAgICAgdmFyIHB0ID0gJChldmVudC50YXJnZXQpLmF0dHIoImRhdGEtcHQiKTsKICAgICAgICAgICAgdmFyIGV2ZW50Q29kZTsKICAgICAgICAgICAgaWYgKGV2ZW50VHlwZSkgewogICAgICAgICAgICAgICAgZXZlbnRDb2RlID0gKGV2ZW50VHlwZS5zcGxpdCgiX2NvZGUiKVswXSk7CiAgICAgICAgICAgICAgICBldmVudFR5cGUgPSBldmVudFR5cGUuc3BsaXQoIl8iKVsyXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGNhc2VOdW1iZXIgPSBwYXJlbnRfcm93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0iY2FzZU51bWJlciJdJykuYXR0cigiZGF0YS1pZCIpOwogICAgICAgICAgICB2YXIgY2FzZVZlcnNpb24gPSBwYXJlbnRfcm93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0iY2FzZVZlcnNpb24iXScpLmF0dHIoImRhdGEtaWQiKTsKCiAgICAgICAgICAgIC8vU2hvdyBtb2RhbCBhbmQgc2V0IGl0cyB2YWx1ZXMuCiAgICAgICAgICAgIHNpbWlsYXJDYXNlTW9kYWwubW9kYWwoJ3Nob3cnKTsKICAgICAgICAgICAgc2ltaWxhckNhc2VNb2RhbC5maW5kKCIjZXZlbnRUeXBlIikuaHRtbChldmVudFR5cGUpOwogICAgICAgICAgICBzaW1pbGFyQ2FzZU1vZGFsLmZpbmQoIiNldmVudFZhbCIpLmh0bWwoZXZlbnRWYWwpOwogICAgICAgICAgICBzaW1pbGFyQ2FzZU1vZGFsLmZpbmQoIiNjYXNlTnVtYmVySW5mbyIpLnZhbChjYXNlTnVtYmVyKTsKICAgICAgICAgICAgc2ltaWxhckNhc2VNb2RhbC5maW5kKCIjZXhlY3V0ZWRDb25maWdJZCIpLnZhbChleGVjdXRlZENvbmZpZ0lkKTsKICAgICAgICAgICAgc2ltaWxhckNhc2VNb2RhbC5maW5kKCIjY2FzZUN1cnJlbnRWZXJzaW9uIikudmFsKGNhc2VWZXJzaW9uKTsKICAgICAgICAgICAgc2ltaWxhckNhc2VNb2RhbC5maW5kKCIjZXZlbnRDb2RlIikudmFsKGV2ZW50Q29kZSk7CiAgICAgICAgICAgIHNpbWlsYXJDYXNlTW9kYWwuZmluZCgiI2V2ZW50Q29kZVZhbCIpLnZhbChldmVudFZhbCk7CiAgICAgICAgICAgIC8vTWFrZSB0aGUgbW9kYWwgdGFibGUgYXMgZGF0YXRhYmxlCgogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHNpZ25hbC5zaW1pbGFyQ2FzZVRhYmxlLmluaXRfc2ltaWxhcl9jYXNlX3RhYmxlKGNhc2VJbmZvVXJsKQogICAgICAgICAgICB9LCAxMDApOwogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgb3BlbkF0dGFjaG1lbnRNb2RhbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnNob3ctYXR0YWNobWVudC1pY29uJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgIHZhciAkdGhpcyA9IHRoaXM7CiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHZhciBwYXJlbnRfcm93ID0gJChldmVudC50YXJnZXQpLmNsb3Nlc3QoJ3RyJyk7CiAgICAgICAgICAgIHZhciBhbGVydElkID0gcGFyZW50X3Jvdy5maW5kKCdhW2RhdGEtZmllbGQ9ImF0dGFjaG1lbnQiXScpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICAgICAgdmFyIGNhc2VDb250cm9sbGVyID0gcGFyZW50X3Jvdy5maW5kKCdhW2RhdGEtZmllbGQ9ImF0dGFjaG1lbnQiXScpLmF0dHIoImRhdGEtY29udHJvbGxlciIpOwogICAgICAgICAgICB2YXIgdXJsID0gIi9zaWduYWwvIiArIGNhc2VDb250cm9sbGVyICsgIi91cGxvYWQiOwogICAgICAgICAgICB2YXIgZ2V0QXR0YWNobWVudFVybCA9ICIvc2lnbmFsLyIgKyBjYXNlQ29udHJvbGxlciArICIvZmV0Y2hBdHRhY2htZW50P2FsZXJ0SWQ9IiArIGFsZXJ0SWQ7CiAgICAgICAgICAgICQoJyNzaG93QXR0YWNobWVudE1vZGFsICNhdHRhY2htZW50Rm9ybSAjYXR0YWNobWVudEZvcm1JZCcpLmF0dHIoJ3ZhbHVlJywgYWxlcnRJZCk7CiAgICAgICAgICAgIHZhciBjYXNlSGlzdG9yeU1vZGFsID0gJCgnI3Nob3dBdHRhY2htZW50TW9kYWwnKTsKICAgICAgICAgICAgY2FzZUhpc3RvcnlNb2RhbC5tb2RhbCgnc2hvdycpOwogICAgICAgICAgICAkKCIjc2hvd0F0dGFjaG1lbnRNb2RhbCBmb3JtI2F0dGFjaG1lbnRGb3JtIikudW5iaW5kKCdzdWJtaXQnKS5vbignc3VibWl0JywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKHRoaXMpOwogICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTsKICAgICAgICAgICAgICAgIGlmICgkdGhpcy5maW5kKCcuYXR0YWNobWVudC1maWxlJykudmFsKCkpIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy5maW5kKCIudXBsb2FkIikuYXR0cigiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBmb3JtRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5maW5kKCcuYXR0YWNobWVudC1maWxlJykudmFsKCcnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dBdHRhY2htZW50SWNvbihwYXJlbnRfcm93KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNzaG93QXR0YWNobWVudE1vZGFsICNhdHRhY2htZW50LXRhYmxlJykuRGF0YVRhYmxlKCkuYWpheC5yZWxvYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmZpbmQoIi51cGxvYWQiKS5hdHRyKCJkaXNhYmxlZCIsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NEYXRhOiBmYWxzZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJCgnI3Nob3dBdHRhY2htZW50TW9kYWwgI2F0dGFjaG1lbnQtdGFibGUnKS5EYXRhVGFibGUoewogICAgICAgICAgICAgICAgZGVzdHJveTogdHJ1ZSwKICAgICAgICAgICAgICAgIHNlYXJjaGluZzogZmFsc2UsCiAgICAgICAgICAgICAgICBzUGFnaW5hdGlvblR5cGU6ICJib290c3RyYXAiLAogICAgICAgICAgICAgICAgcmVzcG9uc2l2ZTogZmFsc2UsCiAgICAgICAgICAgICAgICBsYW5ndWFnZTogewogICAgICAgICAgICAgICAgICAgICJ1cmwiOiAiLi4vYXNzZXRzL2kxOG4vZGF0YVRhYmxlc18iICsgdXNlckxvY2FsZSArICIuanNvbiIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAiYWpheCI6IHsKICAgICAgICAgICAgICAgICAgICAidXJsIjogZ2V0QXR0YWNobWVudFVybCwKICAgICAgICAgICAgICAgICAgICAiZGF0YVNyYyI6ICIiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZm5EcmF3Q2FsbGJhY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAkKCcucmVtb3ZlLWF0dGFjaG1lbnQnKS5jbGljayhmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0YWNobWVudFJvdyA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJ3RyJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRhY2htZW50SWQgPSBhdHRhY2htZW50Um93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0icmVtb3ZlQXR0YWNobWVudCJdJykuYXR0cigiZGF0YS1hdHRhY2htZW50SWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlbW92ZVVybCA9ICcvc2lnbmFsLycgKyBjYXNlQ29udHJvbGxlciArICcvZGVsZXRlQXR0YWNobWVudD9hdHRhY2htZW50SWQ9JyArIGF0dGFjaG1lbnRJZDsKICAgICAgICAgICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogcmVtb3ZlVXJsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge2FsZXJ0SWQ6IGFsZXJ0SWR9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCQoJy5yZW1vdmUtYXR0YWNobWVudCcpLmxlbmd0aCA9PT0xICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVBdHRhY2htZW50SWNvbigkdGhpcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3Nob3dBdHRhY2htZW50TW9kYWwgI2F0dGFjaG1lbnQtdGFibGUnKS5EYXRhVGFibGUoKS5hamF4LnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5Ob3RpZmljYXRpb24ubm90aWZ5KCdlcnJvcicsICd0b3AgcmlnaHQnLCAiRXJyb3IiLCAiQWxsIHNlbGVjdGVkIHNhZmV0eSBvYnNlcnZhdGlvbnMgbXVzdCBiZSBpbiBzYW1lIGRpc3Bvc2l0aW9uIGZvciBwZXJmb3JtaW5nIHRoZSBidWxrIHVwZGF0ZS4iLCB7YXV0b0hpZGVEZWxheTogMTAwMDB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJhb0NvbHVtbnMiOiBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAibmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSIvc2lnbmFsL2F0dGFjaG1lbnRhYmxlL2Rvd25sb2FkP2lkPScgKyByb3cuaWQgKyAnIj4nICsgZXNjYXBlSFRNTChyb3cubmFtZSkgKyAnPC9hPicKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImRlc2NyaXB0aW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICdjZWxsLWJyZWFrJywKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJ0aW1lU3RhbXAiCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAibW9kaWZpZWRCeSIKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiB0YWJpbmRleD0iMCIgdGl0bGU9IlJlbW92ZSBBdHRhY2htZW50IiAgc3R5bGU9ImN1cnNvcjogcG9pbnRlciIgY2xhc3M9ImdseXBoaWNvbiBnbHlwaGljb24tcmVtb3ZlIHJlbW92ZS1hdHRhY2htZW50IiBkYXRhLWZpZWxkPSJyZW1vdmVBdHRhY2htZW50IiBkYXRhLWF0dGFjaG1lbnRJZD0nICsgcm93LmlkICsgJz48L3NwYW4+JwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJiTGVuZ3RoQ2hhbmdlIjogZmFsc2UsCiAgICAgICAgICAgICAgICBjb2x1bW5EZWZzOiBbewogICAgICAgICAgICAgICAgICAgICJ0YXJnZXRzIjogJ19hbGwnLAogICAgICAgICAgICAgICAgICAgICJyZW5kZXIiOiAkLmZuLmRhdGFUYWJsZS5yZW5kZXIudGV4dCgpCiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGJpbmRHcmlkRHluYW1pY0ZpbHRlcnMgPSBmdW5jdGlvbiAoZmlsdGVyc0RhdGEsIHByZWZpeCwgaWQpIHsKICAgICAgICAvL0FkZCBmaWx0ZXJzIHRvIHRoZSBkYXRhIHRhYmxlLgogICAgICAgIHZhciBkYXRhVGFibGVzX2xlbmd0aCA9ICQoJy5kYXRhVGFibGVzX2xlbmd0aCcpOwogICAgICAgIGRhdGFUYWJsZXNfbGVuZ3RoLmFkZENsYXNzKCdjb2wtc20tMTInKTsKICAgICAgICBkYXRhVGFibGVzX2xlbmd0aC5wYXJlbnQoKS5yZW1vdmVDbGFzcygiY29sLXhzLTIiKTsKICAgICAgICBhcHBsaWNhdGlvbk5hbWUgPT0gQUxFUlRfQ09ORklHX1RZUEUuQURIT0NfQUxFUlQgPyBkYXRhVGFibGVzX2xlbmd0aC5wYXJlbnQoIjpub3QoJy5kYXRhVGFibGVzX3dyYXBwZXInKSIpLmFkZENsYXNzKCJjb2wteHMtOSIpIDogZGF0YVRhYmxlc19sZW5ndGgucGFyZW50KCI6bm90KCcuZGF0YVRhYmxlc193cmFwcGVyJykiKS5hZGRDbGFzcygiY29sLXhzLTEwIik7CiAgICAgICAgZGF0YVRhYmxlc19sZW5ndGgucGFyZW50KCI6bm90KCcuZGF0YVRhYmxlc193cmFwcGVyJykiKS5uZXh0KCkucmVtb3ZlQ2xhc3MoImNvbC14cy0xMCIpOwogICAgICAgIGFwcGxpY2F0aW9uTmFtZSA9PSBBTEVSVF9DT05GSUdfVFlQRS5BREhPQ19BTEVSVCA/IGRhdGFUYWJsZXNfbGVuZ3RoLnBhcmVudCgiOm5vdCgnLmRhdGFUYWJsZXNfd3JhcHBlcicpIikubmV4dCgpLmFkZENsYXNzKCJjb2wteHMtMyIpIDogZGF0YVRhYmxlc19sZW5ndGgucGFyZW50KCI6bm90KCcuZGF0YVRhYmxlc193cmFwcGVyJykiKS5uZXh0KCkuYWRkQ2xhc3MoImNvbC14cy0yIik7CiAgICAgICAgZGF0YVRhYmxlc19sZW5ndGguZmluZCgibGFiZWwiKS5hZGRDbGFzcygnY29sLXhzLTInKTsKICAgICAgICBkYXRhVGFibGVzX2xlbmd0aC5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGR0QnV0dG9ucyA9ICc8ZGl2IGNsYXNzPSJkYXRhVGFibGUtdG9wLWRpc3Bvc2l0aW9uIGNvbC14cy0xMCI+JzsKICAgICAgICAgICAgJC5lYWNoKGZpbHRlcnNEYXRhLCBmdW5jdGlvbiAoaW5kZXgsIG9iaikgewogICAgICAgICAgICAgICAgaWYgKG9iai5jbG9zZWQgfHwgb2JqLmlzQ2xvc2VkKSB7CiAgICAgICAgICAgICAgICAgICAgZHRCdXR0b25zICs9ICc8ZGl2IGNsYXNzPSJjaGVja2JveCBjaGVja2JveC1wcmltYXJ5IGNoZWNrYm94LWlubGluZSBtLWwtMyBjaGVja2JveC1wb3MtYWJzIj4nOwogICAgICAgICAgICAgICAgICAgIGR0QnV0dG9ucyArPSAnPGlucHV0IGlkPSJmaWx0ZXInICsgaW5kZXggKyAnIiB0eXBlPSJjaGVja2JveCIgY2xhc3M9ImR5bmFtaWMtZmlsdGVycyIgbmFtZT0icmVsYXRlZFJlc3VsdHMiIGRhdGEtY2xvc2VkPSInICsgb2JqLmlzQ2xvc2VkICsgJyIgdmFsdWU9IicgKyBvYmoudmFsdWUgKyAnIiAvPiA8bGFiZWwgY2xhc3M9Im0tci0zMCIgIGZvcj0iZmlsdGVyJyArIGluZGV4ICsgJyI+JyArIG9iai52YWx1ZSArICc8L2xhYmVsPjwvZGl2PicKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZHRCdXR0b25zICs9ICc8ZGl2IGNsYXNzPSJjaGVja2JveCBjaGVja2JveC1wcmltYXJ5IGNoZWNrYm94LWlubGluZSBtLWwtMyBjaGVja2JveC1wb3MtYWJzIj4nOwogICAgICAgICAgICAgICAgICAgIGR0QnV0dG9ucyArPSAnPGlucHV0IGlkPSJmaWx0ZXInICsgaW5kZXggKyAnIiB0eXBlPSJjaGVja2JveCIgY2xhc3M9ImR5bmFtaWMtZmlsdGVycyIgbmFtZT0icmVsYXRlZFJlc3VsdHMiIGRhdGEtY2xvc2VkPSInICsgb2JqLmlzQ2xvc2VkICsgJyIgY2hlY2tlZD0iY2hlY2tlZCIgdmFsdWU9IicgKyBvYmoudmFsdWUgKyAnIiAvPiA8bGFiZWwgY2xhc3M9Im0tci0zMCIgZm9yPSJmaWx0ZXInICsgaW5kZXggKyAnIj4nICsgb2JqLnZhbHVlICsgJzwvbGFiZWw+PC9kaXY+JwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZHRCdXR0b25zICs9ICc8L2Rpdj4nOwogICAgICAgICAgICBkdEJ1dHRvbnMgPSBkdEJ1dHRvbnMgKyAnPC9kaXY+JzsKICAgICAgICAgICAgaWYgKHRoaXMuaWQgIT09ICdhcmNoaXZlZEFsZXJ0c1RhYmxlX2xlbmd0aCcgJiYgdGhpcy5pZCAhPT0gJ2FjdGl2aXRpZXNUYWJsZV9sZW5ndGgnKQogICAgICAgICAgICAgICAgJCh0aGlzKS5hcHBlbmQoZHRCdXR0b25zKTsKICAgICAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5keW5hbWljLWZpbHRlcnMnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgYWxlcnREZXRhaWxzVGFibGU7CiAgICAgICAgICAgICAgICB2YXIgZnJlcVNlbGVjdGVkID0gIiI7CiAgICAgICAgICAgICAgICBpZiAoJCgiI2ZyZXF1ZW5jeU5hbWVzIikpIHsKICAgICAgICAgICAgICAgICAgICBmcmVxU2VsZWN0ZWQgPSAkKCIjZnJlcXVlbmN5TmFtZXMiKS52YWwoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJBcnJheSA9IFtdOwogICAgICAgICAgICAgICAgdmFyIGZpbHRlclZhbHVlcyA9IFtdOwogICAgICAgICAgICAgICAgJCgnLmR5bmFtaWMtZmlsdGVycycpLmVhY2goZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCQodGhpcykuaXMoJzpjaGVja2VkJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyVmFsdWVzLnB1c2goJCh0aGlzKS52YWwoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGZpbHRlckFycmF5LnB1c2goJCh0aGlzKS5pcygnOmNoZWNrZWQnKSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0ocHJlZml4ICsgImZpbHRlcnNfc3RvcmUiLCBKU09OLnN0cmluZ2lmeShmaWx0ZXJBcnJheSkpOwogICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShwcmVmaXggKyAiZmlsdGVyc192YWx1ZSIsIEpTT04uc3RyaW5naWZ5KGZpbHRlclZhbHVlcykpOwogICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShwcmVmaXggKyAiaWQiLCBpZCk7CiAgICAgICAgICAgICAgICB2YXIgdXJsOwogICAgICAgICAgICAgICAgaWYgKGFwcGxpY2F0aW9uTmFtZSA9PSAnTGl0ZXJhdHVyZSBTZWFyY2ggQWxlcnQnKSB7CiAgICAgICAgICAgICAgICAgICAgYWxlcnREZXRhaWxzVGFibGUgPSAkKCcjYWxlcnRzRGV0YWlsc1RhYmxlJykuRGF0YVRhYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgdXJsID0gbGlzdENvbmZpZ1VybCArICI/ZmlsdGVycz0iICsgZmlsdGVyVmFsdWVzLmpvaW4oIiwiKQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBhbGVydERldGFpbHNUYWJsZSA9ICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5EYXRhVGFibGUoKTsKICAgICAgICAgICAgICAgICAgICB1cmwgPSBsaXN0Q29uZmlnVXJsICsgIiZmcmVxdWVuY3k9IiArIGZyZXFTZWxlY3RlZCArICImaXNGaWx0ZXJSZXF1ZXN0PXRydWUmZmlsdGVycz0iICsgSlNPTi5zdHJpbmdpZnkoZmlsdGVyVmFsdWVzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGFsZXJ0RGV0YWlsc1RhYmxlLmFqYXgudXJsKHVybCkubG9hZCgpCiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgIH07CgogICAgdmFyIGlzQWxlcnRQZXJzaXN0ZWRJblNlc3Npb25TdG9yYWdlID0gZnVuY3Rpb24gKHByZWZpeCkgewogICAgICAgIHZhciBjID0gc2lnbmFsLnV0aWxzLmdldFF1ZXJ5U3RyaW5nKCJjb25maWdJZCIpOwogICAgICAgIHJldHVybiBjID8gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShwcmVmaXggKyAiaWQiKSA9PSBjIDogZmFsc2UKICAgIH07CgogICAgdmFyIHJlbW92ZUZpbHRlcnNGcm9tU2Vzc2lvblN0b3JhZ2UgPSBmdW5jdGlvbiAocHJlZml4KSB7CiAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbShwcmVmaXggKyAiZmlsdGVyc19zdG9yZSIpOwogICAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0ocHJlZml4ICsgImZpbHRlcnNfdmFsdWUiKTsKICAgICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKHByZWZpeCArICJpZCIpOwogICAgfTsKCiAgICB2YXIgb3BlblNhdmVWaWV3TW9kYWwgPSBmdW5jdGlvbiAoZmlsdGVySW5kZXgsIGFwcGxpY2F0aW9uTmFtZSwgdmlld0lkKSB7CiAgICAgICAgdmFyIHN5c3RlbURlZmF1bHQgPSBbIlN5c3RlbSBWaWV3Il07CiAgICAgICAgdmFyIHZpZXdJbmZvOwoKICAgICAgICAvL3NhdmluZyBuZXcgdmlldwogICAgICAgICQoIi5zYXZlVmlldyIpLnVuYmluZCgnY2xpY2snKTsKICAgICAgICAkKCcuc2F2ZVZpZXcnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZpZXdJbmZvID0gZ2VuZXJhdGVWaWV3SW5mbyhmaWx0ZXJJbmRleCk7CgogICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2ZpbHRlcnMnKS52YWwoSlNPTi5zdHJpbmdpZnkodmlld0luZm8uZmlsdGVyTWFwKSk7CiAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfY29sdW1uTGlzdCcpLnZhbCh2aWV3SW5mby5ub3RWaXNpYmxlQ29sdW1uKTsKICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19hbGVydFR5cGUnKS52YWwoYXBwbGljYXRpb25OYW1lKTsKICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19zb3J0aW5nJykudmFsKEpTT04uc3RyaW5naWZ5KHZpZXdJbmZvLnNvcnRlZENvbHVtbikpOwogICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2FkdmFuY2VkX2ZpbHRlcicpLnZhbCh2aWV3SW5mby5hZHZhbmNlZEZpbHRlcik7CiAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI2N1cnJlbnRfdmlld19pZCcpLnZhbCh2aWV3SWQpOwogICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsIC5zYXZlX2J1dHRvbnMnKS5zaG93KCk7CiAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwnKS5tb2RhbCgnc2hvdycpOwogICAgICAgIH0pCgogICAgICAgIC8vdXBkYXRpbmcgZXhpc3RpbmcgdmlldwogICAgICAgICQoIi51cGRhdGVWaWV3IikudW5iaW5kKCdjbGljaycpOwogICAgICAgICQoJy51cGRhdGVWaWV3Jykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2aWV3SW5mbyA9IGdlbmVyYXRlVmlld0luZm8oZmlsdGVySW5kZXgpOwogICAgICAgICAgICBpZiAoJC5pbkFycmF5KCQoJy52aWV3U2VsZWN0IDpzZWxlY3RlZCcpLnRleHQoKS5yZXBsYWNlKCIoZGVmYXVsdCkiLCAiIikudHJpbSgpLCBzeXN0ZW1EZWZhdWx0KSAhPSAtMSkgewogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19maWx0ZXJzJykudmFsKEpTT04uc3RyaW5naWZ5KHZpZXdJbmZvLmZpbHRlck1hcCkpOwogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19jb2x1bW5MaXN0JykudmFsKHZpZXdJbmZvLm5vdFZpc2libGVDb2x1bW4pOwogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19hbGVydFR5cGUnKS52YWwoYXBwbGljYXRpb25OYW1lKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfc29ydGluZycpLnZhbChKU09OLnN0cmluZ2lmeSh2aWV3SW5mby5zb3J0ZWRDb2x1bW4pKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfYWR2YW5jZWRfZmlsdGVyJykudmFsKHZpZXdJbmZvLmFkdmFuY2VkRmlsdGVyKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI2N1cnJlbnRfdmlld19pZCcpLnZhbCh2aWV3SWQpOwogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAuc2F2ZV9idXR0b25zJykuc2hvdygpOwogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCcpLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IG5ldyBPYmplY3QoKTsKICAgICAgICAgICAgICAgIHJlcXVlc3RbJ25hbWUnXSA9ICQoJy52aWV3U2VsZWN0IDpzZWxlY3RlZCcpLnRleHQoKS5yZXBsYWNlKCIoZGVmYXVsdCkiLCAiIikudHJpbSgpOwogICAgICAgICAgICAgICAgcmVxdWVzdFsnZmlsdGVyTWFwJ10gPSBKU09OLnN0cmluZ2lmeSh2aWV3SW5mby5maWx0ZXJNYXApOwogICAgICAgICAgICAgICAgcmVxdWVzdFsnY29sdW1uTGlzdCddID0gdmlld0luZm8ubm90VmlzaWJsZUNvbHVtbi50b1N0cmluZygpOwogICAgICAgICAgICAgICAgcmVxdWVzdFsnYWxlcnRUeXBlJ10gPSBhcHBsaWNhdGlvbk5hbWU7CiAgICAgICAgICAgICAgICByZXF1ZXN0WydpZCddID0gJCgnLnZpZXdTZWxlY3QnKS52YWwoKTsKICAgICAgICAgICAgICAgIHJlcXVlc3RbJ3NvcnRpbmcnXSA9IEpTT04uc3RyaW5naWZ5KHZpZXdJbmZvLnNvcnRlZENvbHVtbik7CiAgICAgICAgICAgICAgICByZXF1ZXN0WydhZHZhbmNlZEZpbHRlciddID0gdmlld0luZm8uYWR2YW5jZWRGaWx0ZXI7CiAgICAgICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgIHVybDogdXBkYXRlVmlld1VybCwKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiUE9TVCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YTogcmVxdWVzdCwKICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogImpzb24iLAogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYWdlVVJMID0gJChsb2NhdGlvbikuYXR0cigiaHJlZiIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFnZVVSTC5pbmRleE9mKCJ2aWV3SWQiKSAhPSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gcGFnZVVSTC5zbGljZSgwLCBwYWdlVVJMLmluZGV4T2YoInZpZXdJZCIpICsgNykgKyBkYXRhLnZpZXdJZAogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhZ2VVUkwuaW5kZXhPZigiIyIpICE9IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZVVSTCA9IHBhZ2VVUkwuc2xpY2UoMCwgcGFnZVVSTC5pbmRleE9mKCIjIikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBwYWdlVVJMICsgIiZ2aWV3SWQ9IiArIGRhdGEudmlld0lkCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoZGF0YS5lcnJvck1lc3NhZ2UpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0Vycm9yTm90aWZpY2F0aW9uKGRhdGEuZXJyb3JNZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy9zZWxlY3RpbmcgYW5vdGhlciB2aWV3CiAgICAgICAgJCgnLnZpZXdTZWxlY3QnKS51bmJpbmQoJ2NsaWNrJyk7CiAgICAgICAgJCgnLnZpZXdTZWxlY3QnKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgcGFnZVVSTCA9ICQobG9jYXRpb24pLmF0dHIoImhyZWYiKTsKICAgICAgICAgICAgdmFyIHNlbGVjdGVkVmlldyA9ICQoJy52aWV3U2VsZWN0JykudmFsKCk7CiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ2lzVmlld0NhbGwnLCAndHJ1ZScpOwogICAgICAgICAgICBpZiAocGFnZVVSTC5pbmRleE9mKCJ2aWV3SWQiKSAhPSAtMSkgewogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBwYWdlVVJMLnNsaWNlKDAsIHBhZ2VVUkwuaW5kZXhPZigidmlld0lkIikgKyA3KSArIHNlbGVjdGVkVmlldwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHBhZ2VVUkwuaW5kZXhPZigiIyIpICE9IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgcGFnZVVSTCA9IHBhZ2VVUkwuc2xpY2UoMCwgcGFnZVVSTC5pbmRleE9mKCIjIikpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHBhZ2VVUkwgKyAiJnZpZXdJZD0iICsgc2VsZWN0ZWRWaWV3CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy9kZWxldGluZyBvciBlZGl0aW5nIHNlbGVjdGVkIHZpZXcKICAgICAgICAkKCcuZWRpdFZpZXcnKS51bmJpbmQoJ2NsaWNrJyk7CiAgICAgICAgJCgnLmVkaXRWaWV3Jykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2aWV3SW5mbyA9IGdlbmVyYXRlVmlld0luZm8oZmlsdGVySW5kZXgpOwoKICAgICAgICAgICAgaWYgKCQuaW5BcnJheSgkKCcudmlld1NlbGVjdCA6c2VsZWN0ZWQnKS50ZXh0KCkucmVwbGFjZSgiKGRlZmF1bHQpIiwgIiIpLnRyaW0oKSwgc3lzdGVtRGVmYXVsdCkgPT0gLTEpIHsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfbmFtZScpLnZhbCgkKCcudmlld1NlbGVjdCA6c2VsZWN0ZWQnKS50ZXh0KCkucmVwbGFjZSgiKGRlZmF1bHQpIiwgIiIpKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfZGVmYXVsdCcpLnByb3AoJ2NoZWNrZWQnLCAoJCgnLnZpZXdTZWxlY3QgOnNlbGVjdGVkJykudGV4dCgpLmluZGV4T2YoIihkZWZhdWx0KSIpICE9IC0xKSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2lkJykudmFsKCQoJy52aWV3U2VsZWN0IDpzZWxlY3RlZCcpLnZhbCgpKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfZmlsdGVycycpLnZhbChKU09OLnN0cmluZ2lmeSh2aWV3SW5mby5maWx0ZXJNYXApKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfY29sdW1uTGlzdCcpLnZhbCh2aWV3SW5mby5ub3RWaXNpYmxlQ29sdW1uKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfc29ydGluZycpLnZhbChKU09OLnN0cmluZ2lmeSh2aWV3SW5mby5zb3J0ZWRDb2x1bW4pKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfYWR2YW5jZWRfZmlsdGVyJykudmFsKHZpZXdJbmZvLmFkdmFuY2VkRmlsdGVyKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfYWxlcnRUeXBlJykudmFsKGFwcGxpY2F0aW9uTmFtZSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsIC5lZGl0X2J1dHRvbnMnKS5zaG93KCk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsJykubW9kYWwoJ3Nob3cnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICQoJyNhbGVydC12aWV3LW1vZGFsJykubW9kYWwoJ3Nob3cnKTsKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICB9OwoKICAgIHZhciBnZW5lcmF0ZVZpZXdJbmZvID0gZnVuY3Rpb24gKGZpbHRlckluZGV4KSB7CiAgICAgICAgdmFyIG9UYWJsZSA9ICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5EYXRhVGFibGUoKTsKCiAgICAgICAgLy9nZW5lcmF0ZSBmaWx0ZXIgdmFsdWUgbWFwCiAgICAgICAgdmFyIGZpbHRlck1hcCA9IG5ldyBPYmplY3QoKTsKICAgICAgICAkLmVhY2goZmlsdGVySW5kZXgsIGZ1bmN0aW9uIChpZHgsIG9iaikgewogICAgICAgICAgICB2YXIgZmlsdGVyVmFsID0geWFkY2YuZXhHZXRDb2x1bW5GaWx0ZXJWYWwob1RhYmxlLCBvYmopOwogICAgICAgICAgICBpZiAoZmlsdGVyVmFsKSB7CiAgICAgICAgICAgICAgICBmaWx0ZXJNYXBbb2JqXSA9IGZpbHRlclZhbAogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vZ2VuZXJhdGUgY29sdW1ucyB2aXNpYmxlIGxpc3QKICAgICAgICB2YXIgbm90VmlzaWJsZUNvbHVtbiA9ICQoJyNjb2x1bW5JbmRleCcpLnZhbCgpOwoKICAgICAgICAvL2dlbmVyYXRlIHNvcnRpbmcgY29sdW1uIGluZm8KICAgICAgICB2YXIgc29ydGVkQ29sdW1uID0gbmV3IE9iamVjdCgpOwogICAgICAgIGlmICgkKCcjYWxlcnRzRGV0YWlsc1RhYmxlJykuZGF0YVRhYmxlKCkuZm5TZXR0aW5ncygpLmFhU29ydGluZ1swXSkgewogICAgICAgICAgICB2YXIgc29ydGVkQ29sID0gJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLmRhdGFUYWJsZSgpLmZuU2V0dGluZ3MoKS5hYVNvcnRpbmdbMF1bMF07CiAgICAgICAgICAgIHZhciBjb2x1bW5OYW1lID0gJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLmZpbmQoInRoIikuZXEoc29ydGVkQ29sKS5hdHRyKCJkYXRhLWZpZWxkIik7CiAgICAgICAgICAgIHZhciBpbmRleCA9IDA7CiAgICAgICAgICAgIGNvbHVtblNlcS5ldmVyeShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VxTmFtZSA9IGNvbHVtblNlcVtpbmRleF0ubmFtZTsKICAgICAgICAgICAgICAgIGlmIChjb2x1bW5OYW1lID09IHNlcU5hbWUpIHsKICAgICAgICAgICAgICAgICAgICBzb3J0ZWRDb2wgPSBjb2x1bW5TZXFbaW5kZXhdLnNlcTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpbmRleCsrOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgc29ydGVkRGlyID0gJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLmRhdGFUYWJsZSgpLmZuU2V0dGluZ3MoKS5hYVNvcnRpbmdbMF1bMV07CiAgICAgICAgICAgIHNvcnRlZENvbHVtbltzb3J0ZWRDb2xdID0gc29ydGVkRGlyOwogICAgICAgIH0KCiAgICAgICAgLy9nZW5lcmF0ZSBhZHZhbmNlZCBmaWx0ZXIgaW5mbwogICAgICAgIHZhciBhZHZhbmNlZEZpdGVySWQgPSAkKCcuYWR2YW5jZWQtZmlsdGVyLWRyb3Bkb3duJykudmFsKCk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgJ2ZpbHRlck1hcCc6IGZpbHRlck1hcCwKICAgICAgICAgICAgJ25vdFZpc2libGVDb2x1bW4nOiBub3RWaXNpYmxlQ29sdW1uLAogICAgICAgICAgICAnc29ydGVkQ29sdW1uJzogc29ydGVkQ29sdW1uLAogICAgICAgICAgICAnYWR2YW5jZWRGaWx0ZXInOiBhZHZhbmNlZEZpdGVySWQKICAgICAgICB9CiAgICB9OwoKICAgIHZhciBjcmVhdGVTb3J0aW5nTWFwID0gZnVuY3Rpb24gKGluZm9LZXksIHZpZXdOYW1lKSB7CiAgICAgICAgdmFyIHNvcnRpbmdNYXAgPSBbXTsKICAgICAgICB2YXIgc29ydGluZyA9IHt9OwogICAgICAgIHZhciBzZXNzaW9uU3RvcmVkVmFsOwogICAgICAgIGlmIChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKHZpZXdOYW1lKSA9PSAkKCcudmlld1NlbGVjdCA6c2VsZWN0ZWQnKS50ZXh0KCkucmVwbGFjZSgiKGRlZmF1bHQpIiwgIiIpLnRyaW0oKSkgewogICAgICAgICAgICBzZXNzaW9uU3RvcmVkVmFsID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShpbmZvS2V5KTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlc3Npb25TdG9yZWRWYWwpIHsKICAgICAgICAgICAgc29ydGluZyA9ICQucGFyc2VKU09OKHNlc3Npb25TdG9yZWRWYWwpOwogICAgICAgIH0gZWxzZSBpZiAoJCgiI3NvcnRlZENvbHVtbiIpLnZhbCgpICE9ICIiICYmICQoIiNzb3J0ZWRDb2x1bW4iKS52YWwoKSAhPSAie30iICYmIGNhbGxpbmdTY3JlZW4gPT0gJ3JldmlldycpIHsKICAgICAgICAgICAgc29ydGluZyA9ICQucGFyc2VKU09OKCQoJyNzb3J0ZWRDb2x1bW4nKS52YWwoKSk7CiAgICAgICAgfQogICAgICAgICQuZWFjaChzb3J0aW5nLCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICBzb3J0aW5nTWFwLnB1c2goW3BhcnNlSW50KGtleSksIHZhbHVlXSkKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gc29ydGluZ01hcAogICAgfTsKCiAgICB2YXIgY3JlYXRlRmlsdGVyTWFwID0gZnVuY3Rpb24gKGluZm9LZXksIHZpZXdOYW1lKSB7CiAgICAgICAgdmFyIGZpbHRlcnNWYWx1ZSA9IFtdOwogICAgICAgIHZhciBmaWx0ZXJNYXAgPSB7fTsKICAgICAgICB2YXIgc2Vzc2lvblN0b3JlZFZhbDsKICAgICAgICBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSh2aWV3TmFtZSkgPT0gJCgnLnZpZXdTZWxlY3QgOnNlbGVjdGVkJykudGV4dCgpLnJlcGxhY2UoIihkZWZhdWx0KSIsICIiKS50cmltKCkpIHsKICAgICAgICAgICAgc2Vzc2lvblN0b3JlZFZhbCA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oaW5mb0tleSk7CiAgICAgICAgfQogICAgICAgIGlmIChzZXNzaW9uU3RvcmVkVmFsICYmIHNlc3Npb25TdG9yZWRWYWwgIT0ge30pIHsKICAgICAgICAgICAgZmlsdGVyTWFwID0gJC5wYXJzZUpTT04oc2Vzc2lvblN0b3JlZFZhbCk7CiAgICAgICAgfSBlbHNlIGlmICgkKCcjZmlsdGVyTWFwJykudmFsKCkgIT0gIiIgJiYgJCgnI2ZpbHRlck1hcCcpLnZhbCgpICE9ICJ7fSIpIHsKICAgICAgICAgICAgZmlsdGVyTWFwID0gJC5wYXJzZUpTT04oJCgnI2ZpbHRlck1hcCcpLnZhbCgpKTsKICAgICAgICB9CiAgICAgICAgJC5lYWNoKGZpbHRlck1hcCwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgdmFyIGZpbHRlckFyciA9IFtwYXJzZUludChrZXkpLCB2YWx1ZV07CiAgICAgICAgICAgIGZpbHRlcnNWYWx1ZS5wdXNoKGZpbHRlckFycikKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gZmlsdGVyc1ZhbHVlCiAgICB9OwoKICAgIHZhciBjcmVhdGVMaXN0T2ZJbmRleCA9IGZ1bmN0aW9uIChpbmZvS2V5LCBpc0V2ZGFzLCB2aWV3TmFtZSkgewogICAgICAgIHZhciBsb2kgPSBbXTsKICAgICAgICB2YXIgY29sdW1uSW5kZXggPSBbXQogICAgICAgIHZhciBzZXNzaW9uU3RvcmVkVmFsOwogICAgICAgIGlmIChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKHZpZXdOYW1lKSA9PSAkKCcudmlld1NlbGVjdCA6c2VsZWN0ZWQnKS50ZXh0KCkucmVwbGFjZSgiKGRlZmF1bHQpIiwgIiIpLnRyaW0oKSkgewogICAgICAgICAgICBzZXNzaW9uU3RvcmVkVmFsID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShpbmZvS2V5KTsKICAgICAgICB9CiAgICAgICAgaWYgKGNhbGxpbmdTY3JlZW4gPT0gJ3JldmlldycpIHsKICAgICAgICAgICAgaWYgKHNlc3Npb25TdG9yZWRWYWwpIHsKICAgICAgICAgICAgICAgIGNvbHVtbkluZGV4ID0gc2Vzc2lvblN0b3JlZFZhbC5zcGxpdCgnLCcpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb2x1bW5JbmRleCA9ICQoJyNjb2x1bW5JbmRleCcpLnZhbCgpLnNwbGl0KCcsJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJC5lYWNoKGNvbHVtbkluZGV4LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoaXNFdmRhcykgewogICAgICAgICAgICAgICAgICAgIGxvaS5wdXNoKHBhcnNlSW50KHRoaXMpKQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBsb2kucHVzaChwYXJzZUludCh0aGlzKSArIDEpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbG9pCiAgICB9OwoKICAgIHZhciBzZXRTb3J0T3JkZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgJCgiI2FsZXJ0c0RldGFpbHNUYWJsZVJvdyIpLm9uKCdtb3VzZWRvd24nLCAndGgnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGluZGV4ID0gJCh0aGlzKS5hdHRyKCJkYXRhLWNvbHVtbi1pbmRleCIpOwogICAgICAgICAgICBkaXIgPSAnYXNjJzsKICAgICAgICAgICAgaWYgKCQodGhpcykuaGFzQ2xhc3MoJ3NvcnRpbmdfYXNjJykpIHsKICAgICAgICAgICAgICAgIGRpciA9ICdkZXNjJwogICAgICAgICAgICB9IGVsc2UgaWYgKCQodGhpcykuaGFzQ2xhc3MoJ3NvcnRpbmdfZGVzYycpKSB7CiAgICAgICAgICAgICAgICBkaXIgPSAnYXNjJwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlzVmlld0luc3RhbmNlID0gMDsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIG9wZW5BbGVydFRhZ01vZGFsID0gZnVuY3Rpb24gKCkgewogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuZWRpdEFsZXJ0VGFncycsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgdmFyIHBhcmVudF9yb3cgPSAkKGV2ZW50LnRhcmdldCkuY2xvc2VzdCgndHInKTsKICAgICAgICAgICAgdmFyIGluZGV4ID0gJCh0aGlzKS5jbG9zZXN0KCd0cicpLmluZGV4KCk7CiAgICAgICAgICAgIHZhciByb3dPYmplY3QgPSB0YWJsZS5yb3dzKGluZGV4KS5kYXRhKClbMF07CiAgICAgICAgICAgIHZhciBhbGVydElkID0gcm93T2JqZWN0LmlkOwogICAgICAgICAgICB2YXIgZXhlY0NvbmZpZ0lkID0gcGFyZW50X3Jvdy5maW5kKCcuZXhlY0NvbmZpZ0lkJykuYXR0cigidmFsdWUiKTsKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDogZmV0Y2hUYWdzVXJsLAogICAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgICAgIGFsZXJ0SWQ6IGFsZXJ0SWQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGFsZXJ0VGFnTW9kYWxPYmogPSAkKCcjYWxlcnRUYWdNb2RhbCcpOwogICAgICAgICAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI3NpbmdsZUFsZXJ0VGFncycpLnNlbGVjdDIoewogICAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogIkFkZCBDYXRlZ29yaWVzIiwKICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlwbGU6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3M6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc3VsdC50YWdMaXN0CgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmoubW9kYWwoJ3Nob3cnKTsKICAgICAgICAgICAgICAgICAgICBhbGVydFRhZ01vZGFsT2JqLmZpbmQoJyNzaW5nbGVBbGVydFRhZ3MnKS52YWwocmVzdWx0LmFsZXJ0VGFnTGlzdCk7CiAgICAgICAgICAgICAgICAgICAgYWxlcnRUYWdNb2RhbE9iai5maW5kKCcjc2luZ2xlQWxlcnRUYWdzJykudHJpZ2dlcignY2hhbmdlJyk7CiAgICAgICAgICAgICAgICAgICAgYWxlcnRUYWdNb2RhbE9iai5maW5kKCIuYWRkVGFncyIpLnVuYmluZCgpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogc2F2ZVRhZ1VybCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydFRhZ3M6IEpTT04uc3RyaW5naWZ5KGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI3NpbmdsZUFsZXJ0VGFncycpLnZhbCgpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydElkOiBhbGVydElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4ZWNDb25maWdJZDogZXhlY0NvbmZpZ0lkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5hamF4LnJlbG9hZCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIG9wZW5TaW5nbGVBbGVydFRhZ01vZGFsID0gZnVuY3Rpb24gKHRhYmxlT2JqLCB0YWdzT2JqKSB7CiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5lZGl0QWxlcnRUYWdzJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgIHZhciBwYXJlbnRfcm93ID0gJChldmVudC50YXJnZXQpLmNsb3Nlc3QoJ3RyJyk7CiAgICAgICAgICAgIHZhciBpbmRleCA9ICQodGhpcykuY2xvc2VzdCgndHInKS5pbmRleCgpOwogICAgICAgICAgICBpZiAoaXNBYnN0cmFjdFZpZXdPckNhc2VWaWV3KGluZGV4KSkgewogICAgICAgICAgICAgICAgaW5kZXggPSBpbmRleCAvIDIKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgcm93T2JqZWN0ID0gdGFibGVPYmoucm93cyhpbmRleCkuZGF0YSgpWzBdOwogICAgICAgICAgICB2YXIgYWxlcnRJZCA9IHJvd09iamVjdC5pZDsKICAgICAgICAgICAgdmFyIGV4ZWNDb25maWdJZCA9IHBhcmVudF9yb3cuZmluZCgnLmV4ZWNDb25maWdJZCcpLmF0dHIoInZhbHVlIik7CiAgICAgICAgICAgIHZhciBhbGVydFRhZ01vZGFsT2JqID0gJCgnI2FsZXJ0VGFnTW9kYWwnKTsKICAgICAgICAgICAgdmFyICRzaW5nbGVDYXNlQWxlcnRUYWdzID0gYWxlcnRUYWdNb2RhbE9iai5maW5kKCcjc2luZ2xlQWxlcnRUYWdzJyk7CiAgICAgICAgICAgIHZhciAkZ2xvYmFsVGFncyA9IGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI2dsb2JhbFRhZ3MnKTsKICAgICAgICAgICAgYXBwbHlTZWxlY3QyRm9yVGFncygkc2luZ2xlQ2FzZUFsZXJ0VGFncywgZmV0Y2hUYWdzVXJsLCAnQ2FzZSBTZXJpZXMgQ2F0ZWdvcmllcycsIHRydWUpOwogICAgICAgICAgICBhcHBseVNlbGVjdDJGb3JUYWdzKCRnbG9iYWxUYWdzLCBmZXRjaFRhZ3NVcmwsICdHbG9iYWwgQ2F0ZWdvcmllcycsIGZhbHNlKTsKICAgICAgICAgICAgJHNpbmdsZUNhc2VBbGVydFRhZ3MuZmluZCgnb3B0aW9uJykucmVtb3ZlKCkKICAgICAgICAgICAgJGdsb2JhbFRhZ3MuZmluZCgnb3B0aW9uJykucmVtb3ZlKCkKICAgICAgICAgICAgJHNpbmdsZUNhc2VBbGVydFRhZ3MudmFsKG51bGwpLnRyaWdnZXIoImNoYW5nZSIpOwogICAgICAgICAgICAkZ2xvYmFsVGFncy52YWwobnVsbCkudHJpZ2dlcigiY2hhbmdlIik7CiAgICAgICAgICAgICQuZWFjaChyb3dPYmplY3QuY2FzZVNlcmllc1RhZ3MsIGZ1bmN0aW9uIChpbmRleCwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHZhciBvcHRpb24gPSBuZXcgT3B0aW9uKHZhbHVlLCB2YWx1ZSwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAkc2luZ2xlQ2FzZUFsZXJ0VGFncy5hcHBlbmQob3B0aW9uKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICQuZWFjaChyb3dPYmplY3QuZ2xvYmFsVGFncywgZnVuY3Rpb24gKGluZGV4LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgdmFyIG9wdGlvbiA9IG5ldyBPcHRpb24odmFsdWUsIHZhbHVlLCB0cnVlLCB0cnVlKTsKICAgICAgICAgICAgICAgICRnbG9iYWxUYWdzLmFwcGVuZChvcHRpb24pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYWxlcnRUYWdNb2RhbE9iai5maW5kKCcjc2luZ2xlQWxlcnRUYWdzJykudHJpZ2dlcignY2hhbmdlJyk7CiAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI2dsb2JhbFRhZ3MnKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgICAgICAgdmFyIGVuYWJsZUNhc2VTZXJpZXNUYWdzID0gcm93T2JqZWN0LmlzQ2FzZVNlcmllc0dlbmVyYXRlZDsKICAgICAgICAgICAgaWYgKCFlbmFibGVDYXNlU2VyaWVzVGFncykgewogICAgICAgICAgICAgICAgYWxlcnRUYWdNb2RhbE9iai5maW5kKCcjc2luZ2xlQWxlcnRUYWdzJykuYXR0cignZGlzYWJsZWQnLCAnJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWxlcnRUYWdNb2RhbE9iai5tb2RhbCgnc2hvdycpOwogICAgICAgICAgICBhbGVydFRhZ01vZGFsT2JqLmZpbmQoIi5hZGRUYWdzIikudW5iaW5kKCkuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICB1cmw6IHNhdmVUYWdVcmwsCiAgICAgICAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgICAgICAgICBhbGVydFRhZ3M6IEpTT04uc3RyaW5naWZ5KGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI3NpbmdsZUFsZXJ0VGFncycpLnZhbCgpKSwKICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsVGFnczogSlNPTi5zdHJpbmdpZnkoYWxlcnRUYWdNb2RhbE9iai5maW5kKCcjZ2xvYmFsVGFncycpLnZhbCgpKSwKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlZENhc2VTZXJpZXNUYWdzOiBKU09OLnN0cmluZ2lmeSh0YWdzT2JqLmRlbGV0ZWRDYXNlU2VyaWVzVGFncyksCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRHbG9iYWxUYWdzOiBKU09OLnN0cmluZ2lmeSh0YWdzT2JqLmRlbGV0ZWRHbG9iYWxUYWdzKSwKICAgICAgICAgICAgICAgICAgICAgICAgYWRkZWRDYXNlU2VyaWVzVGFnczogSlNPTi5zdHJpbmdpZnkodGFnc09iai5hZGRlZENhc2VTZXJpZXNUYWdzKSwKICAgICAgICAgICAgICAgICAgICAgICAgYWRkZWRHbG9iYWxUYWdzOiBKU09OLnN0cmluZ2lmeSh0YWdzT2JqLmFkZGVkR2xvYmFsVGFncyksCiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0SWQ6IGFsZXJ0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGV4ZWNDb25maWdJZDogZXhlY0NvbmZpZ0lkCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChwYXlsb2FkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXlsb2FkLnN0YXR1cykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVPYmouYWpheC5yZWxvYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuTm90aWZpY2F0aW9uLm5vdGlmeSgnc3VjY2VzcycsICd0b3AgcmlnaHQnLCAiU3VjY2VzcyIsIHBheWxvYWQubWVzc2FnZSwge2F1dG9IaWRlRGVsYXk6IDIwMDB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuTm90aWZpY2F0aW9uLm5vdGlmeSgnZXJyb3InLCAndG9wIHJpZ2h0JywgIkVycm9yIiwgcGF5bG9hZC5tZXNzYWdlLCB7YXV0b0hpZGVEZWxheTogMjAwMH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNzaW5nbGUtY2FzZS1hbGVydC1zcGlubmVyJykuYWRkQ2xhc3MoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgJCgnI3NpbmdsZS1jYXNlLWFsZXJ0LXNwaW5uZXInKS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgcG9wdWxhdGVBZHZhbmNlZEZpbHRlclNlbGVjdCA9IGZ1bmN0aW9uIChhbGVydFR5cGUpIHsKCiAgICAgICAgJCgiLmFkdmFuY2VkLWZpbHRlci1kcm9wZG93biIpLnNlbGVjdDIoewogICAgICAgICAgICBwbGFjZWhvbGRlcjogJC5pMThuLl8oJ3NlbGVjdE9uZScpLAogICAgICAgICAgICBhbGxvd0NsZWFyOiB0cnVlLAogICAgICAgICAgICBhamF4OiB7CiAgICAgICAgICAgICAgICB1cmw6IGZldGNoQWR2RmlsdGVyVXJsLAogICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJywKICAgICAgICAgICAgICAgIHR5cGU6ICJHRVQiLAogICAgICAgICAgICAgICAgcXVpZXRNaWxsaXM6IDUwLAogICAgICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24gKHBhcmFtcykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0VHlwZTogYWxlcnRUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXJtOiBwYXJhbXMudGVybSB8fCAnJywKICAgICAgICAgICAgICAgICAgICAgICAgcGFnZTogcGFyYW1zLnBhZ2UgfHwgMSwKICAgICAgICAgICAgICAgICAgICAgICAgbWF4OiBwYXJhbXMubWF4IHx8IDMwCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBwcm9jZXNzUmVzdWx0czogZnVuY3Rpb24gKGRhdGEsIHBhcmFtcykgewogICAgICAgICAgICAgICAgICAgIHBhcmFtcy5wYWdlID0gcGFyYW1zLnBhZ2UgfHwgMTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzOiAkLm1hcChkYXRhLmxpc3QsIGZ1bmN0aW9uIChmaWx0ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogZmlsdGVyLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGZpbHRlci5pZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9yZTogKHBhcmFtcy5wYWdlICogMzApIDwgZGF0YS50b3RhbENvdW50CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vc2VsZWN0IGFkdmFuY2VkIGZpbHRlciBiYXNlZCBvbiBjdXJyZW50IHZpZXcKICAgICAgICBpZiAoJCgnI2FkdmFuY2VkRmlsdGVyVmlldycpLnZhbCgpKSB7CiAgICAgICAgICAgIHZhciBhZHZhbmNlZEZpbHRlclZpZXcgPSAkLnBhcnNlSlNPTigkKCcjYWR2YW5jZWRGaWx0ZXJWaWV3JykudmFsKCkpOwogICAgICAgICAgICB2YXIgb3B0aW9uID0gbmV3IE9wdGlvbihhZHZhbmNlZEZpbHRlclZpZXcubmFtZSwgYWR2YW5jZWRGaWx0ZXJWaWV3LmlkLCB0cnVlLCB0cnVlKTsKICAgICAgICAgICAgJCgiLmFkdmFuY2VkLWZpbHRlci1kcm9wZG93biIpLmFwcGVuZChvcHRpb24pLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgIH0KCiAgICAgICAgJCgnI2FkZEFkdmFuY2VkRmlsdGVyJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBzaWduYWwuYWR2YW5jZWRGaWx0ZXIuaW5pdGlhbGl6ZUFkdmFuY2VkRmlsdGVycygkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCcpKTsKICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI3NlbGVjdE9wZXJhdG9yJykuZW1wdHkoKS5hcHBlbmQoJzxvcHRpb24gc2VsZWN0ZWQ9InNlbGVjdGVkIiB2YWx1ZT0iIj5TZWxlY3QgT3BlcmF0b3I8L29wdGlvbj4nKTsKICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI25hbWUnKS52YWwoJycpOwogICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAjZGVzY3JpcHRpb24nKS52YWwoJycpOwogICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAjcXVlcnlKU09OJykudmFsKCcnKTsKICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI2FsZXJ0VHlwZScpLnZhbCgnJyk7CiAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNidWlsZGVyQWxsJykuZmluZCgnLmV4cHJlc3Npb24nKS5yZW1vdmUoKTsKICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgLmRlbGV0ZUFkdkZpbHRlcicpLmFkZENsYXNzKCdoaWRlJyk7CiAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsIC5maWx0ZXJzV2l0aG91dFNhdmluZycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7CiAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsJykubW9kYWwoJ3Nob3cnKTsKCiAgICAgICAgfSk7CgogICAgICAgICQoJyNlZGl0QWR2YW5jZWRGaWx0ZXInKS51bmJpbmQoKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBhZHZhbmNlZEZpbHRlcklkID0gJCgnLmFkdmFuY2VkLWZpbHRlci1kcm9wZG93bicpLnZhbCgpOwogICAgICAgICAgICBpZiAoYWR2YW5jZWRGaWx0ZXJJZCkgewogICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICB1cmw6IGZldGNoQWR2YW5jZWRGaWx0ZXJJbmZvVXJsLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IHsnYWR2YW5jZWRGaWx0ZXIuaWQnOiBhZHZhbmNlZEZpbHRlcklkfSwKICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJHRVQiLAogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI3NlbGVjdE9wZXJhdG9yJykuZW1wdHkoKS5hcHBlbmQoJzxvcHRpb24gc2VsZWN0ZWQ9InNlbGVjdGVkIiB2YWx1ZT0iIj5TZWxlY3QgT3BlcmF0b3I8L29wdGlvbj4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI25hbWUnKS52YWwocmVzdWx0Lm5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAjZGVzY3JpcHRpb24nKS52YWwocmVzdWx0LmRlc2NyaXB0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI3F1ZXJ5SlNPTicpLnZhbChyZXN1bHQuSlNPTlF1ZXJ5KTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI2FsZXJ0VHlwZScpLnZhbChhbGVydFR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAjZmlsdGVySWQnKS52YWwoYWR2YW5jZWRGaWx0ZXJJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsIC5maWx0ZXJzV2l0aG91dFNhdmluZycpLmFkZENsYXNzKCdoaWRlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsIC5kZWxldGVBZHZGaWx0ZXInKS5yZW1vdmVDbGFzcygnaGlkZScpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAubW9kYWwtdGl0bGUnKS5odG1sKCJFZGl0IEZpbHRlciIpOwogICAgICAgICAgICAgICAgICAgICAgICBzaWduYWwuYWR2YW5jZWRGaWx0ZXIuaW5pdGlhbGl6ZUFkdmFuY2VkRmlsdGVycygpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCcpLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgJCgiLmFkdmFuY2VkLWZpbHRlci1kcm9wZG93biIpLm9uKCJjaGFuZ2UiLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB0YWJsZS5hamF4LnJlbG9hZCgpCiAgICAgICAgfSk7CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgICAgb3BlbkFsZXJ0Q29tbWVudE1vZGFsOiBvcGVuQWxlcnRDb21tZW50TW9kYWwsCiAgICAgICAgb3BlbkNhc2VIaXN0b3J5TW9kYWw6IG9wZW5DYXNlSGlzdG9yeU1vZGFsLAogICAgICAgIHJlc3RhcnRSZXZpZXc6IHJlc3RhcnRSZXZpZXcsCiAgICAgICAgb3BlblNpbWlsYXJDYXNlc01vZGFsOiBvcGVuU2ltaWxhckNhc2VzTW9kYWwsCiAgICAgICAgYXBwbHlCdXNpbmVzc1J1bGVzOiBhcHBseUJ1c2luZXNzUnVsZXMsCiAgICAgICAgc2hvd0F0dGFjaG1lbnRNb2RhbDogb3BlbkF0dGFjaG1lbnRNb2RhbCwKICAgICAgICBiaW5kR3JpZER5bmFtaWNGaWx0ZXJzOiBiaW5kR3JpZER5bmFtaWNGaWx0ZXJzLAogICAgICAgIGVuYWJsZU1lbnVUb29sdGlwczogZW5hYmxlTWVudVRvb2x0aXBzLAogICAgICAgIGRpc2FibGVUb29sdGlwczogZGlzYWJsZVRvb2x0aXBzLAogICAgICAgIHNvcnRJY29uSGFuZGxlcjogc29ydEljb25IYW5kbGVyLAogICAgICAgIGlzQWxlcnRQZXJzaXN0ZWRJblNlc3Npb25TdG9yYWdlOiBpc0FsZXJ0UGVyc2lzdGVkSW5TZXNzaW9uU3RvcmFnZSwKICAgICAgICByZW1vdmVGaWx0ZXJzRnJvbVNlc3Npb25TdG9yYWdlOiByZW1vdmVGaWx0ZXJzRnJvbVNlc3Npb25TdG9yYWdlLAogICAgICAgIG9wZW5TYXZlVmlld01vZGFsOiBvcGVuU2F2ZVZpZXdNb2RhbCwKICAgICAgICBjcmVhdGVTb3J0aW5nTWFwOiBjcmVhdGVTb3J0aW5nTWFwLAogICAgICAgIGNyZWF0ZUZpbHRlck1hcDogY3JlYXRlRmlsdGVyTWFwLAogICAgICAgIGNyZWF0ZUxpc3RPZkluZGV4OiBjcmVhdGVMaXN0T2ZJbmRleCwKICAgICAgICBvcGVuQWxlcnRUYWdNb2RhbDogb3BlbkFsZXJ0VGFnTW9kYWwsCiAgICAgICAgc2V0U29ydE9yZGVyOiBzZXRTb3J0T3JkZXIsCiAgICAgICAgb3BlblNpbmdsZUFsZXJ0VGFnTW9kYWw6IG9wZW5TaW5nbGVBbGVydFRhZ01vZGFsLAogICAgICAgIGdlbmVyYXRlVmlld0luZm86IGdlbmVyYXRlVmlld0luZm8sCiAgICAgICAgcG9wdWxhdGVBZHZhbmNlZEZpbHRlclNlbGVjdDogcG9wdWxhdGVBZHZhbmNlZEZpbHRlclNlbGVjdAogICAgfQoKfSkoKTsKCmZ1bmN0aW9uIHNob3dFcnJvck1lc3NhZ2VJbk1vZGFsKCRtb2RhbCwgdGV4dCkgewogICAgY2xlYXJfZXJyb3JzKCk7CiAgICBpZiAodGV4dCkgewogICAgICAgIHRleHQgPSB0ZXh0OwogICAgfSBlbHNlIHsKICAgICAgICB0ZXh0ID0gJ1BsZWFzZSBmaWxsICB0aGUgcmVxdWlyZWQgRmllbGRzJzsKICAgIH0KICAgIHZhciBhbGVydEh0bWwgPSBnZXRFcnJvck1lc3NhZ2VIdG1sKHRleHQpOwogICAgJG1vZGFsLmZpbmQoJy5tb2RhbC1ib2R5JykucHJlcGVuZChhbGVydEh0bWwpOwp9CgpmdW5jdGlvbiBnZXRFcnJvck1lc3NhZ2VIdG1sKG1zZykgewogICAgdmFyIGFsZXJ0SHRtbCA9ICc8ZGl2IGNsYXNzPSJhbGVydCBhbGVydC1kYW5nZXIgYWxlcnQtZGlzbWlzc2libGUiIHJvbGU9ImFsZXJ0Ij4gJyArCiAgICAgICAgJzxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iY2xvc2UiIGRhdGEtZGlzbWlzcz0iYWxlcnQiPiAnICsKICAgICAgICAnPHNwYW4gYXJpYS1oaWRkZW49InRydWUiPiZ0aW1lczs8L3NwYW4+ICcgKwogICAgICAgICc8c3BhbiBjbGFzcz0ic3Itb25seSI+PGc6bWVzc2FnZSBjb2RlPSJkZWZhdWx0LmJ1dHRvbi5jbG9zZS5sYWJlbCIgLz48L3NwYW4+ICcgKwogICAgICAgICc8L2J1dHRvbj4gJyArIG1zZzsKICAgICc8L2Rpdj4nOwogICAgcmV0dXJuIGFsZXJ0SHRtbDsKfQoKdmFyIGNsZWFyX2Vycm9ycyA9IGZ1bmN0aW9uICgpIHsKICAgICQoJy5tb2RhbCAubW9kYWwtYm9keSAuYWxlcnQnKS5yZW1vdmUoKTsKfTsKCmZ1bmN0aW9uIHNlYXJjaChuYW1lS2V5LCBteUFycmF5KSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG15QXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAobXlBcnJheVtpXS5uYW1lID09PSBuYW1lS2V5KSB7CiAgICAgICAgICAgIHJldHVybiBteUFycmF5W2ldOwogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gcG9wdWxhdGVUb3BpY0RldGFpbCgkbW9kYWwsIHRvcGljT2JqKSB7CiAgICAkbW9kYWwuZmluZCgnI3N0YXJ0RGF0ZScpLnZhbCh0b3BpY09iai5zdGFydERhdGUpOwogICAgJG1vZGFsLmZpbmQoJyNlbmREYXRlJykudmFsKHRvcGljT2JqLmVuZERhdGUpOwogICAgJG1vZGFsLmZpbmQoJy5wcm9kdWN0LXNwYW4nKS50ZXh0KGdldFByb2R1Y3ROYW1lTGlzdChKU09OLnBhcnNlKHRvcGljT2JqLnByb2R1Y3RzKSkpOwogICAgJG1vZGFsLmZpbmQoJyNzdGFydERhdGUnKS5hdHRyKCJkaXNhYmxlZCIsICIiKTsKICAgICRtb2RhbC5maW5kKCcjZW5kRGF0ZScpLmF0dHIoImRpc2FibGVkIiwgIiIpOwogICAgaWYgKHRvcGljT2JqLnByb2R1Y3RzKSB7CiAgICAgICAgJG1vZGFsLmZpbmQoJyNwcm9kdWN0JykuYXR0cigiZGlzYWJsZWQiLCAiIik7CiAgICB9Cn0KCmZ1bmN0aW9uIGRlcG9wdWxhdGVUb3BpY0RldGFpbCgkbW9kYWwpIHsKICAgIHZhciBwcm9kdWN0SnNvbiA9ICRtb2RhbC5maW5kKCcucHJvZHVjdC1qc29uLWNvbnRhaW5lcicpLnZhbCgpOwogICAgJG1vZGFsLmZpbmQoJyNzdGFydERhdGUnKS52YWwoIiIpOwogICAgJG1vZGFsLmZpbmQoJyNlbmREYXRlJykudmFsKCIiKTsKICAgICRtb2RhbC5maW5kKCcjcHJvZHVjdCcpLnZhbCgiIik7CiAgICAkbW9kYWwuZmluZCgnLnByb2R1Y3Qtc3BhbicpLnRleHQoZ2V0UHJvZHVjdE5hbWVMaXN0KEpTT04ucGFyc2UocHJvZHVjdEpzb24pKSk7CiAgICAkbW9kYWwuZmluZCgnI3N0YXJ0RGF0ZScpLnJlbW92ZUF0dHIoImRpc2FibGVkIik7CiAgICAkbW9kYWwuZmluZCgnI2VuZERhdGUnKS5yZW1vdmVBdHRyKCJkaXNhYmxlZCIpOwogICAgJG1vZGFsLmZpbmQoJyNwcm9kdWN0JykucmVtb3ZlQXR0cigiZGlzYWJsZWQiKTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGVQcm9kdWN0SnNvbihwcm9kdWN0SWQsIHByb2R1Y3ROYW1lLCBsZXZlbCkgewogICAgdmFyIHRvcGljUHJvZHVjdFZhbHVlcyA9IHsiMSI6IFtdLCAiMiI6IFtdLCAiMyI6IFtdLCAiNCI6IFtdLCAiNSI6IFtdfTsKICAgIHRvcGljUHJvZHVjdFZhbHVlc1tsZXZlbF0ucHVzaCh7bmFtZTogcHJvZHVjdE5hbWUsIGlkOiBwcm9kdWN0SWR9KTsKICAgIHJldHVybiB0b3BpY1Byb2R1Y3RWYWx1ZXM7Cn0KCmZ1bmN0aW9uIGdldFByb2R1Y3ROYW1lTGlzdChvYmopIHsKICAgIHZhciBwcm9kdWN0QXJyYXkgPSBbXTsKICAgIHZhciBvYmpBcnJheSA9IG9ialsnMyddOwogICAgJC5lYWNoKG9iakFycmF5LCBmdW5jdGlvbiAoaW5kZXgsIHZhbHVlKSB7CiAgICAgICAgcHJvZHVjdEFycmF5LnB1c2godmFsdWUubmFtZSk7CiAgICB9KTsKICAgIHJldHVybiBwcm9kdWN0QXJyYXkuam9pbignLCcpOwp9CgpmdW5jdGlvbiBnZXRQcm9kdWN0SnNvbihhcHBsaWNhdGlvbk5hbWUsIHJvdykgewogICAgdmFyIHByb2R1Y3RKc29uOwogICAgaWYgKGFwcGxpY2F0aW9uTmFtZSA9PSAiQWQtSG9jIEFsZXJ0IikgewogICAgICAgIGlmIChyb3cuZmluZCgnLnJvdy1wcm9kdWN0LWpzb24tY29udGFpbmVyJykudmFsKCkpCiAgICAgICAgICAgIHByb2R1Y3RKc29uID0gSlNPTi5wYXJzZShyb3cuZmluZCgnLnJvdy1wcm9kdWN0LWpzb24tY29udGFpbmVyJykudmFsKCkpOwogICAgfSBlbHNlIHsKICAgICAgICB2YXIgcHJvZHVjdE5hbWUgPSByb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJwcm9kdWN0TmFtZSJdJykuYXR0cigiZGF0YS1pZCIpOwogICAgICAgIHZhciBwcm9kdWN0SWQgPSByb3cuZmluZCgnLnJvdy1wcm9kdWN0LWlkJykudmFsKCk7CiAgICAgICAgdmFyIGxldmVsID0gcm93LmZpbmQoJy5yb3ctbGV2ZWwtaWQnKS52YWwoKTsKICAgICAgICBpZiAoIWxldmVsKSB7CiAgICAgICAgICAgIGxldmVsID0gMzsKICAgICAgICB9CiAgICAgICAgcHJvZHVjdEpzb24gPSBnZW5lcmF0ZVByb2R1Y3RKc29uKHByb2R1Y3RJZCwgcHJvZHVjdE5hbWUsIGxldmVsKTsKICAgIH0KICAgIHJldHVybiBwcm9kdWN0SnNvbjsKfQoKZnVuY3Rpb24gYXBwbHlTZWxlY3QyRm9yVGFncygkc2VsZWN0b3IsIHVybCwgcGxhY2VIb2xkZXJUZXh0LCBpc0Nhc2VTZXJpZXNUYWcpIHsKICAgICRzZWxlY3Rvci5zZWxlY3QyKHsKICAgICAgICBtaW5pbXVtSW5wdXRMZW5ndGg6IDAsCiAgICAgICAgbXVsdGlwbGU6IHRydWUsCiAgICAgICAgdGFnczogdHJ1ZSwKICAgICAgICBwbGFjZWhvbGRlcjogcGxhY2VIb2xkZXJUZXh0LAogICAgICAgIGFsbG93Q2xlYXI6IHRydWUsCiAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICBjcmVhdGVUYWc6IGZ1bmN0aW9uICh0YWcpIHsKCiAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZSBvcHRpb24gaXMgYWxyZWFkeSB0aGVyZQogICAgICAgICAgICBmb3VuZCA9IGZhbHNlOwogICAgICAgICAgICAkc2VsZWN0b3IuZmluZCgib3B0aW9uIikuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoJC50cmltKHRhZy50ZXJtKS50b1VwcGVyQ2FzZSgpID09PSAkLnRyaW0oJCh0aGlzKS50ZXh0KCkpLnRvVXBwZXJDYXNlKCkpIHsKICAgICAgICAgICAgICAgICAgICBwcmV2VGFnID0gJCh0aGlzKTsKICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gaWYgaXQncyBub3QgdGhlcmUsIHRoZW4gc2hvdyB0aGUgc3VnZ2VzdGlvbgogICAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGlkOiAkLnRyaW0odGFnLnRlcm0pLAogICAgICAgICAgICAgICAgICAgIHRleHQ6ICQudHJpbSh0YWcudGVybSkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGlkOiAkLnRyaW0ocHJldlRhZy50ZXh0KCkpLAogICAgICAgICAgICAgICAgICAgIHRleHQ6ICQudHJpbShwcmV2VGFnLnRleHQoKSkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFqYXg6IHsKICAgICAgICAgICAgcXVpZXRNaWxsaXM6IDI1MCwKICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgIGRhdGE6IGZ1bmN0aW9uIChwYXJhbXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgdGVybTogcGFyYW1zLnRlcm0sCiAgICAgICAgICAgICAgICAgICAgcGFnZTogcGFyYW1zLnBhZ2UgfHwgMSwKICAgICAgICAgICAgICAgICAgICBtYXg6IDMwLAogICAgICAgICAgICAgICAgICAgIGxhbmc6IHVzZXJMb2NhbGUsCiAgICAgICAgICAgICAgICAgICAgaXNDYXNlU2VyaWVzVGFnOiBpc0Nhc2VTZXJpZXNUYWcKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHByb2Nlc3NSZXN1bHRzOiBmdW5jdGlvbiAoZGF0YSwgcGFyYW1zKSB7CiAgICAgICAgICAgICAgICBwYXJhbXMucGFnZSA9IHBhcmFtcy5wYWdlIHx8IDE7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHJlc3VsdHM6IGRhdGEubGlzdCwKICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vcmU6IChwYXJhbXMucGFnZSAqIDMwKSA8IGRhdGEudG90YWxDb3VudAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKfQoKZnVuY3Rpb24gc2hvd0NvbW1lbnRJY29uKGN1cnJlbnRSb3cpIHsKICAgIHZhciAkYnRuR3JvdXAgPSAkKGN1cnJlbnRSb3cpLmNsb3Nlc3QoJ3RyJykuZmluZCgndGQuZHJvcERvd24gLmJ0bi1ncm91cCcpOwogICAgaWYgKCQoJGJ0bkdyb3VwKS5maW5kKCcuY29tbWVudCcpLmxlbmd0aCA9PT0gMCkgewogICAgICAgICQoJGJ0bkdyb3VwKS5maW5kKCcuZHJvcGRvd24tdG9nZ2xlJykuYWZ0ZXIoJzxpIGNsYXNzPSJtZGkgbWRpLWNoYXQgYmx1ZS0yIGZvbnQtMTMgcG9zLWFiIGNvbW1lbnQiIHRpdGxlPSInICsgJC5pMThuLl8oJ2NvbW1lbnRBdmFpbGFibGUnKSArICciPjwvaT4nKTsKICAgIH0KfQoKZnVuY3Rpb24gcmVtb3ZlQ29tbWVudEljb24oY3VycmVudFJvdykgewogICAgdmFyICRidG5Hcm91cCA9ICQoY3VycmVudFJvdykuY2xvc2VzdCgndHInKS5maW5kKCd0ZC5kcm9wRG93biAuYnRuLWdyb3VwJyk7CiAgICAkKCRidG5Hcm91cCkuZmluZCgnLmRyb3Bkb3duLXRvZ2dsZScpLm5leHQoJ2knKS5yZW1vdmUoKTsKfQoKZnVuY3Rpb24gcmVtb3ZlQXR0YWNobWVudEljb24oY3VycmVudFJvdykgewogICAgdmFyICRidG5Hcm91cCA9ICQoY3VycmVudFJvdykuY2xvc2VzdCgndHInKS5maW5kKCd0ZC5kcm9wRG93biAuYnRuLWdyb3VwJyk7CiAgICBpZiAoJCgkYnRuR3JvdXApLmZpbmQoJy5jb21tZW50JykubGVuZ3RoID09PSAwKSB7CiAgICAgICAgJCgkYnRuR3JvdXApLmZpbmQoJy5kcm9wZG93bi10b2dnbGUnKS5uZXh0KCdpJykucmVtb3ZlKCk7CiAgICB9IGVsc2UgewogICAgICAgICQoJGJ0bkdyb3VwKS5maW5kKCcuY29tbWVudCcpLm5leHQoJ2knKS5yZW1vdmUoKTsKICAgIH0KfQoKZnVuY3Rpb24gc2hvd0F0dGFjaG1lbnRJY29uKHRyUm93KSB7CiAgICB2YXIgJGJ0bkdyb3VwID0gJCh0clJvdykuZmluZCgndGQuZHJvcERvd24gLmJ0bi1ncm91cCcpOwogICAgaWYgKCQoJGJ0bkdyb3VwKS5maW5kKCcuYXR0YWNoJykubGVuZ3RoID09PSAwKSB7CiAgICAgICAgaWYgKCQoJGJ0bkdyb3VwKS5maW5kKCcuY29tbWVudCcpLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAkKCRidG5Hcm91cCkuZmluZCgnLmRyb3Bkb3duLXRvZ2dsZScpLmFmdGVyKCcgPGkgY2xhc3M9Im1kaSBtZGktYXR0YWNobWVudCBibHVlLTEgZm9udC0xMyBwb3MtYWIgYXR0YWNoIiB0aXRsZT0iJyArICQuaTE4bi5fKCdhdHRhY2htZW50QXZhaWxhYmxlJykgKyAnIj48L2k+ICcpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICQoJGJ0bkdyb3VwKS5maW5kKCcuY29tbWVudCcpLmFmdGVyKCcgPGkgY2xhc3M9Im1kaSBtZGktYXR0YWNobWVudCBibHVlLTEgZm9udC0xMyBwb3MtYWIgYXR0YWNoIiB0aXRsZT0iJyArICQuaTE4bi5fKCdhdHRhY2htZW50QXZhaWxhYmxlJykgKyAnIj48L2k+ICcpOwogICAgICAgIH0KICAgIH0KfQoKdmFyIGlzU2FmZXR5TGVhZEFsbG93ZWQgPSBmdW5jdGlvbiAobGlzdFByb2R1Y3RJZHMsIHNlbGVjdGVkUHJvZHVjdElkKSB7CiAgICByZXR1cm4gbGlzdFByb2R1Y3RJZHMuaW5kZXhPZihzZWxlY3RlZFByb2R1Y3RJZCkgIT09IC0xCn07Cgp2YXIgc2V0Q29sdW1uU2VxID0gZnVuY3Rpb24gKG1hcFNlcSkgewogICAgY29sdW1uU2VxID0gbWFwU2VxCn0KCnZhciBzaWduYWwgPSBzaWduYWwgfHwge307CgpzaWduYWwuYXJjaGl2ZWRfdXRpbHMgPSAoZnVuY3Rpb24gKCkgewogICAgdmFyIGFyY2hpdmVkX3RhYmxlOwogICAgdmFyIHNvcnRpbmdDb3VudCA9IDE7CgogICAgdmFyIGluaXRfYXJjaGl2ZWRfdGFibGUgPSBmdW5jdGlvbiAodGFibGUsIHVybCwgYXBwVHlwZSwgYWxlcnREZXRhaWxVcmwpIHsKICAgICAgICBpZiAoISQuZm4uZGF0YVRhYmxlLmlzRGF0YVRhYmxlKHRhYmxlKSkgewogICAgICAgICAgICBhcmNoaXZlZF90YWJsZSA9ICQodGFibGUpLkRhdGFUYWJsZSh7CiAgICAgICAgICAgICAgICAic1BhZ2luYXRpb25UeXBlIjogImJvb3RzdHJhcCIsCgogICAgICAgICAgICAgICAgImxhbmd1YWdlIjogewogICAgICAgICAgICAgICAgICAgICJ1cmwiOiAiLi4vYXNzZXRzL2kxOG4vZGF0YVRhYmxlc18iICsgdXNlckxvY2FsZSArICIuanNvbiIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBmbkRyYXdDYWxsYmFjazogZnVuY3Rpb24gKCl7CiAgICAgICAgICAgICAgICAgICAgY29sRWxsaXBzaXMoKTsKICAgICAgICAgICAgICAgICAgICB3ZWJVaVBvcEluaXQoKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAiYWpheCI6IHsKICAgICAgICAgICAgICAgICAgICAidXJsIjogdXJsLAogICAgICAgICAgICAgICAgICAgICJkYXRhU3JjIjogIiIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAiYWFTb3J0aW5nIjogW1tzb3J0aW5nQ291bnQsICJkZXNjIl1dLAogICAgICAgICAgICAgICAgImJMZW5ndGhDaGFuZ2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImlEaXNwbGF5TGVuZ3RoIjogMTAsCiAgICAgICAgICAgICAgICAiYkF1dG9XaWR0aCI6IGZhbHNlLAogICAgICAgICAgICAgICAgImFvQ29sdW1ucyI6IGNyZWF0ZV9hcmNoaXZlZF9jb2x1bW5fZGF0YShhcHBUeXBlLCBhbGVydERldGFpbFVybCksCiAgICAgICAgICAgICAgICAic2Nyb2xsWCI6IHRydWUsCiAgICAgICAgICAgICAgICAic2Nyb2xsWSI6ImNhbGMoMTAwdmggLSAyOTZweCkiLAogICAgICAgICAgICAgICAgImF1dG9XaWR0aCI6IHRydWUsCiAgICAgICAgICAgICAgICBjb2x1bW5EZWZzOiBbewogICAgICAgICAgICAgICAgICAgICJ0YXJnZXRzIjogJ19hbGwnLAogICAgICAgICAgICAgICAgICAgICJyZW5kZXIiOiAkLmZuLmRhdGFUYWJsZS5yZW5kZXIudGV4dCgpCiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIGFyY2hpdmVkX3RhYmxlOwogICAgICAgIH0KICAgIH07CgogICAgdmFyIGdlbkFsZXJ0TmFtZUxpbmsgPSBmdW5jdGlvbiAodmFsdWUsIGlkLCBhbGVydERldGFpbFVybCkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iJyArIChhbGVydERldGFpbFVybCArICc/JyArICdjYWxsaW5nU2NyZWVuPXJldmlldyYnICsKICAgICAgICAgICAgICAgIHNpZ25hbC51dGlscy5jb21wb3NlUGFyYW1zKHtjb25maWdJZDogaWR9KSkgKyAnIiArIHRhcmdldD0iX2JsYW5rIj4nICsgdmFsdWUgKyAnPC9hPicKICAgICAgICB9CiAgICB9OwoKICAgIHZhciBjcmVhdGVfYXJjaGl2ZWRfY29sdW1uX2RhdGEgPSBmdW5jdGlvbiAoYXBwVHlwZSwgYWxlcnREZXRhaWxVcmwpIHsKICAgICAgICB2YXIgYW9Db2x1bW5zID0gWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiYWxlcnROYW1lIiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBnZW5BbGVydE5hbWVMaW5rKGVzY2FwZUhUTUwocm93LmFsZXJ0TmFtZSksIHJvdy5leENvbmZpZ0lkLCBhbGVydERldGFpbFVybCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAidmVyc2lvbiIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCBmdWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTAwJwogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAicHJvZHVjdCIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY29sRWxlbWVudCA9ICc8ZGl2IGNsYXNzPSJjb2wtY29udGFpbmVyIj48ZGl2IGNsYXNzPSJjb2wtaGVpZ2h0Ij4nOwogICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQrPXJvdy5wcm9kdWN0OwogICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gJzxhIHRhYmluZGV4PSIwIiB0aXRsZT0iJyArICQuaTE4bi5fKCdhcHBMYWJlbC52aWV3QWxsJykgKyAnIiBjbGFzcz0iaWNvLWRvdHMgdmlldy1hbGwiIG1vcmUtZGF0YT0iJytyb3cucHJvZHVjdCsnIj48aSBjbGFzcz0ibWRpIG1kaS1kb3RzLWhvcml6b250YWwgZm9udC0yMCBibHVlLTEiPiA8L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgY29sRWxlbWVudCArPSAnPC9kaXY+PC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29sRWxlbWVudCAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICdjb2wtbWluLTE1MCBjZWxsLWJyZWFrJywKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogImRlc2NyaXB0aW9uIiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIGZ1bGwpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWRkRWxsaXBzaXMoZGF0YSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwIGNlbGwtYnJlYWsnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjYXNlQ291bnQiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgZnVsbCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTEwMCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogInJldmlld2VkQ2FzZXMiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgZnVsbCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTEwMCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogImRhdGVSYW5nZSIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCBmdWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAibGFzdE1vZGlmaWVkIiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIGZ1bGwpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xNTAnCiAgICAgICAgICAgIH0KICAgICAgICBdOwogICAgICAgIHJldHVybiBhb0NvbHVtbnMKICAgIH07CgogICAgdmFyIHJlbG9hZF9hcmNoaXZlZF90YWJsZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodHlwZW9mIGFyY2hpdmVkX3RhYmxlICE9ICJ1bmRlZmluZWQiICYmIGFyY2hpdmVkX3RhYmxlICE9IG51bGwpIHsKICAgICAgICAgICAgYXJjaGl2ZWRfdGFibGUuYWpheC5yZWxvYWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmxvZygiVW5hYmxlIHRvIHJlbG9hZCB0aGUgYXJjaGl2ZWQgdGFibGUuIFBsZWFzZSByZWZyZXNoIHRoZSBwYWdlLiIpOwogICAgICAgIH0KICAgIH07CgogICAgcmV0dXJuIHsKICAgICAgICBpbml0X2FyY2hpdmVkX3RhYmxlOiBpbml0X2FyY2hpdmVkX3RhYmxlLAogICAgICAgIHJlbG9hZF9hcmNoaXZlZF90YWJsZTogcmVsb2FkX2FyY2hpdmVkX3RhYmxlCiAgICB9Cn0pKCk7CnZhciBzaWduYWwgPSBzaWduYWwgfHwge307CnZhciBleGlzdGluZ1Jvd3MgPSBbXTsKCnNpZ25hbC5jb21tb25UYWcgPSAoZnVuY3Rpb24gKCkgewogICAgdmFyIG9wZW5Db21tb25BbGVydFRhZ01vZGFsID0gZnVuY3Rpb24gKG1vZHVsZSwgZG9tYWluLCB0YWdzKSB7CiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5lZGl0QWxlcnRUYWdzJywgZnVuY3Rpb24gKGV2dCkgewogICAgICAgICAgICB2YXIgcGFyZW50X3JvdyA9ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCd0cicpOwogICAgICAgICAgICB2YXIgaW5kZXggPSAkKHRoaXMpLmNsb3Nlc3QoJ3RyJykuaW5kZXgoKTsKICAgICAgICAgICAgdmFyIHJvd09iamVjdCA9IHRhYmxlLnJvd3MoaW5kZXgpLmRhdGEoKVswXTsKICAgICAgICAgICAgdmFyIGFsZXJ0SWQgPSByb3dPYmplY3QuaWQ7CiAgICAgICAgICAgIHZhciBjb21tb25UYWdNb2RhbE9iaiA9ICQoJyNjb21tb25UYWdNb2RhbCcpOwogICAgICAgICAgICBmaWxsQWxlcnRUYWdzKGNvbW1vblRhZ01vZGFsT2JqLCBmaWxsQ29tbW9uVGFnVXJsLCBtb2R1bGUsIGRvbWFpbiwgdGFncywgYWxlcnRJZCk7CiAgICAgICAgICAgIGNvbW1vblRhZ01vZGFsT2JqLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgfSk7CiAgICB9OwogICAgcmV0dXJuIHsKICAgICAgICBvcGVuQ29tbW9uQWxlcnRUYWdNb2RhbDogb3BlbkNvbW1vbkFsZXJ0VGFnTW9kYWwKICAgIH0KfSkoKTsKCnZhciBmaWxsQWxlcnRUYWdzID0gZnVuY3Rpb24gKHRhZ01vZGFsLCBmaWxsQ29tbW9uVGFnVXJsLCBtb2R1bGUsIGRvbWFpbiwgdGFncywgYWxlcnRJZCkgewogICAgdmFyIGRhdGFVcmwgPSBmaWxsQ29tbW9uVGFnVXJsICsgIi8iK21vZHVsZSsiP2RvbWFpbj0iK2RvbWFpbiArICImYWxlcnRJZD0iK2FsZXJ0SWQ7CiAgICBjYXRlZ29yeU1vZGFsVGFibGUgPSAkKCIjY2F0ZWdvcnlNb2RhbFRhYmxlIikuRGF0YVRhYmxlKHsKICAgICAgICAibGFuZ3VhZ2UiOiB7CiAgICAgICAgICAgICJ1cmwiOiAiLi4vYXNzZXRzL2kxOG4vZGF0YVRhYmxlc18iICsgdXNlckxvY2FsZSArICIuanNvbiIKICAgICAgICB9LAogICAgICAgICJjcmVhdGVkUm93IjogZnVuY3Rpb24gKCByb3csIGRhdGEsIGluZGV4ICkgewogICAgICAgICAgICB2YXIgdGFnc0VuYWJsZWQgPSBub25Db25maWd1cmVkRW5hYmxlZCAhPSAidHJ1ZSIgPyBmYWxzZSA6IHRydWU7CiAgICAgICAgICAgIHZhciBjYXRlZ29yaWVzID0gW107CiAgICAgICAgICAgIHRhZ3MuZm9yRWFjaChmdW5jdGlvbiAobWFwKSB7CiAgICAgICAgICAgICAgICBpZihtYXAucGFyZW50SWQgPT0wIHx8IG1hcC5wYXJlbnRJZCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcmllcy5wdXNoKHtpZDogbWFwLmlkLCB0ZXh0OiBtYXAudGV4dH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJCgnc2VsZWN0Jywgcm93KS5lcSgwKS5zZWxlY3QyKHsKICAgICAgICAgICAgICAgIHRhZ3M6IHRhZ3NFbmFibGVkLAogICAgICAgICAgICAgICAgZGF0YTogY2F0ZWdvcmllcywKICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAiU2VsZWN0IENhdGVnb3J5IgogICAgICAgICAgICB9KS5vbignY2hhbmdlJywgZnVuY3Rpb24ob2JqKSB7CgogICAgICAgICAgICAgICAgdmFyIHN1YnRhZ3NFbmFibGVkID0gbm9uQ29uZmlndXJlZEVuYWJsZWQgIT0gInRydWUiID8gZmFsc2UgOiB0cnVlOwogICAgICAgICAgICAgICAgdmFyIHN1YmNhdGVnb3JpZXMgPSBbXTsKICAgICAgICAgICAgICAgIHRhZ3MuZm9yRWFjaChmdW5jdGlvbiAobWFwKSB7CiAgICAgICAgICAgICAgICAgICAgaWYobWFwLnBhcmVudElkID09IG9iai5jdXJyZW50VGFyZ2V0LnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmNhdGVnb3JpZXMucHVzaCh7aWQ6IG1hcC5pZCwgdGV4dDogbWFwLnRleHR9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZihkYXRhLmFjdGlvbiA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgJCgnc2VsZWN0Jywgcm93KS5lcSgxKS5lbXB0eSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGlmIG5vIHN1YmNhdGVnb3J5IGNvbmZpZ3VyZSB0aGVuIGNhbiBub3QgYWRkIG9uIGZseSBzdWJjYXRlZ29yeQogICAgICAgICAgICAgICAgaWYoc3ViY2F0ZWdvcmllcy5sZW5ndGggPD0gMCl7CiAgICAgICAgICAgICAgICAgICAgc3VidGFnc0VuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgIHN1YnRhZ3NFbmFibGVkID0gKHN1YnRhZ3NFbmFibGVkICYmIHRydWUpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICQoJ3NlbGVjdCcsIHJvdykuZXEoMSkuc2VsZWN0Mih7CiAgICAgICAgICAgICAgICAgICAgdGFnczogc3VidGFnc0VuYWJsZWQsCiAgICAgICAgICAgICAgICAgICAgZGF0YTogc3ViY2F0ZWdvcmllcywKICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogIlNlbGVjdCBTdWIgQ2F0ZWdvcnkiCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkudHJpZ2dlcignY2hhbmdlJyk7CgogICAgICAgICAgICBpZihkYXRhLmFjdGlvbiAhPSAxKSB7CiAgICAgICAgICAgICAgICAkKCdpbnB1dCcsIHJvdykuY2xvc2VzdCgndHInKS5maW5kKCI6aW5wdXQiKS5hdHRyKCdkaXNhYmxlZCcsIHRydWUpOwogICAgICAgICAgICAgICAgaWYoZGF0YS5zdWJjYXRlZ29yeS5sZW5ndGggPD0gMCkKICAgICAgICAgICAgICAgICAgICAkKCdpbnB1dCcsIHJvdykuY2xvc2VzdCgndHInKS5maW5kKCI6aW5wdXRbY2xhc3M9c2VsZWN0Mi1zZWFyY2hfX2ZpZWxkXSIpLmF0dHIoInBsYWNlaG9sZGVyIiwgIiIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkKCIuZWRpdC1yb3ciLCByb3cpLnVuYmluZCgpLmNsaWNrKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB2YXIgaXNEaXNhYmxlZCA9ICQodGhpcykuY2xvc2VzdCgndHInKS5maW5kKCI6aW5wdXQ6bm90KDpmaXJzdCkiKS5hdHRyKCdkaXNhYmxlZCcpOwogICAgICAgICAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCd0cicpLmZpbmQoIjppbnB1dDpub3QoOmZpcnN0KSIpLmF0dHIoJ2Rpc2FibGVkJywgIWlzRGlzYWJsZWQpOwogICAgICAgICAgICAgICAgaWYoaXNEaXNhYmxlZCAmJiBkYXRhLnN1YmNhdGVnb3J5Lmxlbmd0aCA8PSAwKQogICAgICAgICAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgndHInKS5maW5kKCI6aW5wdXRbY2xhc3M9c2VsZWN0Mi1zZWFyY2hfX2ZpZWxkXSIpLmF0dHIoInBsYWNlaG9sZGVyIiwgIlNlbGVjdCBTdWIgQ2F0ZWdvcnkiKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYoaXNEaXNhYmxlZCAmJiBkYXRhLnN1YmNhdGVnb3J5Lmxlbmd0aCA+IDApCiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCd0cicpLmZpbmQoIjppbnB1dFtjbGFzcz1zZWxlY3QyLXNlYXJjaF9fZmllbGRdIikuYXR0cigicGxhY2Vob2xkZXIiLCAiIik7CiAgICAgICAgICAgICAgICBlbHNlIGlmKCFpc0Rpc2FibGVkICYmIGRhdGEuc3ViY2F0ZWdvcnkubGVuZ3RoIDw9IDApCiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCd0cicpLmZpbmQoIjppbnB1dFtjbGFzcz1zZWxlY3QyLXNlYXJjaF9fZmllbGRdIikuYXR0cigicGxhY2Vob2xkZXIiLCAiIik7CgogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICQoIi5kZWxldGUtcm93Iiwgcm93KS51bmJpbmQoKS5jbGljayhmdW5jdGlvbigpewogICAgICAgICAgICAgICAgY2F0ZWdvcnlNb2RhbFRhYmxlCiAgICAgICAgICAgICAgICAgICAgLnJvdyggJCh0aGlzKS5wYXJlbnRzKCd0cicpICkKICAgICAgICAgICAgICAgICAgICAucmVtb3ZlKCkKICAgICAgICAgICAgICAgICAgICAuZHJhdygpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICQoIi51cC1yb3ciLCByb3cpLnVuYmluZCgpLmNsaWNrKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICBjb25zdCAkcm93ID0gJCh0aGlzKS5wYXJlbnRzKCd0cicpOwogICAgICAgICAgICAgICAgaWYgKCRyb3cuaW5kZXgoKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRyb3cucHJldigpLmJlZm9yZSgkcm93LmdldCgwKSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgJCgiLmRvd24tcm93Iiwgcm93KS51bmJpbmQoKS5jbGljayhmdW5jdGlvbigpewogICAgICAgICAgICAgICAgY29uc3QgJHJvdyA9ICQodGhpcykucGFyZW50cygndHInKTsKICAgICAgICAgICAgICAgICRyb3cubmV4dCgpLmFmdGVyKCRyb3cuZ2V0KDApKTsKICAgICAgICAgICAgfSk7CgogICAgICAgIH0sCiAgICAgICAgcm93Q2FsbGJhY2s6IGZ1bmN0aW9uKCByb3csIGRhdGEsIGluZGV4ICkgewogICAgICAgICAgICBpZiAoZGF0YVsncHJpdmF0ZSddID09IHRydWUgJiYgZGF0YVsncHJpdmF0ZUFjY2VzcyddICE9IHRydWUpIHsKICAgICAgICAgICAgICAgICQocm93KS5oaWRlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGluaXRDb21wbGV0ZTogZnVuY3Rpb24oc2V0dGluZ3MsIGpzb24pewogICAgICAgICAgICBleGlzdGluZ1Jvd3MgPSBbXTsKICAgICAgICAgICAgY2F0ZWdvcnlNb2RhbFRhYmxlLnJvd3MoKS5ldmVyeShmdW5jdGlvbihpbmRleCwgZWxlbWVudCl7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLmRhdGEoKTsKICAgICAgICAgICAgICAgIHZhciBjdXJyZW50Um93ID0ge2NhdGVnb3J5OiB2YWx1ZS5jYXRlZ29yeSwgc3ViY2F0ZWdvcnk6IHZhbHVlLnN1YmNhdGVnb3J5LCBhbGVydDogdmFsdWUuYWxlcnQsIHByaXZhdGU6IHZhbHVlLnByaXZhdGUsCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEJ5OiB2YWx1ZS5jcmVhdGVkQnksIGNyZWF0ZWREYXRlOiB2YWx1ZS5jcmVhdGVkRGF0ZSwgcHJpb3JpdHk6IHZhbHVlLnByaW9yaXR5LCB1cGRhdGVkRGF0ZUluaXQ6IHZhbHVlLnVwZGF0ZWREYXRlSW5pdCwKICAgICAgICAgICAgICAgICAgICB1cGRhdGVkQnlJbml0OiB2YWx1ZS51cGRhdGVkQnlJbml0fTsKICAgICAgICAgICAgICAgIGlmKGN1cnJlbnRSb3cuY2F0ZWdvcnkuaWQgIT0gMCkKICAgICAgICAgICAgICAgICAgICBleGlzdGluZ1Jvd3MucHVzaChjdXJyZW50Um93KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICAiYWpheCI6IHsKICAgICAgICAgICAgInVybCI6IGRhdGFVcmwsCiAgICAgICAgICAgICJkYXRhU3JjIjogIiIKICAgICAgICB9LAogICAgICAgIHNlYXJjaGluZzogdHJ1ZSwKICAgICAgICAiYkxlbmd0aENoYW5nZSI6IHRydWUsCiAgICAgICAgInBhZ2luZyI6ICAgZmFsc2UsCiAgICAgICAgIm9yZGVyaW5nIjogZmFsc2UsCiAgICAgICAgInNlYXJjaGluZyI6IGZhbHNlLAogICAgICAgICJpbmZvIjogZmFsc2UsCiAgICAgICAgImJEZXN0cm95IjogdHJ1ZSwKICAgICAgICBzdGF0ZVNhdmU6IHRydWUsCiAgICAgICAgInNjcm9sbFkiOiAgICAgICAgIjM1MHB4IiwKICAgICAgICAic2Nyb2xsQ29sbGFwc2UiOiB0cnVlLAogICAgICAgICJhb0NvbHVtbnMiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjYXRlZ29yeSIsCiAgICAgICAgICAgICAgICAid2lkdGgiOiAiMjUlIiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnZHQtY2VudGVyJywKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHZhciBodG1sID0gJzxzZWxlY3QgbmFtZT0ic2VsZWN0RmllbGQiIGlkPSJkeW5hbWljU2VsZWN0RmllbGRDYXRlZ29yeSIgY2xhc3M9ImR5bmFtaWNTZWxlY3RGaWVsZENhdGVnb3J5IGZvcm0tY29udHJvbCI+JzsKICAgICAgICAgICAgICAgICAgICBpZihkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGh0bWwgKz0gJzxvcHRpb24gc2VsZWN0ZWQ9InNlbGVjdGVkIiB2YWx1ZT0iJyArIGRhdGEuaWQgKyAnIj4nICsgZGF0YS5uYW1lICsgJzwvb3B0aW9uPic7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGh0bWwgKz0gJzwvc2VsZWN0Pic7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGh0bWw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJzdWJjYXRlZ29yeSIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2R0LWNlbnRlcicsCiAgICAgICAgICAgICAgICAid2lkdGgiOiAiMzUlIiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewoKICAgICAgICAgICAgICAgICAgICB2YXIgaHRtbCA9ICc8c2VsZWN0IG5hbWU9InNlbGVjdEZpZWxkIiBpZD0iZHluYW1pY1NlbGVjdEZpZWxkU3ViQ2F0ZWdvcnkiIG11bHRpcGxlPSJtdWx0aXBsZSIgY2xhc3M9ImR5bmFtaWNTZWxlY3RGaWVsZFN1YkNhdGVnb3J5IGZvcm0tY29udHJvbCI+JzsKICAgICAgICAgICAgICAgICAgICByb3cuc3ViY2F0ZWdvcnkuZm9yRWFjaChmdW5jdGlvbiAob2JqKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGh0bWwgKz0gJzxvcHRpb24gc2VsZWN0ZWQ9InNlbGVjdGVkIiB2YWx1ZT0iJytvYmouaWQrJyI+JytvYmoubmFtZSsnPC9vcHRpb24+JzsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBodG1sICs9ICc8L3NlbGVjdD4nOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBodG1sCgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiYWxlcnQiLAogICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICJqdXN0aWZpY2F0aW9uLWNlbGwgZGF0YVRhYmxlQ29sdW1uQ2VudGVyIHRleHQtY2VudGVyIiwKICAgICAgICAgICAgICAgICJ3aWR0aCI6ICIxNSUiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNoZWNrZWQgPSByb3cuYWxlcnQgPT0gdHJ1ZSA/ICJjaGVja2VkIjogIiI7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8aW5wdXQgdHlwZT0iY2hlY2tib3giIGNsYXNzPSJhbGVydC1jaGVjay1ib3giICcgKyBjaGVja2VkICsnIGRhdGEtaWQ9JyArIHJvdy5hbGVydCArICcgLz4nOwoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogInByaXZhdGUiLAogICAgICAgICAgICAgICAgIndpZHRoIjogIjEyJSIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY2hlY2tlZCA9IHJvdy5wcml2YXRlID09IHRydWUgPyAiY2hlY2tlZCI6ICIiOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBjbGFzcz0icHJpdmF0ZS1jaGVjay1ib3giICcgKyBjaGVja2VkICArJyBkYXRhLWlkPScgKyByb3cucHJpdmF0ZSArICcgLz4nOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnZHQtY2VudGVyIGRhdGFUYWJsZUNvbHVtbkNlbnRlciB0ZXh0LWNlbnRlcicKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogImFjdGlvbiIsCiAgICAgICAgICAgICAgICAid2lkdGgiOiAiMTMlIiwKICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAidGQtYWN0aW9uIiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIGlmKGRhdGEgPT09IDEpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxpIGNsYXNzPSJmYSBmYS10cmFzaC1vIGRlbGV0ZS1yb3cgdGFnLWFjdGlvbiBibHVlLTEiPjwvaT4nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkZXRhaWxzID0gJzxiPkNyZWF0ZWQgQnk6PC9iPiAnK3Jvdy5jcmVhdGVkQnkgKyc8aHIvPiA8Yj5DcmVhdGVkIERhdGU6PC9iPiAnK3Jvdy5jcmVhdGVkRGF0ZSArJzxoci8+IDxiPkxhc3QgTW9kaWZpZWQgQnk6PC9iPiAnK3Jvdy51cGRhdGVkQnkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICsnPGhyLz4gPGI+TGFzdCBNb2RpZmllZCBEYXRlOjwvYj4gJytyb3cudXBkYXRlZERhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGkgaWQ9InRhZy1wb3B1cCIgY2xhc3M9ImZhIGZhLWluZm8gcG9wb3Zlck1lc3NhZ2UgdGFnLWFjdGlvbiBibHVlLTEiIHRpdGxlPSJEZXRhaWxzIiBkYXRhLWNvbnRlbnQ9IicgKyBkZXRhaWxzICsgJyI+PC9pPicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgPGkgY2xhc3M9ImZhIGZhLXBlbmNpbCBlZGl0LXJvdyB0YWctYWN0aW9uIGJsdWUtMSIgPjwvaT4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDxpIGNsYXNzPSJmYSBmYS10cmFzaC1vIGRlbGV0ZS1yb3cgdGFnLWFjdGlvbiBibHVlLTEiPjwvaT4nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIF0sCiAgICAgICAgY29sdW1uRGVmczogW3sKICAgICAgICAgICAgInRhcmdldHMiOiAnX2FsbCcsCiAgICAgICAgICAgICJyZW5kZXIiOiAkLmZuLmRhdGFUYWJsZS5yZW5kZXIudGV4dCgpCiAgICAgICAgfV0KICAgIH0pOwogICAgJCggIiNjYXRlZ29yeU1vZGFsVGFibGUiICkuc29ydGFibGUoewogICAgICAgIGl0ZW1zOiAndHI6bm90KDpmaXJzdCknLAogICAgICAgIGN1cnNvcjogJ21vdmUnLAogICAgICAgIG9wYWNpdHk6IDAuNiwKICAgICAgICBzY3JvbGxTcGVlZDogNDAsCiAgICAgICAgY2FuY2VsOiAidGhlYWQiLAogICAgICAgIGNvbnRhaW5tZW50IDogInBhcmVudCIKICAgIH0pOwoKICAgIGlmKHByaXZhdGVFbmFibGVkICE9ICJ0cnVlIikgewogICAgICAgIGNhdGVnb3J5TW9kYWxUYWJsZS5jb2x1bW4oMykudmlzaWJsZShmYWxzZSk7CiAgICB9ZWxzZXsKICAgICAgICBjYXRlZ29yeU1vZGFsVGFibGUuY29sdW1uKDMpLnZpc2libGUodHJ1ZSk7CiAgICB9CiAgICAkKCcjY2F0ZWdvcnlNb2RhbFRhYmxlJykub24oJ21vdXNlb3ZlcicsICd0cicsIGZ1bmN0aW9uICgpIHsKICAgICAgICAkKCcucG9wb3Zlck1lc3NhZ2UnKS5wb3BvdmVyKHsKICAgICAgICAgICAgcGxhY2VtZW50OiAnbGVmdCcsCiAgICAgICAgICAgIHRyaWdnZXI6ICdob3ZlciBmb2N1cycsCiAgICAgICAgICAgIHZpZXdwb3J0OiAnYm9keScsCiAgICAgICAgICAgIGh0bWw6IHRydWUKICAgICAgICB9KTsKICAgIH0pOwoKICAgICQoIiNhZGQtcm93IikuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBsYXN0Um93ID0gY2F0ZWdvcnlNb2RhbFRhYmxlLnJvdygnOmxhc3QnKS5kYXRhKCk7CiAgICAgICAgdmFyIGxhc3RSb3dDYXRlZ29yeSA9ICQoJyNjYXRlZ29yeU1vZGFsVGFibGVCb2R5IHRyOmxhc3QnKS5maW5kKCJ0ZCBzZWxlY3QuZHluYW1pY1NlbGVjdEZpZWxkQ2F0ZWdvcnkiKS52YWwoKTsKICAgICAgICBpZihsYXN0Um93Q2F0ZWdvcnkgIT0gMCkgewogICAgICAgICAgICBjYXRlZ29yeU1vZGFsVGFibGUucm93LmFkZCh7CiAgICAgICAgICAgICAgICAiY2F0ZWdvcnkiOiB7aWQ6IDAsIG5hbWU6ICJTZWxlY3QgQ2F0ZWdvcnkifSwKICAgICAgICAgICAgICAgICJzdWJjYXRlZ29yeSI6IFtdLAogICAgICAgICAgICAgICAgImFsZXJ0IjogZmFsc2UsCiAgICAgICAgICAgICAgICAicHJpdmF0ZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgImFjdGlvbiI6IDEsCiAgICAgICAgICAgICAgICAicHJpb3JpdHkiOiA5OTk5LAogICAgICAgICAgICAgICAgIm5ldyI6IHRydWUKICAgICAgICAgICAgfSkuZHJhdyhmYWxzZSk7CiAgICAgICAgICAgIHZhciAkc2Nyb2xsQm9keSA9ICQoY2F0ZWdvcnlNb2RhbFRhYmxlLnRhYmxlKCkubm9kZSgpKS5wYXJlbnQoKTsKICAgICAgICAgICAgJHNjcm9sbEJvZHkuc2Nyb2xsVG9wKCRzY3JvbGxCb2R5LmdldCgwKS5zY3JvbGxIZWlnaHQpOwogICAgICAgIH0KICAgICAgICAkKCcjY2F0ZWdvcnlNb2RhbFRhYmxlQm9keSB0cjpsYXN0IHNlbGVjdCcpLmVxKDApLmZvY3VzKCk7CiAgICB9KTsKCiAgICAkKCIuYWRkVGFncyIpLnVuYmluZCgpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgbmV3Um93cyA9IFtdOwogICAgICAgIHZhciBjb3VudCA9IDE7CiAgICAgICAgJCgnI2NhdGVnb3J5TW9kYWxUYWJsZUJvZHkgdHInKS5lYWNoKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHZhciB0aCA9ICQodGhpcyk7CiAgICAgICAgICAgIHZhciBjYXRlZ29yeUlkID0gJCh0aCkuZmluZCgidGQgc2VsZWN0LmR5bmFtaWNTZWxlY3RGaWVsZENhdGVnb3J5IikudmFsKCk7CiAgICAgICAgICAgIHZhciBjYXRlZ29yeVRleHQgPSAkKHRoKS5maW5kKCJ0ZCBzZWxlY3QuZHluYW1pY1NlbGVjdEZpZWxkQ2F0ZWdvcnkgb3B0aW9uOnNlbGVjdGVkIikudGV4dCgpOwogICAgICAgICAgICB2YXIgY2F0ZWdvcnkgPSB7aWQ6IGNhdGVnb3J5SWQsIG5hbWU6IGNhdGVnb3J5VGV4dH07CiAgICAgICAgICAgIHZhciBzdWJjYXRlZ29yaWVzID0gW107CiAgICAgICAgICAgICQodGgpLmZpbmQoInRkIHNlbGVjdC5keW5hbWljU2VsZWN0RmllbGRTdWJDYXRlZ29yeSBvcHRpb246c2VsZWN0ZWQiKS5lYWNoKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICBzdWJjYXRlZ29yaWVzLnB1c2goe2lkOiAkKHRoaXMpLnZhbCgpLCBuYW1lOiQodGhpcykudGV4dCgpfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgYWxlcnQgPSAkKHRoKS5maW5kKCJ0ZCBpbnB1dC5hbGVydC1jaGVjay1ib3giKS5pcygiOmNoZWNrZWQiKTsKICAgICAgICAgICAgdmFyIHByaXZhdGUgPSAkKHRoKS5maW5kKCJ0ZCBpbnB1dC5wcml2YXRlLWNoZWNrLWJveCIpLmlzKCI6Y2hlY2tlZCIpOwogICAgICAgICAgICB2YXIgY3VycmVudFJvdyA9IHtjYXRlZ29yeTogY2F0ZWdvcnksIHN1YmNhdGVnb3J5OiBzdWJjYXRlZ29yaWVzLCBhbGVydDogYWxlcnQsIHByaXZhdGU6IHByaXZhdGUsIHByaW9yaXR5OiBjb3VudH07CiAgICAgICAgICAgIGlmKGN1cnJlbnRSb3cuY2F0ZWdvcnkubmFtZSAhPSAnU2VsZWN0IENhdGVnb3J5JyAmJiBjdXJyZW50Um93LmNhdGVnb3J5Lm5hbWUgIT0gJycpIHsKICAgICAgICAgICAgICAgIG5ld1Jvd3MucHVzaChjdXJyZW50Um93KTsKICAgICAgICAgICAgICAgIGNvdW50ID0gY291bnQgKyAxOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHZhciBkYXRhID0gewogICAgICAgICAgICBuZXdSb3dzOiBKU09OLnN0cmluZ2lmeShuZXdSb3dzKSwKICAgICAgICAgICAgZXhpc3RpbmdSb3dzOiBKU09OLnN0cmluZ2lmeShleGlzdGluZ1Jvd3MpLAogICAgICAgICAgICBhbGVydElkOiBhbGVydElkLAogICAgICAgICAgICB0eXBlOiBkb21haW4KICAgICAgICB9OwogICAgICAgICQuYWpheCh7CiAgICAgICAgICAgIHVybDogc2F2ZUNvbW1vblRhZ3NVcmwsCiAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgYXN5bmM6ZmFsc2UsCiAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KGRhdGEpLAogICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLTgnLAogICAgICAgICAgICBkYXRhVHlwZTogImpzb24iLAogICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgdGFibGUuYWpheC5yZWxvYWQoKQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9KTsKICAgIHJldHVybiBjYXRlZ29yeU1vZGFsVGFibGUKfTsKCgoKCi8vPSByZXF1aXJlIGFwcC9wdnMvY29tbW9uL3J4X2NvbW1vbi5qcwovLz0gcmVxdWlyZSBhcHAvcHZzL2NvbW1vbi9yeF9hbGVydF91dGlscy5qcwovLz0gcmVxdWlyZSBhcHAvcHZzL2NvbW1vbi9yeF9saXN0X3V0aWxzLmpzCi8vPSByZXF1aXJlIGFwcC9wdnMvYWN0aXZpdHkvYWN0aXZpdGllcy5qcwovLz0gcmVxdWlyZSBhcHAvcHZzL2FjdGlvbnMvYWN0aW9ucy5qcwovLz0gcmVxdWlyZSBhcHAvcHZzL3VzZXJzL3VzZXJzLmpzCi8vPSByZXF1aXJlIGFwcC9wdnMvY29tbW9uL3J4X2hhbmRsZWJhcl9leHQuanMKLy89IHJlcXVpcmUgYXBwL3B2cy9hbGVydENvbW1lbnRzL2FsZXJ0Q29tbWVudHMuanMKLy89IHJlcXVpcmUgYXBwL3B2cy9hbGVydHNfcmV2aWV3L2FsZXJ0X3Jldmlldy5qcwovLz0gcmVxdWlyZSBhcHAvcHZzL2FsZXJ0c19yZXZpZXcvYXJjaGl2ZWRBbGVydHMuanMKLy89IHJlcXVpcmUgYXBwL3B2cy9jb21tb25fdGFnLmpzCgp2YXIgdXNlckxvY2FsZSA9ICJlbiI7CnZhciBhcHBsaWNhdGlvbk5hbWUgPSAiU2luZ2xlIENhc2UgQWxlcnQiOwp2YXIgYXBwbGljYXRpb25MYWJlbCA9ICJRdWFsaXRhdGl2ZSBBbGVydCI7CnZhciB0YWJsZTsKdmFyIGV4ZWN1dGVkSWRMaXN0ID0gW107CnZhciB0YWdzT2JqID0gewogICAgYWRkZWRDYXNlU2VyaWVzVGFnczogW10sCiAgICBhZGRlZEdsb2JhbFRhZ3M6IFtdLAogICAgZGVsZXRlZENhc2VTZXJpZXNUYWdzOiBbXSwKICAgIGRlbGV0ZWRHbG9iYWxUYWdzOiBbXQp9Owp2YXIgdGFncyA9IFtdOwoKdmFyIGlzRHluYW1pY0ZpbHRlckFwcGxpZWQgPSBmYWxzZTsKdmFyIGRpciA9ICcnOwp2YXIgaW5kZXggPSAtMTsKdmFyIGRldGFpbHNQYXJhbWV0ZXJzID0ge307CgokKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7CiAgICB2YXIgY3VzdG9tRmllbGRzRW5hYmxlZCA9IEpTT04ucGFyc2UoJCgiI2N1c3RvbUZpZWxkc0VuYWJsZWQiKS52YWwoKSk7CgogICAgJCgnYVtocmVmPSIjZGV0YWlscyJdJykub24oInNob3duLmJzLnRhYiIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLkRhdGFUYWJsZSgpLmNvbHVtbnMuYWRqdXN0KCk7CiAgICAgICAgYWRkR3JpZFNob3J0Y3V0cygnI2FsZXJ0c0RldGFpbHNUYWJsZScpOwogICAgICAgIHJlbW92ZUdyaWRTaG9ydGN1dHMoJyNhY3Rpdml0aWVzVGFibGUnKTsKICAgIH0pOwoKICAgICQoJ2FbaHJlZj0iI2FyY2hpdmVkQWxlcnRzIl0nKS5vbigic2hvd24uYnMudGFiIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAkKCcjYXJjaGl2ZWRBbGVydHNUYWJsZScpLkRhdGFUYWJsZSgpLmNvbHVtbnMuYWRqdXN0KCk7CiAgICAgICAgYWRkR3JpZFNob3J0Y3V0cygnI2FyY2hpdmVkQWxlcnRzVGFibGUnKTsKICAgICAgICByZW1vdmVHcmlkU2hvcnRjdXRzKCcjYWN0aXZpdGllc1RhYmxlJyk7CiAgICAgICAgcmVtb3ZlR3JpZFNob3J0Y3V0cygnI2FsZXJ0c0RldGFpbHNUYWJsZScpOwogICAgfSk7CgogICAgdmFyIGFjdGl2aXRpZXNfdGFibGU7CiAgICAkKCcjYWN0aXZpdHlfdGFiJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChhY3Rpdml0aWVzX3RhYmxlID09IG51bGwgfHwgYWN0aXZpdGllc190YWJsZSA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgaWYgKGNhbGxpbmdTY3JlZW4gPT0gQ0FMTElOR19TQ1JFRU4uUkVWSUVXKSB7CiAgICAgICAgICAgICAgICBhY3Rpdml0aWVzX3RhYmxlID0gc2lnbmFsLmFjdGl2aXRpZXNfdXRpbHMuaW5pdF9hY3Rpdml0aWVzX3RhYmxlKCQoIiNhY3Rpdml0aWVzVGFibGUiKSwKICAgICAgICAgICAgICAgICAgICAnL3NpZ25hbC9hY3Rpdml0eS9saXN0QnlFeGVDb25maWc/JyArICdleGVjdXRlZElkTGlzdD0nICsgZXhlY3V0ZWRJZExpc3QgKyAiJmFwcFR5cGU9IiArIGFwcGxpY2F0aW9uTmFtZSwgYXBwbGljYXRpb25OYW1lKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFjdGl2aXRpZXNfdGFibGUgPSBzaWduYWwuYWN0aXZpdGllc191dGlscy5pbml0X2FjdGl2aXRpZXNfdGFibGUoJCgiI2FjdGl2aXRpZXNUYWJsZSIpLAogICAgICAgICAgICAgICAgICAgICcvc2lnbmFsL2FjdGl2aXR5L2xpc3RBY3Rpdml0aWVzPycgKyAiYXBwVHlwZT0iICsgYXBwbGljYXRpb25OYW1lLCBhcHBsaWNhdGlvbk5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7CgogICAgJCgnYVtocmVmPSIjYXJjaGl2ZWRBbGVydHMiXScpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoY2FsbGluZ1NjcmVlbiA9PSBDQUxMSU5HX1NDUkVFTi5SRVZJRVcpIHsKICAgICAgICAgICAgYXJjaGl2ZWRfdGFibGUgPSBzaWduYWwuYXJjaGl2ZWRfdXRpbHMuaW5pdF9hcmNoaXZlZF90YWJsZSgiI2FyY2hpdmVkQWxlcnRzVGFibGUiLCBhcmNoaXZlZEFsZXJ0VXJsLCBhcHBsaWNhdGlvbk5hbWUsIHNpbmdsZUNhc2VEZXRhaWxzVXJsKTsKICAgICAgICB9CiAgICB9KTsKCiAgICBpZiAoY2FsbGluZ1NjcmVlbiA9PSBDQUxMSU5HX1NDUkVFTi5SRVZJRVcgfHwgY2FsbGluZ1NjcmVlbiA9PSBDQUxMSU5HX1NDUkVFTi5EQVNIQk9BUkQpIHsKICAgICAgICAkKHdpbmRvdykub24oJ2JlZm9yZXVubG9hZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDogZGlzY2FyZFRlbXBDaGFuZ2VzVXJsLAogICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJwogICAgICAgICAgICB9KQogICAgICAgIH0pOwogICAgfQoKICAgIC8vYmFjayBidXR0b24gdGFnIHNjcmVlbgogICAgaWYgKGNhbGxpbmdTY3JlZW4gIT0gQ0FMTElOR19TQ1JFRU4uVEFHUykgewogICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oImJhY2tfdXJsIiwgd2luZG93LmxvY2F0aW9uLmhyZWYpCiAgICB9CiAgICAkKCcudGFnLXNjcmVlbi1iYWNrLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2JhY2tfdXJsJykKICAgIH0pOwoKICAgIHZhciBmaXhlZENvbHVtbnMgPSA2OwogICAgdmFyIGZpbHRlckluZGV4ID0gWzgsIDksIDEwLCAxMSwgMTIsIDE0LCAxNl07CiAgICBpZihjdXN0b21GaWVsZHNFbmFibGVkKXsKICAgICAgICBmaWx0ZXJJbmRleC5wdXNoLmFwcGx5KGZpbHRlckluZGV4LCBbMjksIDMwLCAzMSwgMzIsIDMzLCAzNCwgMzUsIDM2XSkKICAgIH0KICAgIHZhciBsaXN0T2ZJbmRleCA9IFsxMywgMTQsIDIxLCAyMiwgMjMsIDI1LCAyNiwgMjcsIDI4LCAyOSwgMzAsIDMxLCAzMl07CiAgICBpZiAoY2FsbGluZ1NjcmVlbiA9PSBDQUxMSU5HX1NDUkVFTi5EQVNIQk9BUkQpIHsKICAgICAgICBmaXhlZENvbHVtbnMgPSA3OwogICAgICAgIGZpbHRlckluZGV4ID0gWzksIDEwLCAxMSwgMTIsIDEzLCAxNSwgMTddOwogICAgICAgIGlmKGN1c3RvbUZpZWxkc0VuYWJsZWQpewogICAgICAgICAgICBmaWx0ZXJJbmRleC5wdXNoLmFwcGx5KGZpbHRlckluZGV4LCBbMzAsIDMxLCAzMiwgMzMsIDM0LCAzNSwgMzYsIDM3XSkKICAgICAgICB9CiAgICB9CiAgICBpZiAoY2FsbGluZ1NjcmVlbiA9PSBDQUxMSU5HX1NDUkVFTi5UUklHR0VSRURfQUxFUlRTKSB7CiAgICAgICAgZml4ZWRDb2x1bW5zID0gNjsKICAgICAgICBmaWx0ZXJJbmRleCA9IFs0LCA4LCA5LCAxMCwgMTEsIDE0LCAxNSwgMTddOwogICAgICAgIGxpc3RPZkluZGV4ID0gWzEzLCAxNCwgMjEsIDIyLCAyMywgMjUsIDI2LCAyNywgMjgsIDI5LCAzMCwgMzEsIDMyXTsKICAgICAgICBpZihjdXN0b21GaWVsZHNFbmFibGVkKXsKICAgICAgICAgICAgZmlsdGVySW5kZXgucHVzaC5hcHBseShmaWx0ZXJJbmRleCwgWzI5LCAzMCwgMzEsIDMyLCAzMywgMzQsIDM1LCAzNl0pCiAgICAgICAgfQogICAgfQogICAgaWYgKCQoIiNpc0ZhZXJzIikudmFsKCkgPT0gInRydWUiKSB7CiAgICAgICAgZml4ZWRDb2x1bW5zID0gMzsKICAgICAgICBmaWx0ZXJJbmRleCA9IFs1LCA2LCA3LCA4LCA5LCAxMCwgMTFdOwogICAgICAgIGlmKGN1c3RvbUZpZWxkc0VuYWJsZWQpewogICAgICAgICAgICBmaWx0ZXJJbmRleC5wdXNoLmFwcGx5KGZpbHRlckluZGV4LCBbMjMsIDI0LCAyNSwgMjYsIDI3LCAyOCwgMjksIDMwXSkKICAgICAgICB9CiAgICB9IGVsc2UgaWYgKCQoIiNpc0Nhc2VTZXJpZXMiKS52YWwoKSA9PSAidHJ1ZSIpIHsKICAgICAgICBmaXhlZENvbHVtbnMgPSA1OwogICAgICAgIGZpbHRlckluZGV4ID0gWzcsIDgsIDksIDEwLCAxMSwgMTMsIDE1XTsKICAgICAgICBpZiAoY3VzdG9tRmllbGRzRW5hYmxlZCkgewogICAgICAgICAgICBmaWx0ZXJJbmRleC5wdXNoLmFwcGx5KGZpbHRlckluZGV4LCBbMjgsIDI5LCAzMCwgMzEsIDMyLCAzMywgMzQsIDM1XSkKICAgICAgICB9CiAgICB9CiAgICB2YXIgYWxlcnREZXRhaWxzVGFibGU7CgogICAgdmFyIGNoZWNrZWRJZExpc3QgPSBbXTsKICAgIHZhciBjaGVja2VkUm93TGlzdCA9IFtdOwoKICAgIHNpZ25hbC5hbGVydFJldmlldy5vcGVuQWxlcnRDb21tZW50TW9kYWwoIlNpbmdsZSBDYXNlIEFsZXJ0IiwgYXBwbGljYXRpb25OYW1lLCBhcHBsaWNhdGlvbkxhYmVsLCBjaGVja2VkSWRMaXN0LCBjaGVja2VkUm93TGlzdCk7CiAgICBzaWduYWwuYWxlcnRSZXZpZXcuc2hvd0F0dGFjaG1lbnRNb2RhbCgpOwogICAgc2lnbmFsLmFsZXJ0UmV2aWV3LnBvcHVsYXRlQWR2YW5jZWRGaWx0ZXJTZWxlY3QoYXBwbGljYXRpb25OYW1lKTsKICAgIHNpZ25hbC5hbGVydFJldmlldy5zZXRTb3J0T3JkZXIoKTsKICAgIHNpZ25hbC5saXN0X3V0aWxzLmZsYWdfaGFuZGxlcigic2luZ2xlQ2FzZUFsZXJ0IiwgInRvZ2dsZUZsYWciKTsKICAgIC8vVGhlIGNhc2UgaGlzdG9yeSBtb2RhbC4KICAgIHNpZ25hbC5hbGVydFJldmlldy5vcGVuQ2FzZUhpc3RvcnlNb2RhbCgpOwogICAgLy9UaGUgcmVzdGFydCBjYXNlIHJldmlldy4KICAgIHNpZ25hbC5hbGVydFJldmlldy5yZXN0YXJ0UmV2aWV3KGNhc2VSZXZpZXdQcmV2aW91c1VybCk7CiAgICAvL1RoZSBzaW1pbGFyIGNhc2VzIG1vZGFsLgogICAgc2lnbmFsLmFsZXJ0UmV2aWV3Lm9wZW5TaW1pbGFyQ2FzZXNNb2RhbChjYXNlSW5mb1VybCk7CgogICAgLy9hcHBseSB0aGUgZmlsdGVyIHZhbHVlcyB0byBjb2x1bW5zIGJhc2VkIG9uIHNhdmVkIHZpZXcKICAgIHZhciBmaWx0ZXJWYWx1ZSA9IHNpZ25hbC5hbGVydFJldmlldy5jcmVhdGVGaWx0ZXJNYXAoJ3NjYV9maWx0ZXJNYXBfJyArIGV4ZWN1dGVkQ29uZmlnSWQsICdzY2Ffdmlld05hbWVfJyArIGV4ZWN1dGVkQ29uZmlnSWQpOwoKICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcjYWRkQ2FzZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICBpbml0X2FkZF9jYXNlX21vZGFsKCkKICAgIH0pOwoKICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuYnVsa0Rpc3Bvc2l0aW9uJywgZnVuY3Rpb24gKCkgewogICAgICAgICQoJyNkaXNwb3NpdGlvblNpZ25hbFBvcG92ZXInKS5tb2RhbCgnc2hvdycpOwogICAgfSk7CgogICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJyNhZGRDYXNlQnV0dG9uJywgZnVuY3Rpb24gKCkgewogICAgICAgIGFkZF9jYXNlX3RvX2xpc3QoKQogICAgfSk7CgogICAgLy9hcHBseSB0aGUgc29ydGluZyB0byBjb2x1bW4gYmFzZWQgb24gc2F2ZWQgdmlldwogICAgdmFyIHNvcnRpbmdNYXAgPSBzaWduYWwuYWxlcnRSZXZpZXcuY3JlYXRlU29ydGluZ01hcCgnc2NhX3NvcnRlZENvbHVtbl8nICsgZXhlY3V0ZWRDb25maWdJZCwgJ3NjYV92aWV3TmFtZV8nICsgZXhlY3V0ZWRDb25maWdJZCk7CiAgICBpZiAoc29ydGluZ01hcCAhPSAndW5kZWZpbmVkJyAmJiBzb3J0aW5nTWFwLmxlbmd0aCA+IDApIHsKICAgICAgICBpbmRleCA9IHNvcnRpbmdNYXBbMF1bMF07CiAgICAgICAgZGlyID0gc29ydGluZ01hcFswXVsxXQogICAgfQoKICAgIHZhciBnZXRBbGVydFR5cGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaCk7CiAgICAgICAgaWYodXJsUGFyYW1zLmdldCgnaXNGYWVycycpICE9IG51bGwgJiYgdXJsUGFyYW1zLmdldCgnaXNGYWVycycpID09ICd0cnVlJykgewogICAgICAgICAgICByZXR1cm4gQUxFUlRfVFlQRS5TSU5HTEVfQ0FTRV9BTEVSVF9GQUVSUzsKICAgICAgICB9ZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBhcHBsaWNhdGlvbk5hbWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhcHBsaWNhdGlvbk5hbWU7CiAgICB9OwoKICAgIGlmIChjYWxsaW5nU2NyZWVuID09IENBTExJTkdfU0NSRUVOLlJFVklFVykgewogICAgICAgIC8vc2F2aW5nIG5ldyBWaWV3SW5zdGFuY2UgbW9kYWwKICAgICAgICB2YXIgYWxlcnRUeXBlID0gZ2V0QWxlcnRUeXBlKCk7CiAgICAgICAgaWYgKCQoJyNpc0Nhc2VTZXJpZXMnKS52YWwoKSA9PSAidHJ1ZSIpIHsKICAgICAgICAgICAgYWxlcnRUeXBlID0gQUxFUlRfQ09ORklHX1RZUEUuU0lOR0xFX0NBU0VfQUxFUlRfRFJJTExfRE9XTgogICAgICAgIH0KICAgICAgICBzaWduYWwuYWxlcnRSZXZpZXcub3BlblNhdmVWaWV3TW9kYWwoZmlsdGVySW5kZXgsIGFsZXJ0VHlwZSwgdmlld0lkKQogICAgfSBlbHNlIGlmIChjYWxsaW5nU2NyZWVuID09IENBTExJTkdfU0NSRUVOLkRBU0hCT0FSRCkgewogICAgICAgIHNpZ25hbC5hbGVydFJldmlldy5vcGVuU2F2ZVZpZXdNb2RhbChmaWx0ZXJJbmRleCwgQUxFUlRfQ09ORklHX1RZUEUuU0lOR0xFX0NBU0VfQUxFUlRfREFTSEJPQVJELCB2aWV3SWQpCiAgICB9CgogICAgJCh3aW5kb3cpLmJpbmQoJ2JlZm9yZXVubG9hZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnaXNWaWV3Q2FsbCcpID09ICd0cnVlJyB8fCAkKCcudmlld1NlbGVjdCA6c2VsZWN0ZWQnKS50ZXh0KCkucmVwbGFjZSgiKGRlZmF1bHQpIiwgIiIpLnRyaW0oKSAhPSAnU3lzdGVtIFZpZXcnKSB7CiAgICAgICAgICAgIHZhciBiYWNrVXJsID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnYmFja191cmwnKTsKICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UuY2xlYXIoKTsKICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnYmFja191cmwnLCBiYWNrVXJsKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciB2aWV3SW5mbyA9IHNpZ25hbC5hbGVydFJldmlldy5nZW5lcmF0ZVZpZXdJbmZvKGZpbHRlckluZGV4KTsKICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnc2NhX2ZpbHRlck1hcF8nICsgZXhlY3V0ZWRDb25maWdJZCwgSlNPTi5zdHJpbmdpZnkodmlld0luZm8uZmlsdGVyTWFwKSk7CiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3NjYV9zb3J0ZWRDb2x1bW5fJyArIGV4ZWN1dGVkQ29uZmlnSWQsIEpTT04uc3RyaW5naWZ5KHZpZXdJbmZvLnNvcnRlZENvbHVtbikpOwogICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdzY2Ffbm90VmlzaWJsZUNvbHVtbl8nICsgZXhlY3V0ZWRDb25maWdJZCwgdmlld0luZm8ubm90VmlzaWJsZUNvbHVtbik7CiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3NjYV92aWV3TmFtZV8nICsgZXhlY3V0ZWRDb25maWdJZCwgJCgnLnZpZXdTZWxlY3QgOnNlbGVjdGVkJykudGV4dCgpLnJlcGxhY2UoIihkZWZhdWx0KSIsICIiKS50cmltKCkpCiAgICAgICAgfQogICAgfSk7CgogICAgJCgnI2FsZXJ0LWxpc3QtZmlsdGVyLWFwcGx5LWJ0JykuY2xpY2soZnVuY3Rpb24gKGV2dCkgewogICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICQoJyNhbGVydC1saXN0LWZpbHRlcicpLmZpbmQoJyNmaWx0ZXJVc2VkJykudmFsKHRydWUpOwogICAgICAgIHZhciBuZXdVcmwgPSBsaXN0Q29uZmlnVXJsICsgIiYiICsgJCgnI2FsZXJ0LWxpc3QtZmlsdGVyJykuc2VyaWFsaXplKCkgKyAiJno9IiArIHRydWU7CiAgICAgICAgJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLkRhdGFUYWJsZSgpLmFqYXgudXJsKG5ld1VybCkubG9hZCgpCiAgICB9KTsKCiAgICAkKCIjZGV0YWlsLXRhYnMgYVtocmVmPScjZGV0YWlscyddIikub24oImNsaWNrIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAkKCcjYWxlcnRzRGV0YWlsc1RhYmxlJykuRGF0YVRhYmxlKCkuY29sdW1ucy5hZGp1c3QoKTsKICAgIH0pOwoKICAgIGZldGNoVGFncygpOwoKICAgIHZhciBpbml0QWxlcnREZXRhaWxzVGFibGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHByZWZpeCA9ICJzY2FfIjsKICAgICAgICB2YXIgaXNGaWx0ZXJSZXF1ZXN0ID0gdHJ1ZTsKICAgICAgICB2YXIgZmlsdGVyQXJyYXkgPSBbXTsKICAgICAgICB2YXIgZmlsdGVyVmFsdWVzID0gW107CiAgICAgICAgaWYgKHdpbmRvdy5zZXNzaW9uU3RvcmFnZSAmJiBzaWduYWwuYWxlcnRSZXZpZXcuaXNBbGVydFBlcnNpc3RlZEluU2Vzc2lvblN0b3JhZ2UocHJlZml4KSkgewogICAgICAgICAgICBmaWx0ZXJWYWx1ZXMgPSBKU09OLnBhcnNlKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0ocHJlZml4ICsgImZpbHRlcnNfdmFsdWUiKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2lnbmFsLmFsZXJ0UmV2aWV3LnJlbW92ZUZpbHRlcnNGcm9tU2Vzc2lvblN0b3JhZ2UocHJlZml4KTsKICAgICAgICAgICAgaXNGaWx0ZXJSZXF1ZXN0ID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHZhciBhb0NvbHVtbnMgPSBjcmVhdGVfc2luZ2xlX2Nhc2VfdGFibGVfY29sdW1ucyhjYWxsaW5nU2NyZWVuLCBjdXN0b21GaWVsZHNFbmFibGVkKTsKICAgICAgICBzaWduYWwuYWN0aW9uc191dGlscy5zZXRfYWN0aW9uX2xpc3RfbW9kYWwoJCgnI2FjdGlvbi1tb2RhbCcpKTsKICAgICAgICBzaWduYWwuYWN0aW9uc191dGlscy5zZXRfYWN0aW9uX2NyZWF0ZV9tb2RhbCgkKCcjYWN0aW9uLWNyZWF0ZS1tb2RhbCcpKTsKCiAgICAgICAgdGFibGUgPSAkKCcjYWxlcnRzRGV0YWlsc1RhYmxlJykuRGF0YVRhYmxlKHsKICAgICAgICAgICAgInNQYWdpbmF0aW9uVHlwZSI6ICJib290c3RyYXAiLAogICAgICAgICAgICAibGFuZ3VhZ2UiOiB7CiAgICAgICAgICAgICAgICAidXJsIjogIi4uL2Fzc2V0cy9pMThuL2RhdGFUYWJsZXNfIiArIHVzZXJMb2NhbGUgKyAiLmpzb24iCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRyYXdDYWxsYmFjazogZnVuY3Rpb24gKHNldHRpbmdzKSB7CgogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzZXR0aW5ncy5qc29uICE9ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICAgICAgJCgiI2Z1bGxDYXNlTGlzdCIpLnZhbChKU09OLnN0cmluZ2lmeShzZXR0aW5ncy5qc29uLmZ1bGxDYXNlTGlzdCkpOwogICAgICAgICAgICAgICAgICAgIGlmICghaXNEeW5hbWljRmlsdGVyQXBwbGllZCkgewogICAgICAgICAgICAgICAgICAgICAgICBpc0R5bmFtaWNGaWx0ZXJBcHBsaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFsZXJ0UmV2aWV3LmJpbmRHcmlkRHluYW1pY0ZpbHRlcnMoc2V0dGluZ3MuanNvbi5maWx0ZXJzLCBwcmVmaXgsIHNldHRpbmdzLmpzb24uY29uZmlnSWQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRhZ0VsbGlwc2lzKCk7CiAgICAgICAgICAgICAgICBjb2xFbGxpcHNpcygpOwogICAgICAgICAgICAgICAgd2ViVWlQb3BJbml0KCk7CiAgICAgICAgICAgICAgICBjbG9zZVBvcHVwT25TY3JvbGwoKTsKICAgICAgICAgICAgICAgIGVudGVyS2V5QWxlcnREZXRhaWwoKTsKICAgICAgICAgICAgICAgIGlmIChpc0Nhc2VEZXRhaWxWaWV3ID09ICJ0cnVlIikgewogICAgICAgICAgICAgICAgICAgIHNob3dDYXNlRGV0YWlsc1ZpZXcoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNpZ25hbC5hbGVydFJldmlldy5zb3J0SWNvbkhhbmRsZXIoKTsKICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJWYWx1ZS5sZW5ndGggPT09IDAgJiYgISQodGFibGUudGFibGUoKS5ib2R5KCkpLmhhc0NsYXNzKCdkZXRhaWxzVGFibGVCb2R5JykpIHsKICAgICAgICAgICAgICAgICAgICAkKHRhYmxlLnRhYmxlKCkuYm9keSgpKS5hZGRDbGFzcygnZGV0YWlsc1RhYmxlQm9keScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAiYWpheCI6IHsKICAgICAgICAgICAgICAgICJ1cmwiOiBjcmVhdGVBbGVydExpc3RVcmwoaXNGaWx0ZXJSZXF1ZXN0LCBmaWx0ZXJWYWx1ZXMpLAogICAgICAgICAgICAgICAgInR5cGUiOiAiUE9TVCIsCiAgICAgICAgICAgICAgICAiZGF0YVNyYyI6ICJhYURhdGEiLAogICAgICAgICAgICAgICAgImNhY2hlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAiZGF0YSI6IGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ICE9IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGQuc29ydCA9IGQuY29sdW1uc1tpbmRleF0uZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgZC5kaXJlY3Rpb24gPSBkaXI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgkKCcjYWR2YW5jZWQtZmlsdGVyJykudmFsKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZC5hZHZhbmNlZEZpbHRlcklkID0gJCgnI2FkdmFuY2VkLWZpbHRlcicpLnZhbCgpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgkKCcjcXVlcnlKU09OJykudmFsKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZC5xdWVyeUpTT04gPSAkKCcjcXVlcnlKU09OJykudmFsKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZC5jYWxsaW5nU2NyZWVuID0gY2FsbGluZ1NjcmVlbjsKICAgICAgICAgICAgICAgICAgICBkZXRhaWxzUGFyYW1ldGVycyA9IGQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGluaXRDb21wbGV0ZTogZnVuY3Rpb24gKHNldHRpbmdzLCBqc29uKSB7CiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyVmFsdWUubGVuZ3RoID09PSAwICYmICFpc0R5bmFtaWNGaWx0ZXJBcHBsaWVkKSB7CiAgICAgICAgICAgICAgICAgICAgaXNEeW5hbWljRmlsdGVyQXBwbGllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFsZXJ0UmV2aWV3LmJpbmRHcmlkRHluYW1pY0ZpbHRlcnMoanNvbi5maWx0ZXJzLCBwcmVmaXgsIGpzb24uY29uZmlnSWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0ocHJlZml4ICsgImZpbHRlcnNfc3RvcmUiKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJzQXJyYXkgPSBKU09OLnBhcnNlKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0ocHJlZml4ICsgImZpbHRlcnNfc3RvcmUiKSk7CiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGZpbHRlcnNBcnJheSwgZnVuY3Rpb24gKGluZGV4LCBvYmopIHsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2ZpbHRlcicgKyBpbmRleCkucHJvcCgiY2hlY2tlZCIsIG9iaiA9PSB0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNpZ25hbC5hbGVydFJldmlldy5lbmFibGVNZW51VG9vbHRpcHMoKTsKICAgICAgICAgICAgICAgIHNpZ25hbC5hbGVydFJldmlldy5kaXNhYmxlVG9vbHRpcHMoKTsKICAgICAgICAgICAgICAgIGFkZEdyaWRTaG9ydGN1dHMoJyNhbGVydHNEZXRhaWxzVGFibGUnKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImJMZW5ndGhDaGFuZ2UiOiB0cnVlLAogICAgICAgICAgICAiY2FjaGUiOiB0cnVlLAogICAgICAgICAgICAiYlByb2Nlc3NpbmciOiB0cnVlLAogICAgICAgICAgICAiYlNlcnZlclNpZGUiOiB0cnVlLAogICAgICAgICAgICAiY29sUmVvcmRlciI6IHsKICAgICAgICAgICAgICAgICJyZWFsdGltZSI6IGZhbHNlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJvTGFuZ3VhZ2UiOiB7CiAgICAgICAgICAgICAgICAic1Byb2Nlc3NpbmciOiAnPGRpdiBjbGFzcz0iZ3JpZC1sb2FkaW5nIj48aW1nIHNyYz0iL3NpZ25hbC9hc3NldHMvc3Bpbm5lci5naWYiIHdpZHRoPSIzMCIgYWxpZ249Im1pZGRsZSIgLz48L2Rpdj4nLAogICAgICAgICAgICAgICAgInNaZXJvUmVjb3JkcyI6ICJObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZSIsICJzRW1wdHlUYWJsZSI6ICJObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZSIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImFMZW5ndGhNZW51IjogW1s1MCwgMTAwLCAyMDAsIDUwMF0sIFs1MCwgMTAwLCAyMDAsIDUwMF1dLAogICAgICAgICAgICAicGFnaW5hdGlvbiI6IHRydWUsCiAgICAgICAgICAgICJpVG90YWxEaXNwbGF5UmVjb3JkcyI6ICI1MCIsCiAgICAgICAgICAgICJhb0NvbHVtbnMiOiBhb0NvbHVtbnMsCiAgICAgICAgICAgICJyZXNwb25zaXZlIjogdHJ1ZSwKICAgICAgICAgICAgImRlZmVyTG9hZGluZyI6IGZpbHRlclZhbHVlLmxlbmd0aCA+IDAgPyAwIDogbnVsbCwKICAgICAgICAgICAgInNjcm9sbFgiOiB0cnVlLAogICAgICAgICAgICAicm93Q2FsbGJhY2siOiBmdW5jdGlvbiAocm93LCBkYXRhLCBpbmRleCkgewogICAgICAgICAgICAgICAgJChyb3cpLmFkZENsYXNzKCJkYXRhLXRhYmxlLXJvdyIpOwogICAgICAgICAgICAgICAgc2lnbmFsLnVzZXJfZ3JvdXBfdXRpbHMuYmluZF9hc3NpZ25Ub190b19ncmlkX3JvdygkKHJvdyksIHNlYXJjaFVzZXJHcm91cExpc3RVcmwsIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiBkYXRhLmFzc2lnbmVkVG9Vc2VyLmZ1bGxOYW1lLAogICAgICAgICAgICAgICAgICAgIGlkOiBkYXRhLmFzc2lnbmVkVG9Vc2VyLmlkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY29sdW1uRGVmczogW3sKICAgICAgICAgICAgICAgICJ0YXJnZXRzIjogJ19hbGwnLAogICAgICAgICAgICAgICAgInJlbmRlciI6ICQuZm4uZGF0YVRhYmxlLnJlbmRlci50ZXh0KCkKICAgICAgICAgICAgfV0KICAgICAgICB9KTsKCiAgICAgICAgc2lnbmFsLnVzZXJfZ3JvdXBfdXRpbHMuYmluZF9hc3NpZ25Ub19zZWxlY3Rpb24oYXNzaWduVG9Hcm91cFVybCwgdGFibGUpOwogICAgICAgIGluaXRfZmlsdGVyKHRhYmxlKTsKCiAgICAgICAgcmV0dXJuIHRhYmxlCiAgICB9OwoKCiAgICB2YXIgaW5pdF9maWx0ZXIgPSBmdW5jdGlvbiAoZGF0YV90YWJsZSkgewoKICAgICAgICB2YXIgY3VtdWxhdGl2ZSA9ICQoIiNjdW11bGF0aXZlIikudmFsKCk7CiAgICAgICAgdmFyIGZpbHRlck9wdGlvbnMgPSBudWxsOwogICAgICAgIGlmIChjdW11bGF0aXZlID09ICJ0cnVlIikgewogICAgICAgICAgICBmaWx0ZXJPcHRpb25zID0gWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDQsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICd0ZXh0JywKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgfSwgLy9uYW1lCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogOCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogInRleHQiLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICB9LCAvL3Byb2R1Y3ROYW1lCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogOSwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogInRleHQiLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICB9LCAvL3B0CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMTAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgfSwgLy9saXN0ZWQKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAxMSwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogInRleHQiLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICB9LCAvL291dGNvbWUKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAxNCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogJ3RleHQnLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICB9LCAvL3NpZ25hbC90b3BpYwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDE1LAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAndGV4dCcsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgIH0sIC8vY3VycmVudCBkaXNwb3NpdGlvbgogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDE3LAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAndGV4dCcsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgIH0sIC8vZHVlSW4KICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAyOSwgIC8vTWVkaWNhdGlvbiBFcnJvcnMgUFRzCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzMCwgIC8vQWdlCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgaWYgKGN1c3RvbUZpZWxkc0VuYWJsZWQpIHsKICAgICAgICAgICAgICAgIGZpbHRlck9wdGlvbnMucHVzaC5hcHBseShmaWx0ZXJPcHRpb25zLCBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDMxLCAvL0Nhc2UgVHlwZQogICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAidGV4dCIsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMzIsIC8vQ29tcGxldGVuZXNzIFNjb3JlCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAidGV4dCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMzMsIC8vUHJpbWFyeSBJTkQjCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAndGV4dCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMzQsIC8vQXBwbGljYXRpb24gVHlwZSAmIE51bWJlcgogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogJ3RleHQnLAogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDM1LCAvL2NvbXBvdW5kaW5nIGZsYWcKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICd0ZXh0JywKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzNiwgIC8vU3VibWl0dGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAidGV4dCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgICAgICB9XSkKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoY2FsbGluZ1NjcmVlbiA9PSBDQUxMSU5HX1NDUkVFTi5EQVNIQk9BUkQpIHsKICAgICAgICAgICAgZmlsdGVyT3B0aW9ucyA9IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiA5LAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAidGV4dCIsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgIH0sIC8vcHJvZHVjdE5hbWUKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAxMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogInRleHQiLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICB9LCAvL3B0CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMTEsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgfSwgLy9saXN0ZWRuZXNzCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMTIsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgfSwgLy9vdXRjb21lCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMTMsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgfSwgLy9zaWduYWwgLyB0b3BpYwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDE1LAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAndGV4dCcsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgIH0sIC8vY3VycmVudCBkaXNwb3NpdGlvbgogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDE3LAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAndGV4dCcsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgIH0sIC8vRHVlIGluYAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDMwLCAgLy9NZWRpY2F0aW9uIEVycm9ycyBQVHMKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogInRleHQiLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDMxLCAgLy9BZ2UKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogInRleHQiLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICBpZiAoY3VzdG9tRmllbGRzRW5hYmxlZCkgewogICAgICAgICAgICAgICAgZmlsdGVyT3B0aW9ucy5wdXNoLmFwcGx5KGZpbHRlck9wdGlvbnMsIFsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMzIsIC8vQ2FzZSBUeXBlCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzMywgLy9Db21wbGV0ZW5lc3MgU2NvcmUKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzNCwgLy9QcmltYXJ5IElORCMKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICd0ZXh0JywKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzNSwgLy9BcHBsaWNhdGlvbiBUeXBlICYgTnVtYmVyCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAndGV4dCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMzYsIC8vY29tcG91bmRpbmcgZmxhZwogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogJ3RleHQnLAogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDM3LCAgLy9TdWJtaXR0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgICAgIH1dKQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICgkKCIjaXNGYWVycyIpLnZhbCgpID09ICJ0cnVlIikgewogICAgICAgICAgICBmaWx0ZXJPcHRpb25zID0gWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDUsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgfSwgLy9wcm9kdWN0TmFtZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDYsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgfSwgLy9wdAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDcsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgfSwgLy9saXN0ZWRuZXNzCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogOCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogInRleHQiLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICB9LCAvL291dGNvbWUKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiA5LAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAidGV4dCIsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgIH0sIC8vc2lnbmFsIC8gdG9waWMKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAxMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogInRleHQiLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICB9LCAvL2N1cnJlbnQgZGlzcG9zaXRpb24KICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAxMSwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogJ3RleHQnLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICB9LCAvL1N1c3AgUHJvZHVjdHMKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAyMywgIC8vTWVkaWNhdGlvbiBFcnJvcnMgUFRzCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAyNCwgIC8vQWdlCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgaWYgKGN1c3RvbUZpZWxkc0VuYWJsZWQpIHsKICAgICAgICAgICAgICAgIGZpbHRlck9wdGlvbnMucHVzaC5hcHBseShmaWx0ZXJPcHRpb25zLCBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDI1LCAvL0Nhc2UgVHlwZQogICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAidGV4dCIsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMjYsIC8vQ29tcGxldGVuZXNzIFNjb3JlCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAidGV4dCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMjcsIC8vUHJpbWFyeSBJTkQjCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAndGV4dCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMjgsIC8vQXBwbGljYXRpb24gVHlwZSAmIE51bWJlcgogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogJ3RleHQnLAogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDI5LCAvL2NvbXBvdW5kaW5nIGZsYWcKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICd0ZXh0JywKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzMCwgIC8vU3VibWl0dGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAidGV4dCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgICAgICB9XSkKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoJCgnI2lzQ2FzZVNlcmllcycpLnZhbCgpID09ICJ0cnVlIikgewogICAgICAgICAgICBmaWx0ZXJPcHRpb25zID0gWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDcsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgfSwgLy9wdAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDgsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgfSwgLy9saXN0ZWRuZXNzCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogOSwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogInRleHQiLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICB9LCAvL291dGNvbWUKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAxMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogInRleHQiLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICB9LCAvL3NpZ25hbCAvIHRvcGljCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMTEsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgfSwgLy9jdXJyZW50IGRpc3Bvc2l0aW9uCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMTMsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICd0ZXh0JywKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgfSwgLy9EdWUgaW4KICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAxNSwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogJ3RleHQnLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICB9LCAvL1NlcmlvdXMKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAyOCwgIC8vTWVkaWNhdGlvbiBFcnJvcnMgUFRzCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAyOSwgIC8vQWdlCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgaWYgKGN1c3RvbUZpZWxkc0VuYWJsZWQpIHsKICAgICAgICAgICAgICAgIGZpbHRlck9wdGlvbnMucHVzaC5hcHBseShmaWx0ZXJPcHRpb25zLCBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzMCwgLy9DYXNlIFR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzMSwgLy9Db21wbGV0ZW5lc3MgU2NvcmUKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzMiwgLy9QcmltYXJ5IElORCMKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICd0ZXh0JywKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzMywgLy9BcHBsaWNhdGlvbiBUeXBlICYgTnVtYmVyCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAndGV4dCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMzQsIC8vY29tcG91bmRpbmcgZmxhZwogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogJ3RleHQnLAogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDM1LCAgLy9TdWJtaXR0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgICAgIH1dKQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZmlsdGVyT3B0aW9ucyA9IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiA4LAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAidGV4dCIsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgIH0sIC8vcHQKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiA5LAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAidGV4dCIsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgIH0sIC8vbGlzdGVkbmVzcwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDEwLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAidGV4dCIsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgIH0sIC8vb3V0Y29tZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDExLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAidGV4dCIsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgIH0sIC8vc2lnbmFsIC8gdG9waWMKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAxMiwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogInRleHQiLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICB9LCAvL2N1cnJlbnQgZGlzcG9zaXRpb24KICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAxNCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogJ3RleHQnLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICB9LCAvL0R1ZSBpbgogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDE2LAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAndGV4dCcsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgIH0sIC8vU2VyaW91cwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDI5LCAgLy9NZWRpY2F0aW9uIEVycm9ycyBQVHMKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogInRleHQiLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDMwLCAgLy9BZ2UKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogInRleHQiLAogICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICB9XTsKICAgICAgICAgICAgaWYgKGN1c3RvbUZpZWxkc0VuYWJsZWQpIHsKICAgICAgICAgICAgICAgIGZpbHRlck9wdGlvbnMucHVzaC5hcHBseShmaWx0ZXJPcHRpb25zLCBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzMSwgLy9DYXNlIFR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzMiwgLy9Db21wbGV0ZW5lc3MgU2NvcmUKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzMywgLy9QcmltYXJ5IElORCMKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICd0ZXh0JywKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzNCwgLy9BcHBsaWNhdGlvbiBUeXBlICYgTnVtYmVyCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAndGV4dCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMzUsIC8vY29tcG91bmRpbmcgZmxhZwogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogJ3RleHQnLAogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDM2LCAgLy9TdWJtaXR0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICAgICAgICAgIH1dKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHlhZGNmLmluaXQoZGF0YV90YWJsZSwgZmlsdGVyT3B0aW9ucyk7CiAgICAgICAgaWYgKGZpbHRlclZhbHVlLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgeWFkY2YuZXhGaWx0ZXJDb2x1bW4oZGF0YV90YWJsZSwgZmlsdGVyVmFsdWUsIHRydWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICQoJy55YWRjZi1maWx0ZXItd3JhcHBlcicpLmhpZGUoKQogICAgICAgIH0KICAgICAgICB3aW5kb3cuc2NhX2RhdGFfdGFibGUgPSB0YWJsZTsKICAgICAgICBzaWduYWwuZmllbGRNYW5hZ2VtZW50LmluaXQoJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLkRhdGFUYWJsZSgpLCAnI2FsZXJ0c0RldGFpbHNUYWJsZScsIGZpeGVkQ29sdW1ucyk7CiAgICAgICAgc2lnbmFsLmNvbW1vblRhZy5vcGVuQ29tbW9uQWxlcnRUYWdNb2RhbCgiUFZTIiwiUXVhbGl0YXRpdmUiLCB0YWdzKTsKICAgICAgICAkKCIjdG9nZ2xlLWNvbHVtbi1maWx0ZXJzIikuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgZWxlID0gJCgnLnlhZGNmLWZpbHRlci13cmFwcGVyJyk7CiAgICAgICAgICAgIHZhciBpbnB1dEVsZSA9ICQoJy55YWRjZi1maWx0ZXInKTsKICAgICAgICAgICAgaWYgKGVsZS5pcygnOnZpc2libGUnKSkgewogICAgICAgICAgICAgICAgZWxlLmhpZGUoKTsKICAgICAgICAgICAgICAgIGlucHV0RWxlLnZhbCgnJyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBlbGUuc2hvdygpOwogICAgICAgICAgICAgICAgaW5wdXRFbGUuZmlyc3QoKS5mb2N1cygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRhdGFfdGFibGUuY29sdW1ucy5hZGp1c3QoKS5maXhlZENvbHVtbnMoKS5yZWxheW91dCgpCiAgICAgICAgfSk7CgogICAgfTsKCiAgICB2YXIgY3JlYXRlX3NpbmdsZV9jYXNlX3RhYmxlX2NvbHVtbnMgPSBmdW5jdGlvbiAoY2FsbGluZ1NjcmVlbiwgY3VzdG9tRmllbGRzRW5hYmxlZCkgewoKICAgICAgICB2YXIgYW9Db2x1bW5zID0gWwoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogInNlbGVjdGVkIiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIGlmICgkLmluQXJyYXkocm93LmV4ZWNDb25maWdJZCwgZXhlY3V0ZWRJZExpc3QpID09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4ZWN1dGVkSWRMaXN0LnB1c2gocm93LmV4ZWNDb25maWdJZCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8aW5wdXQgY2xhc3M9ImV4ZWNDb25maWdJZCIgaWQ9ImV4ZWNDb25maWdJZCIgdHlwZT0iaGlkZGVuIiB2YWx1ZT0iJyArIHJvdy5leGVjQ29uZmlnSWQgKyAnIiAvPicgKwogICAgICAgICAgICAgICAgICAgICAgICAnPGlucHV0IGNsYXNzPSJhbGVydENvbmZpZ0lkIiBpZD0iYWxlcnRDb25maWdJZCIgdHlwZT0iaGlkZGVuIiB2YWx1ZT0iJyArIHJvdy5hbGVydENvbmZpZ0lkICsgJyIgLz4nICsKICAgICAgICAgICAgICAgICAgICAgICAgJzxpbnB1dCBkYXRhLWZpZWxkID0icHJvZHVjdEZhbWlseSIgZGF0YS1pZD0iJyArIHJvdy5wcm9kdWN0RmFtaWx5ICsgJyIgdHlwZT0iaGlkZGVuIiB2YWx1ZT0iJyArIHJvdy5wcm9kdWN0RmFtaWx5ICsgJyIgLz4nICsKICAgICAgICAgICAgICAgICAgICAgICAgJzxpbnB1dCBkYXRhLWZpZWxkID0icHJpbWFyeUV2ZW50IiBkYXRhLWlkPSInICsgcm93LnByaW1hcnlFdmVudCArICciIHR5cGU9ImhpZGRlbiIgdmFsdWU9IicgKyByb3cucHJpbWFyeUV2ZW50ICsgJyIgLz4nICsKICAgICAgICAgICAgICAgICAgICAgICAgJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgY2xhc3M9ImFsZXJ0LWNoZWNrLWJveCBlZGl0b3ItYWN0aXZlIGNvcHktc2VsZWN0IiBkYXRhLWlkPScgKyByb3cuaWQgKyAnIC8+JzsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogIiIsCiAgICAgICAgICAgICAgICAib3JkZXJhYmxlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogImRyb3Bkb3duIiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpb25CdXR0b24gPSAnPGRpdiBzdHlsZT0iZGlzcGxheTogYmxvY2s7IiBjbGFzcz0iYnRuLWdyb3VwIGRyb3Bkb3duIGRhdGFUYWJsZUhpZGVDZWxsQ29udGVudCIgYWxpZ249ImNlbnRlciI+IFwKICAgICAgICAgICAgICAgICAgICAgICAgPGEgY2xhc3M9ImRyb3Bkb3duLXRvZ2dsZSIgZGF0YS10b2dnbGU9ImRyb3Bkb3duIiB0YWJpbmRleD0iMCI+IFwKICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9ImN1cnNvcjogcG9pbnRlcjtmb250LXNpemU6IDEyNSU7IiBjbGFzcz0iZ2x5cGhpY29uIGdseXBoaWNvbi1vcHRpb24tdmVydGljYWwiPjwvc3Bhbj48c3BhbiBjbGFzcz0ic3Itb25seSI+VG9nZ2xlIERyb3Bkb3duPC9zcGFuPiBcCiAgICAgICAgICAgICAgICAgICAgICAgIDwvYT4gJzsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHJvdy5jb21tZW50cykgewogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25CdXR0b24gKz0gJzxpIGNsYXNzPSJtZGkgbWRpLWNoYXQgYmx1ZS0yIGZvbnQtMTMgcG9zLWFiIGNvbW1lbnQiIHRpdGxlPSInICsgJC5pMThuLl8oJ2NvbW1lbnRBdmFpbGFibGUnKSArICciPjwvaT4nOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKHJvdy5pc0F0dGFjaG1lbnQgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25CdXR0b24gKz0gJyA8aSBjbGFzcz0ibWRpIG1kaS1hdHRhY2htZW50IGJsdWUtMSBmb250LTEzIHBvcy1hYiBhdHRhY2giIHRpdGxlPSInICsgJC5pMThuLl8oJ2F0dGFjaG1lbnRBdmFpbGFibGUnKSArICciPjwvaT4nOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uQnV0dG9uICs9ICc8dWwgY2xhc3M9ImRyb3Bkb3duLW1lbnUgbWVudS1jb3N5IiByb2xlPSJtZW51Ij4gPGxpIHJvbGU9InByZXNlbnRhdGlvbiI+PGEgY2xhc3M9InJldmlldy1yb3ctaWNvbiBjYXNlLWhpc3RvcnktaWNvbiIgdGFiaW5kZXg9IjAiPjxzcGFuIGNsYXNzPSJmYSBmYS1saXN0IG0tci0xMCI+PC9zcGFuPkhpc3Rvcnk8L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgIGFjdGlvbkJ1dHRvbiArPSAnPGxpIHJvbGU9InByZXNlbnRhdGlvbiI+PGEgY2xhc3M9InJldmlldy1yb3ctaWNvbiBjb21tZW50LWljb24gIiBkYXRhLWluZm89InJvdyIgdGFiaW5kZXg9IjAiPjxzcGFuIGNsYXNzPSJmYSBmYS1jb21tZW50IG0tci0xMCI+PC9zcGFuPkNvbW1lbnRzPC9hPjwvbGk+JzsKICAgICAgICAgICAgICAgICAgICBhY3Rpb25CdXR0b24gKz0gJzxsaSByb2xlPSJwcmVzZW50YXRpb24iPjxhIGNsYXNzPSJyZXZpZXctcm93LWljb24gc2hvdy1hdHRhY2htZW50LWljb24iIGRhdGEtZmllbGQ9ImF0dGFjaG1lbnQiIGRhdGEtaWQ9IicgKyByb3cuaWQgKyAnIiBkYXRhLWNvbnRyb2xsZXI9InNpbmdsZUNhc2VBbGVydCIgdGFiaW5kZXg9IjAiPjxzcGFuIGNsYXNzPSJmYSBmYS1maWxlIG0tci0xMCI+PC9zcGFuPkF0dGFjaG1lbnQ8L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgIGFjdGlvbkJ1dHRvbiArPSAnPC91bD48L2Rpdj4nOwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uQnV0dG9uOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJvcmRlcmFibGUiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAiZHJvcERvd24iCiAgICAgICAgICAgIH0KICAgICAgICBdOwogICAgICAgIGlmICgkKCIjaXNDYXNlU2VyaWVzIikudmFsKCkgIT0gInRydWUiKSB7CiAgICAgICAgICAgIGFvQ29sdW1ucy5wdXNoLmFwcGx5KGFvQ29sdW1ucywgW3sKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJiYWRnZSIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZmxhZ0VsZW1lbnQgPSAiIjsKICAgICAgICAgICAgICAgICAgICB2YXIgZmxhZyA9IHJvdy5iYWRnZSA/IHJvdy5iYWRnZS5zcGxpdCgnLCcpIDogbnVsbDsKICAgICAgICAgICAgICAgICAgICBpZiAoZmxhZykgewogICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goZmxhZywgZnVuY3Rpb24gKGlkeCwgdmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsID09PSBCQURHRVMuTkVXKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ0VsZW1lbnQgKz0gJzxpIGNsYXNzPSJnbHlwaGljb24gZ2x5cGhpY29uLXRhZyBtLXItNSIgc3R5bGU9ImNvbG9yOiBvcmFuZ2UiPjwvaT4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbCA9PT0gQkFER0VTLkFVVE9fRkxBR0dFRCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsYWdFbGVtZW50ICs9ICc8aSBjbGFzcz0iZ2x5cGhpY29uIGdseXBoaWNvbi10YWcgbS1yLTUiIHN0eWxlPSJjb2xvcjogZ3JlZW4iPjwvaT4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbCA9PT0gQkFER0VTLlBFTkRJTkdfUkVWSUVXKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ0VsZW1lbnQgKz0gJzxpIGNsYXNzPSJnbHlwaGljb24gZ2x5cGhpY29uLXRhZyBtLXItNSIgc3R5bGU9ImNvbG9yOiBwdXJwbGUiPjwvaT4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmxhZ0VsZW1lbnQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogJycsCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHRydWUKICAgICAgICAgICAgfQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICAgICAgaWYgKCQoIiNpc0ZhZXJzIikudmFsKCkgIT0gInRydWUiKSB7CiAgICAgICAgICAgIGFvQ29sdW1ucy5wdXNoLmFwcGx5KGFvQ29sdW1ucywgW3sKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJwcmlvcml0eSIsCiAgICAgICAgICAgICAgICAiYVRhcmdldHMiOiBbInByaW9yaXR5Il0sCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaXNQcmlvcnR5Q2hhbmdlQWxsb3dlZCA9IChpc1Byb2R1Y3RTZWN1cml0eSA9PSAndHJ1ZScgJiYgYWxsb3dlZFByb2R1Y3RzQXNTYWZldHlMZWFkLmluZGV4T2Yocm93LnByb2R1Y3ROYW1lKSkgfHwgaXNQcm9kdWN0U2VjdXJpdHkgPT0gJ2ZhbHNlJzsgICAgICAgICAgICAgICAgICAgIHJldHVybiBzaWduYWwudXRpbHMucmVuZGVyKCdwcmlvcml0eScsIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHlWYWx1ZTogcm93LnByaW9yaXR5LnZhbHVlLAogICAgICAgICAgICAgICAgICAgICAgICBwcmlvcml0eUNsYXNzOiByb3cucHJpb3JpdHkuaWNvbkNsYXNzLAogICAgICAgICAgICAgICAgICAgICAgICBpc1ByaW9yaXR5Q2hhbmdlQWxsb3dlZDogaXNQcmlvcnR5Q2hhbmdlQWxsb3dlZAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAndGV4dC1jZW50ZXIgY29sLW1pbi0zMCBwcmlvcml0eVBhcmVudCcsCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiYWN0aW9ucyIsCiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTMwIHRleHQtY2VudGVyIGFjdGlvbi1jb2wnLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2lnbmFsLmFjdGlvbnNfdXRpbHMuYnVpbGRfYWN0aW9uX3JlbmRlcihyb3cpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAid2lkdGgiOiAnMzVweCcsCiAgICAgICAgICAgICAgICAgICAgInZpc2libGUiOiB0cnVlCiAgICAgICAgICAgICAgICB9XSk7CiAgICAgICAgfQogICAgICAgIGlmIChjYWxsaW5nU2NyZWVuID09IENBTExJTkdfU0NSRUVOLkRBU0hCT0FSRCkgewogICAgICAgICAgICBhb0NvbHVtbnMucHVzaC5hcHBseShhb0NvbHVtbnMsIFt7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiYWxlcnROYW1lIiwKICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAnY29sLW1pbi0xNTAgY29sLW1heC0zMDAgY2VsbC1icmVhaycsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY29sRWxlbWVudCA9ICc8ZGl2IGNsYXNzPSJjb2wtY29udGFpbmVyIj48ZGl2IGNsYXNzPSJjb2wtaGVpZ2h0Ij4nOwogICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gcm93LmFsZXJ0TmFtZTsKICAgICAgICAgICAgICAgICAgICBjb2xFbGVtZW50ICs9ICc8YSB0YWJpbmRleD0iMCIgdGl0bGU9IicgKyAkLmkxOG4uXygnYXBwTGFiZWwudmlld0FsbCcpICsgJyIgY2xhc3M9Imljby1kb3RzIHZpZXctYWxsIiBtb3JlLWRhdGE9IicgKyByb3cuYWxlcnROYW1lICsgJyI+PGkgY2xhc3M9Im1kaSBtZGktZG90cy1ob3Jpem9udGFsIGZvbnQtMjAgYmx1ZS0xIj4gPC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gJzwvZGl2PjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbEVsZW1lbnQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHRydWUKICAgICAgICAgICAgfV0pOwogICAgICAgIH0KICAgICAgICBhb0NvbHVtbnMucHVzaC5hcHBseShhb0NvbHVtbnMsIFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogImNhc2VOdW1iZXIiLAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTc1JywKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHZhciBpc0ZhZXJzID0gJCgiI2lzRmFlcnMiKS52YWwoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgbGlua1ByZSA9ICc8YSB0YXJnZXQ9Il9ibGFuayIgY2xhc3M9InNjYUNhc2VOdW1iZXIiIGhyZWY9IicgKyAoY2FzZURldGFpbFVybCArICc/JyArCiAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbC51dGlscy5jb21wb3NlUGFyYW1zKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2VOdW1iZXI6IHJvdy5jYXNlTnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbjogcm93LmNhc2VWZXJzaW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9sbG93VXBOdW1iZXI6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydElkOiByb3cuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0ZhZXJzOiBpc0ZhZXJzCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKSArICciPic7CgogICAgICAgICAgICAgICAgICAgIHZhciBjYXNlTnVtID0gIjxzcGFuIGRhdGEtZmllbGQgPSdjYXNlTnVtYmVyJyBkYXRhLWlkPSciICsgcm93LmNhc2VOdW1iZXIgKyAiJz4iICsKICAgICAgICAgICAgICAgICAgICAgICAgKHJvdy5jYXNlTnVtYmVyKSArICI8L3NwYW4+PHNwYW4gZGF0YS1maWVsZCA9J2Nhc2VWZXJzaW9uJyBkYXRhLWlkPSciICsgcm93LmNhc2VWZXJzaW9uICsKICAgICAgICAgICAgICAgICAgICAgICAgIic+PC9zcGFuPjxzcGFuIGRhdGEtZmllbGQgPSdleGVjQ29uZmlnSWQnIGRhdGEtaWQ9JyIgKyByb3cuZXhlY0NvbmZpZ0lkICsgIic+PHNwYW4gZGF0YS1maWVsZCA9J2FsZXJ0SWQnIGRhdGEtaWQ9JyIgKyByb3cuaWQgKyAiJz48L3NwYW4+IjsKICAgICAgICAgICAgICAgICAgICB2YXIgbGlua1N1ZiA9ICIoPHNwYW4gZGF0YS1maWVsZCA9J2ZvbGxvd1VwTnVtYmVyJyBkYXRhLWlkPSciICsgcm93LmZvbGxvd1VwTnVtYmVyICsgIic+IiArCiAgICAgICAgICAgICAgICAgICAgICAgICgocm93LmZvbGxvd1VwTnVtYmVyIDwgMSkgPyAwIDogcm93LmZvbGxvd1VwTnVtYmVyKSArICI8L3NwYW4+KSI7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzRmFlcnMgIT0gInRydWUiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsaW5rUHJlICsgY2FzZU51bSArIGxpbmtTdWYgKyAiPC9hPiI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGlua1ByZSArIGNhc2VOdW0gKyAiPC9hPiI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJkYXRhLXR5cGUiOiAiY2FzZU51bWJlciIsCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogImFsZXJ0VGFncyIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdGFnc0VsZW1lbnQgPSBzaWduYWwuYWxlcnRzX3V0aWxzLmdldF90YWdzX2VsZW1lbnQocm93LmFsZXJ0VGFncyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRhZ3NFbGVtZW50CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICdjb2wtbWF4LTMwMCBwb3MtcmVsJywKICAgICAgICAgICAgICAgICJvcmRlcmFibGUiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnYWxlcnRUYWdzJykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogImNhc2VJbml0UmVjZWlwdERhdGUiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgZnVsbCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAoZGF0YSAhPSB1bmRlZmluZWQpID8gbW9tZW50LnV0YyhkYXRhKS5mb3JtYXQoREVGQVVMVF9EQVRFX0ZPUk1BVCkgOiAnJzsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogJ2NvbC1taW4tMTAwJywKICAgICAgICAgICAgICAgICJvcmRlcmFibGUiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnY2FzZUluaXRSZWNlaXB0RGF0ZScpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJwcm9kdWN0TmFtZSIsCiAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogJ2NvbC1taW4tMTAwIGNvbC1tYXgtMjAwIGNlbGwtYnJlYWsnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI8c3BhbiBkYXRhLWZpZWxkID0ncHJvZHVjdE5hbWUnIGRhdGEtaWQ9JyIgKyByb3cucHJvZHVjdE5hbWUgKyAiJz4iICsKICAgICAgICAgICAgICAgICAgICAgICAgcm93LnByb2R1Y3ROYW1lICsgIjwvc3Bhbj4iOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygncHJvZHVjdE5hbWUnKQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAicHQiLAogICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICdjb2wtbWluLTc1JywKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnPHNwYW4gZGF0YS1maWVsZD0ibWFzdGVyUHJlZlRlcm1BbGwiIGRhdGEtaWQ9IicgKyByb3cucHQgKyAnIj4nICsgcm93LnB0ICsgJzwvc3Bhbj4nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdwdCcpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJsaXN0ZWRuZXNzIiwKICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAnJywKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnPHNwYW4+JyArIHJvdy5saXN0ZWRuZXNzICsgJzwvc3Bhbj4nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdsaXN0ZWRuZXNzJykKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIm1EYXRhIjogIm91dGNvbWUiLAogICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICcnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3Bhbj4nICsgcm93Lm91dGNvbWUgKyAnPC9zcGFuPicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ291dGNvbWUnKQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAnc2lnbmFsc0FuZFRvcGljcycsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgc2lnbmFsQW5kVG9waWNzID0gJyc7CiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKHJvdy5zaWduYWxzQW5kVG9waWNzLCBmdW5jdGlvbiAoaSwgb2JqKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1cmwgPSBzaWduYWxEZXRhaWxVcmwgKyAnP2lkPScgKyBvYmpbJ3NpZ25hbElkJ107CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCQoJyNoYXNTaWduYWxNYW5hZ2VtZW50QWNjZXNzJykudmFsKCkgPT0gJ3RydWUnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWduYWxBbmRUb3BpY3MgPSBzaWduYWxBbmRUb3BpY3MgKyAnPHNwYW4gY2xhc3M9ImNsaWNrIj48YSBjbGFzcz0iY2VsbC1icmVhayIgaHJlZj0iJyArIHVybCArICciPicgKyBlc2NhcGVIVE1MKG9ialsnbmFtZSddKSArICc8L2E+PC9zcGFuPiZuYnNwOycKICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsQW5kVG9waWNzID0gc2lnbmFsQW5kVG9waWNzICsgJzxzcGFuIGNsYXNzPSJjbGljayBzaWduYWxTdW1tYXJ5QXV0aCI+PGEgY2xhc3M9ImNlbGwtYnJlYWsiIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSI+JyArIGVzY2FwZUhUTUwob2JqWyduYW1lJ10pICsgJzwvYT48L3NwYW4+Jm5ic3A7JwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbEFuZFRvcGljcyA9IHNpZ25hbEFuZFRvcGljcyArICIsIgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGlmIChzaWduYWxBbmRUb3BpY3MubGVuZ3RoID4gMSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8ZGl2PicgKyBzaWduYWxBbmRUb3BpY3Muc3Vic3RyaW5nKDAsIHNpZ25hbEFuZFRvcGljcy5sZW5ndGggLSAxKSArICc8L2Rpdj4nOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICctJzsKCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICdjb2wtbWluLTE1MCBjb2wtbWF4LTIwMCBzaWduYWxJbmZvcm1hdGlvbicsCiAgICAgICAgICAgICAgICAib3JkZXJhYmxlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ3NpZ25hbHNBbmRUb3BpY3MnKQogICAgICAgICAgICB9XSk7CiAgICAgICAgaWYgKCQoIiNpc0ZhZXJzIikudmFsKCkgIT0gInRydWUiKSB7CiAgICAgICAgICAgIGFvQ29sdW1ucy5wdXNoLmFwcGx5KGFvQ29sdW1ucywgWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjdXJyZW50RGlzcG9zaXRpb24iLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2lnbmFsLnV0aWxzLnJlbmRlcignZGlzcG9zaXRpb24nLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkRGlzcG9zaXRpb246IGRpc3Bvc2l0aW9uSW5jb21pbmdPdXRnb2luZ01hcFtyb3cuZGlzcG9zaXRpb25dLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudERpc3Bvc2l0aW9uOiByb3cuZGlzcG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JjZUp1c3RpZmljYXRpb246IGZvcmNlSnVzdGlmaWNhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzUmV2aWV3ZWQ6IHJvdy5pc1Jldmlld2VkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNWYWxpZGF0aW9uU3RhdGVBY2hpZXZlZDogcm93LmlzVmFsaWRhdGlvblN0YXRlQWNoaWV2ZWQKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ2N1cnJlbnREaXNwb3NpdGlvbicpLAogICAgICAgICAgICAgICAgICAgICJjbGFzcyI6ICdjb2wtbWF4LTI1MCBkaXNwb3NpdGlvbkFjdGlvbicKICAgICAgICAgICAgICAgIH1dKTsKICAgICAgICB9CiAgICAgICAgYW9Db2x1bW5zLnB1c2guYXBwbHkoYW9Db2x1bW5zLCBbewogICAgICAgICAgICAibURhdGEiOiAiZGlzcG9zaXRpb24iLAogICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgIHJldHVybiByb3cuZGlzcG9zaXRpb24KICAgICAgICAgICAgfSwKICAgICAgICAgICAgImNsYXNzTmFtZSI6ICdjb2wtbWF4LTI1MCBjdXJyZW50RGlzcG9zaXRpb24nLAogICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ2Rpc3Bvc2l0aW9uJykKICAgICAgICB9XSk7CiAgICAgICAgaWYgKCQoIiNpc0ZhZXJzIikudmFsKCkgIT0gInRydWUiKSB7CiAgICAgICAgICAgIGFvQ29sdW1ucy5wdXNoLmFwcGx5KGFvQ29sdW1ucywgWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJhc3NpZ25lZFRvVXNlciIsCiAgICAgICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzaWduYWwubGlzdF91dGlscy5hc3NpZ25lZF90b19jb21wKHJvdy5pZCwgcm93LmFzc2lnbmVkVG9Vc2VyKQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICdjb2wtbWluLTEwMCBjb2wtbWF4LTE1MCBhc3NpZ25lZFRvJywKICAgICAgICAgICAgICAgICAgICAib3JkZXJhYmxlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdhc3NpZ25lZFRvVXNlcicpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJkdWVEYXRlIiwKICAgICAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2R1ZUluIGNvbC1taW4tNTAnLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2lnbmFsLmxpc3RfdXRpbHMuZHVlX2luX2NvbXAocm93LmR1ZUluKQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdkdWVEYXRlJykKICAgICAgICAgICAgICAgIH1dKTsKICAgICAgICB9CgogICAgICAgIGFvQ29sdW1ucy5wdXNoLmFwcGx5KGFvQ29sdW1ucywgWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAic3VzcFByb2QiLAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTE1MCBjb2wtbWF4LTIwMCBjZWxsLWJyZWFrJywKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHZhciBjb2xFbGVtZW50ID0gJzxkaXYgY2xhc3M9ImNvbC1jb250YWluZXIiPjxkaXYgY2xhc3M9ImNvbC1oZWlnaHQiPic7CiAgICAgICAgICAgICAgICAgICAgY29sRWxlbWVudCArPSByb3cuc3VzcFByb2Q7CiAgICAgICAgICAgICAgICAgICAgY29sRWxlbWVudCArPSAnPGEgdGFiaW5kZXg9IjAiIHRpdGxlPSInICsgJC5pMThuLl8oJ2FwcExhYmVsLnZpZXdBbGwnKSArICciIGNsYXNzPSJpY28tZG90cyB2aWV3LWFsbCIgbW9yZS1kYXRhPSInICsgcm93LnN1c3BQcm9kICsgJyI+PGkgY2xhc3M9Im1kaSBtZGktZG90cy1ob3Jpem9udGFsIGZvbnQtMjAgYmx1ZS0xIj4gPC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gJzwvZGl2PjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbEVsZW1lbnQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAib3JkZXJhYmxlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ3N1c3BQcm9kJykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogImNvbkNvbWl0IiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xMDAgY29sLW1heC0yMDAnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbEVsZW1lbnQgPSAnPGRpdiBjbGFzcz0iY29sLWNvbnRhaW5lciI+PGRpdiBjbGFzcz0iY29sLWhlaWdodCI+JzsKICAgICAgICAgICAgICAgICAgICBjb2xFbGVtZW50ICs9IHJlbW92ZUxpbmVCcmVhayhyb3cuY29uQ29taXQpOwogICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gJzxhIHRhYmluZGV4PSIwIiB0aXRsZT0iJyArICQuaTE4bi5fKCdhcHBMYWJlbC52aWV3QWxsJykgKyAnIiBjbGFzcz0iaWNvLWRvdHMgdmlldy1hbGwiIG1vcmUtZGF0YT0iJyArIHJlbW92ZUxpbmVCcmVhayhyb3cuY29uQ29taXQpICsgJyI+PGkgY2xhc3M9Im1kaSBtZGktZG90cy1ob3Jpem9udGFsIGZvbnQtMjAgYmx1ZS0xIj4gPC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gJzwvZGl2PjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbEVsZW1lbnQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ2NvbkNvbWl0JykKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJtYXN0ZXJQcmVmVGVybUFsbCIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTAwIGNvbC1tYXgtMjAwJywKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHZhciBwdExpc3QgPSAnJzsKICAgICAgICAgICAgICAgICAgICBpZiAocm93Lm1hc3RlclByZWZUZXJtQWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHB0TGlzdCA9IHJvdy5tYXN0ZXJQcmVmVGVybUFsbC5zcGxpdCgnIUAjI0AhJykuam9pbignICcpOwogICAgICAgICAgICAgICAgICAgICAgICBwdExpc3QgPSBwdExpc3Quc3BsaXQoJyFALkAhJykuam9pbignKSAnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbEVsZW1lbnQgPSAnPGRpdiBjbGFzcz0iY29sLWNvbnRhaW5lciI+PGRpdiBjbGFzcz0iY29sLWhlaWdodCI+JzsKICAgICAgICAgICAgICAgICAgICBjb2xFbGVtZW50ICs9IHB0TGlzdDsKICAgICAgICAgICAgICAgICAgICBjb2xFbGVtZW50ICs9ICc8YSB0YWJpbmRleD0iMCIgdGl0bGU9IicgKyAkLmkxOG4uXygnYXBwTGFiZWwudmlld0FsbCcpICsgJyIgY2xhc3M9Imljby1kb3RzIHZpZXctYWxsIiBtb3JlLWRhdGE9IicgKyBwdExpc3QgKyAnIj48aSBjbGFzcz0ibWRpIG1kaS1kb3RzLWhvcml6b250YWwgZm9udC0yMCBibHVlLTEiPiA8L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgY29sRWxlbWVudCArPSAnPC9kaXY+PC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29sRWxlbWVudAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJvcmRlcmFibGUiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnbWFzdGVyUHJlZlRlcm1BbGwnKQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAic2VyaW91cyIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJycsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuPicgKyByb3cuc2VyaW91cyArICc8L3NwYW4+JwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJvcmRlcmFibGUiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnc2VyaW91cycpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjYXNlUmVwb3J0VHlwZSIsCiAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogJycsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuPicgKyByb3cuY2FzZVJlcG9ydFR5cGUgKyAnPC9zcGFuPicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAib3JkZXJhYmxlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ2Nhc2VSZXBvcnRUeXBlJykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogInJlcG9ydGVyc0hjcEZsYWciLAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICcnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3Bhbj4nICsgcm93LnJlcG9ydGVyc0hjcEZsYWcgKyAnPC9zcGFuPicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAib3JkZXJhYmxlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ3JlcG9ydGVyc0hjcEZsYWcnKQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiY291bnRyeSIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJycsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuPicgKyByb3cuY291bnRyeSArICc8L3NwYW4+JwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJvcmRlcmFibGUiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnY291bnRyeScpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJhZ2UiLAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICcnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3Bhbj4nICsgcm93LmFnZSArICc8L3NwYW4+JwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJvcmRlcmFibGUiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnYWdlJykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogImdlbmRlciIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJycsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuPicgKyByb3cuZ2VuZGVyICsgJzwvc3Bhbj4nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm9yZGVyYWJsZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdnZW5kZXInKQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAicmVjaGFsbGVuZ2UiLAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICcnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3Bhbj4nICsgcm93LnJlY2hhbGxlbmdlICsgJzwvc3Bhbj4nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm9yZGVyYWJsZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdyZWNoYWxsZW5nZScpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJsb2NrZWREYXRlIiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xMDAnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChkYXRhICYmIGRhdGEgIT0gdW5kZWZpbmVkICkgPyBtb21lbnQudXRjKGRhdGEpLmZvcm1hdChERUZBVUxUX0RBVEVfRk9STUFUKSA6ICcnOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJvcmRlcmFibGUiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnbG9ja2VkRGF0ZScpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJkZWF0aCIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJycsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuPicgKyByb3cuZGVhdGggKyAnPC9zcGFuPicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAib3JkZXJhYmxlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ2RlYXRoJykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogIm1lZEVycm9yc1B0IiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xMDAgY29sLW1heC0yMDAgY2VsbC1icmVhaycsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY29sRWxlbWVudCA9ICc8ZGl2IGNsYXNzPSJjb2wtY29udGFpbmVyIj48ZGl2IGNsYXNzPSJjb2wtaGVpZ2h0Ij4nOwogICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gcm93Lm1lZEVycm9yc1B0OwogICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gJzxhIHRhYmluZGV4PSIwIiB0aXRsZT0iJyArICQuaTE4bi5fKCdhcHBMYWJlbC52aWV3QWxsJykgKyAnIiBjbGFzcz0iaWNvLWRvdHMgdmlldy1hbGwiIG1vcmUtZGF0YT0iJyArIHJvdy5tZWRFcnJvcnNQdCArICciPjxpIGNsYXNzPSJtZGkgbWRpLWRvdHMtaG9yaXpvbnRhbCBmb250LTIwIGJsdWUtMSI+IDwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICBjb2xFbGVtZW50ICs9ICc8L2Rpdj48L2Rpdj4nOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBjb2xFbGVtZW50CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm9yZGVyYWJsZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdtZWRFcnJvcnNQdCcpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJwYXRpZW50QWdlIiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xMDAnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuJzxzcGFuPicrcm93LnBhdGllbnRBZ2UrJzwvc3Bhbj4nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdwYXRpZW50QWdlJykKICAgICAgICAgICAgfV0pOwoKICAgICAgICBpZiAoY3VzdG9tRmllbGRzRW5hYmxlZCkgewogICAgICAgICAgICBhb0NvbHVtbnMucHVzaC5hcHBseShhb0NvbHVtbnMsIFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiY2FzZVR5cGUiLAogICAgICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnJywKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3Bhbj4nICsgcm93LmNhc2VUeXBlICsgJzwvc3Bhbj4nCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ2Nhc2VUeXBlJykKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImNvbXBsZXRlbmVzc1Njb3JlIiwKICAgICAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJycsCiAgICAgICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPHNwYW4+JyArIHJvdy5jb21wbGV0ZW5lc3NTY29yZSArICc8L3NwYW4+JwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdjb21wbGV0ZW5lc3NTY29yZScpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJpbmROdW1iZXIiLAogICAgICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnJywKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3Bhbj4nICsgcm93LmluZE51bWJlciArICc8L3NwYW4+JwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdpbmROdW1iZXInKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiYXBwVHlwZUFuZE51bSIsCiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICcnLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuPicgKyByb3cuYXBwVHlwZUFuZE51bSArICc8L3NwYW4+JwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdhcHBUeXBlQW5kTnVtJykKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImNvbXBvdW5kaW5nRmxhZyIsCiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTEwMCBjb2wtbWF4LTIwMCcsCiAgICAgICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2xFbGVtZW50ID0gJzxkaXYgY2xhc3M9ImNvbC1jb250YWluZXIiPjxkaXYgY2xhc3M9ImNvbC1oZWlnaHQiPic7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gcm93LmNvbXBvdW5kaW5nRmxhZzsKICAgICAgICAgICAgICAgICAgICAgICAgY29sRWxlbWVudCArPSAnPGEgdGFiaW5kZXg9IjAiIHRpdGxlPSInICsgJC5pMThuLl8oJ2FwcExhYmVsLnZpZXdBbGwnKSArICciIGNsYXNzPSJpY28tZG90cyB2aWV3LWFsbCIgbW9yZS1kYXRhPSInICsgcm93LmNvbXBvdW5kaW5nRmxhZyArICciPjxpIGNsYXNzPSJtZGkgbWRpLWRvdHMtaG9yaXpvbnRhbCBmb250LTIwIGJsdWUtMSI+IDwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgY29sRWxlbWVudCArPSAnPC9kaXY+PC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbEVsZW1lbnQKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnY29tcG91bmRpbmdGbGFnJykKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogInN1Ym1pdHRlciIsCiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICcnLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuPicgKyByb3cuc3VibWl0dGVyICsgJzwvc3Bhbj4nCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ3N1Ym1pdHRlcicpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0pCiAgICAgICAgfQogICAgICAgIGlmIChjYWxsaW5nU2NyZWVuID09IENBTExJTkdfU0NSRUVOLlRSSUdHRVJFRF9BTEVSVFMpIHsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSg0LCAwLCB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAibmFtZSIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuPicgKyByb3cuYWxlcnROYW1lICsgJzwvc3Bhbj4nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgInZpc2libGUiOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYW9Db2x1bW5zCiAgICB9OwoKICAgIHZhciBjcmVhdGVBbGVydExpc3RVcmwgPSBmdW5jdGlvbiAoaXNGaWx0ZXJSZXF1ZXN0LCBmaWx0ZXJWYWx1ZXMpIHsKICAgICAgICB2YXIgbGlzdFVybCA9IGxpc3RDb25maWdVcmwgKyAnJmlzRmlsdGVyUmVxdWVzdD0nICsgaXNGaWx0ZXJSZXF1ZXN0ICsgJyZmaWx0ZXJzPScgKyBKU09OLnN0cmluZ2lmeShmaWx0ZXJWYWx1ZXMpOwogICAgICAgIGlmICgkKCcjaXNGYWVycycpLnZhbCgpKSB7CiAgICAgICAgICAgIGxpc3RVcmwgKz0gJyZpc0ZhZXJzPScgKyAkKCcjaXNGYWVycycpLnZhbCgpCiAgICAgICAgfQogICAgICAgIHJldHVybiBsaXN0VXJsCiAgICB9OwoKICAgIHZhciBzaG93QWxsU2VsZWN0ZWRDYXNlTnVtYmVycyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAkKCcjY29weUNhc2VOdW1iZXJNb2RlbCcpLm1vZGFsKHsKICAgICAgICAgICAgc2hvdzogdHJ1ZQogICAgICAgIH0pOwoKICAgICAgICB2YXIgbnVtYmVycyA9IF8ubWFwKCQoJ2lucHV0LmNvcHktc2VsZWN0OmNoZWNrZWQnKS5wYXJlbnQoKS5wYXJlbnQoKS5maW5kKCd0ZDpudGgtY2hpbGQoNSknKSwgZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgICAgIHJldHVybiAkKGl0KS50ZXh0KCkKICAgICAgICB9KTsKICAgICAgICAkKCIjY2FzZU51bWJlcnMiKS50ZXh0KG51bWJlcnMpOwogICAgfTsKCiAgICB2YXIgaW5pdFVwZGF0ZUFzc2lnbmVkVG8gPSBmdW5jdGlvbiAoKSB7CgogICAgICAgICQoIiN1cGRhdGVBc3NpZ25lZFRvQnRuIikub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgICAgICAgICAgdXJsOiAkKCIjY2hhbmdlLXVzZXItdXJsIikudmFsKCksCiAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgYWxlcnRJZDogJCgiI2Fzc2lnbmVkVG9Nb2RhbCAjYWxlcnRJZCIpLnZhbCgpLAogICAgICAgICAgICAgICAgICAgIGFzc2lnbmVkVG86ICQoIiNfYXNzaWduZWRUbyIpLmZpbmQoIm9wdGlvbjpzZWxlY3RlZCIpLnZhbCgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICQoIiNhc3NpZ25lZFRvTW9kYWwiKS5maW5kKCcuZm9ybS1jb250cm9sJykudmFsKCIiKQogICAgICAgICAgICAgICAgJCgiI2Fzc2lnbmVkVG9Nb2RhbCIpLm1vZGFsKCdoaWRlJykKICAgICAgICAgICAgICAgIGFsZXJ0RGV0YWlsc1RhYmxlLmFqYXgucmVsb2FkKCkKICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKCkgewogICAgICAgICAgICB9KQogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgaW5pdF9hZGRfY2FzZV9tb2RhbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBhZGRDYXNlTW9kYWxPYmogPSAkKCcjYWRkQ2FzZU1vZGFsJyk7CiAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJ2lucHV0OnRleHQnKS52YWwoJycpOwogICAgICAgIGFkZENhc2VNb2RhbE9iai5maW5kKCcjanVzdGlmaWNhdGlvbicpLnZhbCgiIik7CiAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJyNpbXBvcnRDYXNlc0V4Y2VsJykucHJvcCgnY2hlY2tlZCcsIGZhbHNlKTsKICAgICAgICBhZGRDYXNlTW9kYWxPYmouZmluZCgnI2ltcG9ydENhc2VzU2VjdGlvbicpLmF0dHIoJ2hpZGRlbicsICdoaWRkZW4nKTsKICAgICAgICBhZGRDYXNlTW9kYWxPYmouZmluZCgnI2Nhc2VOdW1iZXInKS5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKS5zaWJsaW5ncygnbGFiZWwnKS5maW5kKCdzcGFuJykuc2hvdygpCiAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJyNqdXN0aWZpY2F0aW9uTGlzdFByaW9yaXR5JykudmFsKCcnKTsKICAgICAgICBhZGRDYXNlTW9kYWxPYmouZmluZCgnI2FkZENhc2VCdXR0b24nKS5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKTsKICAgICAgICBhZGRDYXNlTW9kYWxPYmoubW9kYWwoJ3Nob3cnKTsKCiAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJyNpbXBvcnRDYXNlc0V4Y2VsJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJyNpbXBvcnRDYXNlc0V4Y2VsJykuaXMoJzpjaGVja2VkJykpIHsKICAgICAgICAgICAgICAgIGFkZENhc2VNb2RhbE9iai5maW5kKCcjaW1wb3J0Q2FzZXNTZWN0aW9uJykucmVtb3ZlQXR0cignaGlkZGVuJyk7CiAgICAgICAgICAgICAgICBhZGRDYXNlTW9kYWxPYmouZmluZCgnI3ZlcnNpb25OdW1iZXIsICNjYXNlTnVtYmVyJykudmFsKCcnKS5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpLnNpYmxpbmdzKCdsYWJlbCcpLmZpbmQoJ3NwYW4nKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAkKCcuYWRkLWNhc2UtdG8tbGlzdCcpLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhZGRDYXNlTW9kYWxPYmouZmluZCgnI2ltcG9ydENhc2VzU2VjdGlvbicpLmF0dHIoJ2hpZGRlbicsICdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIGFkZENhc2VNb2RhbE9iai5maW5kKCc6ZmlsZScpLnZhbCgnJykucGFyZW50cygnLmlucHV0LWdyb3VwJykuZmluZCgnOnRleHQnKS52YWwoJycpOwogICAgICAgICAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJyN2ZXJzaW9uTnVtYmVyLCAjY2FzZU51bWJlcicpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJykuc2libGluZ3MoJ2xhYmVsJykuZmluZCgnc3BhbicpLnNob3coKTsKICAgICAgICAgICAgICAgICQoJy5hZGQtY2FzZS10by1saXN0JykucmVtb3ZlQXR0cignZGlzYWJsZWQnKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKCiAgICAgICAgJChkb2N1bWVudCkub24oJ2NoYW5nZScsICcjanVzdGlmaWNhdGlvbkxpc3RQcmlvcml0eScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHZhbHVlID0gJCh0aGlzKS52YWwoKTsKICAgICAgICAgICAgaWYgKHZhbHVlICE9ICIiKSB7CiAgICAgICAgICAgICAgICB2YXIgdGV4dCA9IGp1c3RpZmljYXRpb25PYmouZmlsdGVyKGZ1bmN0aW9uIChhcnIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXJyLmlkID09IHZhbHVlCiAgICAgICAgICAgICAgICB9KVswXS50ZXh0OwogICAgICAgICAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJyNqdXN0aWZpY2F0aW9uJykudmFsKHRleHQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJyNqdXN0aWZpY2F0aW9uJykudmFsKCcnKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKCiAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLm9uKCdjaGFuZ2UnLCAnOmZpbGUnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBpbnB1dCA9ICQodGhpcyk7CiAgICAgICAgICAgIHZhciBudW1GaWxlcyA9IGlucHV0LmdldCgwKS5maWxlcyA/IGlucHV0LmdldCgwKS5maWxlcy5sZW5ndGggOiAwOwogICAgICAgICAgICB2YXIgbGFiZWwgPSBpbnB1dC52YWwoKS5yZXBsYWNlKC9cXC9nLCAnLycpLnJlcGxhY2UoLy4qXC8vLCAnJyk7CiAgICAgICAgICAgIHZhciB2YWxpZEV4dHMgPSBuZXcgQXJyYXkoIi54bHN4IiwgIi54bHMiKTsKICAgICAgICAgICAgdmFyIGZpbGVFeHQgPSBsYWJlbC5zdWJzdHJpbmcobGFiZWwubGFzdEluZGV4T2YoJy4nKSk7CiAgICAgICAgICAgIGlmIChudW1GaWxlcyA+IDApIHsKICAgICAgICAgICAgICAgIGlmICh2YWxpZEV4dHMuaW5kZXhPZihmaWxlRXh0LnRvTG93ZXJDYXNlKCkpIDwgMCkgewogICAgICAgICAgICAgICAgICAgICQoJyNmaWxlRm9ybWF0RXJyb3InKS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgJCgnLmFkZC1jYXNlLXRvLWxpc3QnKS5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkKCcjZmlsZUZvcm1hdEVycm9yJykuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICQoJy5hZGQtY2FzZS10by1saXN0JykucmVtb3ZlQXR0cignZGlzYWJsZWQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICQoJyNmaWxlRm9ybWF0RXJyb3InKS5oaWRlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaW5wdXQudHJpZ2dlcignZmlsZXNlbGVjdCcsIFtudW1GaWxlcywgbGFiZWxdKTsKICAgICAgICB9KTsKCiAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJzpmaWxlJykub24oJ2ZpbGVzZWxlY3QnLCBmdW5jdGlvbiAoZXZlbnQsIG51bUZpbGVzLCBsYWJlbCkgewogICAgICAgICAgICB2YXIgaW5wdXQgPSAkKHRoaXMpLnBhcmVudHMoJy5pbnB1dC1ncm91cCcpLmZpbmQoJzp0ZXh0Jyk7CiAgICAgICAgICAgIHZhciBsb2cgPSBudW1GaWxlcyA+IDAgPyBsYWJlbCA6ICIiOwoKICAgICAgICAgICAgaWYgKGlucHV0Lmxlbmd0aCkgewogICAgICAgICAgICAgICAgaW5wdXQudmFsKGxvZyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGFkZF9jYXNlX3RvX2xpc3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJyNhZGRDYXNlQnV0dG9uJykuYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTsKICAgICAgICB2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJyNhZGROZXdDYXNlJylbMF0pOwogICAgICAgIGlmIChhZGRDYXNlTW9kYWxPYmouZmluZCgnOmZpbGUnKS52YWwoKSkgewogICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoImZpbGUiLCAkKCcjZmlsZV9pbnB1dCcpLmdldCgwKS5maWxlc1swXSk7CiAgICAgICAgfQogICAgICAgICQuYWpheCh7CiAgICAgICAgICAgIHVybDogIi9zaWduYWwvc2luZ2xlQ2FzZUFsZXJ0L2FkZENhc2VUb1NpbmdsZUNhc2VBbGVydCIsCiAgICAgICAgICAgIHR5cGU6ICdQT1NUJywKICAgICAgICAgICAgZGF0YTogZm9ybURhdGEsCiAgICAgICAgICAgIG1pbWVUeXBlOiAibXVsdGlwYXJ0L2Zvcm0tZGF0YSIsCiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBmYWxzZSwKICAgICAgICAgICAgY2FjaGU6IGZhbHNlLAogICAgICAgICAgICBwcm9jZXNzRGF0YTogZmFsc2UsCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICBpZiAoIUpTT04ucGFyc2UoZGF0YSkuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgIGFkZENhc2VNb2RhbE9iai5maW5kKCcjYWRkQ2FzZUJ1dHRvbicpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7CiAgICAgICAgICAgICAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJy5hbGVydC1kYW5nZXInKS5yZW1vdmVDbGFzcygnaGlkZScpOwogICAgICAgICAgICAgICAgICAgIGFkZENhc2VNb2RhbE9iai5maW5kKCcuZXJyb3JNZXNzYWdlU3BhbicpLmh0bWwoSlNPTi5wYXJzZShkYXRhKS5tZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJy5hbGVydC1kYW5nZXInKS5hZGRDbGFzcygnaGlkZScpOwogICAgICAgICAgICAgICAgICAgIH0sIDUwMDApCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGFkZENhc2VNb2RhbE9iai5maW5kKCcjYWRkQ2FzZUJ1dHRvbicpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7CiAgICAgICAgICAgICAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJyNpbXBvcnRDYXNlc1NlY3Rpb24nKS5hdHRyKCdoaWRkZW4nLCAnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJzpmaWxlJykudmFsKCcnKS5wYXJlbnRzKCcuaW5wdXQtZ3JvdXAnKS5maW5kKCc6dGV4dCcpLnZhbCgnJyk7CiAgICAgICAgICAgICAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJyN2ZXJzaW9uTnVtYmVyLCAjY2FzZU51bWJlcicpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJykuc2libGluZ3MoJ2xhYmVsJykuZmluZCgnc3BhbicpLnNob3coKTsKICAgICAgICAgICAgICAgICAgICBhZGRDYXNlTW9kYWxPYmoubW9kYWwoJ2hpZGUnKTsKICAgICAgICAgICAgICAgICAgICByZWxvYWREYXRhKCIiLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBzaG93U3VjY2Vzc05vdGlmaWNhdGlvbihKU09OLnBhcnNlKGRhdGEpLm1lc3NhZ2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9OwoKICAgIGZ1bmN0aW9uIHNob3dTdWNjZXNzTm90aWZpY2F0aW9uKG1lc3NhZ2UpIHsKICAgICAgICAkKCIuYWxlcnQtc3VjY2VzcyIpLmFsZXJ0KCdjbG9zZScpOwogICAgICAgIGlmIChtZXNzYWdlICE9IHVuZGVmaW5lZCAmJiBtZXNzYWdlICE9ICIiKQogICAgICAgICAgICAkKCcjZGV0YWlsc1RhYicpLnByZXBlbmQoCiAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iYWxlcnQgYWxlcnQtc3VjY2VzcyBhbGVydC1kaXNtaXNzYWJsZSI+JyArCiAgICAgICAgICAgICAgICAnPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJjbG9zZSIgJyArCiAgICAgICAgICAgICAgICAnZGF0YS1kaXNtaXNzPSJhbGVydCIgYXJpYS1oaWRkZW49InRydWUiPicgKwogICAgICAgICAgICAgICAgJyZ0aW1lczsnICsKICAgICAgICAgICAgICAgICc8L2J1dHRvbj4nICsKICAgICAgICAgICAgICAgIG1lc3NhZ2UgKwogICAgICAgICAgICAgICAgJzwvZGl2PicKICAgICAgICAgICAgKTsKICAgIH0KCgogICAgdmFyIHJlbG9hZERhdGEgPSBmdW5jdGlvbiAocm93SWQsIHJlc2V0UGFnaW5hdGlvbikgewogICAgICAgIGlmIChyZXNldFBhZ2luYXRpb24gIT0gdHJ1ZSkgewogICAgICAgICAgICByZXNldFBhZ2luYXRpb24gPSBmYWxzZQogICAgICAgIH0KICAgICAgICB2YXIgZGF0YVRhYmxlID0gJCgiI2FsZXJ0c0RldGFpbHNUYWJsZSIpLkRhdGFUYWJsZSgpOwogICAgICAgIGRhdGFUYWJsZS5hamF4LnJlbG9hZChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGhpZ2hsaWdodFJvdyhyb3dJZCwgZGF0YVRhYmxlKTsKICAgICAgICB9LCByZXNldFBhZ2luYXRpb24pOwogICAgfTsKCiAgICB2YXIgaGlnaGxpZ2h0Um93ID0gZnVuY3Rpb24gKHJvd0lkLCBkYXRhVGFibGUpIHsKICAgICAgICBpZiAocm93SWQgIT0gdW5kZWZpbmVkICYmIHJvd0lkICE9ICIiKSB7CiAgICAgICAgICAgIGRhdGFUYWJsZS5yb3coJyMnICsgcm93SWQpLm5vZGVzKCkKICAgICAgICAgICAgICAgIC50byQoKQogICAgICAgICAgICAgICAgLmFkZENsYXNzKCdmbGFzaC1yb3cnKTsKICAgICAgICB9CiAgICB9OwoKCiAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnBvcHVsYXRlQ29sdW1uTGlzdChncmlkQ29sdW1uc1ZpZXdVcmwsIGdyaWRDb2x1bW5zVmlld1VwZGF0ZVVybCk7CiAgICAgICAgYWxlcnREZXRhaWxzVGFibGUgPSBpbml0QWxlcnREZXRhaWxzVGFibGUoKTsKCiAgICAgICAgJCgnaSNjb3B5U2VsZWN0aW9uJykuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICBzaG93QWxsU2VsZWN0ZWRDYXNlTnVtYmVycygpCiAgICAgICAgfSk7CgogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdpbnB1dCNzZWxlY3QtYWxsJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAkKCIuY29weS1zZWxlY3QiKS5wcm9wKCdjaGVja2VkJywgdGhpcy5jaGVja2VkKTsKICAgICAgICB9KTsKCiAgICAgICAgaW5pdFVwZGF0ZUFzc2lnbmVkVG8oKQoKICAgIH07CgogICAgaW5pdCgpOwoKICAgICQoJyNleHBvcnRUeXBlcyBhW2hyZWZdJykuY2xpY2soZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgY2xpY2tlZFVSTCA9IGUuY3VycmVudFRhcmdldC5ocmVmOwogICAgICAgIHZhciB1cGRhdGVkRXhwb3J0VXJsID0gY2xpY2tlZFVSTDsKICAgICAgICB2YXIgaWRzID0gW107CiAgICAgICAgJCgnLmFsZXJ0LWNoZWNrLWJveCcpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoJCh0aGlzKVswXVsnY2hlY2tlZCddKSB7CiAgICAgICAgICAgICAgICBpZHMucHVzaCgkKHRoaXMpLmF0dHIoJ2RhdGEtaWQnKSkKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgY2hlY2tlZENvbHVtbnMgPSB7fTsKICAgICAgICAkKCcjdGFibGVDb2x1bW5zIHRyICcpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgZmllbGROYW1lID0gJCh0aGlzKS5jaGlsZHJlbigpLmNoaWxkcmVuKCkuYXR0cignZGF0YS1maWVsZCcpOwogICAgICAgICAgICBpZiAoZmllbGROYW1lKSB7CiAgICAgICAgICAgICAgICBjaGVja2VkQ29sdW1uc1tmaWVsZE5hbWVdID0gJCh0aGlzKS5jaGlsZHJlbigpWzFdLmZpcnN0Q2hpbGQuY2hlY2tlZAogICAgICAgICAgICB9CiAgICAgICAgfSk7CgoKICAgICAgICBpZiAoaWRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdXBkYXRlZEV4cG9ydFVybCA9IGNsaWNrZWRVUkwgKyAiJnNlbGVjdGVkQ2FzZXM9IiArIGlkcyArICImdmlld0lkPSIgKyB2aWV3SWQ7CiAgICAgICAgfQogICAgICAgIGVsc2UgewoKICAgICAgICAgICAgdmFyIHByZWZpeCA9ICJzY2FfIjsKICAgICAgICAgICAgdmFyIGlzRmlsdGVyUmVxdWVzdCA9IHRydWU7CiAgICAgICAgICAgIHZhciBmaWx0ZXJWYWx1ZXMgPSBbXTsKICAgICAgICAgICAgaWYgKHdpbmRvdy5zZXNzaW9uU3RvcmFnZSkgewogICAgICAgICAgICAgICAgaWYgKHNpZ25hbC5hbGVydFJldmlldy5pc0FsZXJ0UGVyc2lzdGVkSW5TZXNzaW9uU3RvcmFnZShwcmVmaXgpKSB7CiAgICAgICAgICAgICAgICAgICAgZmlsdGVyVmFsdWVzID0gSlNPTi5wYXJzZShzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKHByZWZpeCArICJmaWx0ZXJzX3ZhbHVlIikpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzaWduYWwuYWxlcnRSZXZpZXcucmVtb3ZlRmlsdGVyc0Zyb21TZXNzaW9uU3RvcmFnZShwcmVmaXgpOwogICAgICAgICAgICAgICAgICAgIGlzRmlsdGVyUmVxdWVzdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgZmlsdGVyTGlzdCA9IHt9OwogICAgICAgICAgICAkKCIueWFkY2YtZmlsdGVyLXdyYXBwZXIiKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJWYWwgPSAkKHRoaXMpLmNoaWxkcmVuKCkudmFsKCk7CiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyVmFsKSB7CiAgICAgICAgICAgICAgICAgICAgZmlsdGVyTGlzdFskKHRoaXMpLnByZXYoKS5hdHRyKCdkYXRhLWZpZWxkJyldID0gZmlsdGVyVmFsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgZmlsdGVyTGlzdEpzb24gPSBKU09OLnN0cmluZ2lmeShmaWx0ZXJMaXN0KTsKICAgICAgICAgICAgdXBkYXRlZEV4cG9ydFVybCA9IGNsaWNrZWRVUkwgKyAnJmlzRmlsdGVyUmVxdWVzdD0nICsgaXNGaWx0ZXJSZXF1ZXN0ICsgJyZmaWx0ZXJzPScgKyBKU09OLnN0cmluZ2lmeShmaWx0ZXJWYWx1ZXMpICsgIiZ2aWV3SWQ9IiArIHZpZXdJZCArICImZmlsdGVyTGlzdD0iICsgZW5jb2RlVVJJKGZpbHRlckxpc3RKc29uKSArICImaXNGYWVycz0iICsgJCgnI2lzRmFlcnMnKS52YWwoKTsKICAgICAgICAgICAgaWYgKCQoJyNhZHZhbmNlZC1maWx0ZXInKS52YWwoKSkgewogICAgICAgICAgICAgICAgdXBkYXRlZEV4cG9ydFVybCArPSAiJmFkdmFuY2VkRmlsdGVySWQ9IiArICQoJyNhZHZhbmNlZC1maWx0ZXInKS52YWwoKQogICAgICAgICAgICB9CgogICAgICAgIH0KICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHVwZGF0ZWRFeHBvcnRVcmw7CiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICB9KTsKCiAgICAkKCIuZXhwb3J0Q2FzZUhpc3RvcnkiKS5jbGljayhmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciBjYXNlSGlzdG9yeU1vZGFsID0gJCgnI2Nhc2VIaXN0b3J5TW9kYWwnKTsKICAgICAgICB2YXIgY2FzZVZhbCA9IGNhc2VIaXN0b3J5TW9kYWwuZmluZCgiI2Nhc2VOdW1iZXIiKS5odG1sKCk7CiAgICAgICAgdmFyIHByb2R1Y3RGYW1pbHkgPSBjYXNlSGlzdG9yeU1vZGFsLmZpbmQoIiNwcm9kdWN0RmFtaWx5IikuaHRtbCgpOwogICAgICAgIHZhciBhbGVydENvbmZpZ0lkID0gY2FzZUhpc3RvcnlNb2RhbC5maW5kKCIjYWxlcnRDb25maWdJZCIpLnZhbCgpOwogICAgICAgIHZhciBjYXNlVmVyc2lvbiA9IGNhc2VIaXN0b3J5TW9kYWwuZmluZCgiI2Nhc2VWZXJzaW9uIikudmFsKCk7CiAgICAgICAgdmFyIHNlbGVjdGVkQ2FzZSA9IGUuY3VycmVudFRhcmdldC5ocmVmICsgIiZjYXNlTnVtYmVyPSIgKyBjYXNlVmFsICsgIiZwcm9kdWN0RmFtaWx5PSIgKyBwcm9kdWN0RmFtaWx5ICsgIiZhbGVydENvbmZpZ0lkPSIgKyBhbGVydENvbmZpZ0lkICsgIiZjYXNlVmVyc2lvbj0iICsgY2FzZVZlcnNpb247CiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBzZWxlY3RlZENhc2U7CiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICB9KTsKCiAgICAkKCIjYWxlcnRzRGV0YWlsc1RhYmxlX2ZpbHRlciIpLmhpZGUoKTsKCgogICAgJCgnLnNhdmVDYXNlcycpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAkKCIjc2hvd0NvbmZpZ05hbWVNb2RhbCIpLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgJCgiI3NhdmUtY2FzZXMtYnRuIikub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAkKCcjc2F2ZS1jYXNlcy1idG4sICNjYW5jZWwtYnRuJykuYXR0cigiZGlzYWJsZWQiLCAiZGlzYWJsZWQiKTsKICAgICAgICAgICAgdmFyIHNhdmVTY2FDYXNlc1VybCA9IHNhdmVDYXNlc1VybCArICImY29uZmlnTmFtZT0iICsgJCgnI2NvbmZpZ05hbWUnKS52YWwoKTsKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDogc2F2ZVNjYUNhc2VzVXJsLAogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWxlcnRNZXNzYWdlJykuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNzYXZlLWNhc2VzLWJ0biwgI2NhbmNlbC1idG4nKS5yZW1vdmVBdHRyKCJkaXNhYmxlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NvbmZpZ05hbWUnKS52YWwoJycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3Nob3dDb25maWdOYW1lTW9kYWwnKS5tb2RhbCgnaGlkZScpOwogICAgICAgICAgICAgICAgICAgICAgICB9LCAyMDAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCkKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkKCcjZXJyb3JNZXNzYWdlJykuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNzYXZlLWNhc2VzLWJ0biwgI2NhbmNlbC1idG4nKS5yZW1vdmVBdHRyKCJkaXNhYmxlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NvbmZpZ05hbWUnKS52YWwoJycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2Vycm9yTWVzc2FnZScpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTAwMCk7CgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9KQogICAgfSk7CgogICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJyNkZXRhaWxlZC12aWV3LWNoZWNrYm94JywgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7CiAgICAgICAgdmFyIHJlbG9hZFVybCA9ICR0aGlzLmRhdGEoJ3VybCcpICsgJz9jYWxsaW5nU2NyZWVuPScgKyAkdGhpcy5kYXRhKCdjYWxsaW5nU2NyZWVuJykgKyAnJmNvbmZpZ0lkPScgKyAkdGhpcy5kYXRhKCdjb25maWdJZCcpICsgIiZ2aWV3SWQ9IiArIHZpZXdJZCArICcmaXNDYXNlRGV0YWlsVmlldz0nICsgJHRoaXMuZGF0YSgnaXNDYXNlRGV0YWlsVmlldycpOwogICAgICAgIGlmICgkKCIjaXNGYWVycyIpLnZhbCgpKSB7CiAgICAgICAgICAgIHJlbG9hZFVybCArPSAnJmlzRmFlcnM9JyArICQoIiNpc0ZhZXJzIikudmFsKCk7CiAgICAgICAgfQogICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcmVsb2FkVXJsCgogICAgfSk7CgogICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5zY2FDYXNlTnVtYmVyJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdmFyIHNjYUFsZXJ0SWQgPSAkKHRoaXMpLmZpbmQoInNwYW5bZGF0YS1maWVsZD1hbGVydElkXSIpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICB2YXIgY2FzZVZlcnNpb24gPSAkKHRoaXMpLmZpbmQoInNwYW5bZGF0YS1maWVsZD1jYXNlVmVyc2lvbl0iKS5hdHRyKCJkYXRhLWlkIik7CiAgICAgICAgdmFyIGNhc2VOdW1iZXIgPSAkKHRoaXMpLmZpbmQoInNwYW5bZGF0YS1maWVsZD1jYXNlTnVtYmVyXSIpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICB2YXIgZXhlY0NvbmZpZ0lkID0gJCh0aGlzKS5maW5kKCJzcGFuW2RhdGEtZmllbGQ9ZXhlY0NvbmZpZ0lkXSIpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICAkLmFqYXgoewogICAgICAgICAgICB1cmw6IHVwZGF0ZUF1dG9Sb3V0ZURpc3Bvc2l0aW9uVXJsLAogICAgICAgICAgICBkYXRhOiB7J2lkJzogc2NhQWxlcnRJZH0sCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICAgICAgYWxlcnREZXRhaWxzVGFibGUuYWpheC5yZWxvYWQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNpZ25hbC51dGlscy5wb3N0VXJsKGNhc2VEZXRhaWxVcmwsIHsKICAgICAgICAgICAgICAgICAgICBjYXNlTnVtYmVyOiBjYXNlTnVtYmVyLAogICAgICAgICAgICAgICAgICAgIHZlcnNpb246IGNhc2VWZXJzaW9uLAogICAgICAgICAgICAgICAgICAgIGZvbGxvd1VwTnVtYmVyOiBudWxsLAogICAgICAgICAgICAgICAgICAgIGFsZXJ0SWQ6IHNjYUFsZXJ0SWQsCiAgICAgICAgICAgICAgICAgICAgaXNGYWVyczogJCgiI2lzRmFlcnMiKS52YWwoKSwKICAgICAgICAgICAgICAgICAgICBmdWxsQ2FzZUxpc3Q6ICQoIiNmdWxsQ2FzZUxpc3QiKS52YWwoKSwKICAgICAgICAgICAgICAgICAgICBleGVjQ29uZmlnSWQgOiBleGVjQ29uZmlnSWQsCiAgICAgICAgICAgICAgICAgICAgdG90YWxDb3VudCA6IHRhYmxlLnBhZ2UuaW5mbygpLnJlY29yZHNUb3RhbCwKICAgICAgICAgICAgICAgICAgICBkZXRhaWxzUGFyYW1ldGVyczogSlNPTi5zdHJpbmdpZnkoZGV0YWlsc1BhcmFtZXRlcnMpCiAgICAgICAgICAgICAgICB9LCB0cnVlKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlNvbWUgZXJyb3Igb2NjdXJlZCB3aGlsZSB1cGRhdGluZyBBdXRvUm91dGUgRGlzcG9zaXRpb24iKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSk7CgogICAgcmVnaXN0ZXJVbnNlbGVjdEV2ZW50Rm9yQ2FzZVNlcmllc1RhZygpOwogICAgcmVnaXN0ZXJVbnNlbGVjdEV2ZW50Rm9yR2xvYmFsVGFnKCk7CiAgICByZWdpc3RlclNlbGVjdEV2ZW50Rm9yQ2FzZVNlcmllc1RhZygpOwogICAgcmVnaXN0ZXJTZWxlY3RFdmVudEZvckdsb2JhbFRhZygpOwogICAgJCgnI2FsZXJ0VGFnTW9kYWwnKS5vbignc2hvd24uYnMubW9kYWwnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGFnc09iai5hZGRlZENhc2VTZXJpZXNUYWdzID0gW107CiAgICAgICAgdGFnc09iai5hZGRlZEdsb2JhbFRhZ3MgPSBbXTsKICAgICAgICB0YWdzT2JqLmRlbGV0ZWRDYXNlU2VyaWVzVGFncyA9IFtdOwogICAgICAgIHRhZ3NPYmouZGVsZXRlZEdsb2JhbFRhZ3MgPSBbXTsKICAgIH0pCn0pOwoKdmFyIGZvcm1hdCA9IGZ1bmN0aW9uIChkLCBjbGFzc05hbWUpIHsKICAgIHZhciBwcm9kdWN0TGlzdCA9IGQucHJvZHVjdExpc3Q7CiAgICB2YXIgcHJvZHVjdEFycmF5ID0gcHJvZHVjdExpc3Quc3BsaXQoJywnKTsKICAgIHZhciBwdEFycmF5ID0gZC5wdExpc3Quc3BsaXQoJyFAIyNAIScpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9kdWN0QXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAocHJvZHVjdEFycmF5W2ldID09IGQucHJvZHVjdE5hbWUpIHsKICAgICAgICAgICAgcHJvZHVjdEFycmF5W2ldID0gcHJvZHVjdEFycmF5W2ldICsgIiAoUHJpbWFyeSkiCiAgICAgICAgfQogICAgfQogICAgdmFyIHJlc3VsdGVkT2JqID0gewogICAgICAgIHByb2R1Y3RMaXN0OiBwcm9kdWN0QXJyYXkuam9pbignLCcpLAogICAgICAgIHB0TGlzdDogcHRBcnJheSwKICAgICAgICBjYXNlTmFycmF0aXZlOiBkLmNhc2VOYXJyYXRpdmUsCiAgICAgICAgY29uTWVkczogcmVtb3ZlTGluZUJyZWFrKGQuY29uTWVkcyksCiAgICAgICAgbWVkRXJyb3JzUHQgOiBkLm1lZEVycm9yc1B0CiAgICB9OwogICAgaHRtbCA9IHNpZ25hbC51dGlscy5yZW5kZXIoImNhc2VfZGV0YWlsc19jaGlsZF92aWV3IiwgcmVzdWx0ZWRPYmopOwogICAgcmV0dXJuIGh0bWw7Cn07CgpmdW5jdGlvbiBzaG93Q2FzZURldGFpbHNWaWV3KCkgewogICAgJCgidHIuZGF0YS10YWJsZS1yb3ciKS5lYWNoKGZ1bmN0aW9uIChpbmRleCkgewogICAgICAgIHZhciB0ciA9ICQodGhpcyk7CiAgICAgICAgdmFyIHJvdyA9IHdpbmRvdy5zY2FfZGF0YV90YWJsZS5yb3codHIpOwogICAgICAgIHZhciBjbGFzc05hbWUgPSAkKHRoaXMpLmhhc0NsYXNzKCdvZGQnKSA/ICdvZGQnIDogJ2V2ZW4nOwogICAgICAgIHJvdy5jaGlsZChmb3JtYXQocm93LmRhdGEoKSksIGNsYXNzTmFtZSkuc2hvdygpOwogICAgfSk7Cn0KCmZ1bmN0aW9uIHJlZ2lzdGVyVW5zZWxlY3RFdmVudEZvckNhc2VTZXJpZXNUYWcoKSB7CiAgICAkKGRvY3VtZW50KS5vbigic2VsZWN0Mjp1bnNlbGVjdCIsICcjc2luZ2xlQWxlcnRUYWdzJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdGFnID0gZS5wYXJhbXMuZGF0YS50ZXh0OwogICAgICAgIGlmICghdGFnc09iai5kZWxldGVkQ2FzZVNlcmllc1RhZ3MuaW5jbHVkZXModGFnKSkgewogICAgICAgICAgICB0YWdzT2JqLmRlbGV0ZWRDYXNlU2VyaWVzVGFncy5wdXNoKHRhZyk7CiAgICAgICAgICAgIHRhZ3NPYmouYWRkZWRDYXNlU2VyaWVzVGFncyA9IHRhZ3NPYmouYWRkZWRDYXNlU2VyaWVzVGFncy5yZW1vdmUodGFnKTsKICAgICAgICB9CiAgICB9KTsKfQoKZnVuY3Rpb24gcmVnaXN0ZXJVbnNlbGVjdEV2ZW50Rm9yR2xvYmFsVGFnKCkgewogICAgJChkb2N1bWVudCkub24oInNlbGVjdDI6dW5zZWxlY3QiLCAnI2dsb2JhbFRhZ3MnLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0YWcgPSBlLnBhcmFtcy5kYXRhLnRleHQ7CiAgICAgICAgaWYgKCF0YWdzT2JqLmRlbGV0ZWRHbG9iYWxUYWdzLmluY2x1ZGVzKHRhZykpIHsKICAgICAgICAgICAgdGFnc09iai5kZWxldGVkR2xvYmFsVGFncy5wdXNoKHRhZyk7CiAgICAgICAgICAgIHRhZ3NPYmouYWRkZWRHbG9iYWxUYWdzID0gdGFnc09iai5hZGRlZEdsb2JhbFRhZ3MucmVtb3ZlKHRhZyk7CiAgICAgICAgfQogICAgfSk7Cn0KCmZ1bmN0aW9uIHJlZ2lzdGVyU2VsZWN0RXZlbnRGb3JDYXNlU2VyaWVzVGFnKCkgewogICAgJChkb2N1bWVudCkub24oInNlbGVjdDI6c2VsZWN0aW5nIiwgJyNzaW5nbGVBbGVydFRhZ3MnLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0YWcgPSBlLnBhcmFtcy5hcmdzLmRhdGEuaWQ7CiAgICAgICAgaWYgKCF0YWdzT2JqLmFkZGVkQ2FzZVNlcmllc1RhZ3MuaW5jbHVkZXModGFnKSkgewogICAgICAgICAgICB0YWdzT2JqLmFkZGVkQ2FzZVNlcmllc1RhZ3MucHVzaCh0YWcpOwogICAgICAgICAgICB0YWdzT2JqLmRlbGV0ZWRDYXNlU2VyaWVzVGFncyA9IHRhZ3NPYmouZGVsZXRlZENhc2VTZXJpZXNUYWdzLnJlbW92ZSh0YWcpOwogICAgICAgIH0KICAgIH0pOwp9CgpmdW5jdGlvbiByZWdpc3RlclNlbGVjdEV2ZW50Rm9yR2xvYmFsVGFnKCkgewogICAgJChkb2N1bWVudCkub24oInNlbGVjdDI6c2VsZWN0aW5nIiwgJyNnbG9iYWxUYWdzJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdGFnID0gZS5wYXJhbXMuYXJncy5kYXRhLmlkOwogICAgICAgIGlmICghdGFnc09iai5hZGRlZEdsb2JhbFRhZ3MuaW5jbHVkZXModGFnKSkgewogICAgICAgICAgICB0YWdzT2JqLmFkZGVkR2xvYmFsVGFncy5wdXNoKHRhZyk7CiAgICAgICAgICAgIHRhZ3NPYmouZGVsZXRlZEdsb2JhbFRhZ3MgPSB0YWdzT2JqLmRlbGV0ZWRHbG9iYWxUYWdzLnJlbW92ZSh0YWcpOwogICAgICAgIH0KICAgIH0pOwp9CgokKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnNpZ25hbFN1bW1hcnlBdXRoJywgZnVuY3Rpb24gKGV2dCkgewogICAgJC5Ob3RpZmljYXRpb24ubm90aWZ5KCd3YXJuaW5nJywndG9wIHJpZ2h0JywgIldhcm5pbmciLCAiWW91IGRvbid0IGhhdmUgYWNjZXNzIHRvIHZpZXcgc2lnbmFsIHN1bW1hcnkiLCB7YXV0b0hpZGVEZWxheTogMjAwMH0pOwp9KTsKCnZhciBmZXRjaFRhZ3MgPSBmdW5jdGlvbiAoKSB7CiAgICAkLmFqYXgoewogICAgICAgIHVybDogZmV0Y2hDb21tb25UYWdzVXJsLAogICAgICAgIGFzeW5jOmZhbHNlLAogICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgcmVzdWx0LmNvbW1vblRhZ0xpc3QuZm9yRWFjaChmdW5jdGlvbihtYXApewogICAgICAgICAgICAgICAgdGFncy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBpZDogbWFwLmlkLAogICAgICAgICAgICAgICAgICAgIHRleHQ6IG1hcC50ZXh0LAogICAgICAgICAgICAgICAgICAgIHBhcmVudElkOiBtYXAucGFyZW50SWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9KTsKfTsKCg==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
      <TcpPackets>
        <PacketInfo time="89394109" offset="0" length="4096" />
        <PacketInfo time="89394125" offset="4096" length="16384" />
        <PacketInfo time="89394125" offset="20480" length="16384" />
        <PacketInfo time="89394250" offset="36864" length="3222" />
      </TcpPackets>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>