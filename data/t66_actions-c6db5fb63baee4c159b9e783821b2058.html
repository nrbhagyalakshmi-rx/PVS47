var signal=signal||{};
signal.actions_utils=function(){var n,p,g,q=function(a){return{config:a.find("#config").val(),type:a.find("#type").val(),assignedToValue:a.find("#assignedTo").val(),dueDate:a.find("#dueDate").val(),details:a.find("#details").val(),comments:a.find("#comments").val(),alertId:a.find("#alertId").val(),appType:a.find("#appType").val(),exeConfigId:a.find("#exeConfigId").val(),meetingId:a.find("#meetingElement").val(),actionStatus:a.find("#actionStatus").val(),actionId:a.find("#actionId").val()}},h=function(){$("#createActionModal .modal-body .alert").remove()},
k=function(){$("#action-edit-modal .modal-body .alert").remove()},r=function(){$("#editActionModal .modal-body .alert").remove()},t=function(a,b){var e=b.typeObj.id,d=b.meetingId,f=new Option(b.assignedToObj.fullName,b.assignedToObj.id,!0,!0);a.find("#assignedTo").append(f).trigger("change");d?(a.find("#meetingElement").val(d),a.find("#meetingValue").val(d)):a.find("#type").val(e);a.find(".status-icon").removeClass("hidden");a.find("#config").val(b.configObj.id);a.find("#actionId").val(b.id);e=moment(b.dueDate,
DEFAULT_DATE_FORMAT).format(DEFAULT_DATE_FORMAT);a.find("#due-date-picker").datepicker({date:$("#due-date-picker").val()?new Date($("#due-date-picker").val()):null,momentConfig:{culture:userLocale,format:DEFAULT_DATE_DISPLAY_FORMAT}}).keypress(preventEnterKeySubmit);a.find("#dueDate").val(e);a.find("#comments").val(b.comments);a.find("#details").val(b.details);a.find("#actionStatus").val(b.actionStatus);a.find(".action-value").trigger("change")},l=function(a){a.preventDefault();$("#action-table").DataTable().ajax.reload();
$("#action-edit-modal").modal("hide")},m=function(a){a.preventDefault();a.handled||(a.handled=!0,a=$("#action-editor-container form#action-editor-form").serialize()+"&appType="+$("#appType").val()+"&exeConfigId="+$("#exeConfigId").val(),$.ajax({url:"/signal/action/updateAction",method:"POST",data:a,async:!1,cache:!1,success:function(a){if(0==a.status){k();for(var e="<div class='alert alert-danger'>",d=0;d<a.data.length;d++)e+=a.data[d],e+="</br>";e+="</div>";$("#action-edit-modal .modal-body").prepend(e)}else $("#action-table").DataTable().ajax.reload(),
"undefined"!=typeof applicationLabel&&applicationLabel!==APPLICATION_LABEL.CASE_DETAIL&&applicationLabel!==APPLICATION_LABEL.EVENT_DETAIL&&signal.activities_utils.reload_activity_table(),$("#action-edit-modal").modal("hide")}}))};return{set_action_list_modal:function(a){$(document).on("click",".list-action",function(b){b.preventDefault();a.modal("toggle",$(this))});a.on("shown.bs.modal",function(a){var e=$(a.relatedTarget).attr("data-id"),d=$("#createActionModal #tempForm").find("#appType").val();
a="/signal/action/listByAlert?alertId="+e+"&appType="+d;n=$("#action-table").DataTable({destroy:!0,language:{url:"../assets/i18n/dataTables_"+userLocale+".json"},fnDrawCallback:function(){$(".edit-action-link").click(function(a){a="/signal/action/getById?id="+$(this).attr("data-id");$.ajax({url:a,async:!1,cache:!1}).done(function(a){a.action_types=action_select_values.types;a.action_configs=action_select_values.configs;a.all_status=action_select_values.allStatus;a.alertId=e;a.actionStatus={name:a.actionStatus};
var f=signal.utils.render("action_editor",a);$("#action-editor-container").html(f);$("#action-editor-container #due-date-picker").datepicker({date:a.dueDate}).keydown(preventEnterKeySubmit);a=moment(a.dueDate,"DD-MMM-YYYY").format(DEFAULT_DATE_FORMAT);$("#action-editor-container").find("#due-date-picker").find("#dueDate").val(a);$("#action-editor-container").find("#appType").val(d);$("#action-editor-container");a=$("#action-edit-modal");a.find(".id-element").attr("data-id",e);a.find(".assignedToValue").val(null).trigger("change");
$("#action-modal").modal("hide");a.modal({});$("#action-edit-modal #cancel-bt").click(l);$("#action-edit-modal #update-bt").click(m)})})},fnInitComplete:function(a,c){$(".action-create").attr("data-id",e);signal.actions_utils.set_action_create_modal();$("#due-date-picker").datepicker()},ajax:{url:a,cache:!1,dataSrc:""},searching:!0,bProcessing:!0,bLengthChange:!0,oLanguage:{sProcessing:'<div class="grid-loading"><img src="/signal/assets/spinner.gif" width="30" align="middle" /></div>'},iDisplayLength:5,
aLengthMenu:[[5,10,20,-1],[5,10,20,"All"]],aoColumns:[{mData:"id",mRender:function(a,c,d){return"<a href='#' class='edit-action-link' data-id='"+d.id+"'>"+d.id+"<a>"}},{mData:"type"},{mData:"config"},{mData:"details",className:"col-min-200"},{mData:"dueDate",className:"col-min-100"},{mData:"assignedTo",className:"col-min-100"},{mData:"actionStatus"},{mData:"completedDate",className:"col-min-150",mRender:function(a,c,d){return d.completedDate}}],scrollX:!0,columnDefs:[{targets:"_all",render:$.fn.dataTable.render.text()}]})});
a.on("hidden.bs.modal",function(b){a.find("#action-table").empty()});return n},set_action_create_modal:function(){$("#createActionModal").on("hidden.bs.modal",function(a){$(this).find("#config").val("").end().find("#type").val("").end().find("#meetingElement").val("").end().find(".assignedToValue").val("").trigger("change").end().find(".assignedToValue").empty().end().find("input[type=text],textarea").val("").end();$("#createActionModal .select2-selection__rendered").hover(function(){$(this).removeAttr("title")})});
$("#action-edit-modal").on("hidden.bs.modal",function(a){k();$(this).find("input[type=text],textarea,select").val("").end()});$("#editActionModal").on("hidden.bs.modal",function(a){r();$(this).find("input[type=text],textarea,select").val("").end()});$(document).on("click",".action-create",function(a){p=a=$(a.target);var b=b;"undefined"!==typeof a.attr("alert-id")&&(b=a.attr("alert-id"));var e=$("#createActionModal"),d=$("#create-action-btn");e.find(".id-element").attr("data-id",b);"undefined"!=typeof b&&
""!=b&&e.find(".alertId").val(b);e.find("#due-date-picker").datepicker();d.attr("disabled",!1);h();$(".action-type-list").removeClass("hidden");$(".meeting-list").addClass("hidden");e.modal({});d.unbind("click").click(function(a){d.attr("disabled",!0);var c=$(a.target).attr("data-id");a=$("#createActionModal #tempForm");$.ajax({type:"POST",url:"/signal/action/save",data:q(a),async:!1,cache:!1}).success(function(a){if(0==a.status){h();for(var b="<div class='alert alert-danger'>",f=0;f<a.data.length;f++)b+=
a.data[f],b+="</br>";b+="</div>";$("#createActionModal .modal-body").prepend(b);d.attr("disabled",!1)}else e.modal("hide"),p.parentsUntil("td").find(".default-value").html(a.actionCount),"undefined"!=typeof applicationLabel&&"Case Detail"===applicationLabel?$("#action-table").DataTable().ajax.reload():"undefined"!=typeof c&&""!=c?"undefined"!=typeof detail_table&&detail_table.ajax.reload():($("#action-table").DataTable().ajax.reload(),$("#meeting-table").DataTable().ajax.reload(),$("#signalActivityTable").DataTable().ajax.reload()),
"undefined"!=typeof applicationLabel&&applicationLabel!==APPLICATION_LABEL.CASE_DETAIL&&applicationLabel!==APPLICATION_LABEL.EVENT_DETAIL&&(signal.activities_utils.reload_activity_table(),applicationLabel==APPLICATION_LABEL.SIGNAL_MANAGEMENT&&signal.meeting_utils.reload_meeting_table())}).error(function(a){h();$("#createActionModal .modal-body").prepend("<div class='alert alert-danger'>Error occured while saving Action.</div>");d.attr("disabled",!1)})})})},build_action_render:function(a){return signal.utils.render("action_drop_down",
a)},init_action_table:function(a,b){var e="/signal/action/listByAlert?alertId="+alertId+"&appType="+b;g=$(a).DataTable({language:{url:"../assets/i18n/dataTables_"+userLocale+".json"},fnDrawCallback:function(){$(".edit-action-link").click(function(a){a="/signal/action/getById?id="+$(this).attr("data-id");$.ajax({url:a,async:!1,cache:!1}).done(function(a){if("Signal Management"==b||"Topic"==b){var c=$("#editActionModal");t(c,a);c.modal({});c.find(".update-action").unbind().click(function(){var a=$("#editActionModal #tempForm"),
d;d="true"==$(".meeting-decider").val()?"/signal/action/updateMeetingAction":"/signal/action/updateAction";$.ajax({url:d,method:"POST",data:q(a),async:!1,cache:!1,success:function(a){if(0==a.status){r();for(var d="<div class='alert alert-danger'>",b=0;b<a.data.length;b++)d+=a.data[b],d+="</br>";d+="</div>";$("#editActionModal .modal-body").prepend(d)}else $("#action-table").DataTable().ajax.reload(),$("#meeting-table").DataTable().ajax.reload(),"undefined"!=typeof applicationLabel&&applicationLabel!==
APPLICATION_LABEL.CASE_DETAIL&&applicationLabel!==APPLICATION_LABEL.EVENT_DETAIL&&signal.activities_utils.reload_activity_table(),c.modal("hide")}})})}else{a.action_types=action_select_values.types;a.action_configs=action_select_values.configs;a.all_status=action_select_values.allStatus;a.alertId=alertId;a.actionStatus={name:a.actionStatus};var d=signal.utils.render("action_editor",a),e=$("#action-editor-container");e.html(d);$("#action-editor-container #due-date-picker").datepicker({date:a.dueDate,
momentConfig:{culture:userLocale,tz:userTimeZone,format:DEFAULT_DATE_DISPLAY_FORMAT}}).keydown(preventEnterKeySubmit);e.find("#due-date-picker").find("#dueDate").val(a.dueDate);e.find("#due-date-picker").datepicker();c=$("#action-edit-modal");c.find(".id-element").attr("data-id",alertId);c.modal({});$("#action-editor-container").find("#appType").val(b);$("#action-edit-modal #cancel-bt").click(l);$("#action-edit-modal #update-bt").click(m)}})})},fnInitComplete:function(a,b){$(".action-create").attr("data-id",
alertId);signal.actions_utils.set_action_create_modal();$("#due-date-picker").datepicker()},ajax:{url:e,cache:!1,dataSrc:""},searching:!0,dom:"Bfrtip",buttons:[{text:"New Action",className:"btn-primary action-create",action:function(a,b,c,e){}}],aaSorting:[[0,"desc"]],bLengthChange:!0,iDisplayLength:10,aLengthMenu:[[10,20,50,-1],[10,20,50,"All"]],aoColumns:[{mData:"id",mRender:function(a,b,c){return"<a href='#' class='edit-action-link' data-id='"+c.id+"'>"+c.id+"<a>"},className:""},{mData:"type",
className:"",mRender:function(a,b,c){return"<span class='word-wrap-break-word'>"+escapeHTML(c.type)+"</span>"}},{mData:"config",className:"",mRender:function(a,b,c){return"<span class='word-wrap-break-word'>"+escapeHTML(c.config)+"</span>"}},{mData:"details",className:"",mRender:function(a,b,c){return"<span class='word-wrap-break-word'>"+escapeHTML(c.details)+"</span>"}},{mData:"dueDate",className:"col-min-100",mRender:function(a,b,c){return"Closed"===c.actionStatus&&"Deleted"===c.actionStatus||!c.passDue?
"<div>"+c.dueDate+"</div>":"<div class='closed'>"+c.dueDate+"</div>"}},{mData:"assignedTo",mRender:function(a,b,c){return escapeHTML(c.assignedTo)},className:"col-min-150"},{mData:"",mRender:function(a,b,c){return c.actionStatus},className:""},{mData:"completedDate",mRender:function(a,b,c){return c.completedDate},className:"col-min-150"}],scrollX:!0});g.button().disable();return g},reload_action_table:function(){"undefined"!=typeof g&&null!=g?g.ajax.reload():console.log("Unable to reload the activity table. Please refresh the page.")},
handle_action_editor_cancel:l,handle_action_editor_update:m,clear_edit_errors:k}}();