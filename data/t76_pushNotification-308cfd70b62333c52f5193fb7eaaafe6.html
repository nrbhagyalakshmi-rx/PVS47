var $notificationContainer,notificationCount=0,$notificationRows,$notificationHeader,$inboxMsgMaxCount=100,N_LEVEL_INFO_NAME="Information",N_LEVEL_WARN_NAME="Warning",N_LEVEL_ERROR_NAME="Error";
$(document).ready(function(){startPoller();connect();var a,b;$notificationContainer=$("#notificationContainer");$notificationRows=$("#notificationRows");$notificationHeader=$("#notificationHeader");$(document).on("click","#menuNotification",function(){$notificationContainer.is(":visible")?$notificationContainer.hide():$notificationContainer.show()});$(document).on("click","#notificationContainer",function(){event.stopPropagation();event.preventDefault();return!1});$(document).on("click","#clearNotifications",
function(){0<notificationCount&&($.post(notificationMarkAsReadByUserURL,{id:this.getAttribute("userId")},function(a){},"text"),$notificationRows.empty(),setNotificationCount(0));event.stopPropagation();return!1});$(window).blur(function(a){startPoller()});$(document).on("click","#notificationRows span a",function(){a=$(this).closest("span");b=a.attr("notificationId");var g=a.attr("executedConfigId"),c=a.attr("detailUrl"),e=a.attr("type");window.location.href=0!=g&&"null"!=g?c in detailUrls?detailUrls[c]+
"?callingScreen=review&configId="+g:"#":e===REPORT_GENERATED&&c?c:e===ANALYSIS_REPORT_GENERATED&&c?c:"#";d()});$(document).on("click",".removeNotification",function(){a=$(this).closest("span");b=a.attr("notificationId");d()});var d=function(){$.post(notificationMarkAsReadURL,{id:b},function(b){b&&(a.hide(),--notificationCount,setNotificationCount(notificationCount),event.stopPropagation())})}});function startPoller(){pollAJAX()}
function connect(){var a=new SockJS(socketURL),b=Stomp.over(a),d=NOTIFICATION_QUEUE+userId;b.connect("","",function(){b.subscribe(d,function(a){a=JSON.parse(a.body);addNotification($notificationRows,a);notificationCount+=1;setNotificationCount(notificationCount)})})}
function pollAJAX(){$.ajax({cache:!1,url:notificationURL,success:function(a){$notificationRows.empty();a.sort(function(a,d){return(new Date(d.createdOn)).getTime()-(new Date(a.createdOn)).getTime()});0<a.length&&$.each(a,function(){addNotification($notificationRows,this)});setNotificationCount(a.length)}})}
function addNotification(a,b){var d=document.createElement("span");d.setAttribute("id","notif");d.setAttribute("tabindex","0");d.classList.add("list-group-item");d.style.padding="12px 20px 1px 20px";d.setAttribute("notificationId",b.id);d.setAttribute("executedConfigId",b.executedConfigId);d.setAttribute("detailUrl",b.detailUrl);d.setAttribute("type",b.type);var g=document.createElement("div");g.classList.add("pull-left","p-r-10");var c=document.createElement("em");c.classList.add("fa");var e=document.createElement("a");
e.classList.add("media");e.setAttribute("tabindex","-1");e.style.borderBottom="1px dotted #ccc";e.style.paddingBottom="15px";e.setAttribute("href","#");b.level===N_LEVEL_INFO_NAME?(c.classList.add("noti-success"),c.classList.add("fa-check")):b.level===N_LEVEL_WARN_NAME?(c.classList.add("noti-warning"),c.classList.add("fa-envelope")):b.level===N_LEVEL_ERROR_NAME&&(c.classList.add("noti-danger"),c.classList.add("fa-warning"));g.appendChild(c);c=document.createElement("div");c.classList.add("middle");
var f=document.createElement("h5");f.classList.add("media-heading");f.style.fontWeight="bold";f.style.fontSize="13px";f.appendChild(document.createTextNode(b.message));var h=document.createElement("p");h.classList.add("m-0");var k=document.createElement("span");k.classList.add("small");k.style.color="#f1ab28";k.style.fontStyle="italic";b=moment(b.createdOn,"YYYY-MM-DDTHH:mm:ssZ").fromNow();b=document.createTextNode(b);k.appendChild(b);h.appendChild(k);c.appendChild(f);c.appendChild(h);f=document.createElement("button");
f.classList.add("close");f.classList.add("removeNotification");f.style.marginTop="-29px";h=document.createElement("span");f.appendChild(h);e.appendChild(g);e.appendChild(c);d.appendChild(e);$("#notif").append(f);a.append(d)}
function setNotificationCount(a){notificationCount=a;showNotiCount(a);var b=a>=$inboxMsgMaxCount?$inboxMsgMaxCount+"+":a;$("#notificationBadge").text(b);1==a?$notificationHeader.text($.i18n._("notificationEndOne",a)):$notificationHeader.text($.i18n._("notificationEndMultiple",b))}function showNotiCount(a){0<a?$(".pv-head-noti-icon").append('<span id="notificationBadge"  class="badge badge-xs badge-pink noSelect"></span>'):$(".pv-head-noti-icon #notificationBadge").remove()};